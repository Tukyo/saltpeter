{"version":3,"file":"app.js","mappings":"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","sources":["webpack://saltpeter/./src/client/upgrades/unique/ sync ^\\.\\/.*\\/.*$","webpack://saltpeter/./src/client/upgrades/unique/spatialtargeting/spatialtargeting.ts","webpack://saltpeter/./src/client/upgrades/unique/phoenixmodule/phoenixmodule.ts","webpack://saltpeter/./src/client/upgrades/resource/ sync ^\\.\\/.*\\/.*$","webpack://saltpeter/./src/client/Types.ts","webpack://saltpeter/./src/client/upgrades/stats/hemoglobinsaturator/hemoglobinsaturator.ts","webpack://saltpeter/./src/client/upgrades/stats/locomotionmodule/locomotionmodule.ts","webpack://saltpeter/./src/client/upgrades/unique/clustermodule/clustermodule.ts","webpack://saltpeter/./src/client/upgrades/unique/muzzlesplitter/muzzlesplitter.ts","webpack://saltpeter/./src/client/upgrades/unique/spectralimage/spectralimage.ts","webpack://saltpeter/./src/client/upgrades/stats/bioregulator/bioregulator.ts","webpack://saltpeter/./src/client/upgrades/stats/damagebuffer/damagebuffer.ts","webpack://saltpeter/./src/client/upgrades/equipment/switch/switch.ts","webpack://saltpeter/./src/client/upgrades/unique/kineticbrain/kineticbrain.ts","webpack://saltpeter/./src/client/upgrades/resource/carepackage/carepackage.ts","webpack://saltpeter/./src/client/upgrades/unique/projectilearray/projectilearray.ts","webpack://saltpeter/./src/client/upgrades/stats/ sync ^\\.\\/.*\\/.*$","webpack://saltpeter/./src/client/upgrades/equipment/ sync ^\\.\\/.*\\/.*$","webpack://saltpeter/webpack/bootstrap","webpack://saltpeter/webpack/runtime/define property getters","webpack://saltpeter/webpack/runtime/hasOwnProperty shorthand","webpack://saltpeter/webpack/runtime/make namespace object","webpack://saltpeter/./src/client/Config.ts","webpack://saltpeter/./src/client/Admin.ts","webpack://saltpeter/./src/client/Animator.ts","webpack://saltpeter/./src/client/AudioPool.ts","webpack://saltpeter/./src/client/AudioManager.ts","webpack://saltpeter/./src/client/CacheManager.ts","webpack://saltpeter/./src/client/CharacterConfig.ts","webpack://saltpeter/./src/client/CharacterManager.ts","webpack://saltpeter/./src/client/ChatManager.ts","webpack://saltpeter/./src/client/ControlsManager.ts","webpack://saltpeter/./src/client/CollisionsManager.ts","webpack://saltpeter/./src/client/DecalsConfig.ts","webpack://saltpeter/./src/client/DecalsManager.ts","webpack://saltpeter/./src/client/EventsManager.ts","webpack://saltpeter/./src/client/GameState.ts","webpack://saltpeter/./src/client/LobbyManager.ts","webpack://saltpeter/./src/client/ParticlesConfig.ts","webpack://saltpeter/./src/client/ParticlesManager.ts","webpack://saltpeter/./src/client/RenderingManager.ts","webpack://saltpeter/./src/client/RoomController.ts","webpack://saltpeter/./src/client/RoomManager.ts","webpack://saltpeter/./src/client/SettingsManager.ts","webpack://saltpeter/./src/client/upgrades/equipment/index.ts","webpack://saltpeter/./src/client/upgrades/index.ts","webpack://saltpeter/./src/client/upgrades/resource/index.ts","webpack://saltpeter/./src/client/upgrades/stats/index.ts","webpack://saltpeter/./src/client/upgrades/unique/index.ts","webpack://saltpeter/./src/client/UpgradeManager.ts","webpack://saltpeter/./src/client/player/AmmoReservesUIController.ts","webpack://saltpeter/./src/client/UserInterface.ts","webpack://saltpeter/./src/client/Utility.ts","webpack://saltpeter/./src/client/WebsocketManager.ts","webpack://saltpeter/./src/client/player/CombatController.ts","webpack://saltpeter/./src/client/player/DashController.ts","webpack://saltpeter/./src/client/player/LuckController.ts","webpack://saltpeter/./src/client/player/MoveController.ts","webpack://saltpeter/./src/client/ObjectsManager.ts","webpack://saltpeter/./src/client/player/PlayerController.ts","webpack://saltpeter/./src/client/player/PlayerState.ts","webpack://saltpeter/./src/client/player/StaminaController.ts","webpack://saltpeter/./src/client/player/PlayerConfig.ts","webpack://saltpeter/./src/client/AudioConfig.ts","webpack://saltpeter/./src/client/Camera.ts","webpack://saltpeter/./src/client/world/WorldChunk.ts","webpack://saltpeter/./src/client/world/WorldConfig.ts","webpack://saltpeter/./src/client/world/WorldDebug.ts","webpack://saltpeter/./src/client/world/WorldEdit.ts","webpack://saltpeter/./src/client/world/World.ts","webpack://saltpeter/./src/client/client.ts"],"sourcesContent":["var map = {\n\t\"./clustermodule/clustermodule\": 224,\n\t\"./clustermodule/clustermodule.ts\": 224,\n\t\"./kineticbrain/kineticbrain\": 748,\n\t\"./kineticbrain/kineticbrain.ts\": 748,\n\t\"./muzzlesplitter/muzzlesplitter\": 358,\n\t\"./muzzlesplitter/muzzlesplitter.ts\": 358,\n\t\"./phoenixmodule/phoenixmodule\": 96,\n\t\"./phoenixmodule/phoenixmodule.ts\": 96,\n\t\"./projectilearray/projectilearray\": 800,\n\t\"./projectilearray/projectilearray.ts\": 800,\n\t\"./spatialtargeting/spatialtargeting\": 88,\n\t\"./spatialtargeting/spatialtargeting.ts\": 88,\n\t\"./spectralimage/spectralimage\": 368,\n\t\"./spectralimage/spectralimage.ts\": 368\n};\n\n\nfunction webpackContext(req) {\n\tvar id = webpackContextResolve(req);\n\treturn __webpack_require__(id);\n}\nfunction webpackContextResolve(req) {\n\tif(!__webpack_require__.o(map, req)) {\n\t\tvar e = new Error(\"Cannot find module '\" + req + \"'\");\n\t\te.code = 'MODULE_NOT_FOUND';\n\t\tthrow e;\n\t}\n\treturn map[req];\n}\nwebpackContext.keys = function webpackContextKeys() {\n\treturn Object.keys(map);\n};\nwebpackContext.resolve = webpackContextResolve;\nmodule.exports = webpackContext;\nwebpackContext.id = 65;","import { Upgrade, UpgradeType, UpgradeRarity, Player, UpgradeParams } from '../../../Types';\r\n\r\n// Allows player's rotation to slightly influence projectile direction.\r\n\r\nexport function create(params: UpgradeParams): Upgrade {\r\n    return {\r\n        id: \"spatial_targeting\",\r\n        name: \"Spatial Targeting\",\r\n        subtitle: \"Projectile upgrade that syncs its spatial awareness with the user.\",\r\n        icon: \"/assets/img/icon/upgrades/unique/spatialtargeting.png\",\r\n        type: UpgradeType.UNIQUE,\r\n        rarity: UpgradeRarity.SUPERIOR,\r\n        unique: true,\r\n        func: (player: Player) => {\r\n            if (!player.unique.includes('spatial_targeting')) {\r\n                player.unique.push('spatial_targeting');\r\n            }\r\n        }\r\n    };\r\n}","import { Upgrade, UpgradeType, UpgradeRarity, Player, UpgradeParams } from '../../../Types';\r\n\r\n// Luck based * 1.5, on death chance to trigger.\r\n// One-time use, double damage received permanently on trigger.\r\n\r\nexport function create(params: UpgradeParams): Upgrade {\r\n    return {\r\n        id: \"phoenix_module\",\r\n        name: \"Phoenix Module\",\r\n        subtitle: \"Return from the flames with vengeance.\",\r\n        icon: \"/assets/img/icon/upgrades/unique/phoenixmodule.png\",\r\n        type: UpgradeType.UNIQUE,\r\n        rarity: UpgradeRarity.LEGENDARY,\r\n        unique: true,\r\n        func: (player: Player) => {\r\n            if (!player.unique.includes('phoenix_module')) {\r\n                player.unique.push('phoenix_module');\r\n            }\r\n        }\r\n    };\r\n}","var map = {\n\t\"./carepackage/carepackage\": 751,\n\t\"./carepackage/carepackage.ts\": 751\n};\n\n\nfunction webpackContext(req) {\n\tvar id = webpackContextResolve(req);\n\treturn __webpack_require__(id);\n}\nfunction webpackContextResolve(req) {\n\tif(!__webpack_require__.o(map, req)) {\n\t\tvar e = new Error(\"Cannot find module '\" + req + \"'\");\n\t\te.code = 'MODULE_NOT_FOUND';\n\t\tthrow e;\n\t}\n\treturn map[req];\n}\nwebpackContext.keys = function webpackContextKeys() {\n\treturn Object.keys(map);\n};\nwebpackContext.resolve = webpackContextResolve;\nmodule.exports = webpackContext;\nwebpackContext.id = 136;","import { LobbyManager } from \"./LobbyManager\";\r\nimport { UserInterface } from \"./UserInterface\";\r\nimport { Utility } from \"./Utility\";\r\n\r\nimport { PlayerState } from \"./player/PlayerState\";\r\n\r\n// #region [ Core ]\r\n//\r\n/**\r\n * Represents a 2D vector with x and y coordinates.\r\n */\r\nexport type Vec2 = { x: number, y: number }\r\n\r\n/**\r\n * Represents an object's position and rotation in 2D space.\r\n */\r\nexport type Transform = {\r\n  pos: Vec2;\r\n  rot: number;\r\n}\r\n\r\n/**\r\n * Represents a directional relationship between two points in 2D space.\r\n */\r\nexport type Direction = { rootPos: Vec2; targetPos: Vec2; };\r\n\r\nexport enum NoiseType {\r\n  Perlin = \"perlin\",\r\n  Worley = \"worley\",\r\n  Voronoi = \"voronoi\",\r\n  Ridged = \"ridged\"\r\n}\r\n//\r\n// #endregion\r\n\r\n// #region [ Game Object ]\r\n/**\r\n * Base interface for all game world entities.\r\n * Includes a unique ID, transform data, and a timestamp for synchronization.\r\n */\r\nexport interface GameObject {\r\n  id: string;\r\n  transform: Transform;\r\n  timestamp: number;\r\n}\r\n\r\n/**\r\n * All gameobject types.\r\n */\r\nexport type GameObjects = 'AmmoBox' | 'Player' | 'Projectile';\r\n\r\n/**\r\n * Mapping definition for stored player objects.\r\n */\r\nexport type Players = Map<string, Player>;\r\n\r\n/**\r\n * Full representation of the player object. Extends GameObject.\r\n */\r\nexport interface Player extends GameObject {\r\n  actions: {\r\n    dash: {\r\n      drain: number;\r\n      cooldown: number;\r\n      multiplier: number;\r\n      time: number;\r\n    }\r\n    melee: {\r\n      cooldown: number;\r\n      damage: number;\r\n      duration: number;\r\n      range: number;\r\n      size: number;\r\n    }\r\n    primary: {\r\n      buffer: number;\r\n      burst: {\r\n        amount: number;\r\n        delay: number;\r\n      }\r\n      magazine: {\r\n        currentAmmo: number;\r\n        currentReserve: number;\r\n        maxReserve: number;\r\n        size: number;\r\n      }\r\n      offset: number;\r\n      projectile: {\r\n        amount: number;\r\n        color: string;\r\n        damage: number;\r\n        length: number;\r\n        range: number;\r\n        size: number;\r\n        speed: number;\r\n        spread: number;\r\n      }\r\n      reload: { time: number; }\r\n    }\r\n    sprint: {\r\n      drain: number;\r\n      multiplier: number;\r\n    }\r\n  }\r\n  color: string;\r\n  equipment: string[],\r\n  flags: {\r\n    hidden: boolean;\r\n    invulnerable: boolean;\r\n  }\r\n  inventory: {\r\n    primary: string;\r\n    melee: string;\r\n  }\r\n  physics: {\r\n    acceleration: number;\r\n    friction: number;\r\n  }\r\n  rig: {\r\n    body: string;\r\n    head: string;\r\n    headwear: string;\r\n    weapon: string;\r\n  }\r\n  stats: {\r\n    defense: number;\r\n    health: {\r\n      max: number;\r\n      value: number;\r\n    }\r\n    luck: number;\r\n    size: number;\r\n    speed: number;\r\n    stamina: {\r\n      max: number;\r\n      recovery: {\r\n        delay: number;\r\n        rate: number;\r\n      }\r\n      value: number;\r\n    }\r\n  }\r\n  unique: string[];\r\n}\r\n\r\nexport interface Projectile extends GameObject {\r\n  color: string;\r\n  damage: number;\r\n  distanceTraveled: number;\r\n  length: number;\r\n  ownerId: string;\r\n  range: number;\r\n  size: number;\r\n  velocity: Vec2;\r\n}\r\n\r\nexport type ProjectileOverrides = {\r\n  canTriggerUnique?: boolean;\r\n  bypassDefault?: boolean;\r\n  color?: string;\r\n  damage?: number;\r\n  length?: number;\r\n  range?: number;\r\n  size?: number;\r\n  speed?: number;\r\n  spread?: number;\r\n  amount?: number;\r\n};\r\n\r\nexport interface AmmoBox extends GameObject {\r\n  ammoAmount: number;\r\n  isOpen: boolean;\r\n  lid: {\r\n    pos: Vec2;\r\n    rot: number;\r\n    velocity: Vec2;\r\n    torque: number;\r\n  };\r\n}\r\n\r\nexport interface SpawnObjectParams {\r\n  transform: Transform;\r\n  type: GameObjects;\r\n  data?: any;\r\n}\r\n//\r\n// #endregion\r\n\r\n// #region [ Animation ]\r\n//\r\nexport interface PlayerPartAnimParams {\r\n  playerId: string;\r\n  part: string;\r\n  frames: { [key: number]: { x: number, y: number } };\r\n  duration: number;\r\n  partIndex?: number;\r\n}\r\n\r\nexport type TextAnimParams = {\r\n  element: HTMLElement;\r\n  oldValue: number;\r\n  newValue: number;\r\n  decimals: number;\r\n  animTime: number;\r\n  steps: number;\r\n  color: string;\r\n  timeout: number;\r\n}\r\n//\r\n// #endregion\r\n\r\n// #region [ Audio ]\r\n//\r\nexport interface AudioParams {\r\n  delay?: {\r\n    min: number;\r\n    max: number;\r\n  }\r\n  listener: Vec2;\r\n  loop?: boolean;\r\n  output?: string;\r\n  priority?: number;\r\n  pitch?: {\r\n    min: number;\r\n    max: number;\r\n  };\r\n  spatial?: {\r\n    blend?: number;\r\n    pos?: Vec2;\r\n    rolloff?: {\r\n      distance: number;\r\n      factor: number;\r\n      type?: 'linear' | 'logarithmic';\r\n    }\r\n  }\r\n  src: string;\r\n  volume?: {\r\n    min: number;\r\n    max: number;\r\n  };\r\n}\r\n//\r\n// #endregion\r\n\r\n// #region [ Lobby & Room ]\r\n//\r\nexport type ResetType = 'Room' | 'Lobby'\r\n\r\nexport interface RoomMessage {\r\n  type: 'join-room' | 'create-room' | 'leave-room' | 'room-message' | 'room-created' | 'room-joined' | 'room-joined-game' | 'room-error' | 'user-joined' | 'user-left';\r\n  roomId?: string;\r\n  userId: string;\r\n  message?: string;\r\n  data?: any;\r\n  gameActive?: boolean;\r\n}\r\n\r\nexport interface LobbyPlayer {\r\n  id: string;\r\n  color: string;\r\n  isHost: boolean;\r\n  rig: {\r\n    body: string;\r\n    head: string;\r\n    headwear: string;\r\n    weapon: string;\r\n  }\r\n  transform: Transform;\r\n}\r\n\r\nexport type LobbyControlsParams = {\r\n  lobby: LobbyManager;\r\n  lobbyOptions: LobbyOptionsParams;\r\n  myPlayer: Player;\r\n  roomId: string;\r\n  userId: string;\r\n}\r\n\r\nexport type LobbyOptionsParams = {\r\n  maxPlayers: number;\r\n  maxWins: number;\r\n  isHost: boolean;\r\n  privateRoom: boolean;\r\n  upgradesEnabled: boolean;\r\n}\r\n\r\nexport type ChatMessage = {\r\n  senderId: string;\r\n  message: string;\r\n  isOwn?: boolean;\r\n};\r\n//\r\n// #endregion\r\n\r\n// #region [ Settings ]\r\n//\r\nexport interface GameSettings {\r\n  audio: {\r\n    mixer: {\r\n      master: number;\r\n      interface: number;\r\n      music: number;\r\n      sfx: number;\r\n      voice: number;\r\n    }\r\n  }\r\n  controls: {\r\n    keybinds: {\r\n      attack: string;\r\n      dash: string;\r\n      melee: string;\r\n      moveDown: string;\r\n      moveLeft: string;\r\n      moveRight: string;\r\n      moveUp: string;\r\n      reload: string;\r\n      sprint: string;\r\n    },\r\n    gamepad: {\r\n      attack: number;\r\n      dash: number;\r\n      deadzone: number;\r\n      melee: number;\r\n      reload: number;\r\n      sprint: number;\r\n    }\r\n  }\r\n  graphics: {\r\n    physics: {\r\n      ammoReserves: boolean;\r\n    }\r\n    renderBackgroundParticles: boolean;\r\n    showStaticOverlay: boolean;\r\n  }\r\n}\r\n//\r\n// #endregion\r\n\r\n// #region [ Params ]\r\n//\r\nexport type RandomColorParams = {\r\n  format: 'hex' | 'rgb';\r\n  mode: 'any' | 'primary' | 'pastel' | 'vibrant' | 'dark' | 'light' | 'grayscale';\r\n\r\n}\r\n\r\nexport type SetInputParams = {\r\n  inputId: string;\r\n  value: number;\r\n}\r\n\r\nexport type SetSliderParams = {\r\n  sliderId: string;\r\n  targetValue: number;\r\n  maxValue: number;\r\n  lerpTime?: number;\r\n}\r\n\r\nexport type SetSpanParams = {\r\n  spanId: string;\r\n  value: string | number;\r\n}\r\n\r\nexport type SetToggleParams = {\r\n  toggleId: string;\r\n  value: boolean;\r\n}\r\n\r\nexport type PlayerHitParams = {\r\n  target: Player;\r\n  shooterId: string;\r\n  damage: number;\r\n  newHealth: number;\r\n  source: Projectile | ShrapnelPiece;\r\n  wasKill: boolean;\r\n}\r\n//\r\n// #endregion\r\n\r\n// #region [ Leaderboard ]\r\n//\r\nexport interface LeaderboardEntry {\r\n  playerId: string;\r\n  kills: number;\r\n  deaths: number;\r\n  wins: number;\r\n}\r\n\r\nexport type Leaderboard = Map<string, LeaderboardEntry>;\r\n//\r\n// #endregion\r\n\r\n// #region [ Combat ]\r\n//\r\nexport type AttackType = 'melee' | 'ranged';\r\n//\r\n// #endregion\r\n\r\n// #region [ Visual ]\r\n//\r\nexport type CreateParticleParams = {\r\n  id: string;\r\n  pos: Vec2;\r\n  particleParams: ParticleParams;\r\n  direction?: Vec2;\r\n}\r\n\r\nexport type ParticleParams = {\r\n  count: {\r\n    min: number;\r\n    max: number;\r\n  };\r\n  lifetime: {\r\n    min: number;\r\n    max: number;\r\n  };\r\n  noise: {\r\n    strength: {\r\n      min: number;\r\n      max: number;\r\n    };\r\n    scale: {\r\n      min: number;\r\n      max: number;\r\n    };\r\n  };\r\n  opacity: {\r\n    min: number;\r\n    max: number;\r\n  };\r\n  speed: {\r\n    min: number;\r\n    max: number;\r\n  };\r\n  sizeOverLifetime: {\r\n    min: number;\r\n    max: number;\r\n  };\r\n  size: {\r\n    min: number;\r\n    max: number;\r\n  };\r\n  torque: {\r\n    min: number;\r\n    max: number;\r\n  };\r\n  collide: boolean;\r\n  fade: boolean;\r\n  paint: boolean;\r\n  spread: number;\r\n  stain: boolean;\r\n  colors: string[];\r\n};\r\n\r\nexport type Particle = {\r\n  age: number;\r\n  collide: boolean;\r\n  color: string;\r\n  fade: boolean;\r\n  hasCollided: boolean;\r\n  id: string;\r\n  initialSize: number;\r\n  lifetime: number;\r\n  maxOpacity: number;\r\n  noiseStrength: number;\r\n  noiseScale: number;\r\n  opacity: number;\r\n  paint: boolean;\r\n  pos: Vec2;\r\n  rotation: number;\r\n  size: number;\r\n  sizeOverLifetime: number;\r\n  stain: boolean;\r\n  torque: number;\r\n  velocity: Vec2\r\n}\r\n\r\nexport type EmitterParams = {\r\n  type?: string;\r\n  id: string;\r\n  interval: number;\r\n  lifetime: number;\r\n  offset: Vec2;\r\n  playerId: string;\r\n  pos: Vec2;\r\n  particleType: ParticleParams;\r\n}\r\n\r\nexport type Emitter = {\r\n  age: number;\r\n  direction: number;\r\n  emissionInterval: number;\r\n  lastEmission: number;\r\n  lifetime: number;\r\n  offset: Vec2;\r\n  playerId: string;\r\n  particleType: ParticleParams;\r\n}\r\n\r\nexport type Decal = {\r\n  params: DecalParams | null;\r\n  pos: Vec2;\r\n};\r\n\r\nexport type DecalParams = {\r\n  id: string;\r\n  pos: Vec2;\r\n  type: 'parametric' | 'image';\r\n  parametric?: ParametricDecalParams;\r\n  image?: ImageDecalParams;\r\n};\r\n\r\nexport type ParametricDecalParams = {\r\n  radius: {\r\n    min: number;\r\n    max: number;\r\n  };\r\n  density: {\r\n    min: number;\r\n    max: number;\r\n  };\r\n  opacity: {\r\n    min: number;\r\n    max: number;\r\n  };\r\n  variation: number;\r\n  colors: string[];\r\n};\r\n\r\nexport type ImageDecalParams = {\r\n  src: string;\r\n  scale: number;\r\n  rotation: number;\r\n};\r\n\r\nexport type Shrapnel = {\r\n  amount: number;\r\n  damage: number;\r\n  images: string[];\r\n  lifetime: { min: number, max: number };\r\n  pos: Vec2;\r\n  size: { min: number, max: number };\r\n  speed: { min: number, max: number };\r\n  torque: { min: number, max: number };\r\n}\r\n\r\nexport type ShrapnelPiece = {\r\n  id: string;\r\n  image: string;\r\n  transform: Transform;\r\n  velocity: Vec2;\r\n  rotationSpeed: number;\r\n  size: number;\r\n  age: number;\r\n  lifetime: number;\r\n  ownerId: string;\r\n  damage: number;\r\n}\r\n\r\nexport type DeathDecal = { // TODO: Somehow pass the pool based on current charConfig\r\n  gore: {\r\n    amount: number;\r\n    // pool: string;\r\n  }\r\n  blood: {\r\n    amount: number;\r\n    // pool: string;\r\n  }\r\n  ownerId: string;\r\n  pos: Vec2;\r\n  radius: number;\r\n}\r\n\r\nexport type DeathStamp = {\r\n  transform: Transform;\r\n  type: string;\r\n  scale: number;\r\n  src: string;\r\n}\r\n\r\nexport type ReserveBulletParticle = {\r\n  transform: Transform;\r\n  velocity: Vec2;\r\n  torque: number;\r\n  width: number;\r\n  height: number;\r\n}\r\n\r\nexport type RenderCharacterParams = {\r\n  player: Player | LobbyPlayer;\r\n  context: CanvasRenderingContext2D;\r\n}\r\n\r\nexport type CharacterAnimation = Map<string, {\r\n  playerId: string;\r\n  part: string;\r\n  partIndex?: number;\r\n  frames: { [key: number]: { x: number, y: number } };\r\n  duration: number;\r\n  startTime: number;\r\n  originalOffset: { x: number, y: number };\r\n}>\r\n\r\nexport type CharacterLayer = 'body' | 'weapon' | 'head' | 'headwear' | 'upgrades';\r\n//\r\n// #endregion\r\n\r\n// #region [ Upgrades ]\r\n//\r\nexport enum UpgradeRarity {\r\n  COMMON = 0,\r\n  UNCOMMON = 1,\r\n  SPECIAL = 2,\r\n  SUPERIOR = 3,\r\n  RARE = 4,\r\n  EXCEPTIONAL = 5,\r\n  LEGENDARY = 6,\r\n  MYTHICAL = 7,\r\n  ENLIGHTENED = 8,\r\n  HOLY = 9\r\n}\r\n\r\nexport enum UpgradeType {\r\n  EQUIPMENT = 'equipment',\r\n  RESOURCE = 'resource',\r\n  STAT = 'stat',\r\n  UNIQUE = 'unique',\r\n}\r\n\r\nexport interface Upgrade {\r\n  id: string;\r\n  icon: string;\r\n  name: string;\r\n  rarity: UpgradeRarity;\r\n  subtitle: string;\r\n  type: UpgradeType;\r\n  unique: boolean;\r\n  func: (player: Player) => void;\r\n}\r\n\r\nexport type UpgradeParams = {\r\n  playerState: PlayerState;\r\n  ui: UserInterface;\r\n  utility: Utility;\r\n}\r\n//\r\n// #endregion\r\n\r\n// #region [ World ]\r\n//\r\nexport type WorldData = {\r\n  params: WorldParams;\r\n  seed: number;\r\n}\r\n\r\nexport type WorldParams = {\r\n  general: {\r\n    chunk: { size: number };\r\n    cell: { size: number };\r\n    options: { island: boolean; valley: boolean; }\r\n    seed: number;\r\n  }\r\n  terrain: {\r\n    noiseType: NoiseType;\r\n    intensity: number;\r\n    octaves: number;\r\n    scale: number;\r\n    persistence: number;\r\n    heightCurve: number;\r\n    seaLevel: number;\r\n    lowestDepth: number;\r\n  }\r\n  material: {\r\n    noiseType: NoiseType;\r\n    scale: number;\r\n    detail: {\r\n      noiseType: NoiseType;\r\n      scale: number;\r\n    }\r\n    colorVariation: number;\r\n  }\r\n  degen: {\r\n    noiseType: NoiseType;\r\n    scale: number;\r\n    intensity: number;\r\n    minHeight: number;\r\n    threshold: number;\r\n    hardness: number;\r\n    detail: {\r\n      noiseType: NoiseType;\r\n      scale: number;\r\n    }\r\n  }\r\n  hydration: {\r\n    noiseType: NoiseType;\r\n    intensity: number;\r\n    scale: number;\r\n    multiplier: number;\r\n  }\r\n  render: {\r\n    water: {\r\n      opacityBase: number;\r\n      opacityMultiplier: number;\r\n      foamIntensity: number;\r\n      foamScale: number;\r\n      noiseScale: number;\r\n      shoreBlend: number;\r\n      shimmerStrength: number;\r\n      depthDarkness: number;\r\n    }\r\n    grid: {\r\n      enabled: boolean;\r\n      lineWidth: number;\r\n      chunkBorderColor: string;\r\n      worldBorderColor: string;\r\n      layerBorderColor: string;\r\n      borderWidth: number;\r\n    }\r\n  }\r\n}\r\n\r\nexport interface WorldLayer extends MaterialLayer {\r\n  height: number;\r\n}\r\n\r\nexport interface NetworkChunk {\r\n  pos: Vec2;\r\n  version: number;\r\n  size: number;\r\n  cellData: CellData;\r\n  layer: string;\r\n}\r\n\r\nexport type CellData = {\r\n  worldPixelData: Uint8Array;\r\n  worldHeightData: Uint8Array;\r\n  worldWaterData?: Uint8Array;\r\n  cellLayerGrid?: number[][];\r\n}\r\n\r\nexport type PixelData = {\r\n  layer: WorldLayer\r\n  material: Material;\r\n  materialColorIndex: number;\r\n}\r\n\r\nexport type PixelWaterData = {\r\n  hasWater: boolean;\r\n  waterLevel: number;\r\n  depth: number;\r\n  material: Material;\r\n}\r\n\r\nexport type Material = {\r\n  name: string;\r\n  type: 'terrain' | 'mineral' | 'surface' | 'liquid';\r\n  colors: string[];\r\n  physics: Liquid | Solid | Gas;\r\n}\r\n\r\nexport interface MaterialLayer {\r\n  name: string;\r\n  materials: {\r\n    material: string;\r\n    weight: number;\r\n    blend: number;\r\n  }[];\r\n}\r\n\r\nexport enum PhysicsMaterialTypes { Liquid, Solid, Gas }\r\n\r\ninterface PhysicsMaterial {\r\n  type: PhysicsMaterialTypes;\r\n  simulate: boolean;\r\n}\r\n\r\ninterface Liquid extends PhysicsMaterial {\r\n  type: PhysicsMaterialTypes.Liquid;\r\n  viscosity: number; // how fast it flows / spreads\r\n}\r\n\r\ninterface Solid extends PhysicsMaterial {\r\n  type: PhysicsMaterialTypes.Solid;\r\n  durability: number;\r\n  friction: number;\r\n  density: number;\r\n}\r\n\r\ninterface Gas extends PhysicsMaterial {\r\n  type: PhysicsMaterialTypes.Gas;\r\n}\r\n\r\n//\r\n// #endregion","import { Upgrade, UpgradeType, UpgradeRarity, Player, UpgradeParams } from '../../../Types';\r\n\r\n// Increases the player's max health.\r\n\r\nexport function create(params: UpgradeParams): Upgrade {\r\n    return {\r\n        id: \"hemoglobin_saturator\",\r\n        name: \"Hemoglobin Saturator\",\r\n        subtitle: \"Increases red blood cell density for extended durability.\",\r\n        icon: \"/assets/img/icon/upgrades/stats/hemoglobinsaturator.png\",\r\n        type: UpgradeType.STAT,\r\n        rarity: UpgradeRarity.UNCOMMON,\r\n        unique: false,\r\n        func: (player: Player) => {\r\n            params.playerState.updateStat('stats.health.max', player.stats.health.max + 10);\r\n            params.playerState.updateStat('stats.health.value', player.stats.health.max); // Heal to new max\r\n        }\r\n    };\r\n}","import { Upgrade, UpgradeType, UpgradeRarity, Player, UpgradeParams } from '../../../Types';\r\n\r\n// Increases speed but also increases dash cooldown.\r\n\r\nexport function create(params: UpgradeParams): Upgrade {\r\n    return {\r\n        id: \"locomotion_module\",\r\n        name: \"Locomotion Module\",\r\n        subtitle: \"Primitave locomotion module installed on the user's footwear.\",\r\n        icon: \"/assets/img/icon/upgrades/stats/locomotionmodule.png\",\r\n        type: UpgradeType.STAT,\r\n        rarity: UpgradeRarity.COMMON,\r\n        unique: false,\r\n        func: (player: Player) => {\r\n            params.playerState.updateStat('stats.speed', player.stats.speed + 1);\r\n            params.playerState.updateStat('actions.dash.cooldown', player.actions.dash.cooldown * 1.5);\r\n        }\r\n    };\r\n}","import { Upgrade, UpgradeType, UpgradeRarity, Player, UpgradeParams } from '../../../Types';\r\n\r\n// Luck based, causes projectiles to sometimes break into shrapnel on impact.\r\n// Varying amounts of pieces can spawn, and shrapnel does 1 damage to any enemy hit.\r\n\r\nexport function create(params: UpgradeParams): Upgrade {\r\n    return {\r\n        id: \"cluster_module\",\r\n        name: \"Cluster Module\",\r\n        subtitle: \"Cluster enhancement module for primary attacks.\",\r\n        icon: \"/assets/img/icon/upgrades/unique/clustermodule.png\",\r\n        type: UpgradeType.UNIQUE,\r\n        rarity: UpgradeRarity.RARE,\r\n        unique: true,\r\n        func: (player: Player) => {\r\n            if (!player.unique.includes('cluster_module')) {\r\n                player.unique.push('cluster_module');\r\n            }\r\n        }\r\n    };\r\n}","import { Upgrade, UpgradeType, UpgradeRarity, Player, UpgradeParams } from '../../../Types';\r\n\r\n// Luck based, can replace standard shot with split shot.\r\n\r\nexport function create(params: UpgradeParams): Upgrade {\r\n    return {\r\n        id: \"muzzle_splitter\",\r\n        name: \"Muzzle Splitter\",\r\n        subtitle: \"Muzzle modification for primary attacks, requires certain skillset.\",\r\n        icon: \"/assets/img/icon/upgrades/unique/muzzlesplitter.png\",\r\n        type: UpgradeType.UNIQUE,\r\n        rarity: UpgradeRarity.SPECIAL,\r\n        unique: true,\r\n        func: (player: Player) => {\r\n            if (!player.unique.includes('muzzle_splitter')) {\r\n                player.unique.push('muzzle_splitter');\r\n            }\r\n        }\r\n    };\r\n}","import { Upgrade, UpgradeType, UpgradeRarity, Player, UpgradeParams } from '../../../Types';\r\n\r\n// Dash replaced with spectral teleport, and increased range. No collisions when dashing.\r\n\r\nexport function create(params: UpgradeParams): Upgrade {\r\n    return {\r\n        id: \"spectral_image\",\r\n        name: \"Spectral Image\",\r\n        subtitle: \"Forward imaging coordinate transponder.\",\r\n        icon: \"/assets/img/icon/upgrades/unique/spectralimage.png\",\r\n        type: UpgradeType.UNIQUE,\r\n        rarity: UpgradeRarity.EXCEPTIONAL,\r\n        unique: true,\r\n        func: (player: Player) => {\r\n            if (!player.unique.includes('spectral_image')) {\r\n                player.unique.push('spectral_image');\r\n                params.playerState.updateStat('actions.dash.time', player.actions.dash.time + 50);\r\n            }\r\n        }\r\n    };\r\n}","import { Upgrade, UpgradeType, UpgradeRarity, Player, UpgradeParams } from '../../../Types';\r\n\r\n// Increases stamina, and stamina recovery, but increases regen delay after using.\r\n\r\nexport function create(params: UpgradeParams): Upgrade {\r\n    return {\r\n        id: \"bioregulator\",\r\n        name: \"Bioregulator\",\r\n        subtitle: \"Increases energy regulation efficiency, with a small boot overhead.\",\r\n        icon: \"/assets/img/icon/upgrades/stats/bioregulator.png\",\r\n        type: UpgradeType.STAT,\r\n        rarity: UpgradeRarity.COMMON,\r\n        unique: false,\r\n        func: (player: Player) => {\r\n            params.playerState.updateStat('stats.stamina.max', player.stats.stamina.max * 1.1);\r\n            params.playerState.updateStat('stats.stamina.recovery.rate', player.stats.stamina.recovery.rate + 1);\r\n            params.playerState.updateStat('stats.stamina.recovery.delay', player.stats.stamina.recovery.delay * 1.25);\r\n        }\r\n    };\r\n}","import { Upgrade, UpgradeType, UpgradeRarity, Player, UpgradeParams } from '../../../Types';\r\n\r\n// Increases damage and shot buffer by 10%.\r\n// Bullets hit harder, but can be shot less often each time this is taken. \r\n\r\nexport function create(params: UpgradeParams): Upgrade {\r\n    return {\r\n        id: \"damage_buffer\",\r\n        name: \"Damage Buffer\",\r\n        subtitle: \"Type D125 buffer, which improves damage at a small cost. \",\r\n        icon: \"/assets/img/icon/upgrades/stats/damagebuffer.png\",\r\n        type: UpgradeType.STAT,\r\n        rarity: UpgradeRarity.UNCOMMON,\r\n        unique: false,\r\n        func: (player: Player) => {\r\n            params.playerState.updateStat('actions.primary.projectile.damage', player.actions.primary.projectile.damage * 1.1);\r\n            params.playerState.updateStat('actions.primary.buffer', player.actions.primary.buffer * 1.1);\r\n        }\r\n    };\r\n}","import { Upgrade, UpgradeType, UpgradeRarity, Player, UpgradeParams } from '../../../Types';\r\n\r\n// During dash cooldown, player will be able to hold shoot to auto-fire.\r\n\r\nexport function create(params: UpgradeParams): Upgrade {\r\n    return {\r\n        id: \"switch\",\r\n        name: \"Switch\",\r\n        subtitle: \"Completely legal and completely functional.\",\r\n        icon: \"/assets/img/icon/upgrades/equipment/switch.png\",\r\n        type: UpgradeType.EQUIPMENT,\r\n        rarity: UpgradeRarity.RARE,\r\n        unique: false,\r\n        func: (player: Player) => {\r\n            if (!player.equipment.includes('switch')) {\r\n                player.equipment.push('switch');\r\n                params.playerState.updateStat('actions.primary.projectile.spread', player.actions.primary.projectile.spread *= 1.15);\r\n            }\r\n        }\r\n    };\r\n}","import { Upgrade, UpgradeType, UpgradeRarity, Player, UpgradeParams } from '../../../Types';\r\n\r\n// Luck based, creates visible aura around player.\r\n// Enemy projectiles in radius have a chance to be deflected.\r\n\r\nexport function create(params: UpgradeParams): Upgrade {\r\n    return {\r\n        id: \"kinetic_brain\",\r\n        name: \"Kinetic Brain\",\r\n        subtitle: \"Cerebral kinetic stem implant, unable to function at maximum capacity.\",\r\n        icon: \"/assets/img/icon/upgrades/unique/kineticbrain.png\",\r\n        type: UpgradeType.UNIQUE,\r\n        rarity: UpgradeRarity.EXCEPTIONAL,\r\n        unique: true,\r\n        func: (player: Player) => {\r\n            if (!player.unique.includes('kinetic_brain')) {\r\n                player.unique.push('kinetic_brain');\r\n            }\r\n        }\r\n    };\r\n}","import { Upgrade, UpgradeType, UpgradeRarity, Player, UpgradeParams } from '../../../Types';\r\n\r\n// Gives the player some ammo in their reserves.\r\n\r\nexport function create(params: UpgradeParams): Upgrade {\r\n    return {\r\n        id: \"care_package\",\r\n        name: \"Care Package\",\r\n        subtitle: \"These are hard to come by.\",\r\n        icon: \"/assets/img/icon/upgrades/resource/carepackage.png\",\r\n        type: UpgradeType.RESOURCE,\r\n        rarity: UpgradeRarity.COMMON,\r\n        unique: false,\r\n        func: (player: Player) => {\r\n            const ammo = 20;\r\n            player.actions.primary.magazine.currentReserve += ammo;\r\n            params.ui.ammoReservesUIController.spawnAmmoInReserveUI(ammo);\r\n        }\r\n    };\r\n}","import { Upgrade, UpgradeType, UpgradeRarity, Player, UpgradeParams } from '../../../Types';\r\n\r\n// Luck based, chance to add extra projectiles on shot in random direction.\r\n// Extra shots have more spread, less distance and do half damage.\r\n\r\nexport function create(params: UpgradeParams): Upgrade {\r\n    return {\r\n        id: \"projectile_array\",\r\n        name: \"Projectile Array\",\r\n        subtitle: \"Chance to fire an array of extra projectiles.\",\r\n        icon: \"/assets/img/icon/upgrades/unique/projectilearray.png\",\r\n        type: UpgradeType.UNIQUE,\r\n        rarity: UpgradeRarity.RARE,\r\n        unique: true,\r\n        func: (player: Player) => {\r\n            if (!player.unique.includes('projectile_array')) {\r\n                player.unique.push('projectile_array');\r\n            }\r\n        }\r\n    };\r\n}","var map = {\n\t\"./bioregulator/bioregulator\": 528,\n\t\"./bioregulator/bioregulator.ts\": 528,\n\t\"./damagebuffer/damagebuffer\": 612,\n\t\"./damagebuffer/damagebuffer.ts\": 612,\n\t\"./hemoglobinsaturator/hemoglobinsaturator\": 168,\n\t\"./hemoglobinsaturator/hemoglobinsaturator.ts\": 168,\n\t\"./locomotionmodule/locomotionmodule\": 204,\n\t\"./locomotionmodule/locomotionmodule.ts\": 204\n};\n\n\nfunction webpackContext(req) {\n\tvar id = webpackContextResolve(req);\n\treturn __webpack_require__(id);\n}\nfunction webpackContextResolve(req) {\n\tif(!__webpack_require__.o(map, req)) {\n\t\tvar e = new Error(\"Cannot find module '\" + req + \"'\");\n\t\te.code = 'MODULE_NOT_FOUND';\n\t\tthrow e;\n\t}\n\treturn map[req];\n}\nwebpackContext.keys = function webpackContextKeys() {\n\treturn Object.keys(map);\n};\nwebpackContext.resolve = webpackContextResolve;\nmodule.exports = webpackContext;\nwebpackContext.id = 823;","var map = {\n\t\"./switch/switch\": 617,\n\t\"./switch/switch.ts\": 617\n};\n\n\nfunction webpackContext(req) {\n\tvar id = webpackContextResolve(req);\n\treturn __webpack_require__(id);\n}\nfunction webpackContextResolve(req) {\n\tif(!__webpack_require__.o(map, req)) {\n\t\tvar e = new Error(\"Cannot find module '\" + req + \"'\");\n\t\te.code = 'MODULE_NOT_FOUND';\n\t\tthrow e;\n\t}\n\treturn map[req];\n}\nwebpackContext.keys = function webpackContextKeys() {\n\treturn Object.keys(map);\n};\nwebpackContext.resolve = webpackContextResolve;\nmodule.exports = webpackContext;\nwebpackContext.id = 854;","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tvar cachedModule = __webpack_module_cache__[moduleId];\n\tif (cachedModule !== undefined) {\n\t\treturn cachedModule.exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\t// no module.id needed\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId](module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n","// define getter functions for harmony exports\n__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))","// define __esModule on exports\n__webpack_require__.r = (exports) => {\n\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n\t}\n\tObject.defineProperty(exports, '__esModule', { value: true });\n};","export const OBJECT_DEFAULTS = {\r\n    DATA: {\r\n        ID_LENGTH: 8\r\n    },\r\n};\r\n\r\nexport const SHRAPNEL = {\r\n    PIECE: [\r\n        '/assets/img/effects/shrapnel/shrapnel_00.png',\r\n        '/assets/img/effects/shrapnel/shrapnel_01.png',\r\n        '/assets/img/effects/shrapnel/shrapnel_02.png',\r\n        '/assets/img/effects/shrapnel/shrapnel_03.png',\r\n        '/assets/img/effects/shrapnel/shrapnel_04.png',\r\n        '/assets/img/effects/shrapnel/shrapnel_05.png'\r\n    ]\r\n};\r\n\r\nexport const AMMO_BOX = {\r\n    BASE: '/assets/img/object/ammobox/base.png',\r\n    BULLETS: '/assets/img/object/ammobox/bullets.png',\r\n    LID: '/assets/img/object/ammobox/lid.png',\r\n}\r\n\r\nexport const WORLD = {\r\n    WIDTH: 3200,\r\n    HEIGHT: 2400,\r\n    BORDER_MARGIN: 15\r\n};\r\n\r\nexport const CANVAS = {\r\n    WIDTH: 800,\r\n    HEIGHT: 600\r\n};\r\n\r\nexport const GAMEPAD_MAP = {\r\n    // Face buttons\r\n    A: 0,\r\n    B: 1,\r\n    X: 2,\r\n    Y: 3,\r\n\r\n    // Bumpers\r\n    LB: 4,\r\n    RB: 5,\r\n\r\n    // Triggers\r\n    LT: 6,\r\n    RT: 7,\r\n\r\n    // System buttons\r\n    SELECT: 8,\r\n    START: 9,\r\n\r\n    // Stick clicks\r\n    L_STICK: 10,\r\n    R_STICK: 11,\r\n\r\n    // D-Pad\r\n    DPAD_UP: 12,\r\n    DPAD_DOWN: 13,\r\n    DPAD_LEFT: 14,\r\n    DPAD_RIGHT: 15,\r\n\r\n    // Home/Guide button\r\n    HOME: 16,\r\n\r\n    // Axes\r\n    AXES: {\r\n        LEFT_STICK_X: 0,\r\n        LEFT_STICK_Y: 1,\r\n        RIGHT_STICK_X: 2,\r\n        RIGHT_STICK_Y: 3\r\n    }\r\n};\r\n\r\nexport const GAME = {\r\n    CHARACTER_SIZE: 650,\r\n    CONNECTION_TIMEOUT: 1000,\r\n    CONTROLS: {\r\n        KEYBINDS: {\r\n            MELEE: 'mouse2',\r\n            MOVE_UP: 'w',\r\n            MOVE_LEFT: 'a',\r\n            MOVE_DOWN: 's',\r\n            MOVE_RIGHT: 'd',\r\n            RELOAD: 'r',\r\n            SPRINT: 'shift',\r\n            ATTACK: 'mouse1',\r\n            DASH: ' '\r\n        },\r\n        GAMEPAD: {\r\n            MELEE: GAMEPAD_MAP.RB,\r\n            DASH: GAMEPAD_MAP.LB,\r\n            DEADZONE: 0.2,\r\n            RELOAD: GAMEPAD_MAP.A,\r\n            SPRINT: GAMEPAD_MAP.LT,\r\n            ATTACK: GAMEPAD_MAP.RT\r\n        }\r\n    },\r\n    GAME_END_DELAY: 5000,\r\n    GRAPHICS: {\r\n        PHYSICS: {\r\n            AMMORESERVES: true\r\n        },\r\n        STATIC_OVERLAY: true,\r\n        BACKGROUND_PARTICLES: true\r\n    },\r\n    MAX_PLAYERS: 4,\r\n    MAX_WINS: 5,\r\n    RECONNECT_DELAY: 3000,\r\n    ROUND_END_DELAY: 3000,\r\n    NEW_ROUND_DELAY: 500\r\n};\r\n\r\nexport const UI = {\r\n    PLAYER_ID_LENGTH: 6,\r\n    FONT: '12px Arial',\r\n    TEXT_COLOR: '#fff'\r\n};\r\n\r\nexport const ROOM = {\r\n    ID_PREFIX: 'room_',\r\n    ID_LENGTH: 10\r\n};\r\n\r\nexport const CHAT = {\r\n    MAX_MESSAGES: 100,\r\n    MAX_MESSAGE_LENGTH: 200\r\n};\r\n\r\nexport const NETWORK = {\r\n    MOVE_INTERVAL: 10, //ms\r\n    ROTATE_INTERVAL: 25 //ms\r\n}","import { CacheManager } from \"./CacheManager\";\r\nimport { UserInterface } from \"./UserInterface\";\r\n\r\nconst ADMIN_KEYS = {\r\n    KEYS: ['Control', 'Shift', 'Alt', '-', '+'],\r\n    REQUIRED_COUNT: 5\r\n} as const;\r\n\r\nconst CONSOLE_KEY = 'Control';\r\n\r\nexport class Admin {\r\n    private adminKeysHeld: Set<string> = new Set();\r\n\r\n    constructor(private cacheManager: CacheManager, private ui: UserInterface) {\r\n        this.initKeyListener();\r\n        this.initConsoleKeybinds();\r\n    }\r\n\r\n    // #region [ Admin (Locked) ]\r\n    //\r\n    /**\r\n     * Listens for admin key combo and shows modal when detected.\r\n     */\r\n    private initKeyListener(): void {\r\n        window.addEventListener('keydown', (e) => {\r\n            this.adminKeysHeld.add(e.key);\r\n            this.checkAdminCombo();\r\n        });\r\n\r\n        window.addEventListener('keyup', (e) => {\r\n            this.adminKeysHeld.delete(e.key);\r\n        });\r\n    }\r\n\r\n    /**\r\n     * Checks held keys against the ADMIN_KEYS configuration.\r\n     */\r\n    private checkAdminCombo(): void {\r\n        const hasAllKeys = ADMIN_KEYS.KEYS.every(key => this.adminKeysHeld.has(key));\r\n\r\n        if (hasAllKeys && this.adminKeysHeld.size === ADMIN_KEYS.REQUIRED_COUNT) {\r\n            this.adminKeysHeld.clear(); // Prevent repeated triggers\r\n            this.showAdminModal();\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Shows the admin modal using the general website modal.\r\n     */\r\n    private showAdminModal(): void {\r\n        if (!this.ui.modal || !this.ui.modalInput || !this.ui.modalConfirmButton ||\r\n            !this.ui.modalCancelButton || !this.ui.modalErrorDiv || !this.ui.modalText) return;\r\n\r\n        this.ui.modal.classList.remove('hidden');\r\n        this.ui.modalConfirmButton.classList.remove('hidden');\r\n\r\n        this.ui.modalInput.value = '';\r\n        this.ui.modalInput.style.display = 'block';\r\n        this.ui.modalErrorDiv.textContent = '';\r\n        this.ui.modalText.textContent = 'Enter Admin Command.';\r\n        this.ui.modalConfirmButton.textContent = 'Execute';\r\n        this.ui.modalCancelButton.textContent = 'Cancel';\r\n\r\n        this.ui.modalInput.focus();\r\n\r\n        this.ui.modalConfirmButton.onclick = () => {\r\n            if (!this.ui.modalInput || !this.ui.modalErrorDiv) return;\r\n\r\n            const value = this.ui.modalInput.value.trim();\r\n            if (!value.includes(':')) {\r\n                this.ui.modalErrorDiv.textContent = 'Invalid format.';\r\n                return;\r\n            }\r\n\r\n            const [command, key] = value.split(':');\r\n            if (!command || !key) {\r\n                this.ui.modalErrorDiv.textContent = 'Invalid format.';\r\n                return;\r\n            }\r\n\r\n            this.executeAdminCommand(command.trim(), key.trim());\r\n            this.ui.closeModal();\r\n        };\r\n\r\n        this.ui.modalCancelButton.onclick = () => this.ui.closeModal();\r\n    }\r\n\r\n    /**\r\n     * Executes a command that is in the input field of the admin modal.\r\n     */\r\n    private executeAdminCommand(command: string, key: string): void {\r\n        // This will be called from your main game class with the WebSocket\r\n        console.log(`Admin command: ${command} with key: ${key}`);\r\n\r\n        // You'll expose this via a callback or event system\r\n        this.onAdminCommand?.(command, key);\r\n    }\r\n\r\n    // Public callback for Client.ts\r\n    public onAdminCommand?: (command: string, key: string) => void;\r\n\r\n    //\r\n    // #endregion\r\n\r\n    // #region [ Console ]\r\n    //\r\n    /**\r\n     * Clears cache with tilde key\r\n     */\r\n    private initConsoleKeybinds(): void {\r\n        document.addEventListener('keydown', (e) => {\r\n            if (!e.getModifierState(CONSOLE_KEY)) return;\r\n            if (e.key === '`') { e.preventDefault(); this.clearCacheCommand(); }\r\n        });\r\n    }\r\n\r\n    private clearCacheCommand(): void {\r\n        this.cacheManager.clear().then(() => {\r\n            console.log('Cache cleared! Reload the page.');\r\n            location.reload();\r\n        });\r\n    }\r\n    //\r\n    // #endregion\r\n}","import { PlayerPartAnimParams, CharacterAnimation, Vec2 } from \"./Types\";\r\n\r\nimport { RoomManager } from \"./RoomManager\";\r\n\r\nimport { PlayerState } from \"./player/PlayerState\";\r\nimport { NETWORK } from \"./Config\";\r\n\r\nexport class Animator {\r\n    private characterAnimations: CharacterAnimation = new Map();\r\n    public characterOffsets: Map<string, Vec2> = new Map();\r\n\r\n    constructor(private playerState: PlayerState, private roomManager: RoomManager, private userId: string) { }\r\n\r\n    // #region [ Animation ]\r\n    /**\r\n     * Animates a specific character part locally with generateCharacterAnimation and broadcasts for other clients to sync animations.\r\n     */\r\n    public animateCharacterPart(params: PlayerPartAnimParams): void {\r\n        this.generateCharacterAnimation(params);\r\n\r\n        this.roomManager.sendMessage(JSON.stringify({\r\n            type: 'character-animation',\r\n            params: params\r\n        }));\r\n    }\r\n\r\n    /**\r\n     * Rotates a specific part of a player with the passed rotation.\r\n     */\r\n    public rotateCharacterPart(playerId: string, rotation: number): void {\r\n        if (playerId === this.userId) {\r\n            this.playerState.myPlayer.transform.rot = rotation;\r\n        } else {\r\n            const player = this.playerState.players.get(playerId);\r\n            if (!player) return;\r\n            player.transform.rot = rotation;\r\n        }\r\n\r\n        const now = Date.now();\r\n        const rotationDiff = Math.abs(rotation - this.playerState.lastSentRotation);\r\n        if (rotationDiff > 0.1 && now - this.playerState.lastSentRotationTime >= NETWORK.ROTATE_INTERVAL) {\r\n            this.roomManager.sendMessage(JSON.stringify({\r\n                type: 'player-move',\r\n                transform: {\r\n                    rot: this.playerState.myPlayer.transform.rot\r\n                }\r\n            }));\r\n\r\n            this.playerState.lastSentRotation = rotation;\r\n            this.playerState.lastSentRotationTime = now;\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Responds to a network request to process a character animation.\r\n     */\r\n    public animateCharacterPartNetwork(params: PlayerPartAnimParams): void {\r\n        this.generateCharacterAnimation(params);\r\n    }\r\n\r\n    /**\r\n     * Assembles the character animation and adds it to the characterAnimations mapping for playback during update processing.\r\n     */\r\n    private generateCharacterAnimation(params: PlayerPartAnimParams): void {\r\n        const { playerId, part, frames, duration, partIndex } = params;\r\n        const animationId = `${playerId}_${part}_${partIndex || 0}`;\r\n\r\n        this.characterAnimations.set(animationId, {\r\n            playerId: playerId,\r\n            part: part,\r\n            partIndex: partIndex,\r\n            frames: frames,\r\n            duration: duration,\r\n            startTime: Date.now(),\r\n            originalOffset: { x: 0, y: 0 }\r\n        });\r\n    }\r\n\r\n    /**\r\n     * Process visual character animations by updating part positions.\r\n     */\r\n    public updateCharacterAnimations(delta: number): void {\r\n        const animationsToRemove: string[] = [];\r\n        const currentTime = Date.now();\r\n\r\n        this.characterAnimations.forEach((animation, animationId) => {\r\n            const elapsed = currentTime - animation.startTime;\r\n            const progress = elapsed / animation.duration;\r\n\r\n            if (animation.duration !== 0 && progress >= 1) {\r\n                // Animation complete, remove it\r\n                animationsToRemove.push(animationId);\r\n                return;\r\n            }\r\n\r\n            // Find current keyframe\r\n            const frameKeys = Object.keys(animation.frames).map(Number).sort((a, b) => a - b);\r\n            let currentFrameIndex = 0;\r\n\r\n            for (let i = 0; i < frameKeys.length - 1; i++) {\r\n                const frameProgress = frameKeys[i];\r\n                const nextFrameProgress = frameKeys[i + 1];\r\n\r\n                if (progress >= frameProgress && progress < nextFrameProgress) {\r\n                    currentFrameIndex = i;\r\n                    break;\r\n                }\r\n            }\r\n\r\n            let lerpedX, lerpedY;\r\n            if (progress >= 1) { // Hold at last keyframe for infinite animation\r\n                const lastFrame = animation.frames[frameKeys[frameKeys.length - 1]];\r\n                lerpedX = lastFrame.x;\r\n                lerpedY = lastFrame.y;\r\n            } else { // Normal animation with no lerp\r\n                const currentFrame = animation.frames[frameKeys[currentFrameIndex]];\r\n                const nextFrame = animation.frames[frameKeys[currentFrameIndex + 1]] || currentFrame;\r\n                const frameProgress = (progress - frameKeys[currentFrameIndex]) / (frameKeys[currentFrameIndex + 1] - frameKeys[currentFrameIndex]) || 0;\r\n                lerpedX = currentFrame.x + (nextFrame.x - currentFrame.x) * frameProgress;\r\n                lerpedY = currentFrame.y + (nextFrame.y - currentFrame.y) * frameProgress;\r\n            }\r\n\r\n            this.characterOffsets.set(animationId, { x: lerpedX, y: lerpedY });\r\n        });\r\n\r\n        // Remove completed animations\r\n        animationsToRemove.forEach(id => {\r\n            this.characterAnimations.delete(id);\r\n            if (this.characterOffsets) {\r\n                this.characterOffsets.delete(id);\r\n            }\r\n        });\r\n    }\r\n\r\n    /**\r\n     * Clears all active character animations and offsets.\r\n     */\r\n    public clearAllAnimations(): void {\r\n        this.characterAnimations.clear();\r\n        this.characterOffsets.clear();\r\n    }\r\n    //\r\n    // #endregion\r\n}","export class AudioPool {\r\n    private pools: Map<string, HTMLAudioElement[]> = new Map();\r\n    private activeAudio: Map<string, HTMLAudioElement[]> = new Map();\r\n\r\n    constructor(private poolSize: number = 10, private maxConcurrent: number = 5) { }\r\n\r\n    private createPool(src: string): HTMLAudioElement[] {\r\n        const pool: HTMLAudioElement[] = [];\r\n        for (let i = 0; i < this.poolSize; i++) {\r\n            const audio = new Audio(src);\r\n            audio.preload = 'auto';\r\n            audio.addEventListener('ended', () => this.returnToPool(src, audio));\r\n            audio.addEventListener('pause', () => this.returnToPool(src, audio));\r\n            pool.push(audio);\r\n        }\r\n        return pool;\r\n    }\r\n\r\n    private returnToPool(src: string, audio: HTMLAudioElement): void {\r\n        const active = this.activeAudio.get(src);\r\n        if (active) {\r\n            const index = active.indexOf(audio);\r\n            if (index > -1) {\r\n                active.splice(index, 1);\r\n            }\r\n        }\r\n\r\n        const pool = this.pools.get(src);\r\n        if (pool && !pool.includes(audio)) {\r\n            pool.push(audio);\r\n        }\r\n    }\r\n\r\n    public getAudio(src: string): HTMLAudioElement | null {\r\n        // Check if we're at max concurrent instances\r\n        const active = this.activeAudio.get(src) || [];\r\n        if (active.length >= this.maxConcurrent) {\r\n            return null; // Skip playing if too many instances\r\n        }\r\n\r\n        // Get or create pool for this sound\r\n        let pool = this.pools.get(src);\r\n        if (!pool) {\r\n            pool = this.createPool(src);\r\n            this.pools.set(src, pool);\r\n            this.activeAudio.set(src, []);\r\n        }\r\n\r\n        // Get available audio from pool\r\n        const audio = pool.pop();\r\n        if (audio) {\r\n            // Reset audio properties\r\n            audio.currentTime = 0;\r\n            audio.volume = 1;\r\n            audio.playbackRate = 1;\r\n            audio.loop = false;\r\n\r\n            // Move to active list\r\n            active.push(audio);\r\n            return audio;\r\n        }\r\n\r\n        return null; // Pool exhausted\r\n    }\r\n\r\n    public preloadSound(src: string): void {\r\n        if (!this.pools.has(src)) {\r\n            const pool = this.createPool(src);\r\n            this.pools.set(src, pool);\r\n            this.activeAudio.set(src, []);\r\n        }\r\n    }\r\n}","import { WORLD } from \"./Config\";\r\n\r\nimport { AudioPool } from \"./AudioPool\";\r\nimport { AudioParams } from \"./Types\";\r\nimport { RoomManager } from \"./RoomManager\";\r\nimport { SettingsManager } from \"./SettingsManager\";\r\nimport { Utility } from \"./Utility\";\r\nimport { AudioConfig } from \"./AudioConfig\";\r\n\r\nexport class AudioManager {\r\n    private audioPool: AudioPool;\r\n\r\n    constructor(\r\n        private audioConfig: AudioConfig,\r\n        private roomManager: RoomManager,\r\n        private settingsManager: SettingsManager,\r\n        private utility: Utility\r\n    ) {\r\n        this.audioPool = new AudioPool(\r\n            this.audioConfig.settings.poolSize,\r\n            this.audioConfig.settings.maxConcurrent\r\n        );\r\n    }\r\n\r\n    // #region [ Playback ]\r\n    //\r\n    /**\r\n     * Plays an audio source using the predefined pool for the audio source.\r\n     */\r\n    public playAudio(params: AudioParams): void {\r\n        const audio = this.audioPool.getAudio(params.src);\r\n        if (!audio) {\r\n            console.warn(`Audio pool exhausted or max concurrent reached for: ${params.src}`);\r\n            return;\r\n        }\r\n\r\n        // [ Volume ]\r\n        let volume = 1.0;\r\n        if (params.volume) {\r\n            volume = params.volume.min + Math.random() * (params.volume.max - params.volume.min);\r\n        }\r\n\r\n        // [ 2D Spatial Audio ]\r\n        const blend = params.spatial?.blend ?? 0;\r\n        if (blend > 0 && params.spatial?.pos) {\r\n            const dx = params.spatial.pos.x - params.listener.x;\r\n            const dy = params.spatial.pos.y - params.listener.y;\r\n            const distance = Math.sqrt(dx * dx + dy * dy);\r\n\r\n            let distanceVolume: number;\r\n\r\n            if (params.spatial.rolloff) {\r\n                const rolloffType = params.spatial.rolloff.type || 'linear';\r\n                const factor = params.spatial.rolloff.factor;\r\n                const maxDistance = params.spatial.rolloff.distance;\r\n\r\n                if (rolloffType === 'logarithmic') {\r\n                    // Factor determines reference distance as % of max distance\r\n                    const referenceDistance = maxDistance * factor;\r\n\r\n                    if (distance < referenceDistance) {\r\n                        distanceVolume = 1.0;\r\n                    } else {\r\n                        const normalizedDistance = (distance - referenceDistance) / (maxDistance - referenceDistance);\r\n                        distanceVolume = Math.max(0, 1 - Math.pow(normalizedDistance, 0.5));\r\n                    }\r\n                } else {\r\n                    // Linear: factor is just multiplier on falloff curve\r\n                    distanceVolume = Math.max(0, 1 - (distance / maxDistance) * factor);\r\n                }\r\n            } else {\r\n                // Default: simple linear falloff using canvas dimensions as fallback\r\n                const maxDistance = Math.max(WORLD.WIDTH, WORLD.HEIGHT); //TODO: Remove reliance on config\r\n                distanceVolume = Math.max(0, 1 - (distance / maxDistance));\r\n            }\r\n\r\n            volume *= (1 - blend) + (distanceVolume * blend);\r\n        }\r\n\r\n        // [ Mixer ]\r\n        const outputGroup = params.output?.toLowerCase() || null;\r\n        const mixer = this.settingsManager.getSettings().audio.mixer;\r\n        if (outputGroup && mixer[outputGroup as keyof typeof mixer] !== undefined) {\r\n            volume *= mixer[outputGroup as keyof typeof mixer];\r\n        }\r\n\r\n        volume *= this.settingsManager.getSettings().audio.mixer.master;\r\n        audio.volume = Math.max(0, Math.min(1, volume));\r\n\r\n        // [ Pitch ]\r\n        if (params.pitch) {\r\n            const pitch = params.pitch.min + Math.random() * (params.pitch.max - params.pitch.min);\r\n            audio.playbackRate = Math.max(0.25, Math.min(4, pitch));\r\n        }\r\n\r\n        // [ Loop ]\r\n        if (params.loop !== undefined) {\r\n            audio.loop = params.loop;\r\n        }\r\n\r\n        // [ Trigger Delay ]\r\n        let delayMs = 0;\r\n        if (params.delay) {\r\n            delayMs = (params.delay.min + Math.random() * (params.delay.max - params.delay.min)) * 1000; // Convert to seconds\r\n        }\r\n\r\n        this.utility.safeTimeout(() => {\r\n            audio.play().catch((error: unknown) => {\r\n                console.warn('Audio play failed:', error);\r\n            });\r\n        }, delayMs);\r\n    }\r\n\r\n    /**\r\n     * Syncs an audio trigger over the network.\r\n     */\r\n    public playAudioNetwork(params: AudioParams): void {\r\n        this.playAudio(params);\r\n\r\n        this.roomManager.sendMessage(JSON.stringify({\r\n            type: 'play-audio',\r\n            params: params\r\n        }));\r\n    }\r\n    //\r\n    // #endregion\r\n\r\n    // #region [ Preloading ]\r\n    /**\r\n     * Preloads all audio of a single filetype for the game.\r\n     */\r\n    public preloadAudioAssets(sfx: any, extension: string): void {\r\n        this.preloadSFX(sfx, extension);\r\n    }\r\n\r\n    /**\r\n     * Iterate through the passed audio object, and preload them for the session.\r\n     */\r\n    private preloadSFX(obj: any, extension: string): void {\r\n        for (const key in obj) {\r\n            const value = obj[key];\r\n\r\n            if (Array.isArray(value)) {\r\n                // If it's an array, assume it's an array of audio file paths\r\n                value.forEach(src => {\r\n                    if (typeof src === 'string' && (src.endsWith(extension))) { // All sound files should be .ogg\r\n                        this.audioPool.preloadSound(src);\r\n                    }\r\n                });\r\n            } else if (typeof value === 'object' && value !== null) {\r\n                // If it's an object, recurse into it\r\n                this.preloadSFX(value, extension);\r\n            }\r\n        }\r\n    }\r\n    //\r\n    // #endregion\r\n}","export class CacheManager {\r\n    private dbName = 'SaltpeterCache';\r\n    private dbVersion = 1;\r\n    private db: IDBDatabase | null = null;\r\n\r\n    constructor() {\r\n        this.initDB();\r\n    }\r\n\r\n    /**\r\n     * Initializes the IndexedDB database\r\n     */\r\n    private async initDB(): Promise<void> {\r\n        return new Promise((resolve, reject) => {\r\n            const request = indexedDB.open(this.dbName, this.dbVersion);\r\n\r\n            request.onerror = () => reject(request.error);\r\n            request.onsuccess = () => {\r\n                this.db = request.result;\r\n                resolve();\r\n            };\r\n\r\n            request.onupgradeneeded = (event) => {\r\n                const db = (event.target as IDBOpenDBRequest).result;\r\n                if (!db.objectStoreNames.contains('settings')) {\r\n                    db.createObjectStore('settings');\r\n                }\r\n            };\r\n        });\r\n    }\r\n\r\n    /**\r\n     * Writes any value to the cache\r\n     */\r\n    public async write(key: string, value: any): Promise<void> {\r\n        if (!this.db) await this.initDB();\r\n\r\n        return new Promise((resolve, reject) => {\r\n            const transaction = this.db!.transaction(['settings'], 'readwrite');\r\n            const store = transaction.objectStore('settings');\r\n            const request = store.put(value, key);\r\n\r\n            request.onerror = () => reject(request.error);\r\n            request.onsuccess = () => resolve();\r\n        });\r\n    }\r\n\r\n    /**\r\n     * Reads a value from the cache\r\n     */\r\n    public async read(key: string): Promise<any> {\r\n        if (!this.db) await this.initDB();\r\n\r\n        return new Promise((resolve, reject) => {\r\n            const transaction = this.db!.transaction(['settings'], 'readonly');\r\n            const store = transaction.objectStore('settings');\r\n            const request = store.get(key);\r\n\r\n            request.onerror = () => reject(request.error);\r\n            request.onsuccess = () => resolve(request.result);\r\n        });\r\n    }\r\n\r\n    /**\r\n     * Deletes a value from the cache\r\n     */\r\n    public async delete(key: string): Promise<void> {\r\n        if (!this.db) await this.initDB();\r\n\r\n        return new Promise((resolve, reject) => {\r\n            const transaction = this.db!.transaction(['settings'], 'readwrite');\r\n            const store = transaction.objectStore('settings');\r\n            const request = store.delete(key);\r\n\r\n            request.onerror = () => reject(request.error);\r\n            request.onsuccess = () => resolve();\r\n        });\r\n    }\r\n\r\n    /**\r\n     * Clears all cached data\r\n     */\r\n    public async clear(): Promise<void> {\r\n        if (!this.db) await this.initDB();\r\n\r\n        return new Promise((resolve, reject) => {\r\n            const transaction = this.db!.transaction(['settings'], 'readwrite');\r\n            const store = transaction.objectStore('settings');\r\n            const request = store.clear();\r\n\r\n            request.onerror = () => reject(request.error);\r\n            request.onsuccess = () => resolve();\r\n        });\r\n    }\r\n}","export class CharacterConfig {\r\n    public weapon = {\r\n        glock: [\r\n            '/assets/img/weapon/glock/body.png',\r\n            '/assets/img/weapon/glock/slide.png',\r\n        ],\r\n        knife: [\r\n            '/assets/img/weapon/melee/knife_00.png'\r\n        ]\r\n    };\r\n\r\n    public magazine = {\r\n        glock: {\r\n            empty: '/assets/img/object/weapons/glock/magazine_empty.png',\r\n            full: '/assets/img/object/weapons/glock/magazine_full.png'\r\n        }\r\n    };\r\n\r\n    public body = {\r\n        default: '/assets/img/char/body/default.png'\r\n    };\r\n\r\n    public head = {\r\n        default: '/assets/img/char/head/default.png',\r\n        blondeAfro: '/assets/img/char/head/blonde_afro.png'\r\n    };\r\n\r\n    public headwear = {\r\n        default: '/assets/img/char/headwear/default.png',\r\n        fez: '/assets/img/char/headwear/fez.png',\r\n        strawHat: '/assets/img/char/headwear/straw_hat.png',\r\n        trucker: '/assets/img/char/headwear/trucker.png'\r\n    };\r\n\r\n    public upgrades = {\r\n        kineticBrain: '/assets/img/char/upgrades/kineticbrain.png'\r\n    };\r\n\r\n    public characterDecals = {\r\n        default: {\r\n            blood: [\r\n                '/assets/img/effects/blood/blood_00.png',\r\n                '/assets/img/effects/blood/blood_01.png',\r\n                '/assets/img/effects/blood/blood_02.png',\r\n                '/assets/img/effects/blood/blood_03.png',\r\n                '/assets/img/effects/blood/blood_04.png'\r\n            ],\r\n            gore: [\r\n                '/assets/img/effects/gore/gore_00.png',\r\n                '/assets/img/effects/gore/gore_01.png',\r\n                '/assets/img/effects/gore/gore_02.png',\r\n                '/assets/img/effects/gore/gore_03.png',\r\n                '/assets/img/effects/gore/gore_04.png',\r\n                '/assets/img/effects/gore/gore_05.png',\r\n                '/assets/img/effects/gore/gore_06.png',\r\n                '/assets/img/effects/gore/gore_07.png',\r\n                '/assets/img/effects/gore/gore_08.png',\r\n                '/assets/img/effects/gore/gore_09.png',\r\n                '/assets/img/effects/gore/gore_10.png',\r\n                '/assets/img/effects/gore/gore_11.png',\r\n                '/assets/img/effects/gore/gore_12.png',\r\n                '/assets/img/effects/gore/gore_13.png'\r\n            ]\r\n        }\r\n    };\r\n\r\n    constructor() { }\r\n}","import { CharacterConfig } from \"./CharacterConfig\";\r\nimport { CharacterLayer } from \"./Types\";\r\n\r\nexport class CharacterManager {\r\n    constructor(private charConfig: CharacterConfig) { }\r\n\r\n    public getCharacterAsset(layer: CharacterLayer, variant: string): string | string[] {\r\n        switch (layer) {\r\n            case 'body':\r\n                return this.charConfig.body[variant as keyof typeof this.charConfig.body] || this.charConfig.body.default;\r\n            case 'weapon':\r\n                return this.charConfig.weapon[variant as keyof typeof this.charConfig.weapon] || this.charConfig.weapon.glock;\r\n            case 'head':\r\n                return this.charConfig.head[variant as keyof typeof this.charConfig.head] || this.charConfig.head.default;\r\n            case 'headwear':\r\n                return this.charConfig.headwear[variant as keyof typeof this.charConfig.headwear] || this.charConfig.headwear.default;\r\n            case 'upgrades':\r\n                return variant;\r\n            default:\r\n                throw new Error(`Unknown character layer: ${layer}`);\r\n        }\r\n    }\r\n\r\n    public getUpgradeVisual(upgradeName: string): string | null {\r\n        const lowerName = upgradeName.toLowerCase();\r\n        return this.charConfig.upgrades[lowerName as keyof typeof this.charConfig.upgrades] || null;\r\n    }\r\n}","import { CHAT } from \"./Config\";\r\n\r\nimport { RoomManager } from \"./RoomManager\";\r\nimport { ChatMessage } from \"./Types\";\r\nimport { UserInterface } from \"./UserInterface\";\r\n\r\nexport class ChatManager {\r\n    constructor(private roomManager: RoomManager, private ui: UserInterface) { }\r\n\r\n    // #region [ Chat Management ]\r\n    //\r\n    /**\r\n     * Sends a message in the chat.\r\n     */\r\n    public sendChatMessage(userId: string): void {\r\n        if (!this.ui.chatInput || !this.ui.chatInput.value.trim()) return;\r\n\r\n        const message = this.ui.chatInput.value.trim();\r\n        if (message.length > CHAT.MAX_MESSAGE_LENGTH) { //TODO: Abstract reliance on config\r\n            alert(`Message too long! Max ${CHAT.MAX_MESSAGE_LENGTH} characters.`);\r\n            return;\r\n        }\r\n\r\n        // Send message to server\r\n        this.roomManager.sendMessage(JSON.stringify({\r\n            type: 'chat-message',\r\n            message: message,\r\n            timestamp: Date.now()\r\n        }));\r\n\r\n        // Display own message immediately\r\n        this.displayChatMessage({senderId: userId, message: message, isOwn: true});\r\n\r\n        // Clear input\r\n        this.ui.chatInput.value = '';\r\n    }\r\n\r\n    /**\r\n     * Displayes messages sent in the chat.\r\n     */\r\n    public displayChatMessage(params: ChatMessage): void {\r\n        if (!this.ui.chatMessages) return;\r\n        const { senderId, message, isOwn = false } = params;\r\n\r\n        const messageDiv = document.createElement('div');\r\n        messageDiv.className = `chat_message ${isOwn ? 'own' : 'other'}`;\r\n\r\n        const senderSpan = document.createElement('span');\r\n        senderSpan.className = 'sender';\r\n        senderSpan.textContent = isOwn ? 'You:' : `${senderId}:`;\r\n\r\n        const contentSpan = document.createElement('span');\r\n        contentSpan.className = 'content';\r\n        contentSpan.textContent = message;\r\n\r\n        messageDiv.appendChild(senderSpan);\r\n        messageDiv.appendChild(contentSpan);\r\n\r\n        this.ui.chatMessages.appendChild(messageDiv);\r\n\r\n        // Scroll to bottom\r\n        this.ui.chatMessages.scrollTop = this.ui.chatMessages.scrollHeight;\r\n\r\n        // Limit message history\r\n        while (this.ui.chatMessages.children.length > CHAT.MAX_MESSAGES) {\r\n            this.ui.chatMessages.removeChild(this.ui.chatMessages.firstChild!);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Resets the chat.\r\n     */\r\n    public clearChat(): void {\r\n        if (this.ui.chatMessages) {\r\n            this.ui.chatMessages.innerHTML = '';\r\n        }\r\n        if (this.ui.chatInput) {\r\n            this.ui.chatInput.value = '';\r\n        }\r\n    }\r\n    //\r\n    // #endregion\r\n}","import { Vec2 } from \"./Types\";\r\n\r\nimport { SettingsManager } from \"./SettingsManager\";\r\n\r\nexport class ControlsManager {\r\n    private activeKeys: Set<string> = new Set();\r\n    private gamepadKeys: Set<string> = new Set();\r\n    private previousKeys: Set<string> = new Set();\r\n\r\n    private mousePos: Vec2 = { x: 0, y: 0 };;\r\n\r\n    private gamepadConnected: boolean = false;\r\n    public gamepadConnectionEnabled: boolean = true;\r\n\r\n    private gamepadRAxis: number | null = null;\r\n\r\n    constructor(private settingsManager: SettingsManager) {\r\n        this.initGamepad();\r\n    }\r\n\r\n    // #region [ Keys ]\r\n    //\r\n    /**\r\n     * Returns true if the key is currently being held down.\r\n     */\r\n    public held(key: string): boolean {\r\n        return this.activeKeys.has(key);\r\n    }\r\n\r\n    /**\r\n     * Returns true if the key was pressed this frame.\r\n     */\r\n    public triggered(key: string): boolean {\r\n        return this.activeKeys.has(key) && !this.previousKeys.has(key);\r\n    }\r\n\r\n    /**\r\n     * Returns a read-only copy of the currently active (pressed) keys.\r\n     */\r\n    public getActiveKeys(): ReadonlySet<string> {\r\n        return this.activeKeys;\r\n    }\r\n\r\n    /**\r\n     * Adds a key to the active key set.\r\n     */\r\n    public addKey(key: string): void {\r\n        this.activeKeys.add(key);\r\n    }\r\n\r\n    /**\r\n     * Removes a key from the active key set.\r\n     */\r\n    public removeKey(key: string): void {\r\n        this.activeKeys.delete(key);\r\n    }\r\n\r\n    /**\r\n     * Clears all currently active (pressed) keys.\r\n     */\r\n    public clearActiveKeys(): void {\r\n        this.activeKeys.clear();\r\n    }\r\n\r\n    /**\r\n     * Monitors the previous keys set, allowing for action triggers.\r\n     */\r\n    public updatePreviousKeys(): void {\r\n        this.previousKeys = new Set(this.activeKeys);\r\n    }\r\n    //\r\n    // #endregion\r\n\r\n    // #region [ Mouse ]\r\n    //\r\n    /**\r\n     * Returns the current mouse position as a read-only Vec2.\r\n     */\r\n    public getMousePos(): Readonly<Vec2> {\r\n        return this.mousePos;\r\n    }\r\n\r\n    /**\r\n     * Updates the stored mouse position.\r\n     */\r\n    public setMousePos(pos: Vec2): void {\r\n        this.mousePos.x = pos.x;\r\n        this.mousePos.y = pos.y;\r\n    }\r\n    //\r\n    // #endregion\r\n\r\n    // #region [ Gamepad ]\r\n    //\r\n    /**\r\n     * Initializes gamepad connection listeners.\r\n     */\r\n    private initGamepad(): void {\r\n        window.addEventListener(\"gamepadconnected\", () => {\r\n            console.log(\"Gamepad connected!\");\r\n            this.gamepadConnected = true;\r\n        });\r\n\r\n        window.addEventListener(\"gamepaddisconnected\", () => {\r\n            console.log(\"Gamepad disconnected!\");\r\n            this.gamepadConnected = false;\r\n        });\r\n    }\r\n\r\n    /**\r\n     * Used to poll for gamepad inputs when one is connected.\r\n     * \r\n     * Gamepad bindings map to the keyboard bindings to trigger actions.\r\n     */\r\n    public pollGamepad(): void {\r\n        if (!this.gamepadConnected) return;\r\n\r\n        const gamepads = navigator.getGamepads();\r\n        const gamepad = gamepads[0];\r\n        if (!gamepad) return;\r\n\r\n        const settings = this.settingsManager.getSettings();\r\n        const keybinds = settings.controls.keybinds;\r\n        const gamepadMap = settings.controls.gamepad;\r\n        const deadzone = gamepadMap.deadzone;\r\n\r\n        // Clear previous gamepad keys\r\n        this.gamepadKeys.forEach(key => this.activeKeys.delete(key));\r\n        this.gamepadKeys.clear();\r\n\r\n        const xAxis = gamepad.axes[0];\r\n        const yAxis = gamepad.axes[1];\r\n\r\n        if (xAxis > deadzone) {\r\n            this.activeKeys.add(keybinds.moveRight);\r\n            this.gamepadKeys.add(keybinds.moveRight);\r\n        }\r\n\r\n        if (xAxis < -deadzone) {\r\n            this.activeKeys.add(keybinds.moveLeft);\r\n            this.gamepadKeys.add(keybinds.moveLeft);\r\n        }\r\n\r\n        if (yAxis > deadzone) {\r\n            this.activeKeys.add(keybinds.moveDown);\r\n            this.gamepadKeys.add(keybinds.moveDown);\r\n        }\r\n\r\n        if (yAxis < -deadzone) {\r\n            this.activeKeys.add(keybinds.moveUp);\r\n            this.gamepadKeys.add(keybinds.moveUp);\r\n        }\r\n\r\n        if (gamepad.buttons[gamepadMap.melee].pressed) {\r\n            this.activeKeys.add(keybinds.melee);\r\n            this.gamepadKeys.add(keybinds.melee);\r\n        }\r\n\r\n        if (gamepad.buttons[gamepadMap.dash].pressed) {\r\n            this.activeKeys.add(keybinds.dash);\r\n            this.gamepadKeys.add(keybinds.dash);\r\n        }\r\n\r\n        if (gamepad.buttons[gamepadMap.reload].pressed) {\r\n            this.activeKeys.add(keybinds.reload);\r\n            this.gamepadKeys.add(keybinds.reload);\r\n        }\r\n\r\n        if (gamepad.buttons[gamepadMap.attack].pressed) {\r\n            this.activeKeys.add(keybinds.attack);\r\n            this.gamepadKeys.add(keybinds.attack);\r\n        }\r\n\r\n        if (gamepad.buttons[gamepadMap.sprint].pressed) {\r\n            this.activeKeys.add(keybinds.sprint);\r\n            this.gamepadKeys.add(keybinds.sprint);\r\n        }\r\n\r\n        // Right stick aiming\r\n        const rightX = gamepad.axes[2];\r\n        const rightY = gamepad.axes[3];\r\n        const aimMagnitude = Math.sqrt(rightX * rightX + rightY * rightY);\r\n\r\n        if (aimMagnitude > deadzone) {\r\n            this.gamepadRAxis = Math.atan2(rightY, rightX) + Math.PI / 2;\r\n        } else {\r\n            this.gamepadRAxis = null;\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Returns the current right axis input.\r\n     */\r\n    public getGamepadRAxis(): number | null {\r\n        return this.gamepadRAxis;\r\n    }\r\n    //\r\n    // #endregion\r\n}","import { WORLD } from \"./Config\";\r\nimport { Player } from \"./Types\";\r\n\r\nimport { ObjectsManager } from \"./ObjectsManager\";\r\nimport { RoomManager } from \"./RoomManager\";\r\n\r\nimport { PlayerState } from \"./player/PlayerState\";\r\nimport { UserInterface } from \"./UserInterface\";\r\n\r\n\r\nexport class CollisionsManager {\r\n    constructor(\r\n        private objectsManager: ObjectsManager,\r\n        private playerState: PlayerState,\r\n        private roomManager: RoomManager,\r\n        private ui: UserInterface,\r\n        private userId: string\r\n    ) {}\r\n\r\n    /**\r\n     * Responsible for handling all collisions in the game. Routes to other collision functions.\r\n     */\r\n    public checkCollisions(delta: number): void {\r\n        const minX = WORLD.BORDER_MARGIN;\r\n        const maxX = WORLD.WIDTH - WORLD.BORDER_MARGIN;\r\n        const minY = WORLD.BORDER_MARGIN;\r\n        const maxY = WORLD.HEIGHT - WORLD.BORDER_MARGIN;\r\n\r\n        this.playerState.myPlayer.transform.pos.x = Math.max(minX, Math.min(maxX, this.playerState.myPlayer.transform.pos.x));\r\n        this.playerState.myPlayer.transform.pos.y = Math.max(minY, Math.min(maxY, this.playerState.myPlayer.transform.pos.y));\r\n\r\n        this.checkObjectCollisions(delta);\r\n        this.checkPlayersCollisions(delta);\r\n    }\r\n\r\n    /**\r\n     * Checks for my player colliding with objects in the game. \r\n     */\r\n    private checkObjectCollisions(delta: number): void {\r\n        if (!this.collisionsEnabled(this.playerState.myPlayer)) return;\r\n\r\n        const collisionRadius = this.getPlayerCollider(this.playerState.myPlayer, 5);\r\n\r\n        this.objectsManager.ammoBoxes.forEach((ammoBox, boxId) => {\r\n            if (ammoBox.isOpen) return;\r\n\r\n            const dx = this.playerState.myPlayer.transform.pos.x - ammoBox.transform.pos.x;\r\n            const dy = this.playerState.myPlayer.transform.pos.y - ammoBox.transform.pos.y;\r\n            const distance = Math.sqrt(dx * dx + dy * dy);\r\n\r\n            if (distance <= collisionRadius) {\r\n                // Calculate how much ammo can actually be picked up\r\n                const currentReserve = this.playerState.myPlayer.actions.primary.magazine.currentReserve;\r\n                const maxReserve = this.playerState.myPlayer.actions.primary.magazine.maxReserve;\r\n                const actualAmmoAdded = Math.min(ammoBox.ammoAmount, maxReserve - currentReserve);\r\n\r\n                // Only pick up if we can actually add ammo\r\n                if (actualAmmoAdded > 0) {\r\n                    this.playerState.myPlayer.actions.primary.magazine.currentReserve += actualAmmoAdded;\r\n\r\n                    // Spawn UI bullets based on ACTUAL ammo added, not ammo box amount\r\n                    this.ui.ammoReservesUIController.spawnAmmoInReserveUI(actualAmmoAdded);\r\n\r\n                    console.log(`Picked up ammo box! +${actualAmmoAdded} bullets. Inventory: ${this.playerState.myPlayer.actions.primary.magazine.currentReserve}/${this.playerState.myPlayer.actions.primary.magazine.maxReserve}`);\r\n\r\n                    // Generate random lid physics\r\n                    const angle = Math.random() * Math.PI * 2;\r\n                    const speed = 2 + Math.random() * 3;\r\n\r\n                    ammoBox.isOpen = true;\r\n                    ammoBox.lid.velocity = {\r\n                        x: Math.cos(angle) * speed,\r\n                        y: Math.sin(angle) * speed\r\n                    };\r\n                    ammoBox.lid.torque = (Math.random() - 0.5) * 0.3;\r\n\r\n                    // Broadcast pickup with full box state\r\n                    this.roomManager.sendMessage(JSON.stringify({\r\n                        type: 'ammo-pickup',\r\n                        ammoBoxId: boxId,\r\n                        playerId: this.userId,\r\n                        boxState: {\r\n                            isOpen: true,\r\n                            lid: ammoBox.lid\r\n                        }\r\n                    }));\r\n                }\r\n            }\r\n        })\r\n    }\r\n\r\n    /**\r\n     * Checks for collisions with other players, blocking movement.\r\n     */\r\n    private checkPlayersCollisions(delta: number): void {\r\n        if (!this.collisionsEnabled(this.playerState.myPlayer)) return;\r\n\r\n        this.playerState.players.forEach((player: Player) => {\r\n            if (!this.collisionsEnabled(player)) return;\r\n\r\n            const dx = this.playerState.myPlayer.transform.pos.x - player.transform.pos.x;\r\n            const dy = this.playerState.myPlayer.transform.pos.y - player.transform.pos.y;\r\n            const dist = Math.sqrt(dx * dx + dy * dy);\r\n            const minDist = this.getPlayerCollider(this.playerState.myPlayer) + this.getPlayerCollider(player);\r\n\r\n            if (dist < minDist && dist > 0.01) { // Push myself away from the other player\r\n                const overlap = minDist - dist;\r\n                const pushX = (dx / dist) * overlap;\r\n                const pushY = (dy / dist) * overlap;\r\n\r\n                this.playerState.myPlayer.transform.pos.x += pushX;\r\n                this.playerState.myPlayer.transform.pos.y += pushY;\r\n            }\r\n        });\r\n    }\r\n\r\n    /**\r\n     * Returns the player collider, with padding if needed.\r\n     */\r\n    public getPlayerCollider(player: Player, padding?: number): number {\r\n        let col = player.stats.size / 4\r\n\r\n        if (padding && padding > 0) {\r\n            col = (player.stats.size / 4) + padding\r\n        }\r\n\r\n        return col;\r\n    }\r\n    \r\n    /**\r\n     * Checks if the specific player's collisions are enabled.\r\n     */\r\n    public collisionsEnabled(player: Player): boolean {\r\n        if (player.stats.health.value <= 0) return false\r\n        if (player.flags.hidden && player.flags.invulnerable) return false\r\n        return true\r\n    }\r\n}","import { ParametricDecalParams } from \"./Types\";\r\n\r\nexport class DecalsConfig {\r\n    public decals = {\r\n        projectile: {\r\n            radius: {\r\n                min: 4,\r\n                max: 8\r\n            },\r\n            density: {\r\n                min: 0.175,\r\n                max: 0.35\r\n            },\r\n            opacity: {\r\n                min: 0.15,\r\n                max: 0.25\r\n            },\r\n            variation: 0.215,\r\n            colors: [\"#000000\", \"#191919\", \"#39362d\"]\r\n        } as ParametricDecalParams,\r\n        blood: {\r\n            radius: {\r\n                min: 5,\r\n                max: 17.5\r\n            },\r\n            density: {\r\n                min: 0.1,\r\n                max: 0.175\r\n            },\r\n            opacity: {\r\n                min: 0.275,\r\n                max: 0.315\r\n            },\r\n            variation: 0.5,\r\n            colors: [\"#781414\", \"#710606\", \"#a10101\"]\r\n        } as ParametricDecalParams,\r\n        explosion: {\r\n            radius: {\r\n                min: 25,\r\n                max: 40\r\n            },\r\n            density: {\r\n                min: 0.375,\r\n                max: 0.575\r\n            },\r\n            opacity: {\r\n                min: 0.35,\r\n                max: 0.525\r\n            },\r\n            variation: 0.2,\r\n            colors: [\"#434343\", \"#2a2a2a\", \"#3b1d1d\"]\r\n        } as ParametricDecalParams\r\n    };\r\n\r\n    constructor() { }\r\n}","import { WORLD } from \"./Config\";\r\nimport { Decal, DecalParams, ImageDecalParams, ParametricDecalParams, Vec2 } from \"./Types\";\r\n\r\nimport { RoomManager } from \"./RoomManager\";\r\nimport { UserInterface } from \"./UserInterface\";\r\nimport { Utility } from \"./Utility\";\r\nimport { DecalsConfig } from \"./DecalsConfig\";\r\nimport { PlayerState } from \"./player/PlayerState\";\r\nimport { CharacterConfig } from \"./CharacterConfig\";\r\nimport { Camera } from \"./Camera\";\r\n\r\nexport class DecalsManager {\r\n    public decalsConfig: DecalsConfig;\r\n\r\n    public dynamicDecals: Map<string, Decal> = new Map();\r\n    public staticDecalData: ImageData | null = null;\r\n\r\n    constructor(\r\n        private camera: Camera,\r\n        private charConfig: CharacterConfig,\r\n        private playerState: PlayerState,\r\n        private roomManager: RoomManager,\r\n        private ui: UserInterface,\r\n        private userId: string,\r\n        private utility: Utility\r\n    ) {\r\n        this.decalsConfig = new DecalsConfig();\r\n    }\r\n\r\n    // #region [ Decals ]\r\n    //\r\n    /**\r\n     * Create a decal and broadcast over the network.\r\n     */\r\n    public createDecal(params: DecalParams): void {\r\n        this.generateDecal(params);\r\n\r\n        this.roomManager.sendMessage(JSON.stringify({\r\n            type: 'add-decal',\r\n            params: params\r\n        }));\r\n    }\r\n\r\n    /**\r\n     * Create a decal locally when receiving an 'add-decal' network message.\r\n     */\r\n    public createDecalNetwork(params: DecalParams): void {\r\n        if (this.dynamicDecals.has(params.id)) return; // Don't create duplicate decals\r\n\r\n        this.generateDecal(params);\r\n    }\r\n\r\n    /**\r\n     * Locally generate the decal and stamp it to the decal canvas.\r\n     */\r\n    public generateDecal(params: DecalParams): void {\r\n        if (!this.ui.decalCtx) return;\r\n\r\n        const { x, y } = params.pos;\r\n\r\n        // Check WORLD bounds\r\n        if (x < 0 || x > WORLD.WIDTH || y < 0 || y > WORLD.HEIGHT) return;\r\n\r\n        // Stamp decal at WORLD coordinates (no camera conversion needed)\r\n        if (params.type === 'parametric' && params.parametric) {\r\n            this.generateParametricDecal(params.pos, params.parametric);\r\n        } else if (params.type === 'image' && params.image) {\r\n            this.generateImageDecal(params.pos, params.image);\r\n        }\r\n\r\n        // Store decal with WORLD position\r\n        this.dynamicDecals.set(params.id, { params, pos: { x, y } });\r\n    }\r\n\r\n    /**\r\n     * Generate parametric pixel-based decal.\r\n     * \r\n     * This type of decal does not use an image, but instead paints pixels based on parameters.\r\n     */\r\n    private generateParametricDecal(pos: Vec2, params: ParametricDecalParams): void {\r\n        if (!this.ui.decalCtx) return;\r\n\r\n        const radius = params.radius.min + Math.random() * (params.radius.max - params.radius.min);\r\n        const density = params.density.min + Math.random() * (params.density.max - params.density.min);\r\n        const opacity = params.opacity.min + Math.random() * (params.opacity.max - params.opacity.min);\r\n\r\n        const numPixels = Math.floor((radius * radius * Math.PI) * density);\r\n\r\n        this.ui.decalCtx.save();\r\n        this.ui.decalCtx.globalCompositeOperation = 'source-over';\r\n\r\n        for (let i = 0; i < numPixels; i++) {\r\n            const angle = Math.random() * Math.PI * 2;\r\n            const distance = Math.random() * radius;\r\n            const pixelX = pos.x + Math.cos(angle) * distance;\r\n            const pixelY = pos.y + Math.sin(angle) * distance;\r\n\r\n            // Check WORLD bounds (decal canvas is world-sized)\r\n            if (pixelX < 0 || pixelX >= WORLD.WIDTH || pixelY < 0 || pixelY >= WORLD.HEIGHT) continue;\r\n\r\n            // Pick random color from array\r\n            const chosenColor = params.colors[Math.floor(Math.random() * params.colors.length)];\r\n            const rgb = this.utility.hexToRgb(chosenColor);\r\n            if (!rgb) continue;\r\n\r\n            const pixelOpacity = opacity + (Math.random() - 0.5) * params.variation;\r\n            const clampedOpacity = Math.max(0.05, Math.min(0.6, pixelOpacity));\r\n\r\n            this.ui.decalCtx.fillStyle = `rgba(${rgb.r}, ${rgb.g}, ${rgb.b}, ${clampedOpacity})`;\r\n            // Draw at world coordinates\r\n            this.ui.decalCtx.fillRect(Math.floor(pixelX), Math.floor(pixelY), 1, 1);\r\n        }\r\n\r\n        this.ui.decalCtx.restore();\r\n    }\r\n\r\n    /**\r\n     * Generate image-based decal (for magazines, gore, etc.).\r\n     */\r\n    private generateImageDecal(pos: Vec2, params: ImageDecalParams): void {\r\n        if (!this.ui.decalCtx) return;\r\n\r\n        let image = new Image();\r\n        image.src = params.src;\r\n\r\n        const drawImage = () => {\r\n            if (!this.ui.decalCtx) return;\r\n            if (!image.complete || image.naturalWidth === 0) return;\r\n\r\n            this.ui.decalCtx.save();\r\n            this.ui.decalCtx.translate(pos.x, pos.y);\r\n            this.ui.decalCtx.rotate(params.rotation);\r\n\r\n            const drawSize = 32 * params.scale;\r\n            this.ui.decalCtx.drawImage(\r\n                image,\r\n                -drawSize / 2,\r\n                -drawSize / 2,\r\n                drawSize,\r\n                drawSize\r\n            );\r\n\r\n            this.ui.decalCtx.restore();\r\n        };\r\n\r\n        if (image.complete) {\r\n            drawImage();\r\n        } else {\r\n            image.onload = drawImage;\r\n        }\r\n    }\r\n    //\r\n    // #endregion\r\n\r\n    // #region [ Baking ]\r\n    //\r\n    // TODO: Implement dynamic -> static decal baking as performance requires\r\n    /**\r\n     * Bake all current dynamic decals into static ImageData and clear the dynamic map.\r\n     * This merges all decals into a single pixel buffer that gets composited once per frame.\r\n     */\r\n    private bakeDecals(): void {\r\n        if (!this.ui.decalCtx) return;\r\n\r\n        // Capture current decal canvas state as ImageData\r\n        const currentBaked = this.ui.decalCtx.getImageData(0, 0, WORLD.WIDTH, WORLD.HEIGHT);\r\n\r\n        if (!this.staticDecalData) {\r\n            // First bake - just store it\r\n            this.staticDecalData = currentBaked;\r\n        } else {\r\n            // Merge new decals with existing baked data\r\n            for (let i = 0; i < currentBaked.data.length; i += 4) {\r\n                const alpha = currentBaked.data[i + 3];\r\n                if (alpha > 0) {\r\n                    // Composite new pixel over old (simple alpha blend)\r\n                    const newAlpha = alpha / 255;\r\n                    const oldAlpha = this.staticDecalData.data[i + 3] / 255;\r\n\r\n                    this.staticDecalData.data[i] = currentBaked.data[i] * newAlpha + this.staticDecalData.data[i] * oldAlpha * (1 - newAlpha);\r\n                    this.staticDecalData.data[i + 1] = currentBaked.data[i + 1] * newAlpha + this.staticDecalData.data[i + 1] * oldAlpha * (1 - newAlpha);\r\n                    this.staticDecalData.data[i + 2] = currentBaked.data[i + 2] * newAlpha + this.staticDecalData.data[i + 2] * oldAlpha * (1 - newAlpha);\r\n                    this.staticDecalData.data[i + 3] = Math.min(255, alpha + this.staticDecalData.data[i + 3]);\r\n                }\r\n            }\r\n        }\r\n\r\n        // Clear dynamic decals\r\n        this.dynamicDecals.clear();\r\n        this.ui.decalCtx.clearRect(0, 0, WORLD.WIDTH, WORLD.HEIGHT);\r\n    }\r\n\r\n    /**\r\n     * Render baked decals to the decal canvas (call at start of frame, before dynamic decals)\r\n     */\r\n    private renderBakedDecals(): void {\r\n        if (!this.staticDecalData || !this.ui.decalCtx) return;\r\n        this.ui.decalCtx.putImageData(this.staticDecalData, 0, 0);\r\n    }\r\n    //\r\n    // #endregion\r\n\r\n    // #region [ Weapon Magazine ]\r\n    //\r\n    /**\r\n     * Spawns weapon magazine using createDecal function, also being broadcast over the network.\r\n     */\r\n    public spawnMagazineDecal(): void {\r\n        setTimeout(() => {\r\n            const currentAmmo = this.playerState.myPlayer.actions.primary.magazine.currentAmmo;\r\n\r\n            // Choose magazine sprite: empty if 0 ammo, full if > 0\r\n            const magazineSrc = currentAmmo > 0 // TODO: Get current ranged weapon\r\n                ? this.charConfig.magazine.glock.full\r\n                : this.charConfig.magazine.glock.empty;\r\n\r\n            // Random position in small radius around player (WORLD coordinates)\r\n            const angle = this.utility.getRandomNum(0, Math.PI * 2);\r\n            const distance = this.utility.getRandomNum(8, 24);\r\n\r\n            const x = this.playerState.myPlayer.transform.pos.x + Math.cos(angle) * distance;\r\n            const y = this.playerState.myPlayer.transform.pos.y + Math.sin(angle) * distance;\r\n            const rotation = this.utility.getRandomNum(0, Math.PI * 2);\r\n            const scale = this.utility.getRandomNum(0.65, 0.75);\r\n\r\n            const decalId = `magazine_${this.userId}_${Date.now()}`;\r\n\r\n            const decalParams: DecalParams = {\r\n                id: decalId,\r\n                pos: { x, y }, // World coordinates\r\n                type: 'image',\r\n                image: {\r\n                    src: magazineSrc,\r\n                    scale: scale,\r\n                    rotation: rotation\r\n                }\r\n            };\r\n            this.createDecal(decalParams);\r\n\r\n            console.log(`Spawned ${currentAmmo > 0 ? 'full' : 'empty'} magazine at reload`);\r\n        }, 150);\r\n    }\r\n    //\r\n    // #endregion\r\n}","import { GAMEPAD_MAP } from \"./Config\";\r\n\r\nimport { Animator } from \"./Animator\";\r\nimport { ChatManager } from \"./ChatManager\";\r\nimport { ControlsManager } from \"./ControlsManager\";\r\nimport { GameState } from \"./GameState\";\r\nimport { RoomController } from \"./RoomController\";\r\nimport { SettingsManager } from \"./SettingsManager\";\r\nimport { UserInterface } from \"./UserInterface\";\r\n\r\nimport { PlayerState } from \"./player/PlayerState\";\r\nimport { Camera } from \"./Camera\";\r\n\r\nexport class EventsManager {\r\n    constructor(\r\n        private animator: Animator,\r\n        private camera: Camera,\r\n        private chatManager: ChatManager,\r\n        private controlsManager: ControlsManager,\r\n        private gameState: GameState,\r\n        private roomController: RoomController,\r\n        private playerState: PlayerState,\r\n        private settingsManager: SettingsManager,\r\n        private ui: UserInterface,\r\n        private userId: string\r\n    ) { }\r\n\r\n    // #region [ Events ]\r\n    //\r\n    /**\r\n     * Initializes all event listeners to the required DOM elements.\r\n     */\r\n    public initEventListeners(): void {\r\n        if (!this.ui.canvas || !this.ui.hostButton || !this.ui.joinButton || !this.ui.quickplayButton ||\r\n            !this.ui.lobbyLeaveButton || !this.ui.lobbyCodeButton || !this.ui.gameLeaveButton ||\r\n            !this.ui.gameCodeButton || !this.ui.startGameBtn || !this.ui.chatSendBtn || !this.ui.chatInput) return;\r\n\r\n        this.ui.hostButton.addEventListener(\"click\", () => this.roomController.hostRoom());\r\n        this.ui.joinButton.addEventListener(\"click\", () => this.roomController.joinRoom());\r\n        this.ui.quickplayButton.addEventListener(\"click\", () => this.roomController.quickPlay());\r\n        this.ui.lobbyLeaveButton.addEventListener(\"click\", () => this.roomController.leaveRoom());\r\n        this.ui.lobbyCodeButton.addEventListener(\"click\", () => this.roomController.copyRoomCode());\r\n        this.ui.gameLeaveButton.addEventListener(\"click\", () => this.roomController.leaveRoom());\r\n        this.ui.gameCodeButton.addEventListener(\"click\", () => this.roomController.copyRoomCode());\r\n        this.ui.startGameBtn.addEventListener(\"click\", () => this.onStartButtonClick());\r\n\r\n        // [ Chat ]\r\n        this.ui.chatSendBtn.addEventListener(\"click\", () => this.chatManager.sendChatMessage(this.userId));\r\n        this.ui.chatInput.addEventListener(\"keypress\", (e) => {\r\n            if (e.key === \"Enter\" && !e.shiftKey) {\r\n                e.preventDefault();\r\n                this.chatManager.sendChatMessage(this.userId);\r\n            }\r\n        });\r\n        this.ui.chatInput.addEventListener(\"focus\", () => {\r\n            this.controlsManager.clearActiveKeys();\r\n\r\n            this.playerState.canShoot = false;\r\n            this.playerState.isSprinting = false;\r\n            this.playerState.isDashing = false;\r\n            this.playerState.isBurstActive = false;\r\n            this.playerState.currentBurstShot = 0;\r\n        });\r\n\r\n        this.ui.chatInput.addEventListener(\"blur\", () => {\r\n            this.controlsManager.clearActiveKeys();\r\n\r\n            this.playerState.canShoot = true;\r\n            this.playerState.isSprinting = false;\r\n            this.playerState.isDashing = false;\r\n        });\r\n\r\n        this.ui.settingsButton?.addEventListener('click', () => {\r\n            this.ui.showSettingsPage();\r\n        });\r\n\r\n        this.ui.settingsCloseButton?.addEventListener('click', () => {\r\n            this.ui.hideSettingsPage();\r\n        })\r\n\r\n        // Prevent right-click context menu on the entire window\r\n        window.addEventListener('contextmenu', (e) => {\r\n            e.preventDefault();\r\n        });\r\n\r\n        // Listen on document for events, not canvas.\r\n        // If this presents issues, swap \"document.\" with \"this.interface.canvas\"\r\n        document.addEventListener('keydown', (e) => this.onKeyDown(e));\r\n        document.addEventListener('keyup', (e) => this.onKeyUp(e));\r\n\r\n        document.addEventListener('mouseup', (e) => this.onMouseUp(e));\r\n        document.addEventListener('mousemove', (e) => this.onMouseMove(e));\r\n\r\n        this.ui.canvas.addEventListener('mousedown', (e) => this.onMouseDown(e)); // Canvas only listening for mouse (shooting mainly)\r\n\r\n        this.ui.switchSettingsPage('sound'); // Init settings page to sound tab on dom load\r\n\r\n        this.ui.controlsTab?.addEventListener('click', () => {\r\n            this.ui.switchSettingsPage('controls');\r\n        });\r\n\r\n        this.ui.graphicsTab?.addEventListener('click', () => {\r\n            this.ui.switchSettingsPage('graphics');\r\n        });\r\n\r\n        this.ui.soundTab?.addEventListener('click', () => {\r\n            this.ui.switchSettingsPage('sound');\r\n        });\r\n\r\n        // Settings page click to open when hidden\r\n        this.ui.controlsBody?.addEventListener('click', () => {\r\n            if (this.ui.controlsBody?.classList.contains('settings_page_hidden')) {\r\n                this.ui.switchSettingsPage('controls');\r\n            }\r\n        });\r\n\r\n        this.ui.graphicsBody?.addEventListener('click', () => {\r\n            if (this.ui.graphicsBody?.classList.contains('settings_page_hidden')) {\r\n                this.ui.switchSettingsPage('graphics');\r\n            }\r\n        });\r\n\r\n        this.ui.soundBody?.addEventListener('click', () => {\r\n            if (this.ui.soundBody?.classList.contains('settings_page_hidden')) {\r\n                this.ui.switchSettingsPage('sound');\r\n            }\r\n        });\r\n\r\n        this.initSettingsAudioSliders();\r\n        this.initSettingsInputListeners();\r\n        this.initSettingsToggleListeners();\r\n    }\r\n\r\n    /**\r\n     * Handles all key press events.\r\n     */\r\n    private onKeyDown(e: KeyboardEvent): void {\r\n        if (this.ui.chatInput === document.activeElement) return;\r\n        if (!this.gameState.gameInProgress || this.gameState.isPaused) return;\r\n\r\n        const key = e.key.toLowerCase();\r\n        const keybinds = this.settingsManager.getSettings().controls.keybinds;\r\n\r\n        const isGameKey = Object.values(keybinds).includes(key);\r\n        if (!isGameKey) return;\r\n\r\n        e.preventDefault();\r\n        this.controlsManager.addKey(key);\r\n    }\r\n\r\n    /**\r\n     * Handles all key release events.\r\n     */\r\n    private onKeyUp(e: KeyboardEvent): void {\r\n        if (this.ui.chatInput === document.activeElement) return;\r\n        if (!this.gameState.gameInProgress) return;\r\n\r\n        const key = e.key.toLowerCase();\r\n        const keybinds = this.settingsManager.getSettings().controls.keybinds;\r\n\r\n        if (!Object.values(keybinds).includes(key)) return;\r\n\r\n        e.preventDefault();\r\n        this.controlsManager.removeKey(key);\r\n    }\r\n\r\n    /**\r\n     * Handles all mouse click events.\r\n     */\r\n    private onMouseDown(e: MouseEvent): void {\r\n        if (this.ui.chatInput === document.activeElement) return;\r\n        if (!this.gameState.gameInProgress || this.gameState.isPaused || !this.ui.canvas) return;\r\n\r\n        if (e.button === 0) {\r\n            this.updateMouse(e);\r\n            this.controlsManager.addKey('mouse1'); // Left Click\r\n        } else if (e.button === 1) {\r\n            this.controlsManager.addKey('mouse3'); // Middle Click\r\n        } else if (e.button === 2) {\r\n            this.updateMouse(e);\r\n            this.controlsManager.addKey('mouse2'); // Right Click\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Handles all mouse release events.\r\n     */\r\n    private onMouseUp(e: MouseEvent): void {\r\n        if (this.ui.chatInput === document.activeElement) return;\r\n        if (!this.gameState.gameInProgress) return;\r\n\r\n        if (e.button === 0) {\r\n            this.controlsManager.removeKey('mouse1'); // Left Click\r\n        } else if (e.button === 1) {\r\n            this.controlsManager.addKey('mouse3'); // Middle Click\r\n        } else if (e.button === 2) {\r\n            this.controlsManager.removeKey('mouse2'); // Right Click\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Handles all mouse movement events.\r\n     */\r\n    private onMouseMove(e: MouseEvent): void {\r\n        if (this.ui.chatInput === document.activeElement) return;\r\n        if (!this.gameState.gameInProgress || this.gameState.isPaused) return;\r\n\r\n        this.updateMouse(e);\r\n        const mousePos = this.controlsManager.getMousePos();\r\n\r\n        // Convert mouse screen position to world position\r\n        const worldMousePos = this.camera.screenToWorld(mousePos);\r\n\r\n        // Calculate distance from player\r\n        const dx = worldMousePos.x - this.playerState.myPlayer.transform.pos.x;\r\n        const dy = worldMousePos.y - this.playerState.myPlayer.transform.pos.y;\r\n        const distance = Math.sqrt(dx * dx + dy * dy);\r\n\r\n        // Calculate target rotation\r\n        const targetRotation = Math.atan2(dy, dx) + Math.PI / 2;\r\n\r\n        // Apply distance-based dampening\r\n        const falloffRadius = 100; // Distance where dampening starts (make this the camera.offset)\r\n        const minIntensity = 0.1; // Minimum rotation speed (10% at player center)\r\n\r\n        let intensity = 1.0;\r\n        if (distance < falloffRadius) {\r\n            // Smooth falloff: 100% at edge  15% at center\r\n            intensity = minIntensity + (1 - minIntensity) * (distance / falloffRadius);\r\n        }\r\n\r\n        // Get current rotation\r\n        const currentRotation = this.playerState.myPlayer.transform.rot;\r\n\r\n        // Lerp between current and target based on intensity\r\n        const newRotation = currentRotation + (targetRotation - currentRotation) * intensity;\r\n\r\n        // Rotate my character\r\n        this.animator.rotateCharacterPart(this.userId, newRotation);\r\n    }\r\n\r\n    /**\r\n     * Processes mouse position and updates.\r\n     */\r\n    private updateMouse(e: MouseEvent): void {\r\n        if (this.ui.chatInput === document.activeElement) return;\r\n        if (!this.ui.canvas) return;\r\n\r\n        const rect = this.ui.canvas.getBoundingClientRect();\r\n        const x = e.clientX - rect.left;\r\n        const y = e.clientY - rect.top;\r\n\r\n        this.controlsManager.setMousePos({ x, y });\r\n    }\r\n\r\n    /**\r\n     * Called when the Start Game button is pressed.\r\n     */\r\n    private onStartButtonClick(): void {\r\n        const event = new CustomEvent(\"customEvent_startGame\");\r\n        window.dispatchEvent(event);\r\n    }\r\n    //\r\n    // #endregion\r\n\r\n    // #region [ Settings Page ]\r\n    //\r\n    /**\r\n     * Initializes event listeners for audio sliders on audio settings page.\r\n     */\r\n    private initSettingsAudioSliders(): void {\r\n        const sliders = [\r\n            { slider: this.ui.masterSlider, fill: this.ui.masterFill, value: this.ui.masterValue, channel: 'master' },\r\n            { slider: this.ui.interfaceSlider, fill: this.ui.interfaceFill, value: this.ui.interfaceValue, channel: 'interface' },\r\n            { slider: this.ui.musicSlider, fill: this.ui.musicFill, value: this.ui.musicValue, channel: 'music' },\r\n            { slider: this.ui.sfxSlider, fill: this.ui.sfxFill, value: this.ui.sfxValue, channel: 'sfx' },\r\n            { slider: this.ui.voiceSlider, fill: this.ui.voiceFill, value: this.ui.voiceValue, channel: 'voice' }\r\n        ];\r\n\r\n        sliders.forEach(({ slider, fill, value, channel }) => {\r\n            if (!slider || !fill || !value) return;\r\n\r\n            slider.addEventListener('mousedown', (e) => {\r\n                const handleMove = (moveEvent: MouseEvent) => {\r\n                    const sliderValue = this.ui.calculateSliderValue(slider, moveEvent.clientX);\r\n                    this.ui.updateSettingsSlider(fill, value, sliderValue);\r\n\r\n                    this.settingsManager.updateSettings({\r\n                        audio: {\r\n                            mixer: {\r\n                                [channel]: sliderValue\r\n                            }\r\n                        }\r\n                    });\r\n                };\r\n\r\n                const handleUp = () => {\r\n                    document.removeEventListener('mousemove', handleMove);\r\n                    document.removeEventListener('mouseup', handleUp);\r\n                };\r\n\r\n                handleMove(e);\r\n                document.addEventListener('mousemove', handleMove);\r\n                document.addEventListener('mouseup', handleUp);\r\n                e.preventDefault();\r\n            });\r\n        });\r\n    }\r\n\r\n    /**\r\n     * Initializes event listeners for input fields on all settings pages.\r\n     */\r\n    private initSettingsInputListeners(): void {\r\n        const inputs = [\r\n            { input: this.ui.deadzoneInput, settingPath: 'controls.gamepad.deadzone', parse: parseFloat }\r\n            // Future inputs go here: { input: this.ui.someInput, settingPath: 'path.to.setting', parse: parseFloat }\r\n        ];\r\n\r\n        inputs.forEach(({ input, settingPath, parse }) => {\r\n            if (!input) return;\r\n\r\n            input.addEventListener('change', () => {\r\n                const rawValue = input.value;\r\n                const parsedValue = parse(rawValue);\r\n\r\n                if (isNaN(parsedValue)) return; // Invalid input\r\n\r\n                // Build nested update object\r\n                const pathParts = settingPath.split('.');\r\n                const update: any = {};\r\n                let current = update;\r\n\r\n                for (let i = 0; i < pathParts.length - 1; i++) {\r\n                    current[pathParts[i]] = {};\r\n                    current = current[pathParts[i]];\r\n                }\r\n                current[pathParts[pathParts.length - 1]] = parsedValue;\r\n\r\n                this.settingsManager.updateSettings(update);\r\n            });\r\n        });\r\n    }\r\n\r\n    /**\r\n     * Initializes event listeners for toggles on all settings pages.\r\n     */\r\n    private initSettingsToggleListeners(): void {\r\n        const toggles = [\r\n            { toggle: this.ui.particleJSToggle, settingPath: 'graphics.renderBackgroundParticles' },\r\n            { toggle: this.ui.staticVfxToggle, settingPath: 'graphics.showStaticOverlay' },\r\n            { toggle: this.ui.ammoReservesPhysicsToggle, settingPath: 'graphics.physics.ammoReserves' }\r\n        ];\r\n\r\n        toggles.forEach(({ toggle, settingPath }) => {\r\n            if (!toggle) return;\r\n\r\n            toggle.addEventListener('click', () => {\r\n                const currentValue = toggle.getAttribute('aria-checked') === 'true';\r\n                const newValue = !currentValue;\r\n\r\n                // Update toggle visually\r\n                if (newValue) {\r\n                    toggle.setAttribute('checked', 'true');\r\n                    toggle.setAttribute('aria-checked', 'true');\r\n                } else {\r\n                    toggle.removeAttribute('checked');\r\n                    toggle.setAttribute('aria-checked', 'false');\r\n                }\r\n\r\n                // Build nested update object\r\n                const pathParts = settingPath.split('.');\r\n                const update: any = {};\r\n                let current = update;\r\n\r\n                for (let i = 0; i < pathParts.length - 1; i++) {\r\n                    current[pathParts[i]] = {};\r\n                    current = current[pathParts[i]];\r\n                }\r\n                current[pathParts[pathParts.length - 1]] = newValue;\r\n\r\n                this.settingsManager.updateSettings(update);\r\n            });\r\n        });\r\n    }\r\n\r\n    /**\r\n     * Initializes the keybinds interface, with user prefs or defaults.\r\n     * \r\n     * Also sets up keybind change listeners.\r\n     */\r\n    public initKeybindListeners(): void {\r\n        const controlsSettings = this.settingsManager.getSettings().controls;\r\n        this.ui.initKeybindsInterface(\r\n            controlsSettings,\r\n            (action, type, newBinding) => this.onBindingChange(action, type, newBinding)\r\n        );\r\n    }\r\n\r\n    /**\r\n     * Event that fires on keybind or gamepad press when input change modal is visible.\r\n     */\r\n    public onBindingChange(action: string, type: 'keybind' | 'gamepad', newBinding: string | number): void {\r\n        if (type === 'keybind') {\r\n            this.settingsManager.updateSettings({\r\n                controls: {\r\n                    keybinds: {\r\n                        [action]: newBinding as string\r\n                    }\r\n                }\r\n            });\r\n\r\n            const element = document.getElementById(`${action}Keybind`);\r\n            if (element) {\r\n                element.textContent = newBinding === ' ' ? 'SPACE' : (newBinding as string).toUpperCase();\r\n            }\r\n        } else {\r\n            this.settingsManager.updateSettings({\r\n                controls: {\r\n                    gamepad: {\r\n                        [action]: newBinding as number\r\n                    }\r\n                }\r\n            });\r\n\r\n            const element = document.getElementById(`${action}Gamepad`);\r\n            if (element) {\r\n                const buttonName = Object.keys(GAMEPAD_MAP).find(\r\n                    key => typeof GAMEPAD_MAP[key as keyof typeof GAMEPAD_MAP] === 'number'\r\n                        && GAMEPAD_MAP[key as keyof typeof GAMEPAD_MAP] === newBinding\r\n                );\r\n                element.textContent = buttonName || newBinding.toString();\r\n            }\r\n        }\r\n    }\r\n}","import { GAME } from \"./Config\";\r\n\r\nexport class GameState {\r\n    /**\r\n     * Tracks paused state of the application.\r\n     */\r\n    public isPaused = false;\r\n\r\n    /**\r\n     * Becomes true when game loop starts.\r\n     * \r\n     * False when game loop is no longer ongoing (end game, websocket disconnect, leave room)\r\n     */\r\n    public gameInProgress = false;\r\n\r\n    /**\r\n     * Max wins needed for session to end.\r\n     */\r\n    public gameMaxWins = GAME.MAX_WINS;\r\n\r\n    /**\r\n     * Max players allowed in a game.\r\n     */\r\n    public gameMaxPlayers = GAME.MAX_PLAYERS;\r\n\r\n    constructor() {}\r\n}","import { LobbyControlsParams, LobbyOptionsParams, LobbyPlayer, SetInputParams, SetToggleParams } from \"./Types\";\r\n\r\nimport { UserInterface } from \"./UserInterface\";\r\nimport { RoomManager } from \"./RoomManager\";\r\nimport { Utility } from \"./Utility\";\r\nimport { CharacterManager } from \"./CharacterManager\";\r\nimport { PlayerState } from \"./player/PlayerState\";\r\nimport { PlayerConfig } from \"./player/PlayerConfig\";\r\n\r\nexport class LobbyManager {\r\n    public inLobby = false;\r\n    public lobbyPlayers: Map<string, LobbyPlayer> = new Map(); // Temporary partial player object used for lobby only information\r\n    private charCustomizeHandlers: Array<{ element: HTMLElement, handler: () => void }> = []; // Event handlers for lobby customization arrows\r\n\r\n    constructor(\r\n        private characterManager: CharacterManager,\r\n        private playerConfig: PlayerConfig,\r\n        private playerState: PlayerState,\r\n        private roomManager: RoomManager,\r\n        private ui: UserInterface,\r\n        private utility: Utility\r\n    ) { }\r\n\r\n    // #region [ Lobby Controls ]\r\n    //\r\n    /**\r\n     * Calls updateDisplay to show the lobby specific controls.\r\n     */\r\n    public showLobbyControls(params: LobbyControlsParams): void {\r\n        const { lobby, lobbyOptions, myPlayer, roomId, userId } = params;\r\n        const { isHost, maxWins, privateRoom, upgradesEnabled } = lobbyOptions;\r\n\r\n        this.ui.updateDisplay(lobby, \"lobby\", roomId);\r\n\r\n        const centerX = this.ui.charCustomizeCanvas ? this.ui.charCustomizeCanvas.width / 2 : 0;\r\n        const centerY = this.ui.charCustomizeCanvas ? this.ui.charCustomizeCanvas.height / 2 : 0;\r\n\r\n        // Add myself to lobby\r\n        this.lobbyPlayers.set(userId, {\r\n            id: userId,\r\n            color: myPlayer.color,\r\n            isHost: isHost,\r\n            rig: { //TODO: Load from the user's saved charCustomization\r\n                body: this.playerConfig.default.rig.body,\r\n                head: this.playerConfig.default.rig.head,\r\n                headwear: this.playerConfig.default.rig.headwear,\r\n                weapon: this.playerConfig.default.rig.weapon\r\n            },\r\n            transform: {\r\n                pos: { x: centerX, y: centerY },\r\n                rot: 0\r\n            }\r\n        });\r\n\r\n        // Setup lobby inputs/toggles using nested options\r\n        this.setupLobbyOptions(lobbyOptions);\r\n\r\n        const winsInputParams: SetInputParams = {\r\n            inputId: \"winsInput\",\r\n            value: maxWins\r\n        };\r\n        const privateToggleParams: SetToggleParams = {\r\n            toggleId: \"privateToggle\",\r\n            value: privateRoom\r\n        };\r\n        const upgradesToggleParams: SetToggleParams = {\r\n            toggleId: \"upgradesToggle\",\r\n            value: upgradesEnabled\r\n        };\r\n\r\n        this.utility.setToggle(privateToggleParams);\r\n        this.utility.setToggle(upgradesToggleParams);\r\n        this.utility.setInput(winsInputParams);\r\n\r\n        this.ui.displayLobbyPlayers(isHost, lobby, userId);\r\n        this.ui.updateHostDisplay(isHost, lobby);\r\n\r\n        window.dispatchEvent(new CustomEvent(\"customEvent_renderCharacter\"));\r\n        this.setupCharacterCustomization();\r\n    }\r\n    //\r\n    // #endregion\r\n\r\n    // #region [ Lobby Options ]\r\n    //\r\n    /**\r\n     * Sets up lobby toggles and input for game settings.\r\n     */\r\n    public setupLobbyOptions(params: LobbyOptionsParams): void {\r\n        this.setupLobbyToggle('privateToggle', params.isHost, 'privateRoom', () => params.privateRoom, (val) => params.privateRoom = val);\r\n        this.setupLobbyToggle('upgradesToggle', params.isHost, 'upgradesEnabled', () => params.upgradesEnabled, (val) => params.upgradesEnabled = val);\r\n        this.setupLobbyInput('winsInput', params.isHost, 'maxWins', () => params.maxWins, (val) => params.maxWins = val);\r\n        this.setupLobbyInput('playersInput', params.isHost, 'maxPlayers', () => params.maxPlayers, (val) => params.maxPlayers = val);\r\n    }\r\n\r\n    /**\r\n     * Called by setupLobbyOptions - Responsible for toggles.\r\n     */\r\n    private setupLobbyToggle(elementProp: 'privateToggle' | 'upgradesToggle', isHost: boolean, messageKey: string, getter: () => boolean, setter: (val: boolean) => void): void {\r\n        const element = this.ui[elementProp];\r\n        if (!element) return;\r\n\r\n        // Store the handler so we can remove it later\r\n        const handlerKey = `${elementProp}Handler` as keyof this;\r\n\r\n        // Remove existing listener if it exists\r\n        if (this[handlerKey]) {\r\n            element.removeEventListener('click', this[handlerKey] as EventListener);\r\n        }\r\n\r\n        // Create and store the new handler\r\n        const handler = () => {\r\n            if (!isHost) return;\r\n\r\n            const newValue = !getter();\r\n            setter(newValue);\r\n\r\n            const toggleParams: SetToggleParams = {\r\n                toggleId: elementProp,\r\n                value: newValue\r\n            }\r\n            this.utility.setToggle(toggleParams);\r\n\r\n            this.roomManager.sendMessage(JSON.stringify({\r\n                type: 'lobby-options',\r\n                [messageKey]: newValue\r\n            }));\r\n\r\n            console.log(`${messageKey} changed to: ${newValue}`);\r\n        };\r\n\r\n        // Store handler for later removal & add listener\r\n        (this as any)[handlerKey] = handler;\r\n        element.addEventListener('click', handler);\r\n    }\r\n\r\n    /**\r\n     * Called by setupLobbyOptions - Responsible for input fields.\r\n     */\r\n    private setupLobbyInput(elementProp: 'winsInput' | 'playersInput', isHost: boolean, messageKey: string, getter: () => number, setter: (val: number) => void): void {\r\n        const element = this.ui[elementProp];\r\n        if (!element) return;\r\n\r\n        // Store the handler so we can remove it later\r\n        const handlerKey = `${elementProp}Handler` as keyof this;\r\n\r\n        // Remove existing listener if it exists\r\n        if (this[handlerKey]) {\r\n            element.removeEventListener('change', this[handlerKey] as EventListener);\r\n        }\r\n\r\n        // Create and store the new handler\r\n        const handler = () => {\r\n            if (!isHost) return;\r\n\r\n            const newValue = parseInt(element.value);\r\n            if (isNaN(newValue) || newValue < 1) {\r\n                element.value = getter().toString();\r\n                return;\r\n            }\r\n\r\n            setter(newValue);\r\n\r\n            const inputParams: SetInputParams = {\r\n                inputId: elementProp,\r\n                value: newValue\r\n            }\r\n            this.utility.setInput(inputParams);\r\n\r\n            this.roomManager.sendMessage(JSON.stringify({\r\n                type: 'lobby-options',\r\n                [messageKey]: newValue\r\n            }));\r\n\r\n            console.log(`${messageKey} changed to: ${newValue}`);\r\n        };\r\n\r\n        // Store handler for later removal & setup listener\r\n        (this as any)[handlerKey] = handler;\r\n        element.addEventListener('change', handler);\r\n    }\r\n\r\n    /**\r\n     * Syncs lobby options when state change messages are received over websocket.\r\n     */\r\n    public syncLobbyOptions(options: any): void {\r\n        this.syncOption(options, 'privateRoom', 'isPrivateRoom', 'privateToggle', this.utility.setToggle.bind(this.utility), 'Lobby privacy', (v) => v ? 'Private' : 'Public');\r\n        this.syncOption(options, 'maxWins', 'gameMaxWins', 'winsInput', this.utility.setInput.bind(this.utility), 'Game max wins');\r\n        this.syncOption(options, 'maxPlayers', 'gameMaxPlayers', 'playersInput', this.utility.setInput.bind(this.utility), 'Game max players');\r\n        this.syncOption(options, 'upgradesEnabled', 'isUpgradesEnabled', 'upgradesToggle', this.utility.setToggle.bind(this.utility), 'Game upgrades toggled');\r\n    }\r\n\r\n    /**\r\n     * [DO NOT CALL] Syncs a lobby option - called by syncLobbyOptions.\r\n     */\r\n    private syncOption<T extends SetInputParams | SetToggleParams>(options: any, key: string, prop: string, elementId: string, fn: (params: T) => void, label: string, format?: (v: any) => string): void {\r\n        if (options[key] === undefined) return;\r\n\r\n        (this as any)[prop] = options[key];\r\n\r\n        // Build params object based on element type\r\n        const params = elementId.includes('Input')\r\n            ? { inputId: elementId, value: options[key] } as T\r\n            : { toggleId: elementId, value: options[key] } as T;\r\n\r\n        fn(params);\r\n\r\n        const displayValue = format ? format(options[key]) : options[key];\r\n        console.log(`${label} synced to: ${displayValue}`);\r\n    }\r\n    //\r\n    // #endregion\r\n\r\n    // #region [ Lobby Player Management ]\r\n    //\r\n    /**\r\n     * Promote specific player to host.\r\n     */\r\n    public promotePlayer(playerId: string): void {\r\n        this.roomManager.sendMessage(JSON.stringify({\r\n            type: 'promote-player',\r\n            targetPlayerId: playerId\r\n        }));\r\n    }\r\n\r\n    /**\r\n     * Kick specific  player from the current lobby.\r\n     */\r\n    public kickPlayer(playerId: string): void {\r\n        this.roomManager.sendMessage(JSON.stringify({\r\n            type: 'kick-player',\r\n            targetPlayerId: playerId\r\n        }));\r\n    }\r\n    //\r\n    // #endregion\r\n\r\n    // #region [ Char Customization ]\r\n    //\r\n    /**\r\n     * Initializes the lobby character customization menu buttons.\r\n     */\r\n    public setupCharacterCustomization(): void {\r\n        if (!this.ui.bodyArrowLeft || !this.ui.bodyArrowRight ||\r\n            !this.ui.headArrowLeft || !this.ui.headArrowRight ||\r\n            !this.ui.headwearArrowLeft || !this.ui.headwearArrowRight) return;\r\n\r\n        const myLobbyPlayer = this.lobbyPlayers.get(this.playerState.myPlayer.id);\r\n        if (!myLobbyPlayer) return;\r\n\r\n        // Remove all old listeners\r\n        this.charCustomizeHandlers.forEach(({ element, handler }) => {\r\n            element.removeEventListener('click', handler);\r\n        });\r\n        this.charCustomizeHandlers = [];\r\n\r\n        // Helper to add and track listeners\r\n        const addHandler = (element: HTMLElement, handler: () => void) => {\r\n            this.charCustomizeHandlers.push({ element, handler });\r\n            element.addEventListener('click', handler);\r\n        };\r\n\r\n        // Body arrows\r\n        addHandler(this.ui.bodyArrowLeft, () => this.cycleRigVariant('body', -1));\r\n        addHandler(this.ui.bodyArrowRight, () => this.cycleRigVariant('body', 1));\r\n\r\n        // Head arrows\r\n        addHandler(this.ui.headArrowLeft, () => this.cycleRigVariant('head', -1));\r\n        addHandler(this.ui.headArrowRight, () => this.cycleRigVariant('head', 1));\r\n\r\n        // Headwear arrows\r\n        addHandler(this.ui.headwearArrowLeft, () => this.cycleRigVariant('headwear', -1));\r\n        addHandler(this.ui.headwearArrowRight, () => this.cycleRigVariant('headwear', 1));\r\n    }\r\n\r\n    /**\r\n     * Responsible for swapping layers in the character customizer. Arrow buttons call this, via event handlers.\r\n     */\r\n    private cycleRigVariant(rigProp: 'body' | 'head' | 'headwear' | 'weapon', direction: number): void {\r\n        const myLobbyPlayer = this.lobbyPlayers.get(this.playerState.myPlayer.id);\r\n        if (!myLobbyPlayer) return;\r\n\r\n        // Get all variants for this layer\r\n        const allVariants = Object.keys(this.characterManager['charConfig'][rigProp]);\r\n\r\n        // Find current index\r\n        const currentVariant = myLobbyPlayer.rig[rigProp];\r\n        const currentIndex = allVariants.indexOf(currentVariant);\r\n\r\n        // Calculate new index (with wrapping)\r\n        let newIndex = currentIndex + direction;\r\n        if (newIndex < 0) {\r\n            newIndex = allVariants.length - 1; // Wrap to last\r\n        } else if (newIndex >= allVariants.length) {\r\n            newIndex = 0; // Wrap to first\r\n        }\r\n\r\n        // Update the rig\r\n        myLobbyPlayer.rig[rigProp] = allVariants[newIndex];\r\n\r\n        window.dispatchEvent(new CustomEvent(\"customEvent_renderCharacter\"));\r\n    }\r\n    //\r\n    // #endregion\r\n}","import { ParticleParams } from \"./Types\";\r\n\r\nexport class ParticlesConfig {\r\n    public particles = {\r\n        blood: {\r\n            drip: {\r\n                count: {\r\n                    min: 1,\r\n                    max: 4\r\n                },\r\n                lifetime: {\r\n                    min: 800,\r\n                    max: 1000\r\n                },\r\n                noise: {\r\n                    strength: {\r\n                        min: 0,\r\n                        max: 0\r\n                    },\r\n                    scale: {\r\n                        min: 0,\r\n                        max: 0\r\n                    }\r\n                },\r\n                opacity: {\r\n                    min: 0.25,\r\n                    max: 0.75\r\n                },\r\n                speed: {\r\n                    min: 0.25,\r\n                    max: 0.75\r\n                },\r\n                sizeOverLifetime: {\r\n                    min: 0,\r\n                    max: 0\r\n                },\r\n                size: {\r\n                    min: 0.125,\r\n                    max: 2.275\r\n                },\r\n                torque: {\r\n                    min: -720,\r\n                    max: 720\r\n                },\r\n                collide: true,\r\n                fade: true,\r\n                paint: false,\r\n                spread: 0.25,\r\n                stain: true,\r\n                colors: [\"#690303\", \"#820c0c\", \"#a70707\"]\r\n            } as ParticleParams,\r\n            spray: {\r\n                count: {\r\n                    min: 4,\r\n                    max: 12\r\n                },\r\n                lifetime: {\r\n                    min: 150,\r\n                    max: 1200\r\n                },\r\n                noise: {\r\n                    strength: {\r\n                        min: 0,\r\n                        max: 0\r\n                    },\r\n                    scale: {\r\n                        min: 0,\r\n                        max: 0\r\n                    }\r\n                },\r\n                opacity: {\r\n                    min: 0.425,\r\n                    max: 0.775\r\n                },\r\n                speed: {\r\n                    min: 1.5,\r\n                    max: 4.75\r\n                },\r\n                sizeOverLifetime: {\r\n                    min: 0,\r\n                    max: 0\r\n                },\r\n                size: {\r\n                    min: 0.75,\r\n                    max: 3.5\r\n                },\r\n                torque: {\r\n                    min: -720,\r\n                    max: 720\r\n                },\r\n                collide: true,\r\n                fade: false,\r\n                paint: true,\r\n                spread: 0.425,\r\n                stain: true,\r\n                colors: [\"#7e0a0a\", \"#941414\", \"#b51a1a\"]\r\n            } as ParticleParams,\r\n        },\r\n        glock: {\r\n            muzzle: {\r\n                smoke: {\r\n                    count: {\r\n                        min: 3,\r\n                        max: 6\r\n                    },\r\n                    lifetime: {\r\n                        min: 800,\r\n                        max: 1400\r\n                    },\r\n                    noise: {\r\n                        strength: {\r\n                            min: 0,\r\n                            max: 0\r\n                        },\r\n                        scale: {\r\n                            min: 0,\r\n                            max: 0\r\n                        }\r\n                    },\r\n                    opacity: {\r\n                        min: 0.15,\r\n                        max: 0.35\r\n                    },\r\n                    speed: {\r\n                        min: 0.5,\r\n                        max: 1.5\r\n                    },\r\n                    size: {\r\n                        min: 4,\r\n                        max: 8\r\n                    },\r\n                    sizeOverLifetime: {\r\n                        min: 2,\r\n                        max: 3\r\n                    },\r\n                    torque: {\r\n                        min: -180,\r\n                        max: 180\r\n                    },\r\n                    collide: false,\r\n                    fade: true,\r\n                    paint: false,\r\n                    spread: 0.4,\r\n                    stain: false,\r\n                    colors: [\"#5a5a5a\", \"#7a7a7a\"]\r\n                } as ParticleParams,\r\n                flash: {\r\n                    count: {\r\n                        min: 8,\r\n                        max: 15\r\n                    },\r\n                    lifetime: {\r\n                        min: 150,\r\n                        max: 300\r\n                    },\r\n                    noise: {\r\n                        strength: {\r\n                            min: 0,\r\n                            max: 0\r\n                        },\r\n                        scale: {\r\n                            min: 0,\r\n                            max: 0\r\n                        }\r\n                    },\r\n                    opacity: {\r\n                        min: 0.4,\r\n                        max: 0.8\r\n                    },\r\n                    speed: {\r\n                        min: 4,\r\n                        max: 10\r\n                    },\r\n                    sizeOverLifetime: {\r\n                        min: 0,\r\n                        max: 0\r\n                    },\r\n                    size: {\r\n                        min: 1,\r\n                        max: 3\r\n                    },\r\n                    torque: {\r\n                        min: 0,\r\n                        max: 0\r\n                    },\r\n                    collide: false,\r\n                    fade: true,\r\n                    paint: false,\r\n                    spread: 0.6,\r\n                    stain: false,\r\n                    colors: [\"#ffaa00\", \"#f3b02a\", \"#edbe60\"]\r\n                } as ParticleParams,\r\n            },\r\n            projectile: {\r\n                shell: {\r\n                    count: {\r\n                        min: 1,\r\n                        max: 1\r\n                    },\r\n                    lifetime: {\r\n                        min: 250,\r\n                        max: 550\r\n                    },\r\n                    noise: {\r\n                        strength: {\r\n                            min: 0,\r\n                            max: 0\r\n                        },\r\n                        scale: {\r\n                            min: 0,\r\n                            max: 0\r\n                        }\r\n                    },\r\n                    opacity: {\r\n                        min: 1.0,\r\n                        max: 1.0\r\n                    },\r\n                    speed: {\r\n                        min: 5,\r\n                        max: 8\r\n                    },\r\n                    sizeOverLifetime: {\r\n                        min: 0,\r\n                        max: 0\r\n                    },\r\n                    size: {\r\n                        min: 2,\r\n                        max: 2\r\n                    },\r\n                    torque: {\r\n                        min: -720,\r\n                        max: 720\r\n                    },\r\n                    collide: true,\r\n                    fade: false,\r\n                    paint: true,\r\n                    spread: 0.4,\r\n                    stain: false,\r\n                    colors: [\"#d4af37\", \"#c69e1c\", \"#dcb01f\"]\r\n                } as ParticleParams,\r\n                sparks: {\r\n                    count: {\r\n                        min: 8,\r\n                        max: 16\r\n                    },\r\n                    lifetime: {\r\n                        min: 150,\r\n                        max: 300\r\n                    },\r\n                    noise: {\r\n                        strength: {\r\n                            min: 0.25,\r\n                            max: 5\r\n                        },\r\n                        scale: {\r\n                            min: 0.25,\r\n                            max: 1.5\r\n                        }\r\n                    },\r\n                    opacity: {\r\n                        min: 0.4,\r\n                        max: 0.8\r\n                    },\r\n                    speed: {\r\n                        min: 4,\r\n                        max: 10\r\n                    },\r\n                    size: {\r\n                        min: 1,\r\n                        max: 3\r\n                    },\r\n                    sizeOverLifetime: {\r\n                        min: 0,\r\n                        max: 0\r\n                    },\r\n                    torque: {\r\n                        min: -720,\r\n                        max: 720\r\n                    },\r\n                    collide: false,\r\n                    fade: true,\r\n                    paint: false,\r\n                    spread: 0.6,\r\n                    stain: false,\r\n                    colors: [\"#ffaa00\", \"#ffcf70\", \"#f9dea7\"]\r\n                } as ParticleParams,\r\n            }\r\n        }\r\n    };\r\n\r\n    constructor() { }\r\n}","import { OBJECT_DEFAULTS, WORLD } from \"./Config\";\r\nimport { CreateParticleParams, DeathDecal, DeathStamp, DecalParams, Emitter, EmitterParams, Particle, ParticleParams, PlayerHitParams, Shrapnel, ShrapnelPiece } from \"./Types\";\r\n\r\nimport { CharacterConfig } from \"./CharacterConfig\";\r\nimport { DecalsManager } from \"./DecalsManager\";\r\nimport { RenderingManager } from \"./RenderingManager\";\r\nimport { RoomManager } from \"./RoomManager\";\r\nimport { UserInterface } from \"./UserInterface\";\r\nimport { Utility } from \"./Utility\";\r\n\r\nimport { PlayerState } from \"./player/PlayerState\";\r\nimport { CollisionsManager } from \"./CollisionsManager\";\r\nimport { ParticlesConfig } from \"./ParticlesConfig\";\r\nimport { Camera } from \"./Camera\";\r\n\r\nexport class ParticlesManager {\r\n    public particlesConfig: ParticlesConfig;\r\n\r\n    public particles: Map<string, Particle> = new Map();\r\n    public emitters: Map<string, Emitter> = new Map();\r\n    public shrapnel: Map<string, ShrapnelPiece> = new Map();\r\n\r\n    constructor(\r\n        private camera: Camera,\r\n        private charConfig: CharacterConfig,\r\n        private collisionsManager: CollisionsManager,\r\n        private decalsManager: DecalsManager,\r\n        private playerState: PlayerState,\r\n        private renderingManager: RenderingManager,\r\n        private roomManager: RoomManager,\r\n        private ui: UserInterface,\r\n        private userId: string,\r\n        private utility: Utility\r\n    ) {\r\n        this.particlesConfig = new ParticlesConfig();\r\n    }\r\n\r\n    // #region [ Particles ]\r\n    //\r\n    // [ Basic Particles ]\r\n    //\r\n    /**\r\n     * Creates particles with params. Entrypoint for all particle creations.\r\n     */\r\n    public createParticles(params: CreateParticleParams): void {\r\n        this.generateParticles(params);\r\n\r\n        this.roomManager.sendMessage(JSON.stringify({\r\n            type: 'add-particles',\r\n            params: params\r\n        }));\r\n    }\r\n\r\n    /**\r\n     * Create a particles locally when receiving an 'add-particles' network message.\r\n     */\r\n    public createParticlesNetwork(params: CreateParticleParams): void {\r\n        if (this.particles.has(params.id)) return; // Don't create duplicate particles\r\n\r\n        this.generateParticles(params);\r\n    }\r\n    \r\n    /**\r\n     * Responsible for actual generation of particles locally.\r\n     */\r\n    public generateParticles(params: CreateParticleParams): void {\r\n        const particleParams: ParticleParams = params.particleParams;\r\n\r\n        const count = Math.floor(this.utility.getRandomNum(particleParams.count.min, particleParams.count.max));\r\n\r\n        for (let i = 0; i < count; i++) {\r\n            const lifetime = this.utility.getRandomNum(particleParams.lifetime.min, particleParams.lifetime.max);\r\n            const speed = this.utility.getRandomNum(particleParams.speed.min, particleParams.speed.max);\r\n            const size = this.utility.getRandomNum(particleParams.size.min, particleParams.size.max);\r\n            const opacity = this.utility.getRandomNum(particleParams.opacity.min, particleParams.opacity.max);\r\n            const torque = this.utility.getRandomNum(particleParams.torque.min, particleParams.torque.max);\r\n            const noiseStrength = this.utility.getRandomNum(particleParams.noise.strength.min, particleParams.noise.strength.max);\r\n            const noiseScale = this.utility.getRandomNum(particleParams.noise.scale.min, particleParams.noise.scale.max);\r\n            const sizeOverLifetime = this.utility.getRandomNum(particleParams.sizeOverLifetime.min, particleParams.sizeOverLifetime.max);\r\n\r\n            // Pick random color from array\r\n            const chosenColor = this.utility.getRandomInArray(particleParams.colors);\r\n\r\n            let angle;\r\n            if (params.direction) {\r\n                angle = Math.atan2(params.direction.y, params.direction.x) + (this.utility.getRandomNum(0, 1) - 0.5) * particleParams.spread;\r\n            } else {\r\n                angle = this.utility.getRandomNum(0, Math.PI * 2);\r\n            }\r\n\r\n            const particle: Particle = {\r\n                age: 0,\r\n                collide: particleParams.collide,\r\n                color: chosenColor,\r\n                fade: particleParams.fade,\r\n                hasCollided: false,\r\n                id: `${params.id}_${i}`,\r\n                initialSize: size,\r\n                lifetime: lifetime,\r\n                maxOpacity: opacity,\r\n                noiseScale: noiseScale,\r\n                noiseStrength: noiseStrength,\r\n                opacity: opacity,\r\n                paint: particleParams.paint,\r\n                pos: {\r\n                    x: params.pos.x,\r\n                    y: params.pos.y\r\n                },\r\n                size: size,\r\n                stain: particleParams.stain,\r\n                torque: torque,\r\n                rotation: this.utility.getRandomNum(0, Math.PI * 2),\r\n                sizeOverLifetime: sizeOverLifetime,\r\n                velocity: {\r\n                    x: Math.cos(angle) * speed,\r\n                    y: Math.sin(angle) * speed\r\n                }\r\n            };\r\n\r\n            this.particles.set(particle.id, particle);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Handles updating of all particles in the game during the update loop.\r\n     */\r\n    public updateParticles(delta: number): void {\r\n        const particlesToRemove: string[] = [];\r\n\r\n        this.particles.forEach((particle, id) => {\r\n            if (particle.noiseStrength > 0 && particle.noiseScale > 0) {\r\n                const time = Date.now() * 0.001; // Use time for animation\r\n                const noiseX = this.utility.simplexNoise2D(particle.pos.x / particle.noiseScale, time);\r\n                const noiseY = this.utility.simplexNoise2D(particle.pos.y / particle.noiseScale, time + 100);\r\n\r\n                particle.velocity.x += noiseX * particle.noiseStrength * delta;\r\n                particle.velocity.y += noiseY * particle.noiseStrength * delta;\r\n            }\r\n\r\n            if (particle.sizeOverLifetime > 0) {\r\n                const ageRatio = particle.age / particle.lifetime;\r\n                particle.size = particle.initialSize * (1 + ageRatio * particle.sizeOverLifetime);\r\n            }\r\n\r\n            particle.pos.x += particle.velocity.x * delta;\r\n            particle.pos.y += particle.velocity.y * delta;\r\n            particle.age += 16.67 * delta;\r\n\r\n            particle.rotation += (particle.torque * Math.PI / 180) * delta;\r\n\r\n            if (particle.fade) {\r\n                const ageRatio = particle.age / particle.lifetime;\r\n                particle.opacity = particle.maxOpacity * (1 - ageRatio);\r\n            }\r\n\r\n            // Handle staining during extended collision life\r\n            if (particle.hasCollided && particle.stain) {\r\n                // Paint every frame during extended life\r\n                this.stampParticle(particle);\r\n\r\n                // Calculate how far we are through the extended life\r\n                const extendedLifeRatio = (particle.age - (particle.lifetime - particle.lifetime * 0.5)) / (particle.lifetime * 0.5);\r\n\r\n                if (extendedLifeRatio > 0) {\r\n                    // Shrink particle during extended life\r\n                    particle.size = Math.max(0.5, particle.size * (1 - extendedLifeRatio * 0.1));\r\n\r\n                    // Fade opacity during extended life (from current opacity to 0)\r\n                    particle.opacity = particle.opacity * (1 - extendedLifeRatio);\r\n                }\r\n            }\r\n\r\n            const shouldRemove = particle.age >= particle.lifetime ||\r\n                particle.pos.x < -10 || particle.pos.x > WORLD.WIDTH + 10 ||\r\n                particle.pos.y < -10 || particle.pos.y > WORLD.HEIGHT + 10;\r\n\r\n            if (shouldRemove) {\r\n                // Handle collision for particles with COLLIDE property\r\n                if (particle.collide && particle.age >= particle.lifetime &&\r\n                    particle.pos.x >= 0 && particle.pos.x <= WORLD.WIDTH &&\r\n                    particle.pos.y >= 0 && particle.pos.y <= WORLD.HEIGHT &&\r\n                    !particle.hasCollided) {\r\n\r\n                    // Simulate collision with ground/surface\r\n                    particle.hasCollided = true;\r\n\r\n                    // Reduce speed\r\n                    const speedReduction = 0.875 + Math.random() * 0.1;\r\n                    particle.velocity.x *= (1 - speedReduction);\r\n                    particle.velocity.y *= (1 - speedReduction);\r\n\r\n                    // Extend lifetime\r\n                    const lifetimeExtension = particle.lifetime * 0.5;\r\n                    particle.lifetime += lifetimeExtension;\r\n\r\n                    // Don't remove this particle yet\r\n                    return;\r\n                }\r\n\r\n                // Handle painting before removal (only for non-staining particles)\r\n                if (particle.paint && !particle.stain && particle.age >= particle.lifetime &&\r\n                    particle.pos.x >= 0 && particle.pos.x <= WORLD.WIDTH &&\r\n                    particle.pos.y >= 0 && particle.pos.y <= WORLD.HEIGHT) {\r\n\r\n                    this.stampParticle(particle);\r\n                }\r\n\r\n                particlesToRemove.push(id);\r\n            }\r\n        });\r\n\r\n        particlesToRemove.forEach(id => this.particles.delete(id));\r\n    }\r\n\r\n    /**\r\n     * Responsible for the actual rendering of particles spawned via emitters and particle functions.\r\n     */\r\n    public drawParticles(): void {\r\n        if (!this.ui.ctx) return;\r\n\r\n        this.particles.forEach(particle => {\r\n            if (!this.camera.isVisible(particle.pos)) return;\r\n\r\n            // Convert to screen space\r\n            const screenPos = this.camera.worldToScreen(particle.pos);\r\n\r\n            const rgb = this.utility.hexToRgb(particle.color);\r\n            if (!rgb) return;\r\n\r\n            if (!this.ui.ctx) return;\r\n            this.ui.ctx.save();\r\n            this.ui.ctx.globalAlpha = particle.opacity;\r\n\r\n            if (particle.torque !== 0) {\r\n                this.ui.ctx.translate(screenPos.x + particle.size / 2, screenPos.y + particle.size / 2);\r\n                this.ui.ctx.rotate(particle.rotation);\r\n                this.ui.ctx.fillStyle = `rgb(${rgb.r}, ${rgb.g}, ${rgb.b})`;\r\n                this.ui.ctx.fillRect(-particle.size / 2, -particle.size / 2, particle.size, particle.size);\r\n            } else {\r\n                this.ui.ctx.fillStyle = `rgb(${rgb.r}, ${rgb.g}, ${rgb.b})`;\r\n                this.ui.ctx.fillRect(Math.floor(screenPos.x), Math.floor(screenPos.y), particle.size, particle.size);\r\n            }\r\n\r\n            this.ui.ctx.restore();\r\n        });\r\n    }\r\n    //\r\n    // #endregion\r\n\r\n    // #region [ Persistence ]\r\n    //\r\n    /**\r\n     * Stamps local particles onto the decal canvas.\r\n     */\r\n    private stampParticle(particle: Particle): void {\r\n        if (!this.ui.decalCtx) return;\r\n\r\n        // DON'T convert to screen space - decal canvas is world-sized!\r\n        // Just use world coordinates directly\r\n\r\n        const rgb = this.utility.hexToRgb(particle.color);\r\n        if (!rgb) return;\r\n\r\n        this.ui.decalCtx.save();\r\n        this.ui.decalCtx.globalCompositeOperation = 'source-over';\r\n\r\n        if (particle.torque !== 0) {\r\n            // Use particle.pos directly (world coordinates)\r\n            this.ui.decalCtx.translate(particle.pos.x + particle.size / 2, particle.pos.y + particle.size / 2);\r\n            this.ui.decalCtx.rotate(particle.rotation);\r\n            this.ui.decalCtx.fillStyle = `rgba(${rgb.r}, ${rgb.g}, ${rgb.b}, ${particle.opacity})`;\r\n            this.ui.decalCtx.fillRect(-particle.size / 2, -particle.size / 2, particle.size, particle.size);\r\n        } else {\r\n            this.ui.decalCtx.fillStyle = `rgba(${rgb.r}, ${rgb.g}, ${rgb.b}, ${particle.opacity})`;\r\n            this.ui.decalCtx.fillRect(Math.floor(particle.pos.x), Math.floor(particle.pos.y), particle.size, particle.size);\r\n        }\r\n\r\n        this.ui.decalCtx.restore();\r\n\r\n        const id = `stamp_${Date.now()}`;\r\n\r\n        this.decalsManager.dynamicDecals.set(id, {\r\n            params: null,\r\n            pos: {\r\n                x: particle.pos.x, // World coordinates\r\n                y: particle.pos.y\r\n            }\r\n        });\r\n    }\r\n    //\r\n    // #endregion\r\n\r\n    // #region [ Emitters ]\r\n    //\r\n    /**\r\n     * Creates a particle emitter in the game, and syncs this action via websocket message \"particle-emitter\".\r\n     */\r\n    public createEmitter(params: EmitterParams): void {\r\n        this.generateEmitter(params); // Create an emitter locally\r\n\r\n        // Broadcast to other clients\r\n        const message: EmitterParams = {\r\n            type: 'particle-emitter',\r\n            id: params.id,\r\n            interval: params.interval,\r\n            lifetime: params.lifetime,\r\n            offset: {\r\n                x: params.offset.x,\r\n                y: params.offset.y\r\n            },\r\n            pos: {\r\n                x: params.pos.x,\r\n                y: params.pos.y\r\n            },\r\n            particleType: params.particleType,\r\n            playerId: params.playerId\r\n        };\r\n        this.roomManager.sendMessage(JSON.stringify(message));\r\n\r\n        console.log(`Emitter created on ${params.playerId} for ${params.lifetime}ms`);\r\n    }\r\n\r\n    /**\r\n     * Actual generation of the emitter object into the emitter mapping.\r\n     */\r\n    public generateEmitter(params: EmitterParams): void {\r\n        // Calculate offset from center\r\n        const offsetX = params.pos.x - params.offset.x;\r\n        const offsetY = params.pos.y - params.offset.y;\r\n\r\n        // Calculate direction (away from center towards hit point)\r\n        const angle = Math.atan2(offsetY, offsetX);\r\n\r\n        this.emitters.set(params.id, {\r\n            age: 0,\r\n            direction: angle,\r\n            emissionInterval: params.interval,\r\n            lastEmission: 0,\r\n            lifetime: params.lifetime,\r\n            offset: {\r\n                x: offsetX,\r\n                y: offsetY\r\n            },\r\n            particleType: params.particleType,\r\n            playerId: params.playerId\r\n        });\r\n    }\r\n    /**\r\n     * Process all particle emitters in the game during the update loop.\r\n     */\r\n    public updateEmitters(delta: number): void {\r\n        const emittersToRemove: string[] = [];\r\n\r\n        this.emitters.forEach((emitter, emitterId) => {\r\n            emitter.age += 16.67 * delta;\r\n\r\n            const player = emitter.playerId === this.userId ? this.playerState.myPlayer : this.playerState.players.get(emitter.playerId);\r\n            if (!player || player.stats.health.value <= 0) {\r\n                emittersToRemove.push(emitterId);\r\n                return;\r\n            }\r\n\r\n            // Calculate current world position\r\n            const worldX = player.transform.pos.x + emitter.offset.x;\r\n            const worldY = player.transform.pos.y + emitter.offset.y;\r\n\r\n            if (emitter.age >= emitter.lastEmission + emitter.emissionInterval) {\r\n                // Create directional spray with cone spread\r\n                const coneSpread = Math.PI * 0.6; // 108 degree cone\r\n                const randomSpread = (Math.random() - 0.5) * coneSpread;\r\n                const angle = emitter.direction + randomSpread;\r\n\r\n                // Variable speed for more natural spray\r\n                const baseSpeed = 3;\r\n                const speedVariation = (Math.random() - 0.5) * 4; // -2 to +2\r\n                const finalSpeed = Math.max(0.5, baseSpeed + speedVariation);\r\n\r\n                const particleParams: CreateParticleParams = {\r\n                    id: `emitter_particles_${emitterId}_${emitter.age}`,\r\n                    pos: {\r\n                        x: worldX + (Math.random() - 0.5) * 8,\r\n                        y: worldY + (Math.random() - 0.5) * 8\r\n                    },\r\n                    particleParams: emitter.particleType,\r\n                    direction: {\r\n                        x: Math.cos(angle) * finalSpeed,\r\n                        y: Math.sin(angle) * finalSpeed\r\n                    }\r\n                }\r\n                this.generateParticles(particleParams);\r\n\r\n                emitter.lastEmission = emitter.age;\r\n                emitter.emissionInterval = 120 + Math.random() * 180; // More consistent timing\r\n            }\r\n\r\n            // Remove expired emitters\r\n            if (emitter.age >= emitter.lifetime) {\r\n                const decalParams: DecalParams = {\r\n                    id: `emitter_decal_${emitterId}`,\r\n                    pos: {\r\n                        x: worldX,\r\n                        y: worldY\r\n                    },\r\n                    type: \"parametric\",\r\n                    parametric: this.decalsManager.decalsConfig.decals.blood\r\n                };\r\n                this.decalsManager.generateDecal(decalParams);\r\n\r\n                emittersToRemove.push(emitterId);\r\n            }\r\n        });\r\n\r\n        emittersToRemove.forEach(id => this.emitters.delete(id));\r\n    }\r\n    //\r\n    // #endregion\r\n\r\n    // #region [ Gore ]\r\n    //\r\n    /**\r\n     * Generates gore particles using the decals for the character object.\r\n     */\r\n    public generateGore(params: DeathDecal): void {\r\n        const gorePool = [...this.charConfig.characterDecals.default.gore]; // TODO: Get current pool for gore\r\n        for (let i = 0; i < params.gore.amount && gorePool.length > 0; i++) {\r\n            const goreAsset = this.utility.getRandomInArray(gorePool);\r\n            gorePool.splice(gorePool.indexOf(goreAsset), 1);\r\n            const angle = this.utility.getRandomNum(0, Math.PI * 2);\r\n            const distance = this.utility.getRandomNum(0, params.radius);\r\n\r\n            const goreDecal: DeathStamp = {\r\n                type: 'gore',\r\n                src: goreAsset,\r\n                transform: {\r\n                    pos: {\r\n                        x: params.pos.x + Math.cos(angle) * distance,\r\n                        y: params.pos.y + Math.sin(angle) * distance\r\n                    },\r\n                    rot: this.utility.getRandomNum(0, Math.PI * 2),\r\n                },\r\n                scale: this.utility.getRandomNum(0.65, 1.05)\r\n            };\r\n\r\n            const decalId = `death_gore_${params.ownerId}_${Date.now()}_${i}`;\r\n            this.stampGore(goreDecal);\r\n            this.decalsManager.dynamicDecals.set(decalId, {\r\n                params: null,\r\n                pos: {\r\n                    x: goreDecal.transform.pos.x,\r\n                    y: goreDecal.transform.pos.y\r\n                }\r\n            });\r\n        }\r\n\r\n        const bloodPool = [...this.charConfig.characterDecals.default.blood]; // TODO: Get current pool for blood\r\n        for (let i = 0; i < params.blood.amount && bloodPool.length > 0; i++) {\r\n            const bloodAsset = this.utility.getRandomInArray(bloodPool);\r\n            bloodPool.splice(bloodPool.indexOf(bloodAsset), 1);\r\n            const angle = this.utility.getRandomNum(0, Math.PI * 2);\r\n            const distance = this.utility.getRandomNum(0, params.radius * 0.7);\r\n\r\n            const bloodDecal: DeathStamp = {\r\n                type: 'blood',\r\n                src: bloodAsset,\r\n                transform: {\r\n                    pos: {\r\n                        x: params.pos.x + Math.cos(angle) * distance,\r\n                        y: params.pos.y + Math.sin(angle) * distance\r\n                    },\r\n                    rot: this.utility.getRandomNum(0, Math.PI * 2),\r\n                },\r\n                scale: this.utility.getRandomNum(1.25, 1.45)\r\n            };\r\n\r\n            const decalId = `death_blood_${params.ownerId}_${Date.now()}_${i}`;\r\n            this.stampGore(bloodDecal);\r\n            this.decalsManager.dynamicDecals.set(decalId, {\r\n                params: null,\r\n                pos: {\r\n                    x: bloodDecal.transform.pos.x,\r\n                    y: bloodDecal.transform.pos.y\r\n                }\r\n            });\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Persists gore on the decal canvas.\r\n     */\r\n    private stampGore(params: DeathStamp): void {\r\n        if (!this.ui.decalCtx) return;\r\n        if (!this.camera.isVisible(params.transform.pos)) return;\r\n\r\n        const screenPos = this.camera.worldToScreen(params.transform.pos);\r\n\r\n        let image = this.renderingManager.characterImages.get(params.src);\r\n\r\n        if (!image) {\r\n            image = new Image();\r\n            image.src = params.src;\r\n            this.renderingManager.characterImages.set(params.src, image);\r\n\r\n            if (!image.complete) {\r\n                image.onload = () => {\r\n                    this.stampGore(params);\r\n                };\r\n                return;\r\n            }\r\n        }\r\n\r\n        if (!image.complete || image.naturalWidth === 0) return;\r\n\r\n        this.ui.decalCtx.save();\r\n        this.ui.decalCtx.translate(screenPos.x, screenPos.y);\r\n        this.ui.decalCtx.rotate(params.transform.rot);\r\n\r\n        const drawSize = 32 * params.scale;\r\n        this.ui.decalCtx.drawImage(\r\n            image,\r\n            -drawSize / 2,\r\n            -drawSize / 2,\r\n            drawSize,\r\n            drawSize\r\n        );\r\n\r\n        this.ui.decalCtx.restore();\r\n    }\r\n    //\r\n    // #endregion\r\n\r\n    // #region [ Shrapnel ]\r\n    //\r\n    /**\r\n     * Creates shrapnel pieces and sends network message with Shrapnel data.\r\n     */\r\n    public spawnShrapnel(params: Shrapnel): void {\r\n        const pieces: ShrapnelPiece[] = [];\r\n\r\n        // Generate all pieces locally\r\n        for (let i = 0; i < params.amount; i++) {\r\n            const angle = this.utility.getRandomNum(0, Math.PI * 2);\r\n            const speed = this.utility.getRandomNum(params.speed.min, params.speed.max);\r\n            const lifetime = this.utility.getRandomNum(params.lifetime.min, params.lifetime.max);\r\n            const size = this.utility.getRandomNum(params.size.min, params.size.max);\r\n            const torque = this.utility.getRandomNum(params.torque.min, params.torque.max) * (Math.PI / 180); // Convert radians > deg\r\n\r\n            const piece: ShrapnelPiece = {\r\n                id: this.utility.generateUID(OBJECT_DEFAULTS.DATA.ID_LENGTH),\r\n                image: params.images[i], // Already randomly selected in triggerUnique\r\n                transform: {\r\n                    pos: {\r\n                        x: params.pos.x,\r\n                        y: params.pos.y\r\n                    },\r\n                    rot: this.utility.getRandomNum(0, Math.PI * 2), // Random start rot\r\n                },\r\n                velocity: {\r\n                    x: Math.cos(angle) * speed,\r\n                    y: Math.sin(angle) * speed\r\n                },\r\n                rotationSpeed: torque, // Random spin\r\n                size: size,\r\n                age: 0,\r\n                lifetime: lifetime,\r\n                ownerId: this.userId,\r\n                damage: params.damage\r\n            };\r\n\r\n            pieces.push(piece);\r\n            this.shrapnel.set(piece.id, piece);\r\n        }\r\n\r\n        // Send ONE message with all pieces\r\n        this.roomManager.sendMessage(JSON.stringify({\r\n            type: 'shrapnel-spawn',\r\n            pieces: pieces\r\n        }));\r\n\r\n        console.log(`Spawned ${pieces.length} shrapnel pieces`);\r\n    }\r\n\r\n    /**\r\n     * Generates shrapnel baed on received network message 'shrapnel-spawn' data.\r\n     */\r\n    public generateShrapnel(params: ShrapnelPiece[]): void {\r\n        params.forEach(piece => {\r\n            this.shrapnel.set(piece.id, piece);\r\n        });\r\n\r\n        console.log(`Received ${params.length} shrapnel pieces from network`);\r\n    }\r\n\r\n    /**\r\n     * When shrapnel exists, handles updating of each piece via Client udpate loop.\r\n     */\r\n    public updateShrapnel(delta: number): void {\r\n        if (this.shrapnel.size === 0) return;\r\n\r\n        const shrapnelToRemove: string[] = [];\r\n\r\n        this.shrapnel.forEach((piece, id) => {\r\n            // Update physics\r\n            piece.transform.pos.x += piece.velocity.x * delta;\r\n            piece.transform.pos.y += piece.velocity.y * delta;\r\n            piece.transform.rot += piece.rotationSpeed * delta;\r\n            piece.age += 16.67 * delta;\r\n\r\n            // Apply friction\r\n            // TODO: Add world friction\r\n            piece.velocity.x *= 0.98;\r\n            piece.velocity.y *= 0.98;\r\n\r\n            // Only owner checks collisions and deals damage\r\n            if (piece.ownerId === this.userId) {\r\n                // Check collision with all players\r\n                this.playerState.players.forEach((player, playerId) => {\r\n                    if (player.stats.health.value > 0) {\r\n                        const dx = piece.transform.pos.x - player.transform.pos.x;\r\n                        const dy = piece.transform.pos.y - player.transform.pos.y;\r\n                        const distance = Math.sqrt(dx * dx + dy * dy);\r\n\r\n                        // Collision detection (using player collider + shrapnel size for padding)\r\n                        if (distance <= this.collisionsManager.getPlayerCollider(player, piece.size)) {\r\n                            const actualDamage = Math.max(0, piece.damage - player.stats.defense);\r\n                            const newHealth = Math.max(0, player.stats.health.value - actualDamage);\r\n                            player.stats.health.value = newHealth;\r\n\r\n                            // Remove this shrapnel piece after hit\r\n                            shrapnelToRemove.push(id);\r\n                            console.log(`Shrapnel hit ${playerId} for ${piece.damage} damage`);\r\n\r\n                            const params: PlayerHitParams = {\r\n                                target: player,\r\n                                shooterId: this.userId,\r\n                                damage: piece.damage,\r\n                                newHealth: newHealth,\r\n                                source: piece,\r\n                                wasKill: newHealth <= 0\r\n                            }\r\n                            window.dispatchEvent(new CustomEvent(\"customEvent_playerHitRelay\", { detail: { params } }));\r\n                        }\r\n                    }\r\n                });\r\n            }\r\n\r\n            // Remove if lifetime expired or out of bounds\r\n            if (piece.age >= piece.lifetime ||\r\n                piece.transform.pos.x < 0 || piece.transform.pos.x > WORLD.WIDTH ||\r\n                piece.transform.pos.y < 0 || piece.transform.pos.y > WORLD.HEIGHT) {\r\n\r\n                // Stamp as decal if died in bounds\r\n                if (piece.transform.pos.x >= 0 && piece.transform.pos.x <= WORLD.WIDTH &&\r\n                    piece.transform.pos.y >= 0 && piece.transform.pos.y <= WORLD.HEIGHT) {\r\n                    this.stampShrapnel(piece);\r\n                }\r\n\r\n                shrapnelToRemove.push(id);\r\n            }\r\n        });\r\n\r\n        // Remove dead shrapnel\r\n        shrapnelToRemove.forEach(id => this.shrapnel.delete(id));\r\n    }\r\n\r\n    /**\r\n     * Draws the moving shrapnel to the canvas for rendering.\r\n     */\r\n    public drawShrapnel(): void {\r\n        if (!this.ui.ctx || this.shrapnel.size === 0) return;\r\n\r\n        this.shrapnel.forEach(piece => {\r\n            if (!this.ui.ctx) return;\r\n            if (!this.camera.isVisible(piece.transform.pos)) return;\r\n\r\n            const screenPos = this.camera.worldToScreen(piece.transform.pos);\r\n\r\n            let image = this.renderingManager.characterImages.get(piece.image);\r\n\r\n            if (!image) {\r\n                image = new Image();\r\n                image.src = piece.image;\r\n                this.renderingManager.characterImages.set(piece.image, image);\r\n\r\n                if (!image.complete) { return; }\r\n            }\r\n\r\n            if (!image.complete || image.naturalWidth === 0) return;\r\n\r\n            this.ui.ctx.save();\r\n            this.ui.ctx.translate(screenPos.x, screenPos.y);\r\n            this.ui.ctx.rotate(piece.transform.rot);\r\n\r\n            this.ui.ctx.drawImage(\r\n                image,\r\n                -piece.size / 2,\r\n                -piece.size / 2,\r\n                piece.size,\r\n                piece.size\r\n            );\r\n\r\n            this.ui.ctx.restore();\r\n        });\r\n    }\r\n\r\n    /**\r\n     * Stamps dead shrapnel to the decal canvas to persist visually.\r\n     */\r\n    private stampShrapnel(params: ShrapnelPiece): void {\r\n        if (!this.ui.decalCtx) return;\r\n        if (!this.camera.isVisible(params.transform.pos)) return;\r\n\r\n        const screenPos = this.camera.worldToScreen(params.transform.pos);\r\n\r\n        let image = this.renderingManager.characterImages.get(params.image);\r\n        if (!image || !image.complete || image.naturalWidth === 0) return;\r\n\r\n        this.ui.decalCtx.save();\r\n        this.ui.decalCtx.translate(screenPos.x, screenPos.y);\r\n        this.ui.decalCtx.rotate(params.transform.rot);\r\n\r\n        this.ui.decalCtx.drawImage(\r\n            image,\r\n            -params.size / 2,\r\n            -params.size / 2,\r\n            params.size,\r\n            params.size\r\n        );\r\n\r\n        this.ui.decalCtx.restore();\r\n\r\n        // Register decal with WORLD position\r\n        this.decalsManager.dynamicDecals.set(`shrapnel_${params.id}`, {\r\n            params: null,\r\n            pos: {\r\n                x: params.transform.pos.x, // World coordinates\r\n                y: params.transform.pos.y\r\n            }\r\n        });\r\n    }\r\n\r\n    //\r\n    // #endregion\r\n}","import { AMMO_BOX, CANVAS, GAME, UI, WORLD } from \"./Config\";\r\nimport { CharacterLayer, Projectile, RenderCharacterParams } from \"./Types\";\r\n\r\nimport { Animator } from \"./Animator\";\r\nimport { CharacterManager } from \"./CharacterManager\";\r\nimport { ObjectsManager } from \"./ObjectsManager\";\r\nimport { UserInterface } from \"./UserInterface\";\r\nimport { LobbyManager } from \"./LobbyManager\";\r\nimport { PlayerConfig } from \"./player/PlayerConfig\";\r\nimport { Camera } from \"./Camera\";\r\n\r\nexport class RenderingManager {\r\n    public characterImages: Map<string, HTMLImageElement> = new Map();\r\n    public ammoBoxImages: { [layer: string]: HTMLImageElement } = {};\r\n\r\n    constructor(\r\n        private animator: Animator,\r\n        private camera: Camera,\r\n        private charManager: CharacterManager,\r\n        private lobbyManager: LobbyManager,\r\n        private objectsManager: ObjectsManager,\r\n        private playerConfig: PlayerConfig,\r\n        private ui: UserInterface,\r\n        private userId: string,\r\n    ) {\r\n        this.initEventListeners();\r\n    }\r\n\r\n    // #region [ General ]\r\n    //\r\n    /**\r\n     * Clear all canvas rendering context in the game.\r\n     * \r\n     * / OR /\r\n     * \r\n     * Pass the specific CanvasRenderingContext2D to clear.\r\n     */\r\n    public clearCtx(customCtx?: CanvasRenderingContext2D): void {\r\n        if (customCtx) {\r\n            customCtx.clearRect(0, 0, CANVAS.WIDTH, CANVAS.HEIGHT);\r\n            return;\r\n        }\r\n\r\n        if (!this.ui.decalCtx || !this.ui.ctx) return;\r\n\r\n        this.ui.ctx.clearRect(0, 0, CANVAS.WIDTH, CANVAS.HEIGHT);\r\n        this.ui.decalCtx.clearRect(0, 0, WORLD.WIDTH, WORLD.HEIGHT);\r\n    }\r\n    //\r\n    // #endregion\r\n\r\n    // #region [ Character ]\r\n    //\r\n    /**\r\n     * Draws the corresponding character layers defined in the rig to create the player character.\r\n     */\r\n    public drawCharacter(params: RenderCharacterParams): void {\r\n        const { player, context } = params;\r\n        if (!context || !player) return;\r\n\r\n        if ('stats' in player) {\r\n            if (player.stats.health.value <= 0) return;\r\n            this.renderUniqueEffects(params);\r\n            if (player.flags.hidden) return;\r\n\r\n            if (!this.camera.isVisible(player.transform.pos)) return;\r\n            const screenPos = this.camera.worldToScreen(player.transform.pos);\r\n\r\n            context.fillStyle = UI.TEXT_COLOR;\r\n            context.font = UI.FONT;\r\n            context.textAlign = 'center';\r\n\r\n            const displayName = player.id === this.userId ? 'You' : player.id.substring(0, 6);\r\n            context.fillText(\r\n                displayName,\r\n                screenPos.x,\r\n                screenPos.y - this.playerConfig.default.data.idOffset\r\n            );\r\n        }\r\n\r\n        // Main player\r\n        this.drawCharacterLayers(params);\r\n    }\r\n    \r\n    /**\r\n     * Entrypoint for rendering of all character layers.\r\n     */\r\n    private drawCharacterLayers(params: RenderCharacterParams): void {\r\n        const player = params.player;\r\n        if (!player) return;\r\n\r\n        this.drawCharacterLayer(params, 'body', player.rig.body);\r\n        this.drawCharacterLayer(params, 'weapon', player.rig.weapon);\r\n        this.drawCharacterLayer(params, 'head', player.rig.head);\r\n        this.drawCharacterLayer(params, 'headwear', player.rig.headwear);\r\n\r\n        if ('stats' in player) { this.drawUpgradeLayers(params); }\r\n    }\r\n\r\n    /**\r\n     * Retrieves character assets and draws each layer using drawCharacterPart.\r\n     */\r\n    private drawCharacterLayer(params: RenderCharacterParams, layer: CharacterLayer, variant: string): void {\r\n        if (!params) return;\r\n\r\n        const assets = this.charManager.getCharacterAsset(layer, variant);\r\n\r\n        if (typeof assets === 'string') {\r\n            this.drawCharacterPart(params, assets, layer);\r\n        }\r\n        else if (Array.isArray(assets)) {\r\n            assets.forEach((assetPath, index) => {\r\n                this.drawCharacterPart(params, assetPath, layer, index);\r\n            });\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Handles the actual rendering for all player parts on each layer.\r\n     */\r\n    private drawCharacterPart(params: RenderCharacterParams, assetPath: string, partType: CharacterLayer, partIndex?: number): void {\r\n        const { context, player } = params;\r\n        if (!context || !player) return;\r\n\r\n        let image = this.characterImages.get(assetPath);\r\n\r\n        if (!image) {\r\n            image = new Image();\r\n            image.src = assetPath;\r\n            this.characterImages.set(assetPath, image);\r\n\r\n            image.onload = () => { this.renderLobbyPlayer(); };\r\n\r\n            if (!image.complete) return;\r\n        }\r\n\r\n        if (!image.complete || image.naturalWidth === 0) return;\r\n\r\n        // Determine draw size based on player type\r\n        const drawSize = 'stats' in player\r\n            ? GAME.CHARACTER_SIZE * (player.stats.size / GAME.CHARACTER_SIZE)\r\n            : GAME.CHARACTER_SIZE * 0.35;\r\n\r\n        // UPDATED: Get world position and convert to screen\r\n        const worldX = player.transform?.pos?.x ?? 0;\r\n        const worldY = player.transform?.pos?.y ?? 0;\r\n\r\n        // Only apply camera offset for full players (not lobby)\r\n        const shouldApplyCamera = 'stats' in player && player.transform.rot !== undefined;\r\n\r\n        const posX = shouldApplyCamera ? this.camera.worldToScreen({ x: worldX, y: worldY }).x : worldX;\r\n        const posY = shouldApplyCamera ? this.camera.worldToScreen({ x: worldX, y: worldY }).y : worldY;\r\n\r\n        context.save();\r\n\r\n        // Only apply rotation and animation for full players\r\n        if (shouldApplyCamera) {\r\n            const animationId = `${player.id}_${partType}_${partIndex || 0}`;\r\n            const animationOffset = this.animator.characterOffsets?.get(animationId) || { x: 0, y: 0 };\r\n\r\n            context.translate(posX, posY);\r\n            context.rotate(player.transform.rot);\r\n            context.translate(animationOffset.x, animationOffset.y);\r\n\r\n            context.drawImage(\r\n                image,\r\n                -drawSize / 2,\r\n                -drawSize / 2,\r\n                drawSize,\r\n                drawSize\r\n            );\r\n        } else {\r\n            // Simple centered draw for lobby players\r\n            context.drawImage(\r\n                image,\r\n                posX - drawSize / 2,\r\n                posY - drawSize / 2,\r\n                drawSize,\r\n                drawSize\r\n            );\r\n        }\r\n\r\n        context.restore();\r\n    }\r\n    //\r\n    // #endregion\r\n\r\n    // #region [ Uniques & Upgrades ]\r\n    //\r\n    /**\r\n     * Draws the equipment and unique upgrades that have a character layer visual component.\r\n     */\r\n    private drawUpgradeLayers(params: RenderCharacterParams): void {\r\n        const { player } = params;\r\n\r\n        if ('unique' in player) {\r\n            // Check unique upgrades\r\n            player.unique.forEach(uniqueName => {\r\n                const assetPath = this.charManager.getUpgradeVisual(uniqueName);\r\n                if (assetPath) {\r\n                    this.drawCharacterPart(params, assetPath, 'upgrades');\r\n                }\r\n            });\r\n\r\n            // Check equipment upgrades\r\n            player.equipment.forEach(equipmentName => {\r\n                const assetPath = this.charManager.getUpgradeVisual(equipmentName);\r\n                if (assetPath) {\r\n                    this.drawCharacterPart(params, assetPath, 'upgrades');\r\n                }\r\n            });\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Called in main rendering loop, used to override standard rendering when unique effects temporarily need to.\r\n     */\r\n    private renderUniqueEffects(params: RenderCharacterParams): void {\r\n        const { player } = params;\r\n        if (!player) return;\r\n\r\n        if ('unique' in player) {\r\n            if (player.unique.includes(\"spectral_image\")) {\r\n                this.renderSpectralImage(params);\r\n            }\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Renders the chosen player as a spectral image.\r\n     */\r\n    private renderSpectralImage(params: RenderCharacterParams): void {\r\n        const { context, player } = params;\r\n        if (!context || !player || !('stats' in player)) return;\r\n\r\n        // Static ghost memory (attached per instance)\r\n        const staticGhosts = (this as any)._spectralGhosts ??= {\r\n            lastHidden: new Map<string, boolean>(),\r\n            flashes: [] as {\r\n                x: number;\r\n                y: number;\r\n                t: number;\r\n                type: 'start' | 'end';\r\n                playerId: string;\r\n            }[]\r\n        };\r\n\r\n        const now = Date.now();\r\n        const wasHidden = staticGhosts.lastHidden.get(player.id) ?? false;\r\n        const isHidden = player.flags.hidden;\r\n\r\n        // Detect start of dash (flash out)\r\n        if (!wasHidden && isHidden) {\r\n            staticGhosts.flashes.push({\r\n                x: player.transform.pos.x,\r\n                y: player.transform.pos.y,\r\n                t: now,\r\n                type: 'start',\r\n                playerId: player.id\r\n            });\r\n        }\r\n\r\n        // Detect end of dash (flash in)\r\n        if (wasHidden && !isHidden) {\r\n            staticGhosts.flashes.push({\r\n                x: player.transform.pos.x,\r\n                y: player.transform.pos.y,\r\n                t: now,\r\n                type: 'end',\r\n                playerId: player.id\r\n            });\r\n        }\r\n\r\n        staticGhosts.lastHidden.set(player.id, isHidden);\r\n\r\n        // Render ghost flashes\r\n        for (const ghost of staticGhosts.flashes) {\r\n            if (ghost.playerId !== player.id) continue;\r\n            const age = now - ghost.t;\r\n            if (age > player.actions.dash.time) continue;\r\n\r\n            // Convert ghost world position to screen position\r\n            const screenPos = this.camera.worldToScreen({ x: ghost.x, y: ghost.y });\r\n\r\n            const alpha = ghost.type === 'start'\r\n                ? 1 - (age / player.actions.dash.time)\r\n                : (age / player.actions.dash.time);\r\n\r\n            context.save();\r\n\r\n            // Invert-style effect via difference + high saturation\r\n            context.globalAlpha = alpha * 0.8;\r\n            context.globalCompositeOperation = 'difference';\r\n            context.filter = 'saturate(100) contrast(2)';\r\n\r\n            const ghostPlayer = {\r\n                ...player,\r\n                transform: {\r\n                    ...player.transform,\r\n                    pos: { x: screenPos.x, y: screenPos.y } // Screen coordinates for rendering\r\n                }\r\n            };\r\n\r\n            this.drawCharacterLayers({\r\n                player: ghostPlayer,\r\n                context: context\r\n            });\r\n            context.restore();\r\n        }\r\n    }\r\n    //\r\n    // #endregion\r\n\r\n    // #region [ Lobby Rendering ]\r\n    //\r\n    /**\r\n     * Renders lobby player in customization canvas via character rendering functions.\r\n     */\r\n    private renderLobbyPlayer(): void {\r\n        if (!this.lobbyManager.inLobby) return;\r\n\r\n        const myLobbyPlayer = this.lobbyManager.lobbyPlayers.get(this.userId);\r\n        if (!myLobbyPlayer || !this.ui.charCustomizeCanvas) return;\r\n\r\n        const ctx = this.ui.charCustomizeCanvas.getContext('2d');\r\n        if (!ctx) return;\r\n\r\n        ctx.clearRect(0, 0, this.ui.charCustomizeCanvas.width, this.ui.charCustomizeCanvas.height);\r\n\r\n        this.drawCharacter({\r\n            player: myLobbyPlayer,\r\n            context: ctx\r\n        });\r\n    }\r\n    //\r\n    // #endregion\r\n\r\n    // #region [ Objects ]\r\n    //\r\n    /**\r\n     * Draws object entities on the canvas.\r\n     */\r\n    public drawObjects(): void {\r\n        if (!this.ui.ctx) return;\r\n\r\n        //TODO: Use this function to draw all 'objects' in the scene.\r\n\r\n        // Ammo Boxes\r\n        this.objectsManager.ammoBoxes.forEach(ammoBox => {\r\n            if (!this.ui.ctx) return;\r\n            if (!this.camera.isVisible(ammoBox.transform.pos)) return;\r\n\r\n            // Load and cache images\r\n            if (!this.ammoBoxImages) this.ammoBoxImages = {};\r\n            const layers: (keyof typeof AMMO_BOX)[] = ['BASE', 'BULLETS', 'LID'];\r\n            layers.forEach(layer => {\r\n                if (!this.ammoBoxImages[layer]) {\r\n                    const img = new Image();\r\n                    img.src = AMMO_BOX[layer];\r\n                    this.ammoBoxImages[layer] = img;\r\n                }\r\n            });\r\n\r\n            if (!layers.every(layer => this.ammoBoxImages[layer]?.complete && this.ammoBoxImages[layer]?.naturalWidth > 0)) return;\r\n\r\n            const scale = 35;\r\n            const screenPos = this.camera.worldToScreen(ammoBox.transform.pos);\r\n\r\n            // Update lid physics if open\r\n            if (ammoBox.isOpen) {\r\n                ammoBox.lid.velocity.x *= 0.85;\r\n                ammoBox.lid.velocity.y *= 0.85;\r\n                ammoBox.lid.torque *= 0.85;\r\n\r\n                ammoBox.lid.pos.x += ammoBox.lid.velocity.x;\r\n                ammoBox.lid.pos.y += ammoBox.lid.velocity.y;\r\n                ammoBox.lid.rot += ammoBox.lid.torque;\r\n            }\r\n\r\n            this.ui.ctx.save();\r\n            this.ui.ctx.translate(screenPos.x, screenPos.y);\r\n            this.ui.ctx.rotate(ammoBox.transform.rot || 0);\r\n\r\n            // Draw body\r\n            this.ui.ctx.drawImage(this.ammoBoxImages['BASE'], -scale / 2, -scale / 2, scale, scale);\r\n\r\n            // Draw bullets only if NOT open\r\n            if (!ammoBox.isOpen) {\r\n                this.ui.ctx.drawImage(this.ammoBoxImages['BULLETS'], -scale / 2, -scale / 2, scale, scale);\r\n                // Draw closed lid here\r\n                this.ui.ctx.drawImage(this.ammoBoxImages['LID'], -scale / 2, -scale / 2, scale, scale);\r\n            }\r\n\r\n            this.ui.ctx.restore();\r\n\r\n            // Draw flying lid separately if open\r\n            if (ammoBox.isOpen) {\r\n                this.ui.ctx.save();\r\n                this.ui.ctx.translate(screenPos.x + ammoBox.lid.pos.x, screenPos.y + ammoBox.lid.pos.y);\r\n                this.ui.ctx.rotate((ammoBox.transform.rot || 0) + ammoBox.lid.rot);\r\n                this.ui.ctx.drawImage(this.ammoBoxImages['LID'], -scale / 2, -scale / 2, scale, scale);\r\n                this.ui.ctx.restore();\r\n            }\r\n        });\r\n    }\r\n\r\n    /**\r\n     * Draws the rect of the projectile and renders it on the main canvas.\r\n     */\r\n    public drawProjectile(projectile: Projectile): void {\r\n        if (!this.ui.ctx) return;\r\n        if (!this.camera.isVisible(projectile.transform.pos)) return;\r\n\r\n        // Convert world position to screen position\r\n        const screenPos = this.camera.worldToScreen(projectile.transform.pos);\r\n\r\n        // Calculate projectile direction\r\n        const speed = Math.sqrt(projectile.velocity.x * projectile.velocity.x + projectile.velocity.y * projectile.velocity.y);\r\n        const dirX = projectile.velocity.x / speed;\r\n        const dirY = projectile.velocity.y / speed;\r\n\r\n        // Calculate front and back points (in screen space)\r\n        const frontX = screenPos.x + dirX * (projectile.length / 2);\r\n        const frontY = screenPos.y + dirY * (projectile.length / 2);\r\n        const backX = screenPos.x - dirX * (projectile.length / 2);\r\n        const backY = screenPos.y - dirY * (projectile.length / 2);\r\n\r\n        // Draw the capsule body (rectangle)\r\n        this.ui.ctx.fillStyle = projectile.color;\r\n        this.ui.ctx.strokeStyle = projectile.color;\r\n        this.ui.ctx.lineWidth = projectile.size;\r\n        this.ui.ctx.lineCap = 'round';\r\n\r\n        this.ui.ctx.beginPath();\r\n        this.ui.ctx.moveTo(backX, backY);\r\n        this.ui.ctx.lineTo(frontX, frontY);\r\n        this.ui.ctx.stroke();\r\n    }\r\n    //\r\n    // #endregion\r\n\r\n    // #region [ Events ]\r\n    //\r\n    private initEventListeners(): void {\r\n        window.addEventListener(\"customEvent_renderCharacter\", () => this.renderLobbyPlayer());\r\n    }\r\n    //\r\n    // #endregion\r\n}","import { GAME } from \"./Config\";\r\n\r\nimport { GameState } from \"./GameState\";\r\nimport { LobbyManager } from \"./LobbyManager\";\r\nimport { RoomManager } from \"./RoomManager\";\r\nimport { UpgradeManager } from \"./UpgradeManager\";\r\nimport { UserInterface } from \"./UserInterface\";\r\nimport { Utility } from \"./Utility\";\r\nimport { WebsocketManager } from \"./WebsocketManager\";\r\n\r\nimport { PlayerState } from \"./player/PlayerState\";\r\n\r\nexport class RoomController {\r\n    constructor(\r\n        private gameState: GameState,\r\n        private lobbyManager: LobbyManager,\r\n        private playerState: PlayerState,\r\n        private roomManager: RoomManager,\r\n        private ui: UserInterface,\r\n        private upgradeManager: UpgradeManager,\r\n        private userId: string,\r\n        private utility: Utility,\r\n        private wsManager: WebsocketManager\r\n    ) { }\r\n\r\n    /**\r\n     * Calls updateDisplay to show the room specific controls.\r\n     */\r\n    public showRoomControls(): void {\r\n        this.ui.updateDisplay(this.lobbyManager, \"room\");\r\n    }\r\n\r\n    /**\r\n     * Creates a websocket connection on the server, and a room with the roomManager.\r\n     */\r\n    public hostRoom(): void {\r\n        if (!this.wsManager.getWebSocket()) {\r\n            this.wsManager.connectWebSocket();\r\n            this.utility.safeTimeout(() => {\r\n                const roomId = this.roomManager.createRoom();\r\n                if (!roomId) return;\r\n\r\n                this.playerState.isHost = true;\r\n\r\n                this.lobbyManager.showLobbyControls({\r\n                    lobby: this.lobbyManager,\r\n                    lobbyOptions: {\r\n                        maxPlayers: this.gameState.gameMaxPlayers,\r\n                        maxWins: this.gameState.gameMaxWins,\r\n                        isHost: this.playerState.isHost,\r\n                        privateRoom: this.roomManager.isPrivateRoom,\r\n                        upgradesEnabled: this.upgradeManager.isUpgradesEnabled\r\n                    },\r\n                    myPlayer: this.playerState.myPlayer,\r\n                    roomId: roomId,\r\n                    userId: this.userId\r\n                });\r\n            }, GAME.CONNECTION_TIMEOUT);\r\n        } else {\r\n            const roomId = this.roomManager.createRoom();\r\n            if (!roomId) return;\r\n\r\n            this.playerState.isHost = true;\r\n\r\n            this.lobbyManager.showLobbyControls({\r\n                lobby: this.lobbyManager,\r\n                lobbyOptions: {\r\n                    maxPlayers: this.gameState.gameMaxPlayers,\r\n                    maxWins: this.gameState.gameMaxWins,\r\n                    isHost: this.playerState.isHost,\r\n                    privateRoom: this.roomManager.isPrivateRoom,\r\n                    upgradesEnabled: this.upgradeManager.isUpgradesEnabled\r\n                },\r\n                myPlayer: this.playerState.myPlayer,\r\n                roomId: roomId,\r\n                userId: this.userId\r\n            });\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Displays the room joining modal, and allows pasting of room code.\r\n     */\r\n    public joinRoom(): void {\r\n        this.ui.showJoinRoomModal((roomId: string) => {\r\n            this.joinRoomById(roomId);\r\n        });\r\n    }\r\n\r\n    /**\r\n     * Directly connect to a game with it's room id.\r\n     * \r\n     * Called by the room join modal.\r\n     */\r\n    private joinRoomById(roomId: string): void {\r\n        if (!roomId) return;\r\n        if (!this.wsManager.getWebSocket()) {\r\n            this.wsManager.connectWebSocket();\r\n            this.utility.safeTimeout(() => {\r\n                this.roomManager.joinRoom(roomId!);\r\n            }, GAME.CONNECTION_TIMEOUT);\r\n        } else {\r\n            this.roomManager.joinRoom(roomId);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Calls quickplay endpoint on server to find a random open public room.\r\n     */\r\n    public quickPlay(): void {\r\n        fetch('/quickplay')\r\n            .then(response => {\r\n                if (!response.ok) {\r\n                    throw new Error('No available rooms');\r\n                }\r\n                return response.json();\r\n            })\r\n            .then(data => {\r\n                if (!this.wsManager.getWebSocket()) {\r\n                    this.wsManager.connectWebSocket();\r\n                    this.utility.safeTimeout(() => {\r\n                        this.roomManager.joinRoom(data.roomId);\r\n                    }, GAME.CONNECTION_TIMEOUT);\r\n                } else {\r\n                    this.roomManager.joinRoom(data.roomId);\r\n                }\r\n            })\r\n            .catch(error => {\r\n                if (!this.ui.modal || !this.ui.modalConfirmButton || !this.ui.modalCancelButton ||\r\n                    !this.ui.modalContent || !this.ui.modalText || !this.ui.modalInput ||\r\n                    !this.ui.modalErrorDiv || !this.ui.modalButtons) return;\r\n\r\n                this.ui.modal.classList.remove('hidden');\r\n                this.ui.modalInput.style.display = 'none';\r\n                this.ui.modalErrorDiv.textContent = ' ';\r\n                this.ui.modalButtons.style.display = 'flex';\r\n                this.ui.modalCancelButton.style.display = 'none';\r\n\r\n                this.ui.modalText.textContent = 'No available games found.';\r\n\r\n                this.ui.modalConfirmButton.textContent = 'Confirm';\r\n                this.ui.modalConfirmButton.onclick = () => {\r\n                    if (!this.ui.modal || !this.ui.modalInput || !this.ui.modalCancelButton ||\r\n                        !this.ui.modalText || !this.ui.modalConfirmButton) return;\r\n\r\n                    this.ui.modal.classList.add('hidden');\r\n                    this.ui.modalInput.style.display = 'flex';\r\n                    this.ui.modalText.textContent = 'Join Room';\r\n                    this.ui.modalCancelButton.style.display = 'flex';\r\n                    this.ui.modalConfirmButton.onclick = null;\r\n                };\r\n            });\r\n    }\r\n\r\n    /**\r\n     * Called when leaving the current room - resets game state.\r\n     */\r\n    public leaveRoom(): void {\r\n        this.roomManager.leaveRoom();\r\n\r\n        window.dispatchEvent(new CustomEvent(\"customEvent_resetGameState\", {\r\n            detail: { resetType: \"Room\" }\r\n        }));\r\n\r\n        this.showRoomControls();\r\n    }\r\n\r\n    /**\r\n     * Used to check for a room link in the URL when loading the page.\r\n     */\r\n    public checkForRoomInURL(): void {\r\n        const roomId = this.getRoomIdFromURL();\r\n        if (roomId) {\r\n            this.wsManager.connectWebSocket();\r\n            this.utility.safeTimeout(() => {\r\n                this.roomManager.joinRoom(roomId);\r\n            }, GAME.CONNECTION_TIMEOUT);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * [DO NOT CALL - Call checkForRoomInURL] Directly parses the room ID from the URL if one is found. \r\n     */\r\n    private getRoomIdFromURL(): string | null {\r\n        const urlParams = new URLSearchParams(window.location.search);\r\n        return urlParams.get('room');\r\n    }\r\n\r\n    /**\r\n     * Gets the room ID contextually, and copies it to clipboard.\r\n     */\r\n    public copyRoomCode(): void {\r\n        // Get room ID from either lobby or game container\r\n        const roomId = this.lobbyManager.inLobby\r\n            ? this.ui.roomIdDisplay?.textContent\r\n            : this.ui.gameRoomIdDisplay?.textContent;\r\n\r\n        if (!roomId) return;\r\n\r\n        navigator.clipboard.writeText(roomId).then(() => {\r\n            if (!this.ui.modal || !this.ui.modalConfirmButton || !this.ui.modalCancelButton ||\r\n                !this.ui.modalContent || !this.ui.modalText || !this.ui.modalInput ||\r\n                !this.ui.modalErrorDiv || !this.ui.modalButtons) return;\r\n\r\n            this.ui.modal.classList.remove('hidden');\r\n            this.ui.modalInput.style.display = 'none';\r\n            this.ui.modalErrorDiv.textContent = ' ';\r\n            this.ui.modalButtons.style.display = 'flex';\r\n            this.ui.modalCancelButton.style.display = 'none';\r\n\r\n            this.ui.modalText.textContent = 'Room code copied!';\r\n            this.ui.modalConfirmButton.textContent = 'Confirm';\r\n\r\n            // Define the close function\r\n            const closeModal = () => {\r\n                if (!this.ui.modal || !this.ui.modalInput || !this.ui.modalCancelButton ||\r\n                    !this.ui.modalText || !this.ui.modalConfirmButton) return;\r\n\r\n                this.ui.modal.classList.add('hidden');\r\n                this.ui.modalInput.style.display = 'flex';\r\n                this.ui.modalText.textContent = 'Join Room';\r\n                this.ui.modalCancelButton.style.display = 'flex';\r\n                this.ui.modalConfirmButton.onclick = null;\r\n            };\r\n\r\n            this.ui.modalConfirmButton.onclick = closeModal;\r\n\r\n            // Auto-close after 3 seconds\r\n            this.utility.safeTimeout(() => {\r\n                if (this.ui.modal && !this.ui.modal.classList.contains('hidden')) {\r\n                    closeModal();\r\n                }\r\n            }, 3000);\r\n        }).catch(() => {\r\n            alert(\"Could not copy. Please copy manually.\");\r\n        });\r\n    }\r\n}","import { ROOM } from './Config';\r\nimport { RoomMessage } from './Types';\r\n\r\nimport { Utility } from './Utility';\r\n\r\nexport class RoomManager {\r\n  private currentRoom: string | null = null;\r\n  private ws: WebSocket | null = null;\r\n  private messageHandlers: ((message: RoomMessage) => void)[] = [];\r\n\r\n  public isPrivateRoom = false;\r\n\r\n  constructor(private userId: string, private utility: Utility) { }\r\n\r\n  /**\r\n   * Assigns the active WebSocket connection and sets up message handling.\r\n   */\r\n  public setWebSocket(ws: WebSocket): void {\r\n    this.ws = ws;\r\n    this.setupMessageHandler();\r\n  }\r\n\r\n  /**\r\n   * Creates a new room and automatically joins it as the host.\r\n   */\r\n  public createRoom(): string | null {\r\n    if (!this.ws || this.ws.readyState !== WebSocket.OPEN) {\r\n      alert('Cannot create room: Not connected to server. Please refresh the page.');\r\n      return null;\r\n    }\r\n\r\n    const roomId = this.utility.generateUID(ROOM.ID_LENGTH, ROOM.ID_PREFIX);\r\n    this.joinRoom(roomId, true);\r\n    return roomId;\r\n  }\r\n\r\n  /**\r\n   * Joins an existing room or creates one if isHost is true.\r\n   */\r\n  public joinRoom(roomId: string, isHost: boolean = false): void {\r\n    if (!this.ws || this.ws.readyState !== WebSocket.OPEN) {\r\n      alert('Cannot join room: Not connected to server. Please refresh the page.');\r\n      return;\r\n    }\r\n\r\n    const message: RoomMessage = {\r\n      type: isHost ? 'create-room' : 'join-room',\r\n      roomId,\r\n      userId: this.userId\r\n    };\r\n\r\n    this.ws.send(JSON.stringify(message));\r\n    this.currentRoom = roomId;\r\n    this.utility.generateLink(roomId, 'room');\r\n  }\r\n\r\n  /**\r\n   * Leaves the current room and resets the client state.\r\n   */\r\n  public leaveRoom(): void {\r\n    if (!this.currentRoom || !this.ws) return;\r\n\r\n    const message: RoomMessage = {\r\n      type: 'leave-room',\r\n      roomId: this.currentRoom,\r\n      userId: this.userId\r\n    };\r\n\r\n    this.ws.send(JSON.stringify(message));\r\n    this.currentRoom = null;\r\n    window.history.pushState({}, '', window.location.origin);\r\n  }\r\n\r\n  /**\r\n   * Returns the ID of the current active room.\r\n   */\r\n  public sendMessage(text: string): void {\r\n    if (!this.currentRoom || !this.ws) return;\r\n\r\n    if (this.ws.readyState !== WebSocket.OPEN) {\r\n      alert('Cannot send message: Not connected to server. Please refresh the page.');\r\n      return;\r\n    }\r\n\r\n    const message: RoomMessage = {\r\n      type: 'room-message',\r\n      roomId: this.currentRoom,\r\n      userId: this.userId,\r\n      message: text\r\n    };\r\n\r\n    this.ws.send(JSON.stringify(message));\r\n  }\r\n\r\n  /**\r\n   * Sends an admin command from the frontend to backend.\r\n   */\r\n  public sendAdminCommand(command: string, key: string): void {\r\n    if (!this.ws) return;\r\n\r\n    const message = {\r\n      type: 'admin-command',\r\n      id: command,\r\n      key: key,\r\n      userId: this.userId\r\n    };\r\n\r\n    this.ws.send(JSON.stringify(message));\r\n  }\r\n\r\n  /**\r\n   * Returns the ID of the current active room.\r\n   */\r\n  public getCurrentRoom(): string | null {\r\n    return this.currentRoom;\r\n  }\r\n\r\n  /**\r\n   * Generates a shareable link for the current room.\r\n   */\r\n  public getRoomLink(param?: string): string | null {\r\n    return this.currentRoom ? this.utility.generateLink(this.currentRoom, param) : null;\r\n  }\r\n\r\n  /**\r\n   * Registers a callback to handle incoming room messages.\r\n   */\r\n  public onMessage(handler: (message: RoomMessage) => void): void {\r\n    this.messageHandlers.push(handler);\r\n  }\r\n\r\n  /**\r\n   * Processes incoming WebSocket messages and dispatches them to all handlers.\r\n   */\r\n  private setupMessageHandler(): void {\r\n    if (!this.ws) return;\r\n\r\n    this.ws.onmessage = (event) => {\r\n      try {\r\n        const message: RoomMessage = JSON.parse(event.data);\r\n        this.messageHandlers.forEach(handler => handler(message));\r\n      } catch (error) {\r\n        // Handle plain text messages (backwards compatibility)\r\n        const plainMessage: RoomMessage = {\r\n          type: 'room-message',\r\n          userId: 'server',\r\n          message: event.data\r\n        };\r\n        this.messageHandlers.forEach(handler => handler(plainMessage));\r\n      }\r\n    };\r\n  }\r\n}\r\n","import { GAME } from \"./Config\";\r\nimport { GameSettings } from \"./Types\";\r\n\r\nimport { CacheManager } from \"./CacheManager\";\r\nimport { AudioConfig } from \"./AudioConfig\";\r\n\r\nexport class SettingsManager {\r\n    private gameSettings: GameSettings\r\n\r\n    constructor(private audioConfig: AudioConfig, private cacheManager: CacheManager) {\r\n        this.gameSettings = this.initSettings();\r\n    }\r\n\r\n    /**\r\n     * Initializes default options when the game starts.\r\n     */\r\n    public initSettings(): GameSettings {\r\n        return { // [ IMPORTANT ] Keep track of the default game options here\r\n            audio: {\r\n                mixer: {\r\n                    master: this.audioConfig.mixer.master,\r\n                    interface: this.audioConfig.mixer.interface,\r\n                    music: this.audioConfig.mixer.music,\r\n                    sfx: this.audioConfig.mixer.sfx,\r\n                    voice: this.audioConfig.mixer.voice\r\n                }\r\n            },\r\n            controls: {\r\n                keybinds: {\r\n                    attack: GAME.CONTROLS.KEYBINDS.ATTACK,\r\n                    dash: GAME.CONTROLS.KEYBINDS.DASH,\r\n                    melee: GAME.CONTROLS.KEYBINDS.MELEE,\r\n                    moveDown: GAME.CONTROLS.KEYBINDS.MOVE_DOWN,\r\n                    moveLeft: GAME.CONTROLS.KEYBINDS.MOVE_LEFT,\r\n                    moveRight: GAME.CONTROLS.KEYBINDS.MOVE_RIGHT,\r\n                    moveUp: GAME.CONTROLS.KEYBINDS.MOVE_UP,\r\n                    reload: GAME.CONTROLS.KEYBINDS.RELOAD,\r\n                    sprint: GAME.CONTROLS.KEYBINDS.SPRINT,\r\n                },\r\n                gamepad: {\r\n                    attack: GAME.CONTROLS.GAMEPAD.ATTACK,\r\n                    dash: GAME.CONTROLS.GAMEPAD.DASH,\r\n                    deadzone: GAME.CONTROLS.GAMEPAD.DEADZONE,\r\n                    melee: GAME.CONTROLS.GAMEPAD.MELEE,\r\n                    reload: GAME.CONTROLS.GAMEPAD.RELOAD,\r\n                    sprint: GAME.CONTROLS.GAMEPAD.SPRINT\r\n                }\r\n            },\r\n            graphics: {\r\n                physics: {\r\n                    ammoReserves: GAME.GRAPHICS.PHYSICS.AMMORESERVES\r\n                },\r\n                renderBackgroundParticles: GAME.GRAPHICS.BACKGROUND_PARTICLES,\r\n                showStaticOverlay: GAME.GRAPHICS.STATIC_OVERLAY,\r\n            }\r\n        };\r\n    }\r\n\r\n    /**\r\n     * Returns the currently stored gameSettings.\r\n     */\r\n    public getSettings(): GameSettings { return this.gameSettings }\r\n\r\n    /**\r\n     * Recursively updates any setting(s) passed within the stored gameSettings.\r\n     */\r\n    public updateSettings(settings: any): void {\r\n        const merge = (target: any, source: any): void => {\r\n            for (const key in source) {\r\n                if (source[key] && typeof source[key] === 'object' && !Array.isArray(source[key])) {\r\n                    if (!target[key]) target[key] = {};\r\n                    merge(target[key], source[key]);\r\n                } else {\r\n                    target[key] = source[key];\r\n                }\r\n            }\r\n        };\r\n\r\n        merge(this.gameSettings, settings);\r\n        this.cacheManager.write('gameSettings', this.gameSettings);\r\n    }\r\n\r\n    /**\r\n     * Loads the currently cached gameSettings from the cacheManager.\r\n     */\r\n    public async loadSettings(): Promise<void> {\r\n        const cached = await this.cacheManager.read('gameSettings');\r\n        if (cached) {\r\n            this.gameSettings = cached;\r\n        }\r\n    }\r\n}","export const equipment = [\r\n    'switch'\r\n];","import { equipment } from './equipment';\r\nimport { resource } from './resource';\r\nimport { stats } from './stats';\r\nimport { unique } from './unique';\r\n\r\nexport const upgradeFiles = {\r\n    equipment,\r\n    resource,\r\n    stats,\r\n    unique\r\n};","export const resource = [\r\n    'carepackage'\r\n];","export const stats = [\r\n    'bioregulator',\r\n    'damagebuffer',\r\n    'hemoglobinsaturator',\r\n    'locomotionmodule'\r\n];","export const unique = [\r\n    'clustermodule',\r\n    'kineticbrain',\r\n    'muzzlesplitter',\r\n    'phoenixmodule',\r\n    'projectilearray',\r\n    'spatialtargeting',\r\n    'spectralimage'\r\n];","import { Player, Upgrade, UpgradeParams, UpgradeRarity, UpgradeType } from './Types';\r\n\r\nimport { upgradeFiles } from './upgrades';\r\n\r\nimport { UserInterface } from './UserInterface';\r\nimport { Utility } from './Utility';\r\n\r\nimport { PlayerState } from './player/PlayerState';\r\nimport { PlayerConfig } from './player/PlayerConfig';\r\n\r\nexport class UpgradeManager {\r\n    public takenUniques = new Set<string>(); // Pool of uniques already taken by players during this session\r\n    public upgradesCompleted = new Set<string>(); // Tracks round end upgrade progress\r\n\r\n    public isUpgradesEnabled = true;\r\n\r\n    private rarityConfig = {\r\n        [UpgradeRarity.COMMON]: {\r\n            weight: 35,\r\n            color: '#7e7e7e'\r\n        },\r\n        [UpgradeRarity.UNCOMMON]: {\r\n            weight: 20,\r\n            color: '#61b6d5'\r\n        },\r\n        [UpgradeRarity.SPECIAL]: {\r\n            weight: 15,\r\n            color: '#58d688'\r\n        },\r\n        [UpgradeRarity.SUPERIOR]: {\r\n            weight: 12,\r\n            color: '#ffc233'\r\n        },\r\n        [UpgradeRarity.RARE]: {\r\n            weight: 8,\r\n            color: '#0077ff'\r\n        },\r\n        [UpgradeRarity.EXCEPTIONAL]: {\r\n            weight: 5,\r\n            color: '#00ff62'\r\n        },\r\n        [UpgradeRarity.LEGENDARY]: {\r\n            weight: 2.5,\r\n            color: '#f6ff00'\r\n        },\r\n        [UpgradeRarity.MYTHICAL]: {\r\n            weight: 1.5,\r\n            color: '#ff0000'\r\n        },\r\n        [UpgradeRarity.ENLIGHTENED]: {\r\n            weight: 0.9,\r\n            color: '#9500ff'\r\n        },\r\n        [UpgradeRarity.HOLY]: {\r\n            weight: 0.1,\r\n            color: '#ff00f7'\r\n        }\r\n    };\r\n\r\n    public upgrades: Upgrade[] = []\r\n\r\n    constructor(\r\n        private playerConfig: PlayerConfig,\r\n        private playerState: PlayerState,\r\n        private ui: UserInterface,\r\n        private utility: Utility\r\n    ) { \r\n        this.initUpgrades();\r\n    }\r\n\r\n    /**\r\n     * Initializes upgrades[] by importing the upgradeFiles from the index.ts in the upgrades folder.\r\n     */\r\n    private initUpgrades(): void {\r\n        const params: UpgradeParams = {\r\n            playerState: this.playerState,\r\n            ui: this.ui,\r\n            utility: this.utility\r\n        };\r\n\r\n        upgradeFiles.equipment.forEach(filename => {\r\n            const upgrade = require(`./upgrades/equipment/${filename}/${filename}`).create(params);\r\n            this.upgrades.push(upgrade);\r\n        });\r\n\r\n        upgradeFiles.resource.forEach(filename => {\r\n            const upgrade = require(`./upgrades/resource/${filename}/${filename}`).create(params);\r\n            this.upgrades.push(upgrade);\r\n        });\r\n\r\n        upgradeFiles.stats.forEach(filename => {\r\n            const upgrade = require(`./upgrades/stats/${filename}/${filename}`).create(params);\r\n            this.upgrades.push(upgrade);\r\n        });\r\n\r\n        upgradeFiles.unique.forEach(filename => {\r\n            const upgrade = require(`./upgrades/unique/${filename}/${filename}`).create(params);\r\n            this.upgrades.push(upgrade);\r\n        });\r\n    }\r\n\r\n    /**\r\n     * Returns a selected amount of upgrades for a specific player in the game.\r\n     * \r\n     * Used to display upgrades for all round losers after brief roud-end pause.\r\n     */\r\n    public getUpgrades(count: number, player: Player): Upgrade[] {\r\n        // Filter available upgrades based on type restrictions\r\n        const availableUpgrades = this.upgrades.filter(upgrade => {\r\n            // Check if unique upgrade has already been taken globally\r\n            if (upgrade.unique && this.takenUniques.has(upgrade.id)) {\r\n                return false;\r\n            }\r\n\r\n            // Check if equipment is already owned by this player\r\n            if (upgrade.type === UpgradeType.EQUIPMENT && player.equipment.includes(upgrade.id)) {\r\n                return false;\r\n            }\r\n\r\n            return true;\r\n        });\r\n\r\n        // Weighted random selection using rarity config\r\n        const selected: Upgrade[] = [];\r\n\r\n        for (let i = 0; i < Math.min(count, availableUpgrades.length); i++) {\r\n            if (availableUpgrades.length === 0) break;\r\n\r\n            // Calculate weighted random selection using this.rarityConfig\r\n            const totalWeight = availableUpgrades.reduce((sum, upgrade) => {\r\n                return sum + this.getRarityWeight(upgrade.rarity);\r\n            }, 0);\r\n\r\n            let random = Math.random() * totalWeight;\r\n            let selectedUpgrade: Upgrade | null = null;\r\n\r\n            for (const upgrade of availableUpgrades) {\r\n                random -= this.getRarityWeight(upgrade.rarity);\r\n                if (random <= 0) {\r\n                    selectedUpgrade = upgrade;\r\n                    break;\r\n                }\r\n            }\r\n\r\n            if (selectedUpgrade) {\r\n                selected.push(selectedUpgrade);\r\n                // Remove from available pool to prevent duplicates in this selection\r\n                const index = availableUpgrades.indexOf(selectedUpgrade);\r\n                availableUpgrades.splice(index, 1);\r\n            }\r\n        }\r\n\r\n        return selected;\r\n    }\r\n\r\n    /**\r\n     * Applies a specific upgrade to a specific player by mutating their myPlayer object.\r\n     */\r\n    public applyUpgrade(upgradeId: string, player: Player): boolean {\r\n        const upgrade = this.upgrades.find(u => u.id === upgradeId);\r\n        if (!upgrade) return false;\r\n\r\n        // Double-check restrictions\r\n        if (upgrade.unique && this.takenUniques.has(upgradeId)) {\r\n            console.warn(`Unique upgrade ${upgradeId} already taken globally`);\r\n            return false;\r\n        }\r\n\r\n        if (upgrade.type === UpgradeType.EQUIPMENT && this.hasEquipment(player, upgradeId)) {\r\n            console.warn(`Equipment ${upgradeId} already owned by player`);\r\n            return false;\r\n        }\r\n\r\n        // Track unique upgrades globally\r\n        if (upgrade.unique) {\r\n            this.takenUniques.add(upgradeId);\r\n        }\r\n\r\n        // Apply the upgrade to the player object\r\n        upgrade.func(player);\r\n        return true;\r\n    }\r\n\r\n    /**\r\n     * Removes a unique upgrade from the global pool.\r\n     * \r\n     * This process involved adding the unique item to the client's takenUniques array.\r\n     * \r\n     * Network message 'upgrade-taken' broadcasts this to all players.\r\n     */\r\n    public removeUpgradeFromPool(upgradeId: string): void {\r\n        this.takenUniques.add(upgradeId);\r\n    }\r\n\r\n    /**\r\n     * Resets the global uniques pool to a clean slate.\r\n     */\r\n    public resetUpgrades(player: Player): void {\r\n        this.takenUniques.clear();\r\n\r\n        player.equipment = this.playerConfig.default.equipment;\r\n        player.unique = this.playerConfig.default.unique;\r\n    }\r\n\r\n    // #region [ Helpers ]\r\n    //\r\n    /**\r\n     * Returns boolean based on if the selected player has a specific equipment piece or not.\r\n     */\r\n    public hasEquipment(player: Player, equipmentId: string): boolean {\r\n        return player.equipment.includes(equipmentId);\r\n    }\r\n\r\n    /**\r\n     * Returns boolean based on if the selected player has a specific unique item or not.\r\n     */\r\n    private hasUnique(player: Player, uniqueId: string): boolean {\r\n        return player.unique.includes(uniqueId);\r\n    }\r\n\r\n    /**\r\n     * Gets the color associated with a specific rarity.\r\n     */\r\n    private getRarityColor(rarity: UpgradeRarity): string {\r\n        return this.rarityConfig[rarity].color;\r\n    }\r\n\r\n    /**\r\n     * Gets the weight of a specific rarity.\r\n     */\r\n    private getRarityWeight(rarity: UpgradeRarity): number {\r\n        return this.rarityConfig[rarity].weight;\r\n    }\r\n}\r\n\r\n/**\r\n Upgrade Ideas:\r\n ionic compound\r\n randomly chance to combine all nProjeciles into one\r\n explosion on dash\r\n while sprinting, luck doubled\r\n bullet trails\r\n projectile with padding on sides = projectiles that are detonated on reload\r\n on death respawn as 1hp ghost who can melee with .25s invul\r\n chemistry system\r\n volatile upgrades\r\n\r\n on hit, chance to instakill player, destroy one of your equipment, only trigger if enemies damage would kill you\r\n - one time use, destroys itself and another upgrade\r\n \r\n > [ Stats ]\r\n  - Size -- / Speed ++\r\n  - Damage ++ / Buffer ++\r\n  - \r\n > [ Persistent ]\r\n  - Projectile burst into more projectiles on non-player hit.\r\n  - Dash becomes teleport but uses twice as much stamina.\r\n  - Switch, unlocking further firing modes \r\n > [ Luck Based ]\r\n  - Explosive\r\n    > explode on hit\r\n    > stick, then explode after timer\r\n    > only explode on player hit\r\n  - Fire\r\n    > leave behind a flame on ground hit that persists and does damage for some time\r\n    > burn player on hit for timer\r\n  - Oil\r\n    > leave oil puddles on hit, flammable, oil on fire persists much longer\r\n  - Poison\r\n    > decrease player health gradually for timer on player hit\r\n    > leave pool of poison on ground for timer\r\n    > spray poison out on ground hit\r\n  - Bounce\r\n    > chance for projectile to bounce\r\n  - Orbital Laser\r\n    > chance to spawn cluster of lasers on non-boundary hit\r\n*/","import { ReserveBulletParticle } from \"../Types\";\r\n\r\nimport { SettingsManager } from \"../SettingsManager\";\r\nimport { UserInterface } from \"../UserInterface\";\r\nimport { Utility } from \"../Utility\";\r\n\r\nexport class AmmoReservesUIController {\r\n    private ammoReserveIcon: HTMLImageElement | null = null;\r\n    private projectileIcon: HTMLImageElement | null = null;\r\n\r\n    public reserveBulletParticles: ReserveBulletParticle[] = [];\r\n\r\n    constructor(\r\n        private settings: SettingsManager,\r\n        private ui: UserInterface,\r\n        private utility: Utility\r\n    ) { }\r\n\r\n    // [ Ammo Reserve Canvas ]\r\n    //\r\n    /**\r\n     * Initializes the ammo reserve canvas in the HUD.\r\n     */\r\n    public initAmmoReserveCanvas(): void { // TODO: Unify where UI element references are stored\r\n        this.ammoReserveIcon = new Image();\r\n        this.ammoReserveIcon.src = '/assets/img/icon/inventory/ammobox.png';\r\n        this.ammoReserveIcon.onload = () => {\r\n            this.renderAmmoReserves();\r\n        };\r\n\r\n        this.projectileIcon = new Image();\r\n        this.projectileIcon.src = '/assets/img/icon/inventory/9mm.png';\r\n\r\n        // Start physics loop if it is enabled in the user's prefs\r\n        if (this.settings.getSettings().graphics.physics.ammoReserves) {\r\n            requestAnimationFrame(() => this.updateAmmoReservePhysics());\r\n        }\r\n    }\r\n\r\n    /**\r\n     * When picking up ammo, this function spawns the casings in the player's ammo reserve UI.\r\n     */\r\n    public spawnAmmoInReserveUI(amount: number = 1): void {\r\n        if (!this.ui.ammoReservesCtx || !this.projectileIcon) return;\r\n\r\n        const physicsEnabled = this.settings.getSettings().graphics.physics.ammoReserves;\r\n\r\n        const spawnDelay = 100;\r\n        const { collisionHeight, collisionWidth, collisionX, collisionY } = this.getAmmoReserveCollisionZone();\r\n\r\n        const scale = 0.25;\r\n        const bulletWidth = 11 * scale;\r\n        const bulletHeight = 28 * scale;\r\n\r\n        for (let i = 0; i < amount; i++) {\r\n            this.utility.safeTimeout(() => {\r\n                if (physicsEnabled) {\r\n                    // Physics mode: spawn with velocity from right side\r\n                    const x = collisionX + collisionWidth;\r\n                    const y = collisionY + collisionHeight / 2;\r\n                    const speed = 2 + Math.random() * 8;\r\n                    const angle = (Math.random() - 0.5) * (Math.PI / 3);\r\n                    const vx = Math.cos(angle) * speed;\r\n                    const vy = Math.sin(angle) * speed;\r\n                    const rotation = Math.random() * Math.PI * 2;\r\n                    const torque = (Math.random() - 0.5) * 0.1;\r\n\r\n                    this.reserveBulletParticles.push({\r\n                        transform: {\r\n                            pos: { x, y },\r\n                            rot: rotation,\r\n                        },\r\n                        velocity: { x: vx, y: vy },\r\n                        torque,\r\n                        width: bulletWidth,\r\n                        height: bulletHeight\r\n                    });\r\n                } else {\r\n                    // Static mode: spawn at random position, no velocity\r\n                    const x = collisionX + Math.random() * collisionWidth;\r\n                    const y = collisionY + Math.random() * collisionHeight;\r\n                    const rotation = Math.random() * Math.PI * 2;\r\n\r\n                    this.reserveBulletParticles.push({\r\n                        transform: {\r\n                            pos: { x, y },\r\n                            rot: rotation,\r\n                        },\r\n                        velocity: { x: 0, y: 0 },\r\n                        torque: 0,\r\n                        width: bulletWidth,\r\n                        height: bulletHeight\r\n                    });\r\n                    this.renderAmmoReserves(); // Render static bullet immediately\r\n                }\r\n            }, i * spawnDelay);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Removes ammo from the reserves UI when ammo is taken from the player's reserves.\r\n     */\r\n    public removeAmmoFromReserveUI(amount: number = 1): void {\r\n        const removeDelay = 100; // ms, match spawnBullet\r\n        for (let i = 0; i < amount; i++) {\r\n            this.utility.safeTimeout(() => {\r\n                if (this.reserveBulletParticles.length > 0) {\r\n                    this.reserveBulletParticles.shift();\r\n                }\r\n                if (!this.settings.getSettings().graphics.physics.ammoReserves) {\r\n                    this.renderAmmoReserves();\r\n                }\r\n            }, i * removeDelay);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Processes ammo reserve physics for the projectiles in the ammo reserve UI.\r\n     */\r\n    private updateAmmoReservePhysics(): void {\r\n        if (!this.settings.getSettings().graphics.physics.ammoReserves) return;\r\n        if (!this.ui.ammoReservesCtx || !this.ammoReserveIcon) return;\r\n\r\n        // TODO: Add sleeping when they come to a stop and end simulation\r\n\r\n        // Physics constants\r\n        const friction = 0.9;\r\n        const bounce = 0.5;\r\n\r\n        const { collisionHeight, collisionWidth, collisionX, collisionY } = this.getAmmoReserveCollisionZone();\r\n\r\n        // Clear\r\n        this.ui.ammoReservesCtx.clearRect(0, 0, this.ui.ammoReservesCanvas!.width, this.ui.ammoReservesCanvas!.height);\r\n\r\n        // Draw background box\r\n        this.ui.ammoReservesCtx.drawImage(\r\n            this.ammoReserveIcon,\r\n            0, 0,\r\n            this.ui.ammoReservesCanvas!.width,\r\n            this.ui.ammoReservesCanvas!.height\r\n        );\r\n\r\n        // Update and draw bullets\r\n        for (let bullet of this.reserveBulletParticles) {\r\n            // Physics\r\n            bullet.transform.pos.x += bullet.velocity.x;\r\n            bullet.transform.pos.y += bullet.velocity.y;\r\n            bullet.transform.rot += bullet.torque;\r\n\r\n            bullet.velocity.x *= friction;\r\n            bullet.velocity.y *= friction;\r\n            bullet.torque *= friction;\r\n\r\n            // Wall collisions\r\n            // Left\r\n            if (bullet.transform.pos.x - bullet.width / 2 < collisionX) {\r\n                bullet.transform.pos.x = collisionX + bullet.width / 2;\r\n                bullet.velocity.x *= -bounce;\r\n            }\r\n            // Right\r\n            if (bullet.transform.pos.x + bullet.width / 2 > collisionX + collisionWidth) {\r\n                bullet.transform.pos.x = collisionX + collisionWidth - bullet.width / 2;\r\n                bullet.velocity.x *= -bounce;\r\n            }\r\n            // Top\r\n            if (bullet.transform.pos.y - bullet.height / 2 < collisionY) {\r\n                bullet.transform.pos.y = collisionY + bullet.height / 2;\r\n                bullet.velocity.y *= -bounce;\r\n            }\r\n            // Bottom\r\n            if (bullet.transform.pos.y + bullet.height / 2 > collisionY + collisionHeight) {\r\n                bullet.transform.pos.y = collisionY + collisionHeight - bullet.height / 2;\r\n                bullet.velocity.y *= -bounce;\r\n            }\r\n        }\r\n\r\n        // Optional: bullet-bullet collisions (efficient, skip if <2 bullets)\r\n        for (let i = 0; i < this.reserveBulletParticles.length; i++) {\r\n            for (let j = i + 1; j < this.reserveBulletParticles.length; j++) {\r\n                const a = this.reserveBulletParticles[i];\r\n                const b = this.reserveBulletParticles[j];\r\n                const dx = a.transform.pos.x - b.transform.pos.x;\r\n                const dy = a.transform.pos.y - b.transform.pos.y;\r\n                const dist = Math.sqrt(dx * dx + dy * dy);\r\n                const minDist = (a.width + b.width) / 2;\r\n                if (dist < minDist) {\r\n                    // Simple elastic collision\r\n                    const angle = Math.atan2(dy, dx);\r\n                    const overlap = minDist - dist;\r\n                    const ax = Math.cos(angle) * overlap / 2;\r\n                    const ay = Math.sin(angle) * overlap / 2;\r\n\r\n                    a.transform.pos.x += ax;\r\n                    a.transform.pos.y += ay;\r\n                    b.transform.pos.x -= ax;\r\n                    b.transform.pos.y -= ay;\r\n\r\n                    // Swap velocities (1D along collision axis)\r\n                    const va = a.velocity.x * Math.cos(angle) + a.velocity.y * Math.sin(angle);\r\n                    const vb = b.velocity.x * Math.cos(angle) + b.velocity.y * Math.sin(angle);\r\n                    const avg = (va + vb) / 2;\r\n                    a.velocity.x += (avg - va) * bounce;\r\n                    b.velocity.x += (avg - vb) * bounce;\r\n                }\r\n            }\r\n        }\r\n\r\n        // Draw bullets\r\n        for (let bullet of this.reserveBulletParticles) {\r\n            this.ui.ammoReservesCtx.save();\r\n            this.ui.ammoReservesCtx.translate(bullet.transform.pos.x, bullet.transform.pos.y);\r\n            this.ui.ammoReservesCtx.rotate(bullet.transform.rot);\r\n            this.ui.ammoReservesCtx.drawImage(\r\n                this.projectileIcon!,\r\n                -bullet.width / 2,\r\n                -bullet.height / 2,\r\n                bullet.width,\r\n                bullet.height\r\n            );\r\n            this.ui.ammoReservesCtx.restore();\r\n        }\r\n\r\n        requestAnimationFrame(() => this.updateAmmoReservePhysics());\r\n    }\r\n\r\n    /**\r\n     * Renders the ammo reserves canvas.\r\n     */\r\n    private renderAmmoReserves(): void {\r\n        if (!this.ui.ammoReservesCtx || !this.ammoReserveIcon || !this.ammoReserveIcon.complete) return;\r\n\r\n        // Clear the canvas\r\n        this.ui.ammoReservesCtx.clearRect(0, 0, this.ui.ammoReservesCanvas!.width, this.ui.ammoReservesCanvas!.height);\r\n\r\n        // Draw the ammobox icon to fill the entire canvas\r\n        this.ui.ammoReservesCtx.drawImage(\r\n            this.ammoReserveIcon,\r\n            0, 0,\r\n            this.ui.ammoReservesCanvas!.width,\r\n            this.ui.ammoReservesCanvas!.height\r\n        );\r\n\r\n        if (!this.settings.getSettings().graphics.physics.ammoReserves) {\r\n            for (let bullet of this.reserveBulletParticles) {\r\n                this.ui.ammoReservesCtx.save();\r\n                this.ui.ammoReservesCtx.translate(bullet.transform.pos.x, bullet.transform.pos.y);\r\n                this.ui.ammoReservesCtx.rotate(bullet.transform.rot);\r\n                this.ui.ammoReservesCtx.drawImage(\r\n                    this.projectileIcon!,\r\n                    -bullet.width / 2,\r\n                    -bullet.height / 2,\r\n                    bullet.width,\r\n                    bullet.height\r\n                );\r\n                this.ui.ammoReservesCtx.restore();\r\n            }\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Returns the ammo reserves collision zone to help with physics calculations for rendered projectiles.\r\n     */\r\n    private getAmmoReserveCollisionZone(): { collisionHeight: number; collisionWidth: number; collisionX: number; collisionY: number } {\r\n        const collisionWidth = 63;\r\n        const collisionHeight = 27;\r\n        const collisionX = (this.ui.ammoReservesCanvas!.width - collisionWidth) / 2 - 3;\r\n        const collisionY = (this.ui.ammoReservesCanvas!.height - collisionHeight) / 2 - 1;\r\n\r\n        const params = { collisionHeight, collisionWidth, collisionX, collisionY };\r\n\r\n        return params;\r\n    }\r\n    //\r\n    // #endregion\r\n}","import { CANVAS, GAMEPAD_MAP, WORLD } from \"./Config\";\r\nimport { GameSettings, Leaderboard, Players } from \"./Types\";\r\n\r\nimport { LobbyManager } from \"./LobbyManager\";\r\nimport { SettingsManager } from \"./SettingsManager\";\r\nimport { Utility } from \"./Utility\";\r\n\r\nimport { PlayerState } from \"./player/PlayerState\";\r\nimport { AmmoReservesUIController } from \"./player/AmmoReservesUIController\";\r\n\r\nexport class UserInterface {\r\n    public ammoReservesUIController: AmmoReservesUIController;\r\n\r\n    // [ Canvas ]\r\n    //\r\n    public ammoReservesCanvas: HTMLCanvasElement | null = null;\r\n    public ammoReservesCtx: CanvasRenderingContext2D | null = null;\r\n    public canvas: HTMLCanvasElement | null = null;\r\n    public ctx: CanvasRenderingContext2D | null = null;\r\n    public decalCanvas: HTMLCanvasElement | null = null;\r\n    public decalCtx: CanvasRenderingContext2D | null = null;\r\n    public worldCanvas: HTMLCanvasElement | null = null;\r\n    public worldCtx: CanvasRenderingContext2D | null = null;\r\n    //\r\n    //\r\n    // [ Containers ]\r\n    //\r\n    public gameContainer: HTMLDivElement | null = null;\r\n    public gameOptionsContainer: HTMLDivElement | null = null;\r\n    public lobbyContainer: HTMLDivElement | null = null;\r\n    public roomControls: HTMLDivElement | null = null;\r\n    public upgradeContainer: HTMLElement | null = null;\r\n    //\r\n    //\r\n    // [ Displays ]\r\n    //\r\n    public gameRoomIdDisplay: HTMLSpanElement | null = null;\r\n    public lobbyPlayersList: HTMLDivElement | null = null;\r\n    public roomIdDisplay: HTMLSpanElement | null = null;\r\n    public userIdDisplay: HTMLSpanElement | null = null;\r\n    //\r\n    //\r\n    // [ Buttons ]\r\n    //\r\n    public gameCodeButton: HTMLButtonElement | null = null;\r\n    public gameLeaveButton: HTMLButtonElement | null = null;\r\n    public hostButton: HTMLButtonElement | null = null;\r\n    public joinButton: HTMLButtonElement | null = null;\r\n    public lobbyCodeButton: HTMLButtonElement | null = null;\r\n    public lobbyLeaveButton: HTMLButtonElement | null = null;\r\n    public quickplayButton: HTMLButtonElement | null = null;\r\n    public startGameBtn: HTMLButtonElement | null = null;\r\n    //\r\n    //\r\n    // [ Inputs / Toggles ]\r\n    //\r\n    public playersInput: HTMLInputElement | null = null;\r\n    public privateToggle: HTMLElement | null = null;\r\n    public upgradesToggle: HTMLElement | null = null;\r\n    public winsInput: HTMLInputElement | null = null;\r\n    //\r\n    //\r\n    // [ Chat ]\r\n    //\r\n    public chatContainer: HTMLDivElement | null = null;\r\n    public chatInput: HTMLInputElement | null = null;\r\n    public chatMessages: HTMLDivElement | null = null;\r\n    public chatSendBtn: HTMLButtonElement | null = null;\r\n    //\r\n    //\r\n    // [ Char Customizer ]\r\n    //\r\n    public charCustomizeContainer: HTMLDivElement | null = null;\r\n    public charCustomizeCanvas: HTMLCanvasElement | null = null;\r\n    public charCustomizeCtx: CanvasRenderingContext2D | null = null;\r\n    public headwearArrowLeft: HTMLDivElement | null = null;\r\n    public headArrowLeft: HTMLDivElement | null = null;\r\n    public bodyArrowLeft: HTMLDivElement | null = null;\r\n    public headwearArrowRight: HTMLDivElement | null = null;\r\n    public headArrowRight: HTMLDivElement | null = null;\r\n    public bodyArrowRight: HTMLDivElement | null = null;\r\n    //\r\n    //\r\n    // [ Modal ]\r\n    //\r\n    public modal: HTMLElement | null = null;\r\n    public modalButtons: HTMLDivElement | null = null;\r\n    public modalCancelButton: HTMLButtonElement | null = null;\r\n    public modalConfirmButton: HTMLButtonElement | null = null;\r\n    public modalContent: HTMLElement | null = null;\r\n    public modalErrorDiv: HTMLElement | null = null;\r\n    public modalInput: HTMLInputElement | null = null;\r\n    public modalText: HTMLSpanElement | null = null;\r\n    //\r\n    //\r\n    // [ Leaderboard ]\r\n    //\r\n    public leaderboard: Leaderboard = new Map();\r\n    public leaderboardBody: HTMLTableSectionElement | null = null;\r\n    public leaderboardContainer: HTMLDivElement | null = null;\r\n    //\r\n    //\r\n    // [ Settings ]\r\n    public settingsContainer: HTMLDivElement | null = null;\r\n    public settingsButton: HTMLButtonElement | null = null;\r\n    public settingsCloseButton: HTMLButtonElement | null = null;\r\n    public controlsTab: HTMLDivElement | null = null;\r\n    public graphicsTab: HTMLDivElement | null = null;\r\n    public soundTab: HTMLDivElement | null = null;\r\n    public controlsBody: HTMLDivElement | null = null;\r\n    public graphicsBody: HTMLDivElement | null = null;\r\n    public soundBody: HTMLDivElement | null = null;\r\n\r\n    public masterSlider: HTMLDivElement | null = null;\r\n    public masterFill: HTMLDivElement | null = null;\r\n    public masterValue: HTMLDivElement | null = null;\r\n    public interfaceSlider: HTMLDivElement | null = null;\r\n    public interfaceFill: HTMLDivElement | null = null;\r\n    public interfaceValue: HTMLDivElement | null = null;\r\n    public musicSlider: HTMLDivElement | null = null;\r\n    public musicFill: HTMLDivElement | null = null;\r\n    public musicValue: HTMLDivElement | null = null;\r\n    public sfxSlider: HTMLDivElement | null = null;\r\n    public sfxFill: HTMLDivElement | null = null;\r\n    public sfxValue: HTMLDivElement | null = null;\r\n    public voiceSlider: HTMLDivElement | null = null;\r\n    public voiceFill: HTMLDivElement | null = null;\r\n    public voiceValue: HTMLDivElement | null = null;\r\n\r\n    public deadzoneInput: HTMLInputElement | null = null;\r\n\r\n    public particleJSToggle: HTMLElement | null = null;\r\n    public staticVfxToggle: HTMLElement | null = null;\r\n    public ammoReservesPhysicsToggle: HTMLElement | null = null;\r\n    //\r\n    //\r\n    // [ Stats ]\r\n    public accuracyStat: HTMLSpanElement | null = null;\r\n    public damageStat: HTMLSpanElement | null = null;\r\n    public luckStat: HTMLSpanElement | null = null;\r\n    public rangeStat: HTMLSpanElement | null = null;\r\n    public shotSpeedStat: HTMLSpanElement | null = null;\r\n    public speedStat: HTMLSpanElement | null = null;\r\n\r\n    constructor(\r\n        private playerState: PlayerState,\r\n        private settingsManager: SettingsManager,\r\n        private utility: Utility\r\n    ) {\r\n        this.ammoReservesUIController = new AmmoReservesUIController(\r\n            this.settingsManager,\r\n            this,\r\n            this.utility\r\n        );\r\n\r\n        this.initInterfaceListeners();\r\n    }\r\n\r\n    // #region [ Init ]\r\n    //\r\n    /**\r\n     * Responsible for initializing all elements defined in the class structure.\r\n     * \r\n     * Do not use \"getElement\" type lookups on runtime. Cache them all on start.\r\n     */\r\n    public initInterface() {\r\n        this.canvas = document.getElementById('gameCanvas') as HTMLCanvasElement;\r\n        this.decalCanvas = document.createElement('canvas') as HTMLCanvasElement;\r\n        this.worldCanvas = document.createElement('canvas') as HTMLCanvasElement;\r\n        this.ammoReservesCanvas = document.getElementById('ammoReservesCanvas') as HTMLCanvasElement;\r\n        this.charCustomizeCanvas = document.getElementById('charCustomizeCanvas') as HTMLCanvasElement;\r\n\r\n        this.roomControls = document.getElementById('roomControls') as HTMLDivElement;\r\n        this.gameContainer = document.getElementById('gameContainer') as HTMLDivElement;\r\n        this.lobbyContainer = document.getElementById('lobbyContainer') as HTMLDivElement;\r\n        this.lobbyPlayersList = document.getElementById('lobbyPlayersList') as HTMLDivElement;\r\n        this.startGameBtn = document.getElementById('startGameBtn') as HTMLButtonElement;\r\n        this.gameOptionsContainer = document.getElementById('gameOptionsContainer') as HTMLDivElement;\r\n\r\n        this.userIdDisplay = document.getElementById('userId') as HTMLSpanElement;\r\n        this.roomIdDisplay = document.getElementById('roomId') as HTMLSpanElement;\r\n        this.gameRoomIdDisplay = document.getElementById('gameRoomId') as HTMLSpanElement;\r\n\r\n        this.chatContainer = document.getElementById('chatContainer') as HTMLDivElement;\r\n        this.chatMessages = document.getElementById('chatMessages') as HTMLDivElement;\r\n        this.chatInput = document.getElementById('chatInput') as HTMLInputElement;\r\n        this.chatSendBtn = document.getElementById('chatSendBtn') as HTMLButtonElement;\r\n\r\n        this.charCustomizeContainer = document.getElementById('charCustomizeContainer') as HTMLDivElement;\r\n        this.headwearArrowLeft = document.getElementById('headwearArrowLeft') as HTMLDivElement;\r\n        this.headArrowLeft = document.getElementById('headArrowLeft') as HTMLDivElement;\r\n        this.bodyArrowLeft = document.getElementById('bodyArrowLeft') as HTMLDivElement;\r\n        this.headwearArrowRight = document.getElementById('headwearArrowRight') as HTMLDivElement;\r\n        this.headArrowRight = document.getElementById('headArrowRight') as HTMLDivElement;\r\n        this.bodyArrowRight = document.getElementById('bodyArrowRight') as HTMLDivElement;\r\n\r\n        this.privateToggle = document.getElementById('privateToggle') as HTMLElement;\r\n        this.upgradesToggle = document.getElementById('upgradesToggle') as HTMLElement;\r\n        this.winsInput = document.getElementById('winsInput') as HTMLInputElement;\r\n        this.playersInput = document.getElementById('playersInput') as HTMLInputElement;\r\n\r\n        this.upgradeContainer = document.getElementById('upgradeContainer') as HTMLElement;\r\n\r\n        this.leaderboardContainer = document.getElementById('leaderboardContainer') as HTMLDivElement;\r\n        this.leaderboardBody = document.getElementById('leaderboardBody') as HTMLTableSectionElement;\r\n\r\n        this.hostButton = document.getElementById('atomHost') as HTMLButtonElement;\r\n        this.joinButton = document.getElementById('atomJoin') as HTMLButtonElement;\r\n        this.quickplayButton = document.getElementById('atomQuickplay') as HTMLButtonElement;\r\n\r\n        this.lobbyLeaveButton = document.getElementById('lobbyLeaveBtn') as HTMLButtonElement;\r\n        this.lobbyCodeButton = document.getElementById('lobbyCodeBtn') as HTMLButtonElement;\r\n\r\n        this.gameLeaveButton = document.getElementById('gameLeaveBtn') as HTMLButtonElement;\r\n        this.gameCodeButton = document.getElementById('gameCodeBtn') as HTMLButtonElement;\r\n\r\n        this.modal = document.getElementById('modal') as HTMLDivElement;\r\n        this.modalInput = document.getElementById('joinRoomInput') as HTMLInputElement;\r\n        this.modalButtons = document.getElementById('modalButtons') as HTMLDivElement;\r\n        this.modalConfirmButton = document.getElementById('joinRoomConfirmBtn') as HTMLButtonElement;\r\n        this.modalCancelButton = document.getElementById('joinRoomCancelBtn') as HTMLButtonElement;\r\n        this.modalErrorDiv = document.getElementById('joinRoomError') as HTMLDivElement;\r\n        this.modalContent = document.getElementById('modalContent') as HTMLDivElement;\r\n        this.modalText = document.getElementById('modalText') as HTMLSpanElement;\r\n\r\n        this.settingsContainer = document.getElementById('settingsContainer') as HTMLDivElement;\r\n        this.settingsButton = document.getElementById('atomSettings') as HTMLButtonElement;\r\n        this.settingsCloseButton = document.getElementById('settingsCloseButton') as HTMLButtonElement;\r\n        this.controlsTab = document.getElementById('controlsTab') as HTMLDivElement;\r\n        this.graphicsTab = document.getElementById('graphicsTab') as HTMLDivElement;\r\n        this.soundTab = document.getElementById('soundTab') as HTMLDivElement;\r\n        this.controlsBody = document.getElementById('controlsBody') as HTMLDivElement;\r\n        this.graphicsBody = document.getElementById('graphicsBody') as HTMLDivElement;\r\n        this.soundBody = document.getElementById('soundBody') as HTMLDivElement;\r\n\r\n        this.masterSlider = document.getElementById('masterSlider') as HTMLDivElement;\r\n        this.masterFill = document.getElementById('masterFill') as HTMLDivElement;\r\n        this.masterValue = document.getElementById('masterValue') as HTMLDivElement;\r\n        this.interfaceSlider = document.getElementById('interfaceSlider') as HTMLDivElement;\r\n        this.interfaceFill = document.getElementById('interfaceFill') as HTMLDivElement;\r\n        this.interfaceValue = document.getElementById('interfaceValue') as HTMLDivElement;\r\n        this.musicSlider = document.getElementById('musicSlider') as HTMLDivElement;\r\n        this.musicFill = document.getElementById('musicFill') as HTMLDivElement;\r\n        this.musicValue = document.getElementById('musicValue') as HTMLDivElement;\r\n        this.sfxSlider = document.getElementById('sfxSlider') as HTMLDivElement;\r\n        this.sfxFill = document.getElementById('sfxFill') as HTMLDivElement;\r\n        this.sfxValue = document.getElementById('sfxValue') as HTMLDivElement;\r\n        this.voiceSlider = document.getElementById('voiceSlider') as HTMLDivElement;\r\n        this.voiceFill = document.getElementById('voiceFill') as HTMLDivElement;\r\n        this.voiceValue = document.getElementById('voiceValue') as HTMLDivElement;\r\n\r\n        this.deadzoneInput = document.getElementById('deadzoneInput') as HTMLInputElement;\r\n\r\n        this.particleJSToggle = document.getElementById('particleJSToggle') as HTMLElement;\r\n        this.staticVfxToggle = document.getElementById('staticToggle') as HTMLElement;\r\n        this.ammoReservesPhysicsToggle = document.getElementById('ammoReservesPhysicsToggle') as HTMLElement;\r\n\r\n        this.accuracyStat = document.getElementById('accuracyValue') as HTMLSpanElement;\r\n        this.damageStat = document.getElementById('damageValue') as HTMLSpanElement;\r\n        this.luckStat = document.getElementById('luckValue') as HTMLSpanElement;\r\n        this.rangeStat = document.getElementById('rangeValue') as HTMLSpanElement;\r\n        this.shotSpeedStat = document.getElementById('shotSpeedValue') as HTMLSpanElement;\r\n        this.speedStat = document.getElementById('speedValue') as HTMLSpanElement;\r\n\r\n        if (!this.canvas || !this.decalCanvas || !this.ammoReservesCanvas || !this.charCustomizeCanvas ||\r\n            !this.worldCanvas || !this.roomControls || !this.gameContainer || !this.lobbyContainer ||\r\n            !this.userIdDisplay || !this.roomIdDisplay || !this.gameRoomIdDisplay ||\r\n            !this.lobbyPlayersList || !this.startGameBtn || !this.gameOptionsContainer || !this.chatContainer ||\r\n            !this.chatMessages || !this.chatInput || !this.chatSendBtn || !this.privateToggle ||\r\n            !this.upgradesToggle || !this.winsInput || !this.playersInput || !this.upgradeContainer ||\r\n            !this.leaderboardContainer || !this.leaderboardBody || !this.hostButton || !this.joinButton ||\r\n            !this.quickplayButton || !this.lobbyLeaveButton || !this.lobbyCodeButton || !this.gameLeaveButton ||\r\n            !this.gameCodeButton || !this.settingsButton || !this.settingsCloseButton || !this.settingsContainer ||\r\n            !this.controlsTab || !this.graphicsTab || !this.soundTab || !this.controlsBody || !this.graphicsBody ||\r\n            !this.soundBody || !this.masterSlider || !this.masterFill || !this.interfaceSlider ||\r\n            !this.interfaceFill || !this.musicSlider || !this.musicFill || !this.sfxSlider || !this.sfxFill ||\r\n            !this.voiceSlider || !this.voiceFill || !this.masterValue || !this.interfaceValue || !this.musicValue ||\r\n            !this.sfxValue || !this.voiceValue || !this.accuracyStat || !this.damageStat ||\r\n            !this.luckStat || !this.rangeStat || !this.shotSpeedStat || !this.speedStat || !this.deadzoneInput ||\r\n            !this.particleJSToggle || !this.staticVfxToggle || !this.ammoReservesPhysicsToggle ||\r\n            !this.charCustomizeContainer || !this.headwearArrowLeft || !this.headArrowLeft || !this.bodyArrowLeft ||\r\n            !this.headwearArrowRight || !this.headArrowRight || !this.bodyArrowRight\r\n        ) {\r\n            alert('Failed to load game. Please refresh the page.');\r\n            throw new Error('Critical error: Required DOM elements are missing.');\r\n        }\r\n\r\n        this.canvas.width = CANVAS.WIDTH;\r\n        this.canvas.height = CANVAS.HEIGHT;\r\n        this.decalCanvas.width = WORLD.WIDTH;\r\n        this.decalCanvas.height = WORLD.HEIGHT;\r\n        this.worldCanvas.width = WORLD.WIDTH;\r\n        this.worldCanvas.height = WORLD.HEIGHT;\r\n\r\n        this.ammoReservesCanvas.width = 100;\r\n        this.ammoReservesCanvas.height = 64;\r\n        this.charCustomizeCanvas.width = 200;\r\n        this.charCustomizeCanvas.height = 200;\r\n\r\n        this.ctx = this.canvas.getContext('2d');\r\n        this.decalCtx = this.decalCanvas.getContext('2d');\r\n        this.worldCtx = this.worldCanvas.getContext('2d');\r\n        this.ammoReservesCtx = this.ammoReservesCanvas.getContext('2d');\r\n        this.charCustomizeCtx = this.charCustomizeCanvas.getContext('2d')\r\n\r\n        if (!this.ctx || !this.decalCtx || !this.worldCtx || !this.ammoReservesCtx || !this.charCustomizeCtx) {\r\n            alert('Failed to load game. Please refresh the page.');\r\n            throw new Error('Could not get canvas context');\r\n        }\r\n    }\r\n    //\r\n    // #endregion\r\n\r\n    // #region [ Display ]\r\n    //\r\n    /**\r\n     * Updates the display based on the current state.\r\n     */\r\n    public updateDisplay(lobby: LobbyManager, target: \"lobby\" | \"room\" | \"game\", roomId?: string): void {\r\n        if (!this.roomControls || !this.lobbyContainer || !this.gameContainer ||\r\n            !this.chatContainer || !this.leaderboardContainer || !this.charCustomizeContainer) return;\r\n\r\n        this.clearDisplay();\r\n\r\n        switch (target) {\r\n            case \"lobby\":\r\n                this.lobbyContainer.style.display = \"flex\";\r\n                this.chatContainer.style.display = \"flex\";\r\n                this.charCustomizeContainer.style.display = \"flex\";\r\n                if (roomId && this.roomIdDisplay) {\r\n                    this.roomIdDisplay.textContent = roomId;\r\n                }\r\n                lobby.inLobby = true;\r\n                break;\r\n\r\n            case \"room\":\r\n                this.roomControls.style.display = \"flex\";\r\n                break;\r\n\r\n            case \"game\":\r\n                this.gameContainer.style.display = \"flex\";\r\n                this.chatContainer.style.display = \"flex\";\r\n                this.leaderboardContainer.style.display = \"flex\";\r\n                if (roomId) {\r\n                    const gameRoomId = this.gameRoomIdDisplay;\r\n                    if (gameRoomId) gameRoomId.textContent = roomId;\r\n                }\r\n                lobby.inLobby = false;\r\n                break;\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Shows host controls when called.\r\n     */\r\n    public updateHostDisplay(isHost: boolean, lobby: LobbyManager): void {\r\n        if (!this.startGameBtn || !this.gameOptionsContainer) return;\r\n\r\n        this.startGameBtn.style.display = isHost ? 'block' : 'none';\r\n        this.startGameBtn.disabled = lobby.lobbyPlayers.size < 1;\r\n\r\n        this.gameOptionsContainer.style.display = isHost ? 'flex' : 'none';\r\n    }\r\n\r\n    /**\r\n     * Displays connected players in the lobby interface.\r\n     */\r\n    public displayLobbyPlayers(isHost: boolean, lobby: LobbyManager, userId: string): void {\r\n        if (!this.lobbyPlayersList) return;\r\n\r\n        this.lobbyPlayersList.innerHTML = '';\r\n\r\n        // Sort players: host first, then others\r\n        const sortedPlayers = Array.from(lobby.lobbyPlayers.values()).sort((a, b) => {\r\n            if (a.isHost && !b.isHost) return -1;\r\n            if (!a.isHost && b.isHost) return 1;\r\n            return 0;\r\n        });\r\n\r\n        sortedPlayers.forEach(player => {\r\n            const playerDiv = document.createElement('div');\r\n            playerDiv.className = 'lobby_player';\r\n\r\n            const colorDiv = document.createElement('div');\r\n            colorDiv.className = 'player_color';\r\n            colorDiv.style.backgroundColor = player.color;\r\n\r\n            const nameDiv = document.createElement('div');\r\n            nameDiv.className = 'player_name';\r\n            nameDiv.textContent = `${player.id}${player.isHost ? ' (Host)' : ''}`;\r\n\r\n            const controlsDiv = document.createElement('div');\r\n            controlsDiv.className = 'player_controls';\r\n\r\n            // Only show controls if I'm the host and this isn't me\r\n            if (isHost && player.id !== userId) {\r\n                const promoteBtn = document.createElement('button');\r\n                promoteBtn.textContent = 'Promote';\r\n                promoteBtn.onclick = () => lobby.promotePlayer(player.id);\r\n\r\n                const kickBtn = document.createElement('button');\r\n                kickBtn.textContent = 'Kick';\r\n                kickBtn.className = 'danger';\r\n                kickBtn.onclick = () => lobby.kickPlayer(player.id);\r\n\r\n                controlsDiv.appendChild(promoteBtn);\r\n                controlsDiv.appendChild(kickBtn);\r\n            }\r\n\r\n            playerDiv.appendChild(colorDiv);\r\n            playerDiv.appendChild(nameDiv);\r\n            playerDiv.appendChild(controlsDiv);\r\n\r\n            if (this.lobbyPlayersList) {\r\n                this.lobbyPlayersList.appendChild(playerDiv);\r\n            }\r\n        });\r\n    }\r\n\r\n    /**\r\n     * Refreshes the display to a blank slate.\r\n     */\r\n    private clearDisplay(): void {\r\n        if (!this.roomControls || !this.lobbyContainer || !this.gameContainer\r\n            || !this.chatContainer || !this.leaderboardContainer\r\n            || !this.upgradeContainer || !this.charCustomizeContainer) return;\r\n\r\n        this.roomControls.style.display = \"none\";\r\n        this.lobbyContainer.style.display = \"none\";\r\n        this.gameContainer.style.display = \"none\";\r\n        this.chatContainer.style.display = \"none\";\r\n        this.leaderboardContainer.style.display = \"none\";\r\n        this.upgradeContainer.style.display = \"none\";\r\n        this.charCustomizeContainer.style.display = \"none\";\r\n    }\r\n\r\n    /**\r\n     * Unified modal closure function used to close and refresh the modal.\r\n     */\r\n    public closeModal(): void {\r\n        if (!this.modal || !this.modalInput || !this.modalConfirmButton ||\r\n            !this.modalCancelButton || !this.modalText) return;\r\n\r\n        this.modal.classList.add('hidden');\r\n        this.modalInput.style.display = 'flex';\r\n        this.modalText.textContent = 'Join Room';\r\n        this.modalConfirmButton.onclick = null;\r\n        this.modalCancelButton.onclick = null;\r\n        this.modalInput.onkeydown = null;\r\n    }\r\n    //\r\n    // #endregion\r\n\r\n    // #region [ Room Modal ]\r\n    //\r\n    /**\r\n     * Shows the join room modal for pasting room codes.\r\n     */\r\n    public showJoinRoomModal(onConfirm: (roomId: string) => void): void {\r\n        if (!this.modal || !this.modalInput || !this.modalConfirmButton ||\r\n            !this.modalCancelButton || !this.modalErrorDiv) return;\r\n\r\n        this.modal.classList.remove('hidden');\r\n        this.modalConfirmButton.classList.remove('hidden');\r\n\r\n        this.modalInput.value = '';\r\n        this.modalErrorDiv.textContent = '';\r\n\r\n        this.modalConfirmButton.textContent = 'Join'\r\n\r\n        this.modalInput.focus();\r\n\r\n        this.modalConfirmButton.onclick = () => {\r\n            if (!this.modalInput || !this.modalErrorDiv) return;\r\n\r\n            const value = this.modalInput.value.trim();\r\n            if (!value) {\r\n                this.modalErrorDiv.textContent = 'Invalid code...';\r\n                return;\r\n            }\r\n\r\n            let roomId: string | null = null;\r\n            try {\r\n                const url = new URL(value, window.location.origin);\r\n                if (url.pathname.startsWith(\"/room_\")) {\r\n                    roomId = url.pathname.replace(\"/\", \"\");\r\n                } else {\r\n                    roomId = new URLSearchParams(url.search).get(\"room\");\r\n                }\r\n            } catch {\r\n                if (value.startsWith(\"room_\")) {\r\n                    roomId = value;\r\n                }\r\n            }\r\n\r\n            if (!roomId) {\r\n                this.modalErrorDiv.textContent = 'Invalid code...';\r\n                return;\r\n            }\r\n\r\n            this.closeModal();\r\n            onConfirm(roomId); // pass back the parsed roomId\r\n        };\r\n\r\n        this.modalCancelButton.onclick = () => this.closeModal();\r\n    }\r\n\r\n    /**\r\n     * Displays a wanring modal if the player starts a game alone.\r\n     */\r\n    public soloGameWarning(onConfirm: () => void): void {\r\n        if (!this.modal || !this.modalConfirmButton || !this.modalCancelButton ||\r\n            !this.modalContent || !this.modalText || !this.modalInput ||\r\n            !this.modalErrorDiv || !this.modalButtons) return;\r\n\r\n        this.modal.classList.remove('hidden');\r\n        this.modalConfirmButton.classList.remove('hidden');\r\n\r\n        this.modalInput.style.display = 'none';\r\n        this.modalErrorDiv.textContent = ' ';\r\n        this.modalButtons.style.display = 'flex';\r\n        this.modalCancelButton.style.display = 'flex';\r\n\r\n        this.modalText.textContent = 'Start game as only player? Other players will be unable to join until you return to the lobby.';\r\n        this.modalConfirmButton.textContent = 'Start Game';\r\n        this.modalCancelButton.textContent = 'Cancel';\r\n\r\n        this.modalConfirmButton.onclick = () => {\r\n            this.closeModal();\r\n            onConfirm(); // Proceed with starting the game\r\n        };\r\n\r\n        this.modalCancelButton.onclick = () => this.closeModal();\r\n    }\r\n    //\r\n    // #endregion\r\n\r\n    // #region [ Settings Modal ]\r\n    /**\r\n     * Shows the settings modal.\r\n     */\r\n    public showSettingsPage(): void {\r\n        if (!this.settingsContainer) return;\r\n        this.settingsContainer.classList.remove('hidden');\r\n    }\r\n\r\n    /**\r\n     * Hides the settings modal.\r\n     */\r\n    public hideSettingsPage(): void {\r\n        if (!this.settingsContainer) return;\r\n        this.settingsContainer.classList.add('hidden');\r\n    }\r\n\r\n    /**\r\n     * Switches active settings page.\r\n     */\r\n    public switchSettingsPage(page: 'controls' | 'graphics' | 'sound'): void {\r\n        if (!this.controlsBody || !this.graphicsBody || !this.soundBody ||\r\n            !this.controlsTab || !this.graphicsTab || !this.soundTab) return;\r\n\r\n        // Remove active class from all tabs\r\n        this.controlsTab.classList.remove('settings_tab_active');\r\n        this.graphicsTab.classList.remove('settings_tab_active');\r\n        this.soundTab.classList.remove('settings_tab_active');\r\n\r\n        // Remove hidden class from all pages\r\n        this.controlsBody.classList.remove('settings_page_hidden');\r\n        this.graphicsBody.classList.remove('settings_page_hidden');\r\n        this.soundBody.classList.remove('settings_page_hidden');\r\n\r\n        // Hide all pages and activate the selected tab\r\n        switch (page) {\r\n            case 'controls':\r\n                this.controlsTab.classList.add('settings_tab_active');\r\n                this.graphicsBody.classList.add('settings_page_hidden');\r\n                this.soundBody.classList.add('settings_page_hidden');\r\n                break;\r\n            case 'graphics':\r\n                this.graphicsTab.classList.add('settings_tab_active');\r\n                this.controlsBody.classList.add('settings_page_hidden');\r\n                this.soundBody.classList.add('settings_page_hidden');\r\n                break;\r\n            case 'sound':\r\n                this.soundTab.classList.add('settings_tab_active');\r\n                this.controlsBody.classList.add('settings_page_hidden');\r\n                this.graphicsBody.classList.add('settings_page_hidden');\r\n                break;\r\n        }\r\n    }\r\n    //\r\n    // #endregion\r\n\r\n    // #region [ Settings Sliders ]\r\n    //\r\n    /**\r\n     * Updates settings specific sliders that also have value elements associated.\r\n     */\r\n    public updateSettingsSlider(fillElement: HTMLDivElement, valueElement: HTMLDivElement, value: number): void {\r\n        const percentage = Math.max(0, Math.min(100, value * 100));\r\n        fillElement.style.width = `${percentage}%`;\r\n        valueElement.textContent = `${Math.round(percentage)}%`;\r\n    }\r\n\r\n    /**\r\n     * Calculates the value of the slider based on the hovered mouse position.\r\n     */\r\n    public calculateSliderValue(sliderElement: HTMLDivElement, mouseX: number): number {\r\n        const rect = sliderElement.getBoundingClientRect();\r\n        const position = mouseX - rect.left;\r\n        const width = rect.width;\r\n        return Math.max(0, Math.min(1, position / width));\r\n    }\r\n\r\n    /**\r\n     * Initializes the sound sliders in the sound settings page with user prefs or defaults.\r\n     */\r\n    public initSoundSliders(settings: GameSettings): void {\r\n        const audioSettings = settings.audio.mixer;\r\n        if (this.masterFill && this.masterValue) this.updateSettingsSlider(this.masterFill, this.masterValue, audioSettings.master);\r\n        if (this.interfaceFill && this.interfaceValue) this.updateSettingsSlider(this.interfaceFill, this.interfaceValue, audioSettings.interface);\r\n        if (this.musicFill && this.musicValue) this.updateSettingsSlider(this.musicFill, this.musicValue, audioSettings.music);\r\n        if (this.sfxFill && this.sfxValue) this.updateSettingsSlider(this.sfxFill, this.sfxValue, audioSettings.sfx);\r\n        if (this.voiceFill && this.voiceValue) this.updateSettingsSlider(this.voiceFill, this.voiceValue, audioSettings.voice);\r\n    }\r\n    //\r\n    // #endregion\r\n\r\n    // #region [ Settings Inputs ]\r\n    //\r\n    /**\r\n     * Initializes all inputs in settings pages with user prefs or defaults.\r\n     */\r\n    public initSettingsInputs(settings: GameSettings): void {\r\n        if (this.deadzoneInput) {\r\n            this.deadzoneInput.value = settings.controls.gamepad.deadzone.toString();\r\n        }\r\n    }\r\n    //\r\n    // #endregion\r\n\r\n    // #region [ Settings Toggles ]\r\n    //\r\n    /**\r\n     * Initializes all toggles in settings pages with user prefs or defaults.\r\n     */\r\n    public initSettingsToggles(settings: GameSettings): void {\r\n        if (this.particleJSToggle) {\r\n            this.utility.setToggle({\r\n                toggleId: 'particleJSToggle',\r\n                value: settings.graphics.renderBackgroundParticles\r\n            });\r\n        }\r\n\r\n        if (this.staticVfxToggle) {\r\n            this.utility.setToggle({\r\n                toggleId: 'staticToggle',\r\n                value: settings.graphics.showStaticOverlay\r\n            });\r\n        }\r\n\r\n        if (this.ammoReservesPhysicsToggle) {\r\n            this.utility.setToggle({\r\n                toggleId: 'ammoReservesPhysicsToggle',\r\n                value: settings.graphics.physics.ammoReserves\r\n            });\r\n        }\r\n    }\r\n    //\r\n    // #endregion\r\n\r\n    // #region [ Settings Interfaces ]\r\n    //\r\n    /**\r\n     * Initializes the keybinds settings page interface.\r\n     */\r\n    public initKeybindsInterface(controlsSettings: { keybinds: Record<string, string>, gamepad: Record<string, number> }, onBindingChange: (action: string, type: 'keybind' | 'gamepad', newBinding: string | number) => void): void {\r\n        // [ Keys ]\r\n        Object.keys(controlsSettings.keybinds).forEach(action => {\r\n            const elementId = `${action}Keybind`;\r\n            const element = document.getElementById(elementId);\r\n            if (element) {\r\n                const key = controlsSettings.keybinds[action];\r\n                element.textContent = key === ' ' ? 'SPACE' : key.toUpperCase();\r\n\r\n                element.addEventListener('click', () => {\r\n                    this.showRebindModal(action, 'keybind', (newBinding) => {\r\n                        onBindingChange(action, 'keybind', newBinding as string);\r\n                    });\r\n                });\r\n            }\r\n        });\r\n\r\n        // [ Gamepad ]\r\n        Object.keys(controlsSettings.gamepad).forEach(action => {\r\n            const elementId = `${action}Gamepad`;\r\n            const element = document.getElementById(elementId);\r\n\r\n            if (element && controlsSettings.gamepad[action] !== undefined) {\r\n                const buttonValue = controlsSettings.gamepad[action];\r\n                const buttonName = Object.keys(GAMEPAD_MAP).find(\r\n                    key => typeof GAMEPAD_MAP[key as keyof typeof GAMEPAD_MAP] === 'number'\r\n                        && GAMEPAD_MAP[key as keyof typeof GAMEPAD_MAP] === buttonValue\r\n                );\r\n                element.textContent = buttonName || buttonValue.toString();\r\n\r\n                element.addEventListener('click', () => {\r\n                    this.showRebindModal(action, 'gamepad', (newBinding) => {\r\n                        onBindingChange(action, 'gamepad', newBinding as number);\r\n                    });\r\n                });\r\n            }\r\n        });\r\n    }\r\n\r\n    /**\r\n     * Shows the controls rebinding modal when called.\r\n     * \r\n     * Can be used for rebinding keyboard or gamepad.\r\n     */\r\n    public showRebindModal(action: string, type: 'keybind' | 'gamepad', onRebind: (newBinding: string | number) => void): void {\r\n        if (!this.modal || !this.modalText || !this.modalInput || !this.modalConfirmButton || !this.modalCancelButton || !this.modalErrorDiv) return;\r\n\r\n        const duplicateWarnings = [\r\n            \"Binding already assigned!\",\r\n            \"Binding already in use!\",\r\n            \"That binding is assigned already!\",\r\n            \"Binding already being used!\",\r\n            \"Already bound to another action!\"\r\n        ];\r\n        let warningIndex = 0;\r\n\r\n        // Check for gamepad if type is gamepad\r\n        if (type === 'gamepad') {\r\n            const gamepads = navigator.getGamepads();\r\n            const hasGamepad = Array.from(gamepads).some(gp => gp !== null);\r\n\r\n            if (!hasGamepad) {\r\n                this.modal.classList.remove('hidden');\r\n                this.modalErrorDiv.textContent = '';\r\n                this.modalText.textContent = 'No gamepad detected';\r\n                this.modalInput.style.display = 'none';\r\n                this.modalConfirmButton.classList.add('hidden');\r\n                this.modalCancelButton.textContent = 'Close';\r\n\r\n                this.modalCancelButton.onclick = () => this.closeModal();\r\n\r\n                this.utility.safeTimeout(() => {\r\n                    this.closeModal();\r\n                }, 3000);\r\n\r\n                return;\r\n            }\r\n        }\r\n\r\n        this.modal.classList.remove('hidden');\r\n        this.modalErrorDiv.textContent = '';\r\n        this.modalInput.style.display = 'none';\r\n        this.modalText.textContent = `Press any ${type === 'keybind' ? 'key' : 'button'} for ${action.toUpperCase()}`;\r\n        this.modalConfirmButton.classList.add('hidden');\r\n        this.modalCancelButton.textContent = 'Cancel';\r\n\r\n        const checkDuplicate = (binding: string | number): boolean => {\r\n            if (type === 'keybind') {\r\n                const allKeybinds = Object.entries(this.settingsManager?.getSettings().controls.keybinds || {});\r\n                return allKeybinds.some(([key, value]) => key !== action && value === binding);\r\n            } else {\r\n                const allGamepad = Object.entries(this.settingsManager?.getSettings().controls.gamepad || {});\r\n                return allGamepad.some(([key, value]) => key !== action && value === binding);\r\n            }\r\n        };\r\n\r\n        const handleKeyPress = (e: KeyboardEvent) => {\r\n            e.preventDefault();\r\n            if (e.key === 'Escape') {\r\n                cleanup();\r\n                this.closeModal();\r\n                return;\r\n            }\r\n\r\n            const newKey = e.key.toLowerCase();\r\n\r\n            if (checkDuplicate(newKey)) {\r\n                if (!this.modalErrorDiv) return;\r\n                this.modalErrorDiv.textContent = duplicateWarnings[warningIndex % duplicateWarnings.length];\r\n                warningIndex++;\r\n                return;\r\n            }\r\n\r\n            cleanup();\r\n            onRebind(newKey);\r\n            this.closeModal();\r\n        };\r\n\r\n        const handleMouseDown = (e: MouseEvent) => {\r\n            // Check if click is on cancel button\r\n            if (e.target === this.modalCancelButton || this.modalCancelButton?.contains(e.target as Node)) {\r\n                return;\r\n            }\r\n\r\n            e.preventDefault();\r\n            e.stopPropagation();\r\n\r\n            let mouseKey = '';\r\n            if (e.button === 0) mouseKey = 'mouse1';\r\n            else if (e.button === 1) mouseKey = 'mouse3';\r\n            else if (e.button === 2) mouseKey = 'mouse2';\r\n\r\n            if (mouseKey) {\r\n                if (checkDuplicate(mouseKey)) {\r\n                    if (!this.modalErrorDiv) return;\r\n                    this.modalErrorDiv.textContent = duplicateWarnings[warningIndex % duplicateWarnings.length];\r\n                    warningIndex++;\r\n                    return;\r\n                }\r\n\r\n                cleanup();\r\n                onRebind(mouseKey);\r\n                this.closeModal();\r\n            }\r\n        };\r\n\r\n        const handleGamepadPress = () => {\r\n            const gamepads = navigator.getGamepads();\r\n            for (const gamepad of gamepads) {\r\n                if (!gamepad) continue;\r\n\r\n                for (let i = 0; i < gamepad.buttons.length; i++) {\r\n                    if (gamepad.buttons[i].pressed) {\r\n                        if (checkDuplicate(i)) {\r\n                            if (!this.modalErrorDiv) return;\r\n                            this.modalErrorDiv.textContent = duplicateWarnings[warningIndex % duplicateWarnings.length];\r\n                            warningIndex++;\r\n                            requestAnimationFrame(handleGamepadPress);\r\n                            return;\r\n                        }\r\n\r\n                        cleanup();\r\n                        onRebind(i);\r\n                        this.closeModal();\r\n                        return;\r\n                    }\r\n                }\r\n            }\r\n            requestAnimationFrame(handleGamepadPress);\r\n        };\r\n\r\n        const cleanup = () => {\r\n            if (type === 'keybind') {\r\n                document.removeEventListener('keydown', handleKeyPress);\r\n                document.removeEventListener('mousedown', handleMouseDown);\r\n            }\r\n            this.modalCancelButton!.onclick = null;\r\n        };\r\n\r\n        if (type === 'keybind') {\r\n            document.addEventListener('keydown', handleKeyPress);\r\n            document.addEventListener('mousedown', handleMouseDown);\r\n        } else {\r\n            requestAnimationFrame(handleGamepadPress);\r\n        }\r\n\r\n        this.modalCancelButton.onclick = () => {\r\n            cleanup();\r\n            this.closeModal();\r\n        };\r\n    }\r\n    //\r\n    // #endregion\r\n\r\n    // #region [ Leaderboard ]\r\n    //\r\n    /**\r\n     * Locally initialize the leaderboard, or update it if it already exists.\r\n     */\r\n    public createLeaderboard(lobby: LobbyManager, players: Players, userId: string): void {\r\n        // Create a set of all players\r\n        const allPlayers = new Set<string>();\r\n        allPlayers.add(userId);\r\n        players.forEach((_, playerId) => {\r\n            allPlayers.add(playerId);\r\n        });\r\n        lobby.lobbyPlayers.forEach((_, playerId) => {\r\n            allPlayers.add(playerId);\r\n        });\r\n\r\n        // Create/update leaderboard entries for all players\r\n        allPlayers.forEach(playerId => {\r\n            if (!this.leaderboard.has(playerId)) {\r\n                this.leaderboard.set(playerId, { // Create new entry with 0 stats\r\n                    playerId: playerId,\r\n                    wins: 0,\r\n                    kills: 0,\r\n                    deaths: 0\r\n                });\r\n                console.log(`Created leaderboard entry for ${playerId}`);\r\n            }\r\n            // If entry already exists, leave it alone (preserves existing stats)\r\n        });\r\n\r\n        this.updateLeaderboardDisplay(userId);\r\n        console.log('Leaderboard created/updated:', Array.from(this.leaderboard.entries()));\r\n    }\r\n\r\n    /**\r\n     * Update the table for the leaderboard to display the current game status.\r\n     */\r\n    public updateLeaderboardDisplay(localPlayer: string): void {\r\n        if (!this.leaderboardBody) return;\r\n\r\n        // Clear existing rows\r\n        this.leaderboardBody.innerHTML = '';\r\n\r\n        // Sort by wins (highest first), then by kills\r\n        const sortedEntries = Array.from(this.leaderboard.entries()).sort((a, b) => {\r\n            const [, entryA] = a;\r\n            const [, entryB] = b;\r\n\r\n            // First sort by wins (descending)\r\n            if (entryB.wins !== entryA.wins) {\r\n                return entryB.wins - entryA.wins;\r\n            }\r\n            // Then by kills (descending)\r\n            return entryB.kills - entryA.kills;\r\n        });\r\n\r\n        // Create table rows\r\n        sortedEntries.forEach(([playerId, entry]) => {\r\n            const row = document.createElement('tr');\r\n            row.className = 'leaderboard_row';\r\n\r\n            // Highlight current player\r\n            if (playerId === localPlayer) {\r\n                row.classList.add('current-player');\r\n            }\r\n\r\n            // Player name\r\n            const nameCell = document.createElement('td');\r\n            nameCell.textContent = playerId === localPlayer ? 'You' : playerId.substring(0, 8);\r\n            nameCell.className = 'player_name';\r\n            row.appendChild(nameCell);\r\n\r\n            // Wins\r\n            const winsCell = document.createElement('td');\r\n            winsCell.textContent = entry.wins.toString();\r\n            winsCell.className = 'wins';\r\n            row.appendChild(winsCell);\r\n\r\n            // Kills\r\n            const killsCell = document.createElement('td');\r\n            killsCell.textContent = entry.kills.toString();\r\n            killsCell.className = 'kills';\r\n            row.appendChild(killsCell);\r\n\r\n            // Deaths\r\n            const deathsCell = document.createElement('td');\r\n            deathsCell.textContent = entry.deaths.toString();\r\n            deathsCell.className = 'deaths';\r\n            row.appendChild(deathsCell);\r\n\r\n            if (this.leaderboardBody) {\r\n                this.leaderboardBody.appendChild(row);\r\n            }\r\n        });\r\n    }\r\n\r\n    /**\r\n     * Reset the leaderboard to default state.\r\n     */\r\n    public clearLeaderboard(): void {\r\n        this.leaderboard.clear();\r\n        if (this.leaderboardBody) {\r\n            this.leaderboardBody.innerHTML = '';\r\n        }\r\n    }\r\n    //\r\n    // #endregion\r\n\r\n    // #region [ Events ]\r\n    //\r\n    /**\r\n     * Initializes listeners to interface elements, and sets up their animations.\r\n     */\r\n    private initInterfaceListeners(): void {\r\n        const uiDecimals = 2;\r\n        const animTime = 500;\r\n        const steps = 20;\r\n        const increaseColor = '#00ff00';\r\n        const decreaseColor = '#ff0000';\r\n        const timeout = 200;\r\n\r\n        // Accuracy (spread - inverted: lower is better)\r\n        this.playerState.onStatChange('actions.primary.projectile.spread', (value) => {\r\n            if (!this.accuracyStat) return;\r\n            const oldValue = parseFloat(this.accuracyStat.textContent || '0');\r\n            const isIncrease = value < oldValue;\r\n\r\n            this.utility.animateTextInElement({\r\n                element: this.accuracyStat,\r\n                oldValue: oldValue,\r\n                newValue: value,\r\n                decimals: uiDecimals,\r\n                animTime: animTime,\r\n                steps: steps,\r\n                color: isIncrease ? increaseColor : decreaseColor,\r\n                timeout: timeout\r\n            });\r\n        });\r\n\r\n        // Damage\r\n        this.playerState.onStatChange('actions.primary.projectile.damage', (value) => {\r\n            if (!this.damageStat) return;\r\n            const oldValue = parseFloat(this.damageStat.textContent || '0');\r\n            const isIncrease = value > oldValue;\r\n\r\n            this.utility.animateTextInElement({\r\n                element: this.damageStat,\r\n                oldValue: oldValue,\r\n                newValue: Math.round(value),\r\n                decimals: uiDecimals,\r\n                animTime: animTime,\r\n                steps: steps,\r\n                color: isIncrease ? increaseColor : decreaseColor,\r\n                timeout: timeout\r\n            });\r\n        });\r\n\r\n        // Speed\r\n        this.playerState.onStatChange('stats.speed', (value) => {\r\n            if (!this.speedStat) return;\r\n            const oldValue = parseFloat(this.speedStat.textContent || '0');\r\n            const isIncrease = value > oldValue;\r\n\r\n            this.utility.animateTextInElement({\r\n                element: this.speedStat,\r\n                oldValue: oldValue,\r\n                newValue: value,\r\n                decimals: uiDecimals,\r\n                animTime: animTime,\r\n                steps: steps,\r\n                color: isIncrease ? increaseColor : decreaseColor,\r\n                timeout: timeout\r\n            });\r\n        });\r\n\r\n        // Range\r\n        this.playerState.onStatChange('actions.primary.projectile.range', (value) => {\r\n            if (!this.rangeStat) return;\r\n            const oldValue = parseFloat(this.rangeStat.textContent || '0');\r\n            const isIncrease = value > oldValue;\r\n\r\n            this.utility.animateTextInElement({\r\n                element: this.rangeStat,\r\n                oldValue: oldValue,\r\n                newValue: value,\r\n                decimals: uiDecimals,\r\n                animTime: animTime,\r\n                steps: steps,\r\n                color: isIncrease ? increaseColor : decreaseColor,\r\n                timeout: timeout\r\n            });\r\n        });\r\n\r\n        // Shot Speed\r\n        this.playerState.onStatChange('actions.primary.projectile.speed', (value) => {\r\n            if (!this.shotSpeedStat) return;\r\n            const oldValue = parseFloat(this.shotSpeedStat.textContent || '0');\r\n            const isIncrease = value > oldValue;\r\n\r\n            this.utility.animateTextInElement({\r\n                element: this.shotSpeedStat,\r\n                oldValue: oldValue,\r\n                newValue: value,\r\n                decimals: uiDecimals,\r\n                animTime: animTime,\r\n                steps: steps,\r\n                color: isIncrease ? increaseColor : decreaseColor,\r\n                timeout: timeout\r\n            });\r\n        });\r\n\r\n        // Luck\r\n        this.playerState.onStatChange('stats.luck', (value) => {\r\n            if (!this.luckStat) return;\r\n            const oldValue = parseFloat(this.luckStat.textContent || '0');\r\n            const isIncrease = value > oldValue;\r\n\r\n            this.utility.animateTextInElement({\r\n                element: this.luckStat,\r\n                oldValue: oldValue,\r\n                newValue: value,\r\n                decimals: uiDecimals,\r\n                animTime: animTime,\r\n                steps: steps,\r\n                color: isIncrease ? increaseColor : decreaseColor,\r\n                timeout: timeout\r\n            });\r\n        });\r\n    }\r\n    //\r\n    // #endregion\r\n}","import { Direction, NoiseType, RandomColorParams, SetInputParams, SetSliderParams, SetSpanParams, SetToggleParams, TextAnimParams, Vec2 } from './Types';\r\n\r\nexport class Utility {\r\n    private lastFrameTime: number;\r\n    private simplexTable: Uint8Array;\r\n    private activeTimeouts: Set<number>;\r\n\r\n    constructor() {\r\n        this.lastFrameTime = performance.now();\r\n        this.simplexTable = this.generateSimplexTable();\r\n        this.activeTimeouts = new Set();\r\n    }\r\n\r\n    // #region [ General ]\r\n    //\r\n\r\n    public deepMerge(target: any, source: any): void {\r\n        for (const key in source) {\r\n            if (\r\n                source[key] !== null &&\r\n                typeof source[key] === 'object' &&\r\n                !Array.isArray(source[key])\r\n            ) {\r\n                if (!target[key]) target[key] = {};\r\n                this.deepMerge(target[key], source[key]);\r\n            } else {\r\n                target[key] = source[key];\r\n            }\r\n        }\r\n    }\r\n\r\n    /** Yields to next animation frame (~16ms) allowing UI updates and optional progress message. */\r\n    public async yield(message?: string): Promise<void> {\r\n        console.log(`[Yield] ${message ?? \"(no message)\"}`);\r\n        \r\n        if (message) {\r\n            document.dispatchEvent(new CustomEvent(\"yieldMessage\", { detail: { message } }));\r\n        } else {\r\n            document.dispatchEvent(new CustomEvent(\"yieldProgress\"));\r\n        }\r\n\r\n        await new Promise<void>(resolve => requestAnimationFrame(() => resolve()));\r\n    }\r\n\r\n    //\r\n    // #endregion\r\n\r\n    // #region [ Time ]\r\n    //\r\n    /**\r\n     * Calculates and returns delta time.\r\n     * \r\n     * https://en.wikipedia.org/wiki/Delta_timing\r\n     */\r\n    public deltaTime(): number {\r\n        const now = performance.now();\r\n        const delta = now - this.lastFrameTime;\r\n        this.lastFrameTime = now;\r\n\r\n        // Normalize to 60fps (16.67ms per frame)\r\n        // Cap at 100ms to prevent huge jumps during lag spikes\r\n        return Math.min(delta, 100) / 16.67;\r\n    }\r\n\r\n    /**\r\n     * Overrides 'setTimeout' with safe processing.\r\n     * \r\n     * Timeouts are stored in the 'activeTimeouts' set - allowing stale timeouts to be cleared.\r\n     */\r\n    public safeTimeout(callback: () => void, delay: number): number {\r\n        const id = window.setTimeout(() => {\r\n            this.activeTimeouts.delete(id);\r\n            callback();\r\n        }, delay);\r\n        this.activeTimeouts.add(id);\r\n        return id;\r\n    }\r\n\r\n    /**\r\n     * Clears all active timeouts from the activeTimeouts cache.\r\n     */\r\n    public clearTimeoutCache(): void {\r\n        this.activeTimeouts.forEach(id => window.clearTimeout(id));\r\n        this.activeTimeouts.clear();\r\n    }\r\n    //\r\n    // #endregion\r\n    //\r\n    // #region [ Math ]\r\n    /**\r\n     * Returns a random number.\r\n     * \r\n     * Optionally pass the decimals if you want the returned value trimmed.\r\n     */\r\n    public getRandomNum(min: number, max: number, decimals?: number): number {\r\n        const value = Math.random() * (max - min) + min;\r\n\r\n        if (decimals !== undefined) {\r\n            return parseFloat(value.toFixed(decimals));\r\n        }\r\n\r\n        return value;\r\n    }\r\n\r\n    /**\r\n     * Returns a random int between the passed min/max values.\r\n     */\r\n    public getRandomInt(min: number, max: number): number {\r\n        return Math.floor(Math.random() * (max - min + 1)) + min;\r\n    }\r\n\r\n    /**\r\n     * Returns a random position in an array.\r\n     */\r\n    public getRandomInArray<T>(array: T[]): T {\r\n        return array[Math.floor(Math.random() * array.length)];\r\n    }\r\n\r\n    /**\r\n     * Returns a shuffled copy of an array.\r\n     */\r\n    public getShuffledArray<T>(array: T[]): T[] {\r\n        return array.slice().sort(() => Math.random() - 0.5);\r\n    }\r\n\r\n    /**\r\n     * Returns the dot product of two 2D vectors.\r\n     */\r\n    public getDotProduct(v1: Vec2, v2: Vec2): number {\r\n        return v1.x * v2.x + v1.y * v2.y;\r\n    }\r\n\r\n    /**\r\n     * Reflects a velocity vector off a surface normal.\r\n     * Formula: V' = V - 2(VN)N\r\n     */\r\n    public getReflection(velocity: Vec2, normal: Vec2): Vec2 {\r\n        const dot = this.getDotProduct(velocity, normal);\r\n        return {\r\n            x: velocity.x - 2 * dot * normal.x,\r\n            y: velocity.y - 2 * dot * normal.y\r\n        };\r\n    }\r\n    //\r\n    // #endregion\r\n    //\r\n    // #region [ Direction ]\r\n    //\r\n    /**\r\n     * Returns the forward facing direction of the passed rotation.\r\n     */\r\n    public forward(rot: number): Vec2 {\r\n        return { x: Math.cos(rot), y: Math.sin(rot) };\r\n    }\r\n\r\n    /**\r\n     * Gets the current aim direction of the local player.\r\n     */\r\n    public getDirection(params: Direction): Vec2 {\r\n        const dx = params.targetPos.x - params.rootPos.x;\r\n        const dy = params.targetPos.y - params.rootPos.y;\r\n\r\n        const distance = Math.sqrt(dx * dx + dy * dy);\r\n        if (distance === 0) return { x: 0, y: 0 }; // avoid NaN\r\n\r\n        return { x: dx / distance, y: dy / distance };\r\n    }\r\n\r\n    /**\r\n     * Returns a random based on the degree radius.\r\n     */\r\n    public getRandomDirection(degrees: number): Vec2 {\r\n        const randomAngle = Math.random() * (degrees * Math.PI / 180);\r\n        const direction = { x: Math.cos(randomAngle), y: Math.sin(randomAngle) }\r\n        return direction;\r\n    }\r\n    //\r\n    // #endregion\r\n    //\r\n    // #region [ Visual ]\r\n    /**\r\n     * Returns a random color. With no params passed, color will be completely random hex.\r\n     * \r\n     * Params can be used to return color templates in either hex or RGB.\r\n     */\r\n    public getRandomColor(params?: RandomColorParams): string {\r\n        const format = params?.format ?? 'hex';\r\n        const mode = params?.mode ?? 'any';\r\n\r\n        let hexColor: string;\r\n\r\n        switch (mode) {\r\n            case 'primary':\r\n                const primaries = ['#FF0000', '#00FF00', '#0000FF', '#FFFF00', '#00FFFF', '#FF00FF'];\r\n                hexColor = this.getRandomInArray(primaries);\r\n                break;\r\n\r\n            case 'pastel':\r\n                const r = this.getRandomInt(127, 254);\r\n                const g = this.getRandomInt(127, 254);\r\n                const b = this.getRandomInt(127, 254);\r\n                hexColor = `#${r.toString(16).padStart(2, '0')}${g.toString(16).padStart(2, '0')}${b.toString(16).padStart(2, '0')}`;\r\n                break;\r\n\r\n            case 'vibrant':\r\n                const channels = [255, this.getRandomInt(0, 255), this.getRandomInt(0, 255)];\r\n                channels.sort(() => Math.random() - 0.5);\r\n                hexColor = `#${channels[0].toString(16).padStart(2, '0')}${channels[1].toString(16).padStart(2, '0')}${channels[2].toString(16).padStart(2, '0')}`;\r\n                break;\r\n\r\n            case 'dark':\r\n                const dr = this.getRandomInt(0, 127);\r\n                const dg = this.getRandomInt(0, 127);\r\n                const db = this.getRandomInt(0, 127);\r\n                hexColor = `#${dr.toString(16).padStart(2, '0')}${dg.toString(16).padStart(2, '0')}${db.toString(16).padStart(2, '0')}`;\r\n                break;\r\n\r\n            case 'light':\r\n                const lr = this.getRandomInt(128, 255);\r\n                const lg = this.getRandomInt(128, 255);\r\n                const lb = this.getRandomInt(128, 255);\r\n                hexColor = `#${lr.toString(16).padStart(2, '0')}${lg.toString(16).padStart(2, '0')}${lb.toString(16).padStart(2, '0')}`;\r\n                break;\r\n\r\n            case 'grayscale':\r\n                const gray = this.getRandomInt(0, 255);\r\n                hexColor = `#${gray.toString(16).padStart(2, '0')}${gray.toString(16).padStart(2, '0')}${gray.toString(16).padStart(2, '0')}`;\r\n                break;\r\n\r\n            case 'any':\r\n            default:\r\n                hexColor = \"#\" + this.getRandomInt(0, 0xFFFFFF).toString(16).padStart(6, \"0\");\r\n                break;\r\n        }\r\n\r\n        // Convert to requested format\r\n        if (format === 'rgb') {\r\n            const rgb = this.hexToRgb(hexColor);\r\n            if (!rgb) return hexColor; // Fallback to hex if conversion fails\r\n            return `rgb(${rgb.r}, ${rgb.g}, ${rgb.b})`;\r\n        }\r\n\r\n        return hexColor;\r\n    }\r\n\r\n    /**\r\n     * Returns the lightest color from a hex color array.\r\n     */\r\n    public getLightestColor(colors: string[]): string {\r\n        let lightestColor = colors[0];\r\n        let maxBrightness = 0;\r\n\r\n        for (const color of colors) {\r\n            const r = parseInt(color.slice(1, 3), 16);\r\n            const g = parseInt(color.slice(3, 5), 16);\r\n            const b = parseInt(color.slice(5, 7), 16);\r\n\r\n            // Calculate perceived brightness\r\n            const brightness = (r * 0.299 + g * 0.587 + b * 0.114);\r\n\r\n            if (brightness > maxBrightness) {\r\n                maxBrightness = brightness;\r\n                lightestColor = color;\r\n            }\r\n        }\r\n\r\n        return lightestColor;\r\n    }\r\n\r\n    /**\r\n     * Converts hex color code to RGB.\r\n     */\r\n    public hexToRgb(hex: string): { r: number, g: number, b: number } | null {\r\n        const result = /^#?([a-f\\d]{2})([a-f\\d]{2})([a-f\\d]{2})$/i.exec(hex);\r\n        return result ? {\r\n            r: parseInt(result[1], 16),\r\n            g: parseInt(result[2], 16),\r\n            b: parseInt(result[3], 16)\r\n        } : null;\r\n    }\r\n    //\r\n    // #endregion\r\n    //\r\n    // #region [ Noise ]\r\n    //\r\n    // - Simplex\r\n    /**\r\n     * Generates the permutation table for simplex noise.\r\n     */\r\n    private generateSimplexTable(): Uint8Array {\r\n        const table = new Uint8Array(512);\r\n        for (let k = 0; k < 256; k++) table[k] = k;\r\n        for (let k = 0; k < 256; k++) {\r\n            const r = k + this.getRandomInt(0, 255 - k);\r\n            [table[k], table[r]] = [table[r], table[k]];\r\n        }\r\n        for (let k = 0; k < 256; k++) table[256 + k] = table[k];\r\n        return table;\r\n    }\r\n\r\n    /**\r\n     * 2D noise function using Simplex.\r\n     * \r\n     * https://en.wikipedia.org/wiki/Simplex_noise\r\n     */\r\n    public simplexNoise2D(x: number, y: number, override: boolean = false): number {\r\n        if (override) { this.simplexTable = this.generateSimplexTable(); }\r\n\r\n        const perm = this.simplexTable;\r\n\r\n        const F2 = 0.5 * (Math.sqrt(3.0) - 1.0);\r\n        const G2 = (3.0 - Math.sqrt(3.0)) / 6.0;\r\n\r\n        const s = (x + y) * F2;\r\n        const i = Math.floor(x + s);\r\n        const j = Math.floor(y + s);\r\n\r\n        const t = (i + j) * G2;\r\n        const X0 = i - t;\r\n        const Y0 = j - t;\r\n        const x0 = x - X0;\r\n        const y0 = y - Y0;\r\n\r\n        const i1 = x0 > y0 ? 1 : 0;\r\n        const j1 = x0 > y0 ? 0 : 1;\r\n\r\n        const x1 = x0 - i1 + G2;\r\n        const y1 = y0 - j1 + G2;\r\n        const x2 = x0 - 1.0 + 2.0 * G2;\r\n        const y2 = y0 - 1.0 + 2.0 * G2;\r\n\r\n        const ii = i & 255;\r\n        const jj = j & 255;\r\n\r\n        const gi0 = perm[ii + perm[jj]] % 12;\r\n        const gi1 = perm[ii + i1 + perm[jj + j1]] % 12;\r\n        const gi2 = perm[ii + 1 + perm[jj + 1]] % 12;\r\n\r\n        const grad3 = [[1, 1, 0], [-1, 1, 0], [1, -1, 0], [-1, -1, 0],\r\n        [1, 0, 1], [-1, 0, 1], [1, 0, -1], [-1, 0, -1],\r\n        [0, 1, 1], [0, -1, 1], [0, 1, -1], [0, -1, -1]];\r\n\r\n        const dot = (g: number[], x: number, y: number) => g[0] * x + g[1] * y;\r\n\r\n        let t0 = 0.5 - x0 * x0 - y0 * y0;\r\n        let n0 = t0 < 0 ? 0 : Math.pow(t0, 4) * dot(grad3[gi0], x0, y0);\r\n\r\n        let t1 = 0.5 - x1 * x1 - y1 * y1;\r\n        let n1 = t1 < 0 ? 0 : Math.pow(t1, 4) * dot(grad3[gi1], x1, y1);\r\n\r\n        let t2 = 0.5 - x2 * x2 - y2 * y2;\r\n        let n2 = t2 < 0 ? 0 : Math.pow(t2, 4) * dot(grad3[gi2], x2, y2);\r\n\r\n        return 70.0 * (n0 + n1 + n2);\r\n    }\r\n\r\n    // - Seeded\r\n    //\r\n    /**\r\n     * Helper function to switch between noise types\r\n     */\r\n    public getNoise(noiseType: NoiseType, x: number, y: number, seed: number, options?: any): number {\r\n        switch (noiseType) {\r\n            case NoiseType.Perlin:\r\n                return this.perlinNoise(\r\n                    x,\r\n                    y,\r\n                    seed,\r\n                    options?.octaves ?? 1,\r\n                    options?.persistence ?? 0.5\r\n                );\r\n            case NoiseType.Ridged:\r\n                return this.ridgedNoise(x, y, seed, options?.octaves ?? 1, options?.persistence ?? 0.5);\r\n            case NoiseType.Worley:\r\n                return this.worleyNoise(\r\n                    x,\r\n                    y,\r\n                    seed,\r\n                    Math.max(1, Math.floor(options?.octaves ?? 1))\r\n                );\r\n            case NoiseType.Voronoi:\r\n                return this.voronoiNoise(x, y, seed);\r\n            default:\r\n                return this.perlinNoise(x, y, seed);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Creates a noise pattern deterministically with a seed.\r\n     * \r\n     * Optionally pass the octaves and persistence to effect the noise outcome.\r\n     */\r\n    private perlinNoise(x: number, y: number, seed: number, octaves: number = 1, persistence: number = 1): number {\r\n        let total = 0, frequency = 1, amplitude = 1, maxValue = 0;\r\n        for (let i = 0; i < octaves; i++) {\r\n            total += this.interpolateNoise(x * frequency, y * frequency, seed + i * 1000) * amplitude;\r\n            maxValue += amplitude;\r\n            amplitude *= persistence;\r\n            frequency *= 2;\r\n        }\r\n        return total / maxValue;\r\n    }\r\n\r\n    private ridgedNoise(x: number, y: number, seed: number, octaves: number = 1, persistence: number = 0.5): number {\r\n        let total = 0;\r\n        let frequency = 1;\r\n        let amplitude = 1;\r\n        let maxValue = 0;\r\n\r\n        for (let i = 0; i < octaves; i++) {\r\n            let noise = this.interpolateNoise(x * frequency, y * frequency, seed + i * 1000);\r\n            noise = 1 - Math.abs(noise); // Invert to create ridges\r\n            total += noise * amplitude;\r\n            maxValue += amplitude;\r\n            amplitude *= persistence;\r\n            frequency *= 2;\r\n        }\r\n\r\n        return total / maxValue; // Already [0,1] because of the inversion\r\n    }\r\n\r\n    private worleyNoise(x: number, y: number, seed: number, pointsPerCell: number = 1): number {\r\n        const cellX = Math.floor(x);\r\n        const cellY = Math.floor(y);\r\n        let minDist = Infinity;\r\n\r\n        // Check 3x3 neighborhood\r\n        for (let dx = -1; dx <= 1; dx++) {\r\n            for (let dy = -1; dy <= 1; dy++) {\r\n                const cx = cellX + dx;\r\n                const cy = cellY + dy;\r\n\r\n                for (let p = 0; p < pointsPerCell; p++) {\r\n                    // Use hash to get pseudo-random point in cell [0,1)\r\n                    const px = cx + this.hash2D(cx, cy, seed + p * 10000);\r\n                    const py = cy + this.hash2D(cx, cy, seed + p * 10000 + 1);\r\n                    const dx = x - px;\r\n                    const dy = y - py;\r\n                    const dist = Math.sqrt(dx * dx + dy * dy);\r\n                    if (dist < minDist) minDist = dist;\r\n                }\r\n            }\r\n        }\r\n\r\n        // Normalize: max distance in unit grid is ~1.5\r\n        return this.normalize(minDist / 1.5);\r\n    }\r\n\r\n    private voronoiNoise(x: number, y: number, seed: number): number {\r\n        return this.worleyNoise(x, y, seed, 1);\r\n    }\r\n    // - Noise Helpers\r\n    //\r\n    /**\r\n     * Generates a deterministic pseudo-random value from integer coordinates and a seed.\r\n     * \r\n     * Uses a fast 2D hash function to produce a normalized float in [0, 1].\r\n     */\r\n    public hash2D(x: number, y: number, seed: number): number {\r\n        const n = x * 374761393 + y * 668265263 + seed;\r\n        const hash = (n ^ (n >> 13)) * 1274126177;\r\n        return ((hash ^ (hash >> 16)) & 0x7fffffff) / 0x7fffffff;\r\n    }\r\n\r\n    /**\r\n     * Helper function to interpolate the seededNoise function.\r\n     * \r\n     * Performs bilinear interpolation with smoothstep weighting between four hashed grid points.\r\n     */\r\n    private interpolateNoise(x: number, y: number, seed: number): number {\r\n        const ix = Math.floor(x), fx = x - ix;\r\n        const iy = Math.floor(y), fy = y - iy;\r\n\r\n        const v1 = this.hash2D(ix, iy, seed);\r\n        const v2 = this.hash2D(ix + 1, iy, seed);\r\n        const v3 = this.hash2D(ix, iy + 1, seed);\r\n        const v4 = this.hash2D(ix + 1, iy + 1, seed);\r\n\r\n        const sx = this.smoothstep(fx);\r\n        const sy = this.smoothstep(fy);\r\n\r\n        const i1 = this.lerp(v1, v2, sx);\r\n        const i2 = this.lerp(v3, v4, sx);\r\n        return this.lerp(i1, i2, sy);\r\n    }\r\n\r\n    /** Smoothly blends from 0 to 1. */\r\n    public smoothstep(t: number): number { return t * t * (3 - 2 * t); }\r\n\r\n    /** Linear blend between a and b. */\r\n    public lerp(a: number, b: number, t: number): number { return a + (b - a) * t; }\r\n\r\n    /** Normalizes a value. */\r\n    public normalize(value: number): number { return Math.max(0, Math.min(1, value)); }\r\n    //\r\n    // #endregion\r\n\r\n    // #region [ Generation ]\r\n    //\r\n    /**\r\n     * Returns a UID using pure random math. With 36 characters defined - 8 character long UID has ~2.8 trillion outcomes.\r\n     */\r\n    public generateUID(length: number, prefix?: string): string {\r\n        const chars = '0123456789abcdefghijklmnopqrstuvwxyz';\r\n        let result = prefix ?? '';\r\n        for (let i = 0; i < length; i++) {\r\n            result += chars[this.getRandomInt(0, chars.length - 1)];\r\n        }\r\n        return result;\r\n    }\r\n\r\n    /**\r\n     * Generate a custom link using the url from the window object.\r\n     * \r\n     * Example: generateLink(abc123, 'room'); Result: https://www.link.com/?room=abc123\r\n     */\r\n    public generateLink(value: string, param?: string): string {\r\n        const base = window.location.origin;\r\n        if (param) {\r\n            return `${base}?${param}=${value}`;\r\n        }\r\n        return `${base}?${value}`;\r\n    }\r\n    //\r\n    // #endregion\r\n\r\n    // #region [ DOM ]\r\n    //\r\n    /**\r\n     * Sets the value of the chosen HTMLInputElement in the DOM.\r\n     */\r\n    public setInput(params: SetInputParams): void {\r\n        const inputElement = document.getElementById(params.inputId) as HTMLInputElement | null;\r\n        if (inputElement) {\r\n            inputElement.value = params.value.toString();\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Sets a specific slider to a specific value.\r\n     * \r\n     * Slider must have a base element and a fill element. Optionally lerp the value between the target and the current, using the max.\r\n     */\r\n    public setSlider(params: SetSliderParams): void {\r\n        const { sliderId, targetValue, maxValue, lerpTime = 0 } = params;\r\n\r\n        const sliderContainer = document.getElementById(sliderId);\r\n        const sliderFill = sliderContainer?.querySelector('div') as HTMLElement;\r\n\r\n        if (!sliderContainer || !sliderFill) {\r\n            console.warn(`Slider not found: ${sliderId}...`);\r\n            return;\r\n        }\r\n\r\n        if (maxValue === 0) {\r\n            console.warn(\"maxValue cannot be 0...\");\r\n            return;\r\n        }\r\n\r\n        // Clamp target value between 0 and maxValue\r\n        const clampedTarget = Math.max(0, Math.min(maxValue, targetValue));\r\n        const targetPercentage = (clampedTarget / maxValue) * 100;\r\n\r\n        // Get current width percentage\r\n        const currentWidthStr = sliderFill.style.width || '100%';\r\n        const currentPercentage = parseFloat(currentWidthStr.replace('%', ''));\r\n\r\n        // If already at target, no animation needed\r\n        if (Math.abs(currentPercentage - targetPercentage) < 0.1) return;\r\n\r\n        // If lerpTime is <= 0, directly set the slider to the targetValue\r\n        if (lerpTime <= 0) {\r\n            sliderFill.style.transition = 'none';\r\n            sliderFill.style.width = `${targetPercentage}%`;\r\n            return;\r\n        }\r\n\r\n        // Animate using CSS transition\r\n        sliderFill.style.transition = `width ${lerpTime}ms ease-out`;\r\n        sliderFill.style.width = `${targetPercentage}%`;\r\n\r\n        // Clear transition after animation completes to avoid interfering with future updates\r\n        setTimeout(() => {\r\n            if (sliderFill) {\r\n                sliderFill.style.transition = '';\r\n            }\r\n        }, lerpTime);\r\n    }\r\n\r\n    /**\r\n     * Update a span element with a specific number or string.\r\n     */\r\n    public setSpan(params: SetSpanParams): void {\r\n        const spanElement = document.getElementById(params.spanId);\r\n\r\n        if (!spanElement) {\r\n            console.warn(`Span not found: ${params.spanId}`);\r\n            return;\r\n        }\r\n\r\n        spanElement.textContent = params.value.toString();\r\n    }\r\n\r\n    /**\r\n     * Updates the attributes of a toggle element for reference.\r\n     */\r\n    public setToggle(params: SetToggleParams): void {\r\n        const toggle = document.getElementById(params.toggleId);\r\n        if (toggle) {\r\n            if (params.value) {\r\n                toggle.setAttribute('checked', 'true');\r\n                toggle.setAttribute('aria-checked', 'true');\r\n            } else {\r\n                toggle.removeAttribute('checked');\r\n                toggle.setAttribute('aria-checked', 'false');\r\n            }\r\n        }\r\n    }\r\n    //\r\n    // #endregion\r\n\r\n    // #region [ Animation ]\r\n    //\r\n    /**\r\n     * Can be used to animate most elements with text on the page.\r\n     * \r\n     * Element must have '.style.color' and '.textContent'.\r\n     */\r\n    public animateTextInElement(params: TextAnimParams): void {\r\n        const increment = (params.newValue - params.oldValue) / params.steps;\r\n        const stepTime = params.animTime / params.steps;\r\n\r\n        let currentStep = 0;\r\n        let currentValue = params.oldValue;\r\n\r\n        // Set color\r\n        params.element.style.color = params.color;\r\n\r\n        const interval = setInterval(() => {\r\n            currentStep++;\r\n            currentValue += increment;\r\n\r\n            if (currentStep >= params.steps) {\r\n                params.element.textContent = params.newValue.toFixed(params.decimals);\r\n                clearInterval(interval);\r\n\r\n                // Reset color after animation\r\n                setTimeout(() => {\r\n                    params.element.style.color = '';\r\n                }, params.timeout);\r\n            } else {\r\n                params.element.textContent = currentValue.toFixed(params.decimals);\r\n            }\r\n        }, stepTime);\r\n    }\r\n    //\r\n    // #endregion\r\n}","import { GAME } from \"./Config\";\r\n\r\nimport { GameState } from \"./GameState\";\r\nimport { RoomManager } from \"./RoomManager\";\r\nimport { Utility } from \"./Utility\";\r\n\r\nexport class WebsocketManager {\r\n    private ws: WebSocket | null = null;\r\n\r\n    constructor(\r\n        private gameState: GameState,\r\n        private roomManager: RoomManager,\r\n        private utility: Utility\r\n    ) { }\r\n\r\n    /**\r\n     * Used for creating the websocket connection between clients.\r\n     * \r\n     * Called when joining or creating a room.\r\n     */\r\n    public connectWebSocket(): void {\r\n        const wsProtocol = location.protocol === \"https:\" ? \"wss:\" : \"ws:\";\r\n        let wsHost: string;\r\n\r\n        if (location.port === '8888') { // Electron testing  connect to localhost:8080\r\n            wsHost = 'localhost:8080';\r\n            this.ws = new WebSocket(`ws://${wsHost}`);\r\n        } else if (location.port === '9999') { // Electron production  connect to saltpeter.xyz\r\n            wsHost = 'saltpeter.xyz';\r\n            this.ws = new WebSocket(`wss://${wsHost}`);\r\n        } else { // Browser (not Electron)\r\n            wsHost = location.hostname === 'localhost' ? 'localhost:8080' : location.host;\r\n            this.ws = new WebSocket(`${wsProtocol}//${wsHost}`);\r\n        }\r\n\r\n        this.ws.onopen = () => {\r\n            console.log(\"Connected to WebSocket\");\r\n            this.roomManager.setWebSocket(this.ws!);\r\n        };\r\n\r\n        this.ws.onclose = () => {\r\n            console.log(\"Disconnected from WebSocket\");\r\n            this.gameState.gameInProgress = false;\r\n            this.utility.safeTimeout(() => this.connectWebSocket(), GAME.RECONNECT_DELAY);\r\n        };\r\n\r\n        this.ws.onerror = (error) => {\r\n            console.error(\"WebSocket error:\", error);\r\n        };\r\n    }\r\n\r\n\r\n    /**\r\n     * Returns the current WebSocket connection.\r\n     */\r\n    public getWebSocket(): WebSocket | null {\r\n        return this.ws;\r\n    }\r\n}","import { OBJECT_DEFAULTS, SHRAPNEL, WORLD } from \"../Config\";\r\nimport { AttackType, AudioParams, CreateParticleParams, DecalParams, PlayerHitParams, Projectile, ProjectileOverrides, Shrapnel, Vec2 } from \"../Types\";\r\n\r\nimport { Animator } from \"../Animator\";\r\nimport { AudioManager } from \"../AudioManager\";\r\nimport { CollisionsManager } from \"../CollisionsManager\";\r\nimport { DecalsManager } from \"../DecalsManager\";\r\nimport { GameState } from \"../GameState\";\r\nimport { LuckController } from \"./LuckController\";\r\nimport { ParticlesManager } from \"../ParticlesManager\";\r\nimport { PlayerState } from \"./PlayerState\";\r\nimport { RoomManager } from \"../RoomManager\";\r\nimport { Utility } from \"../Utility\";\r\nimport { PlayerController, } from \"./PlayerController\";\r\nimport { UserInterface } from \"../UserInterface\";\r\nimport { AudioConfig } from \"../AudioConfig\";\r\nimport { World } from \"../world/World\";\r\n\r\nexport class CombatController {\r\n    public projectiles: Map<string, Projectile> = new Map();\r\n\r\n    constructor(\r\n        private animator: Animator,\r\n        private audioConfig: AudioConfig,\r\n        private audioManager: AudioManager,\r\n        private collisionsManager: CollisionsManager,\r\n        private decalsManager: DecalsManager,\r\n        private gameState: GameState,\r\n        private luckController: LuckController,\r\n        private particlesManager: ParticlesManager,\r\n        private playerController: PlayerController,\r\n        private playerState: PlayerState,\r\n        private roomManager: RoomManager,\r\n        private ui: UserInterface,\r\n        private userId: string,\r\n        private utility: Utility,\r\n        private world: World\r\n    ) { }\r\n\r\n    // #region [ Attack ]\r\n    /**\r\n     * Entrypoint for triggering attacks based on type needed.\r\n     */\r\n    public triggerAttack(type: AttackType): void {\r\n        switch (type) {\r\n            case 'melee':\r\n                this.startMelee();\r\n                break;\r\n            case 'ranged':\r\n                this.startBurst();\r\n                break;\r\n            default:\r\n                console.warn(`Unknown attack type: ${type}`);\r\n                break;\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Responsible for what happens during attack actions.\r\n     */\r\n    public updateAttack(delta: number): void {\r\n        if (!this.gameState.gameInProgress || this.playerState.myPlayer.stats.health.value <= 0) return;\r\n\r\n        const currentTime = Date.now();\r\n\r\n        // Handle reload\r\n        if (this.playerState.isReloading) {\r\n            if (currentTime >= this.playerState.reloadStartTime + this.playerState.myPlayer.actions.primary.reload.time) { // Reload complete\r\n                this.finishReload();\r\n            }\r\n            return; // Can't shoot while reloading\r\n        }\r\n\r\n        // Handle ongoing burst\r\n        if (this.playerState.isBurstActive && currentTime >= this.playerState.nextBurstShotTime) {\r\n            // Check if we still have ammo and haven't finished the intended burst amount\r\n            const ammoNeeded = this.playerState.myPlayer.actions.primary.burst.amount;\r\n            if (this.playerState.myPlayer.actions.primary.magazine.currentAmmo > 0 && this.playerState.currentBurstShot < ammoNeeded) {\r\n                const angle = this.playerState.myPlayer.transform.rot - Math.PI / 2;\r\n                const targetDir = { x: Math.cos(angle), y: Math.sin(angle) };\r\n\r\n                const triggeredUniques = this.triggerBurstUniques();\r\n                if (triggeredUniques.length === 0) {\r\n                    this.launchProjectile(targetDir);\r\n                }\r\n\r\n                this.playerState.currentBurstShot++;\r\n                this.playerState.myPlayer.actions.primary.magazine.currentAmmo--; // Use 1 ammo per shot in burst\r\n\r\n                console.log(`Burst shot ${this.playerState.currentBurstShot}! Magazine: ${this.playerState.myPlayer.actions.primary.magazine.currentAmmo}/${this.playerState.myPlayer.actions.primary.magazine.size}, Inventory: ${this.playerState.myPlayer.actions.primary.magazine.currentReserve}/${this.playerState.myPlayer.actions.primary.magazine.maxReserve}`);\r\n\r\n                if (this.playerState.currentBurstShot >= ammoNeeded || this.playerState.myPlayer.actions.primary.magazine.currentAmmo === 0) { // Burst complete (reached burst amount or out of ammo)\r\n                    this.playerState.isBurstActive = false;\r\n                    this.playerState.currentBurstShot = 0;\r\n                } else { // Schedule next shot in burst\r\n                    this.playerState.nextBurstShotTime = currentTime + this.playerState.myPlayer.actions.primary.burst.delay;\r\n                }\r\n            } else { // Out of ammo or reached burst limit\r\n                this.playerState.isBurstActive = false;\r\n                this.playerState.currentBurstShot = 0;\r\n            }\r\n        }\r\n    }\r\n    //\r\n    // #endregion\r\n\r\n    // #region [ Melee ]\r\n    //\r\n    /**\r\n     * Checks if the player can melee or not.\r\n     */\r\n    public canMelee(): boolean {\r\n        const now = Date.now(); 1\r\n        return (\r\n            !this.playerState.isMelee &&\r\n            now >= this.playerState.lastMeleeTime + this.playerState.myPlayer.actions.melee.cooldown &&\r\n            this.collisionsManager.collisionsEnabled(this.playerState.myPlayer) &&\r\n            !this.playerState.isBurstActive &&\r\n            !this.playerState.isReloading\r\n        );\r\n    }\r\n\r\n    /**\r\n     * Triggers a melee attack, using standard projectiles with special params.\r\n     */\r\n    private startMelee(): void {\r\n        this.playerState.isMelee = true;\r\n        this.playerState.lastMeleeTime = Date.now();\r\n\r\n        this.playerState.myPlayer.rig.weapon = this.playerState.myPlayer.inventory.melee;\r\n\r\n        this.roomManager.sendMessage(JSON.stringify({\r\n            type: 'weapon-change',\r\n            playerId: this.userId,\r\n            weapon: this.playerState.myPlayer.inventory.melee\r\n        }));\r\n\r\n        // Calculate melee direction (use current rotation)\r\n        const angle = this.playerState.myPlayer.transform.rot;\r\n        const range = this.playerState.myPlayer.actions.melee.range;\r\n        const size = this.playerState.myPlayer.actions.melee.size;\r\n\r\n        // Use the same spawn offset as normal projectiles\r\n        const spawnOffset = this.collisionsManager.getPlayerCollider(this.playerState.myPlayer) +\r\n            this.playerState.myPlayer.actions.primary.projectile.size +\r\n            this.playerState.myPlayer.actions.primary.offset;\r\n\r\n        // Calculate spawn position at the tip of the weapon\r\n        const spawnX = this.playerState.myPlayer.transform.pos.x + Math.cos(angle - Math.PI / 2) * spawnOffset;\r\n        const spawnY = this.playerState.myPlayer.transform.pos.y + Math.sin(angle - Math.PI / 2) * spawnOffset;\r\n\r\n        const velocity = {\r\n            x: Math.cos(angle - Math.PI / 2) * range,\r\n            y: Math.sin(angle - Math.PI / 2) * range\r\n        };\r\n\r\n        const meleeProjectile = {\r\n            id: this.utility.generateUID(OBJECT_DEFAULTS.DATA.ID_LENGTH),\r\n            transform: {\r\n                pos: { x: spawnX, y: spawnY },\r\n                rot: angle\r\n            },\r\n            timestamp: Date.now(),\r\n            color: 'rgba(255, 255, 255, 0)',\r\n            damage: this.playerState.myPlayer.actions.melee.damage,\r\n            distanceTraveled: 0,\r\n            length: size,\r\n            ownerId: this.userId,\r\n            range: range,\r\n            size: size,\r\n            velocity: velocity\r\n        };\r\n\r\n        this.projectiles.set(meleeProjectile.id, meleeProjectile);\r\n\r\n        this.roomManager.sendMessage(JSON.stringify({\r\n            type: 'projectile-launch',\r\n            projectile: meleeProjectile\r\n        }));\r\n\r\n        // Remove melee projectile after it has traveled its duration\r\n        this.utility.safeTimeout(() => {\r\n            this.projectiles.delete(meleeProjectile.id);\r\n            this.playerState.isMelee = false;\r\n\r\n            this.playerState.myPlayer.rig.weapon = this.playerState.myPlayer.inventory.primary;\r\n\r\n            this.roomManager.sendMessage(JSON.stringify({\r\n                type: 'weapon-change',\r\n                playerId: this.userId,\r\n                weapon: this.playerState.myPlayer.inventory.primary\r\n            }));\r\n        }, this.playerState.myPlayer.actions.melee.duration);\r\n    }\r\n    //\r\n    // #endregion\r\n\r\n    // #region [ Ranged ]\r\n    //\r\n    /**\r\n     * Entrypoint for ranged attacks. When this is called, it starts the primary attack flow.\r\n     */\r\n    private startBurst(): void {\r\n        if (this.playerState.isBurstActive || !this.collisionsManager.collisionsEnabled(this.playerState.myPlayer) || this.playerState.isReloading) return;\r\n\r\n        const now = Date.now();\r\n        if (now < this.playerState.lastShotTime + this.playerState.myPlayer.actions.primary.buffer) return;\r\n        this.playerState.lastShotTime = now;\r\n\r\n        // Check if we have enough ammo for the burst\r\n        const ammoNeeded = this.playerState.myPlayer.actions.primary.burst.amount;\r\n        const ammoToUse = Math.min(ammoNeeded, this.playerState.myPlayer.actions.primary.magazine.currentAmmo);\r\n\r\n        if (ammoToUse === 0) {\r\n            console.log('Out of ammo! Magazine empty.');\r\n\r\n            this.animator.animateCharacterPart({\r\n                playerId: this.userId,\r\n                part: 'weapon',\r\n                frames: {\r\n                    0: { x: 0, y: 8 } // Slide held back\r\n                },\r\n                duration: 0,\r\n                partIndex: 1\r\n            }); // duration=0 means infinite/held\r\n\r\n            this.audioManager.playAudioNetwork({\r\n                src: this.utility.getRandomInArray(this.audioConfig.resources.sfx.weapon.glock.empty),\r\n                listener: {\r\n                    x: this.playerState.myPlayer.transform.pos.x,\r\n                    y: this.playerState.myPlayer.transform.pos.y\r\n                },\r\n                output: 'sfx',\r\n                pitch: { min: 0.975, max: 1.05 },\r\n                spatial: {\r\n                    blend: 1.0,\r\n                    pos: { x: this.playerState.myPlayer.transform.pos.x, y: this.playerState.myPlayer.transform.pos.y }\r\n                },\r\n                volume: { min: 0.985, max: 1 }\r\n            });\r\n            return;\r\n        }\r\n\r\n        this.playerState.isBurstActive = true;\r\n        this.playerState.currentBurstShot = 0;\r\n\r\n        // Calculate direction from player's current rotation instead of mouse\r\n        const angle = this.playerState.myPlayer.transform.rot - Math.PI / 2; // Subtract PI/2 to convert from visual rotation to direction\r\n        const targetDir = { x: Math.cos(angle), y: Math.sin(angle) };\r\n\r\n        const triggeredUniques = this.triggerBurstUniques();\r\n        if (triggeredUniques.length === 0) {\r\n            this.launchProjectile(targetDir);\r\n        }\r\n\r\n        this.playerState.currentBurstShot++;\r\n        this.playerState.myPlayer.actions.primary.magazine.currentAmmo--; // Use 1 ammo per shot in burst\r\n\r\n        // Blend in empty sound as magazine gets low\r\n        // This is a local sound only, to help the player manage their ammo\r\n        const ammoRatio = this.playerState.myPlayer.actions.primary.magazine.currentAmmo / this.playerState.myPlayer.actions.primary.magazine.size;\r\n        const emptyBlend = 1 - ammoRatio; // 0 when full, 1 when empty\r\n\r\n        if (emptyBlend > 0.5) { // Only play when below 50% ammo (half mag empty)\r\n            const blendVolume = (emptyBlend - 0.5) * 2 * 0.5; // Remap 0.5-1.0 to 0-0.5 volume\r\n            this.audioManager.playAudio({ // Play sound locally\r\n                src: this.utility.getRandomInArray(this.audioConfig.resources.sfx.weapon.glock.empty), // TODO: Use current weapon\r\n                listener: {\r\n                    x: this.playerState.myPlayer.transform.pos.x,\r\n                    y: this.playerState.myPlayer.transform.pos.y\r\n                },\r\n                output: 'sfx',\r\n                pitch: { min: 0.975, max: 1.05 },\r\n                volume: { min: blendVolume, max: blendVolume }\r\n            });\r\n        }\r\n\r\n        // If burst has more shots and we have ammo, schedule the next one\r\n        if (this.playerState.myPlayer.actions.primary.burst.amount > 1 && this.playerState.myPlayer.actions.primary.magazine.currentAmmo > 0 && this.playerState.currentBurstShot < ammoToUse) {\r\n            this.playerState.nextBurstShotTime = Date.now() + this.playerState.myPlayer.actions.primary.burst.delay;\r\n        } else { // Burst complete\r\n            this.playerState.isBurstActive = false;\r\n            this.playerState.currentBurstShot = 0;\r\n\r\n            if (this.playerState.myPlayer.actions.primary.magazine.currentAmmo === 0) {\r\n                this.animator.animateCharacterPart({\r\n                    playerId: this.userId,\r\n                    part: 'weapon',\r\n                    frames: {\r\n                        0: { x: 0, y: 8 } // Slide held back\r\n                    },\r\n                    duration: 0,\r\n                    partIndex: 1\r\n                }); // duration=0 means infinite/held\r\n            }\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Calculates physics for projectile and adds them to mapping.\r\n     */\r\n    private launchProjectile(dir: Vec2, overrides?: ProjectileOverrides): void {\r\n        console.log(`Fired shot!`);\r\n\r\n        // Use the passed direction and normalize it\r\n        const distance = Math.sqrt(dir.x * dir.x + dir.y * dir.y);\r\n        if (distance === 0) return;\r\n\r\n        const dirX = dir.x / distance;\r\n        const dirY = dir.y / distance;\r\n\r\n        // Animate weapon slide (glock_slide.png is index 1 in the weapon.glock array)\r\n        this.animator.animateCharacterPart({\r\n            playerId: this.userId,\r\n            part: 'weapon',\r\n            frames: {\r\n                0: { x: 0, y: 0 },    // Start position\r\n                0.5: { x: 0, y: 20 }, // Pull back slide\r\n                1: { x: 0, y: 0 }     // Return to start\r\n            },\r\n            duration: 175,\r\n            partIndex: 1\r\n        });\r\n\r\n        const canTriggerUnique = overrides?.canTriggerUnique ?? true;\r\n        const projectileAmount = overrides?.amount ?? this.playerState.myPlayer.actions.primary.projectile.amount;\r\n        const projectileColor = overrides?.color ?? this.playerState.myPlayer.actions.primary.projectile.color;\r\n        const projectileDamage = overrides?.damage ?? this.playerState.myPlayer.actions.primary.projectile.damage;\r\n        const projectileLength = overrides?.length ?? this.playerState.myPlayer.actions.primary.projectile.length;\r\n        const projectileRange = overrides?.range ?? this.playerState.myPlayer.actions.primary.projectile.range;\r\n        const projectileSize = overrides?.size ?? this.playerState.myPlayer.actions.primary.projectile.size;\r\n        const projectileSpeed = overrides?.speed ?? this.playerState.myPlayer.actions.primary.projectile.speed;\r\n        const projectileSpread = overrides?.spread ?? this.playerState.myPlayer.actions.primary.projectile.spread;\r\n\r\n        // Calculate spawn offset\r\n        const baseAngle = Math.atan2(dirY, dirX);\r\n        const spawnOffset = this.collisionsManager.getPlayerCollider(this.playerState.myPlayer) + projectileSize + this.playerState.myPlayer.actions.primary.offset;\r\n        const bulletSpawnX = this.playerState.myPlayer.transform.pos.x + Math.cos(baseAngle) * spawnOffset;\r\n        const bulletSpawnY = this.playerState.myPlayer.transform.pos.y + Math.sin(baseAngle) * spawnOffset;\r\n        const rightX = -dirY;\r\n        const rightY = dirX;\r\n\r\n        // TODO: Wrap all of these particles in some sort of defined type that contains this in one message\r\n\r\n        const muzzleParams: CreateParticleParams = {\r\n            id: `muzzle_${Date.now()}`,\r\n            pos: {\r\n                x: bulletSpawnX,\r\n                y: bulletSpawnY\r\n            },\r\n            particleParams: this.particlesManager.particlesConfig.particles.glock.muzzle.flash, // TODO: Get current weapon\r\n            direction: { x: dirX, y: dirY }\r\n        }\r\n        this.particlesManager.createParticles(muzzleParams);\r\n\r\n        const smokeParams: CreateParticleParams = {\r\n            id: `smoke_${Date.now()}`,\r\n            pos: {\r\n                x: bulletSpawnX,\r\n                y: bulletSpawnY\r\n            },\r\n            particleParams: this.particlesManager.particlesConfig.particles.glock.muzzle.smoke, // TODO: Get current weapon\r\n            direction: { x: dirX * 0.3, y: dirY * 0.3 }\r\n        }\r\n        this.particlesManager.createParticles(smokeParams);\r\n\r\n        const shellParams: CreateParticleParams = {\r\n            id: `shell_${Date.now()}`,\r\n            pos: {\r\n                x: bulletSpawnX - 5,\r\n                y: bulletSpawnY - 5\r\n            },\r\n            particleParams: this.particlesManager.particlesConfig.particles.glock.projectile.shell, // TODO: Get current weapon\r\n            direction: { x: rightX * 0.8 + dirX * -0.2, y: rightY * 0.8 + dirY * -0.2 } // Right + slightly back\r\n        }\r\n        this.particlesManager.createParticles(shellParams);\r\n\r\n        this.audioManager.playAudioNetwork({\r\n            src: this.utility.getRandomInArray(this.audioConfig.resources.sfx.weapon.glock.attack), // TODO: Use current weapon\r\n            listener: {\r\n                x: this.playerState.myPlayer.transform.pos.x,\r\n                y: this.playerState.myPlayer.transform.pos.y\r\n            },\r\n            output: 'sfx',\r\n            pitch: { min: 0.95, max: 1.125 },\r\n            spatial: {\r\n                blend: 1.0,\r\n                pos: { x: this.playerState.myPlayer.transform.pos.x, y: this.playerState.myPlayer.transform.pos.y },\r\n                rolloff: {\r\n                    distance: Math.max(WORLD.WIDTH, WORLD.HEIGHT) / 2, // TODO: Make more reliable distance attenuation, right now, just half of the world size\r\n                    factor: 0.5,\r\n                    type: 'logarithmic'\r\n                }\r\n            },\r\n            volume: { min: 0.965, max: 1 }\r\n        });\r\n\r\n        this.audioManager.playAudioNetwork({\r\n            src: this.utility.getRandomInArray(this.audioConfig.resources.sfx.weapon.glock.shell), // TODO: Use current weapon\r\n            delay: { min: 0.25, max: 0.5 }, // Play with a short delay trigger to simulate the shell hitting the ground\r\n            listener: {\r\n                x: this.playerState.myPlayer.transform.pos.x,\r\n                y: this.playerState.myPlayer.transform.pos.y\r\n            },\r\n            output: 'sfx',\r\n            pitch: { min: 0.95, max: 1.125 },\r\n            spatial: {\r\n                blend: 1.0,\r\n                pos: { x: this.playerState.myPlayer.transform.pos.x, y: this.playerState.myPlayer.transform.pos.y }\r\n            },\r\n            volume: { min: 0.375, max: 0.85 }\r\n        });\r\n\r\n        // Create projectiles\r\n        for (let i = 0; i < projectileAmount; i++) {\r\n            if (this.playerState.myPlayer.unique.length > 0 && canTriggerUnique) {\r\n                const shuffledUniques = this.utility.getShuffledArray(this.playerState.myPlayer.unique);\r\n\r\n                for (const unique of shuffledUniques) {\r\n                    if (this.luckController.luckRoll()) {\r\n                        this.triggerUnique(unique);\r\n                        break;\r\n                    }\r\n                }\r\n            }\r\n\r\n            const spread = (Math.random() - 0.5) * (projectileSpread / 100);\r\n            const angle = Math.atan2(dirY, dirX) + spread;\r\n            const dir = this.utility.forward(angle);\r\n\r\n            const projectile: Projectile = {\r\n                id: this.utility.generateUID(OBJECT_DEFAULTS.DATA.ID_LENGTH),\r\n                transform: {\r\n                    pos: {\r\n                        x: bulletSpawnX,\r\n                        y: bulletSpawnY,\r\n                    },\r\n                    rot: angle\r\n                },\r\n                timestamp: Date.now(),\r\n                color: projectileColor,\r\n                damage: projectileDamage,\r\n                distanceTraveled: 0,\r\n                length: projectileLength,\r\n                ownerId: this.userId,\r\n                range: projectileRange * 100, // Convert to px\r\n                size: projectileSize,\r\n                velocity: {\r\n                    x: dir.x * projectileSpeed,\r\n                    y: dir.y * projectileSpeed,\r\n                },\r\n            };\r\n\r\n            this.projectiles.set(projectile.id, projectile);\r\n\r\n            // Send projectile to other players\r\n            this.roomManager.sendMessage(JSON.stringify({\r\n                type: 'projectile-launch',\r\n                projectile: projectile\r\n            }));\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Updates all projectiles in the game locally.\r\n     */\r\n    public updateProjectiles(delta: number): void {\r\n        const projectilesToRemove: string[] = [];\r\n\r\n        this.projectiles.forEach((projectile, id) => {\r\n            // Update movement (with optional spatial targeting nudge)\r\n            if (projectile.ownerId === this.userId) {\r\n                if (this.playerState.myPlayer.unique.includes('spatial_targeting')) {\r\n                    const aim = this.playerState.myPlayer.transform.rot - Math.PI / 2;\r\n                    const dx = Math.cos(aim), dy = Math.sin(aim);\r\n                    const speed = Math.sqrt(projectile.velocity.x ** 2 + projectile.velocity.y ** 2);\r\n                    const vx = projectile.velocity.x / speed, vy = projectile.velocity.y / speed;\r\n                    const lerpFactor = 0.05;\r\n                    const lx = vx + (dx - vx) * lerpFactor;\r\n                    const ly = vy + (dy - vy) * lerpFactor;\r\n                    const norm = Math.sqrt(lx ** 2 + ly ** 2);\r\n\r\n                    projectile.velocity.x = (lx / norm) * speed;\r\n                    projectile.velocity.y = (ly / norm) * speed;\r\n                    projectile.transform.rot = Math.atan2(projectile.velocity.y, projectile.velocity.x);\r\n                }\r\n            }\r\n            projectile.transform.pos.x += projectile.velocity.x * delta;\r\n            projectile.transform.pos.y += projectile.velocity.y * delta;\r\n\r\n            // Update distance traveled\r\n            const frameDistance = Math.sqrt(\r\n                projectile.velocity.x * projectile.velocity.x +\r\n                projectile.velocity.y * projectile.velocity.y\r\n            ) * delta;\r\n            projectile.distanceTraveled += frameDistance;\r\n\r\n            // Check collision with my player (only if I'm alive)\r\n            if (this.collisionsManager.collisionsEnabled(this.playerState.myPlayer)) {\r\n                const dx = projectile.transform.pos.x - this.playerState.myPlayer.transform.pos.x;\r\n                const dy = projectile.transform.pos.y - this.playerState.myPlayer.transform.pos.y;\r\n                const distance = Math.sqrt(dx * dx + dy * dy);\r\n\r\n                const playerCollider = this.collisionsManager.getPlayerCollider(this.playerState.myPlayer);\r\n                const canDeflect = this.playerState.myPlayer.unique.includes('kinetic_brain') &&\r\n                    distance <= playerCollider * 4 &&\r\n                    distance > playerCollider + projectile.size &&\r\n                    projectile.ownerId !== this.userId;\r\n\r\n                if (canDeflect) {\r\n                    if (this.luckController.luckRoll()) {\r\n                        console.log('Kinetic Brain activated! Deflecting projectile.');\r\n\r\n                        // Calculate normal from player center to projectile\r\n                        const normal = {\r\n                            x: (projectile.transform.pos.x - this.playerState.myPlayer.transform.pos.x) / distance,\r\n                            y: (projectile.transform.pos.y - this.playerState.myPlayer.transform.pos.y) / distance\r\n                        };\r\n\r\n                        const speedReduction = this.utility.getRandomNum(0.85, 0.95);\r\n\r\n                        // Reflect velocity off the normal\r\n                        const reflected = this.utility.getReflection(projectile.velocity, normal);\r\n                        projectile.velocity.x = reflected.x * speedReduction; // Slow down\r\n                        projectile.velocity.y = reflected.y * 0.85;\r\n\r\n                        // Change ownership\r\n                        projectile.ownerId = this.userId;\r\n                        projectile.color = this.playerState.myPlayer.actions.primary.projectile.color;\r\n\r\n                        // Update rotation\r\n                        projectile.transform.rot = Math.atan2(projectile.velocity.y, projectile.velocity.x);\r\n\r\n                        // Broadcast deflection\r\n                        this.roomManager.sendMessage(JSON.stringify({\r\n                            type: 'projectile-update',\r\n                            projectileId: projectile.id,\r\n                            newOwnerId: this.userId,\r\n                            velocity: projectile.velocity,\r\n                            color: projectile.color\r\n                        }));\r\n\r\n                        return;\r\n                    }\r\n                }\r\n\r\n                if (distance <= playerCollider + projectile.size) { // Projectile collided with my player\r\n                    projectilesToRemove.push(id);\r\n\r\n                    const actualDamage = Math.max(0, projectile.damage - this.playerState.myPlayer.stats.defense);\r\n                    this.playerState.myPlayer.stats.health.value = Math.max(0, this.playerState.myPlayer.stats.health.value - actualDamage);\r\n\r\n                    const params: PlayerHitParams = {\r\n                        target: this.playerState.myPlayer,\r\n                        shooterId: projectile.ownerId,\r\n                        damage: projectile.damage,\r\n                        newHealth: this.playerState.myPlayer.stats.health.value,\r\n                        source: projectile,\r\n                        wasKill: this.playerState.myPlayer.stats.health.value <= 0\r\n                    }\r\n                    this.playerController.playerHit(params);\r\n                }\r\n            }\r\n\r\n            // Check collision with other players (for my projectiles only)\r\n            if (projectile.ownerId === this.userId) {\r\n                this.playerState.players.forEach((player, playerId) => {\r\n                    if (this.collisionsManager.collisionsEnabled(player)) { // Only check collision if the player has collisions enabled\r\n                        const dx2 = projectile.transform.pos.x - player.transform.pos.x;\r\n                        const dy2 = projectile.transform.pos.y - player.transform.pos.y;\r\n                        const distance2 = Math.sqrt(dx2 * dx2 + dy2 * dy2);\r\n\r\n                        if (distance2 <= this.collisionsManager.getPlayerCollider(player) + projectile.size) { // My projectile hit another player!\r\n                            projectilesToRemove.push(id);\r\n\r\n                            const actualDamage = Math.max(0, projectile.damage - player.stats.defense);\r\n                            const newHealth = Math.max(0, player.stats.health.value - actualDamage);\r\n                            player.stats.health.value = newHealth;\r\n\r\n                            const params: PlayerHitParams = {\r\n                                target: player,\r\n                                shooterId: this.userId,\r\n                                damage: projectile.damage,\r\n                                newHealth: newHealth,\r\n                                source: projectile,\r\n                                wasKill: newHealth <= 0\r\n                            }\r\n                            this.playerController.playerHit(params);\r\n                        }\r\n                    }\r\n                });\r\n            }\r\n\r\n            // Check if projectile should be removed (range/bounds)\r\n            if (projectile.distanceTraveled >= projectile.range ||\r\n                projectile.transform.pos.x < 0 || projectile.transform.pos.x > WORLD.WIDTH ||\r\n                projectile.transform.pos.y < 0 || projectile.transform.pos.y > WORLD.HEIGHT) {\r\n\r\n                projectilesToRemove.push(id);\r\n\r\n                // Create burn mark where projectile expired (only for my projectiles)\r\n                if (projectile.ownerId === this.userId) {\r\n                    const impactX = projectile.transform.pos.x;\r\n                    const impactY = projectile.transform.pos.y;\r\n\r\n                    const triggeredUniques = this.triggerCollisionUniques(projectile.transform.pos);\r\n\r\n                    // TODO: Catch the triggered uniques, and use that string array, might be a bouncing bullet or something that makes it not get destroyed yet\r\n\r\n                    const inBounds =\r\n                        impactX >= 0 && impactX <= WORLD.WIDTH &&\r\n                        impactY >= 0 && impactY <= WORLD.HEIGHT;\r\n\r\n                    if (inBounds) {\r\n                        if (projectile.distanceTraveled >= projectile.range) {\r\n                            const decalParams: DecalParams = {\r\n                                id: `impact_${id}`,\r\n                                pos: {\r\n                                    x: projectile.transform.pos.x,\r\n                                    y: projectile.transform.pos.y\r\n                                },\r\n                                type: 'parametric',\r\n                                parametric: this.decalsManager.decalsConfig.decals.projectile\r\n                            };\r\n                            this.decalsManager.createDecal(decalParams);\r\n                        }\r\n\r\n                        const sparksParams: CreateParticleParams = {\r\n                            id: `sparks_${id}`,\r\n                            pos: {\r\n                                x: projectile.transform.pos.x,\r\n                                y: projectile.transform.pos.y\r\n                            },\r\n                            particleParams: this.particlesManager.particlesConfig.particles.glock.projectile.sparks  // TODO: Use current projectile hit effect\r\n                        }\r\n                        this.particlesManager.createParticles(sparksParams);\r\n\r\n                        const sfxParams: AudioParams = {\r\n                            src: this.utility.getRandomInArray(this.audioConfig.resources.sfx.impact.metal.bullet), // TODO: Use current projectile type\r\n                            listener: {\r\n                                x: this.playerState.myPlayer.transform.pos.x,\r\n                                y: this.playerState.myPlayer.transform.pos.y\r\n                            },\r\n                            output: 'sfx',\r\n                            pitch: { min: 0.95, max: 1.125 },\r\n                            spatial: {\r\n                                blend: 1.0,\r\n                                pos: { x: projectile.transform.pos.x, y: projectile.transform.pos.y }\r\n                            },\r\n                            volume: { min: 0.965, max: 1 }\r\n                        }\r\n                        this.audioManager.playAudioNetwork(sfxParams);\r\n\r\n                        this.world.worldEdit.requestCraterAt(projectile.transform.pos);\r\n                    }\r\n\r\n                    // Notify others to remove projectile\r\n                    this.roomManager.sendMessage(JSON.stringify({\r\n                        type: 'projectile-remove',\r\n                        projectileId: id\r\n                    }));\r\n                }\r\n            }\r\n        });\r\n\r\n        // Remove projectiles locally\r\n        projectilesToRemove.forEach(id => {\r\n            this.projectiles.delete(id);\r\n        });\r\n    }\r\n\r\n    /**\r\n     * Used to toggle auto fire\r\n     */\r\n    public toggleAutoFire(timestamp: number): void {\r\n        this.playerState.canAutoFire = true;\r\n\r\n        const cachedBuffer = this.playerState.myPlayer.actions.primary.buffer\r\n\r\n        this.playerState.myPlayer.actions.primary.buffer *= 0.5; // TODO: Pass the buffer change\r\n\r\n        console.log(`Auto-fire enabled until ${timestamp}`);\r\n\r\n        this.utility.safeTimeout(() => {\r\n            this.playerState.canAutoFire = false;\r\n            this.playerState.myPlayer.actions.primary.buffer = cachedBuffer;\r\n            console.log('Auto-fire disabled.');\r\n        }, timestamp - Date.now()); // Duration of override\r\n    } // TODO: Timestamp duration should be optional, if not passed toggle is permanent on/off\r\n    //\r\n    // #endregion\r\n\r\n    // #region [ Uniques ]\r\n    //\r\n    /**\r\n     * Manually triggers a specific unique effect when called.\r\n     */\r\n    private triggerUnique(unique: string, pos?: Vec2): void {\r\n        if (unique === \"cluster_module\") {\r\n            if (pos) {\r\n                const amount = this.utility.getRandomInt(3, 6);\r\n                const images: string[] = [];\r\n                for (let i = 0; i < amount; i++) {\r\n                    images.push(this.utility.getRandomInArray(SHRAPNEL.PIECE));\r\n                }\r\n                const shrapnel: Shrapnel = {\r\n                    amount: amount,\r\n                    damage: this.playerState.myPlayer.actions.primary.projectile.damage * 0.1,\r\n                    images: images,\r\n                    lifetime: { // ms\r\n                        min: 100,\r\n                        max: 500\r\n                    },\r\n                    pos: {\r\n                        x: pos.x,\r\n                        y: pos.y\r\n                    },\r\n                    size: { // px^2\r\n                        min: 8,\r\n                        max: 14\r\n                    },\r\n                    speed: { // px/frame*(dt)\r\n                        min: 10,\r\n                        max: 15\r\n                    },\r\n                    torque: { // deg/frame*dt\r\n                        min: -360,\r\n                        max: 360\r\n                    }\r\n                }\r\n                this.particlesManager.spawnShrapnel(shrapnel);\r\n            }\r\n        }\r\n\r\n        if (unique === \"projectile_array\") {\r\n            const amount = this.utility.getRandomInt(1, 3);\r\n            for (let i = 0; i < amount; i++) {\r\n                const dir = this.utility.getRandomDirection(360);\r\n\r\n                const params: ProjectileOverrides = {\r\n                    canTriggerUnique: false,\r\n                    damage: this.playerState.myPlayer.actions.primary.projectile.damage / 2,\r\n                    range: this.utility.getRandomNum((this.playerState.myPlayer.actions.primary.projectile.range / 2), this.playerState.myPlayer.actions.primary.projectile.range),\r\n                    spread: this.utility.getRandomNum(this.playerState.myPlayer.actions.primary.projectile.spread, (this.playerState.myPlayer.actions.primary.projectile.spread * 2))\r\n                }\r\n\r\n\r\n                this.launchProjectile(dir, params);\r\n            }\r\n        }\r\n\r\n        console.log(`Triggered Unique: ${unique}`)\r\n    }\r\n\r\n    /**\r\n     * Responsible for processing possible unique triggers on burst. (Before launchProjectile is called...)\r\n     */\r\n    private triggerBurstUniques(): string[] {\r\n        const triggered: string[] = [];\r\n\r\n        if (this.playerState.myPlayer.unique.includes('muzzle_splitter')) {\r\n            if (this.luckController.luckRoll()) {\r\n                const baseAngle = this.playerState.myPlayer.transform.rot - Math.PI / 2;\r\n                const angleOffset = 10 * (Math.PI / 180); // 10 degrees\r\n\r\n                const dirA = { x: Math.cos(baseAngle - angleOffset), y: Math.sin(baseAngle - angleOffset) };\r\n                const dirB = { x: Math.cos(baseAngle + angleOffset), y: Math.sin(baseAngle + angleOffset) };\r\n\r\n                const baseParams: ProjectileOverrides = {\r\n                    canTriggerUnique: false,\r\n                    damage: this.playerState.myPlayer.actions.primary.projectile.damage,\r\n                    range: this.playerState.myPlayer.actions.primary.projectile.range,\r\n                    size: this.playerState.myPlayer.actions.primary.projectile.size,\r\n                    speed: this.playerState.myPlayer.actions.primary.projectile.speed,\r\n                    color: this.playerState.myPlayer.actions.primary.projectile.color,\r\n                    length: this.playerState.myPlayer.actions.primary.projectile.length,\r\n                    spread: this.playerState.myPlayer.actions.primary.projectile.spread\r\n                };\r\n\r\n                this.launchProjectile(dirA, baseParams);\r\n                this.launchProjectile(dirB, baseParams);\r\n\r\n                console.log(`Triggered burst unique: muzzle_splitter`);\r\n                triggered.push('muzzle_splitter');\r\n            }\r\n        }\r\n\r\n        return triggered;\r\n    }\r\n\r\n    /**\r\n     * Responsible for checking specific uniques on collision.\r\n     */\r\n    private triggerCollisionUniques(pos?: Vec2): string[] {\r\n        if (this.playerState.myPlayer.unique.length === 0) return [];\r\n\r\n        const succeededUniques: string[] = [];\r\n\r\n        for (const unique of this.playerState.myPlayer.unique) {\r\n            if (unique === 'cluster_module') {\r\n                const succeeded = this.luckController.luckRoll();\r\n\r\n                if (succeeded) {\r\n                    this.triggerUnique(unique, pos);\r\n                    succeededUniques.push('cluster_module');\r\n                }\r\n            }\r\n        }\r\n        return succeededUniques;\r\n    }\r\n    //\r\n    // #endregion\r\n\r\n    // #region [ Reload ]\r\n    //\r\n    /**\r\n     * Checks if the player can reload or not.\r\n     */\r\n    private canReload(): boolean {\r\n        return (\r\n            !this.playerState.isReloading &&\r\n            this.playerState.myPlayer.actions.primary.magazine.currentAmmo < this.playerState.myPlayer.actions.primary.magazine.size &&\r\n            this.playerState.myPlayer.actions.primary.magazine.currentReserve > 0 && !this.playerState.isMelee\r\n        );\r\n    }\r\n\r\n    /**\r\n     * Manual trigger for reload. Called when pressing the assigned keybind.\r\n     */\r\n    public startReload(): void {\r\n        if (!this.canReload()) return;\r\n        console.log(`Reloading...`);\r\n\r\n        this.playerState.isReloading = true;\r\n        this.playerState.reloadStartTime = Date.now();\r\n\r\n        // Cancel any ongoing burst\r\n        this.playerState.isBurstActive = false;\r\n        this.playerState.currentBurstShot = 0;\r\n\r\n        this.decalsManager.spawnMagazineDecal();\r\n\r\n        this.animator.animateCharacterPart({\r\n            playerId: this.userId,\r\n            part: 'weapon',\r\n            frames: {\r\n                0: { x: 0, y: 8 } // Slide held back\r\n            },\r\n            duration: 0,\r\n            partIndex: 1\r\n        }); // duration=0 means infinite/held\r\n\r\n        this.audioManager.playAudioNetwork({\r\n            src: this.utility.getRandomInArray(this.audioConfig.resources.sfx.weapon.glock.reload.start), // TODO: Use current weapon\r\n            listener: {\r\n                x: this.playerState.myPlayer.transform.pos.x,\r\n                y: this.playerState.myPlayer.transform.pos.y\r\n            },\r\n            output: 'sfx',\r\n            pitch: { min: 0.975, max: 1.05 },\r\n            spatial: {\r\n                blend: 1.0,\r\n                pos: { x: this.playerState.myPlayer.transform.pos.x, y: this.playerState.myPlayer.transform.pos.y }\r\n            },\r\n            volume: { min: 0.985, max: 1 }\r\n        });\r\n    }\r\n\r\n    /**\r\n     * Ends the reload loop, and updates visual state.\r\n     */\r\n    private finishReload(): void {\r\n        const magazineSpace = this.playerState.myPlayer.actions.primary.magazine.size - this.playerState.myPlayer.actions.primary.magazine.currentAmmo;\r\n        const ammoToReload = Math.min(magazineSpace, this.playerState.myPlayer.actions.primary.magazine.currentReserve);\r\n\r\n        this.playerState.myPlayer.actions.primary.magazine.currentAmmo += ammoToReload;\r\n        this.playerState.myPlayer.actions.primary.magazine.currentReserve -= ammoToReload;\r\n        this.playerState.isReloading = false;\r\n\r\n        this.ui.ammoReservesUIController.removeAmmoFromReserveUI(ammoToReload);\r\n\r\n        this.animator.animateCharacterPart({\r\n            playerId: this.userId,\r\n            part: 'weapon',\r\n            frames: {\r\n                0: { x: 0, y: 20 }, // Start with slide back\r\n                1: { x: 0, y: 0 } // Return to start\r\n            },\r\n            duration: 175,\r\n            partIndex: 1\r\n        });\r\n\r\n        this.audioManager.playAudioNetwork({\r\n            src: this.utility.getRandomInArray(this.audioConfig.resources.sfx.weapon.glock.reload.end), // TODO: Use current weapon\r\n            listener: {\r\n                x: this.playerState.myPlayer.transform.pos.x,\r\n                y: this.playerState.myPlayer.transform.pos.y\r\n            },\r\n            output: 'sfx',\r\n            pitch: { min: 0.975, max: 1.05 },\r\n            spatial: {\r\n                blend: 1.0,\r\n                pos: { x: this.playerState.myPlayer.transform.pos.x, y: this.playerState.myPlayer.transform.pos.y }\r\n            },\r\n            volume: { min: 0.985, max: 1 }\r\n        });\r\n\r\n        console.log(`Reload complete...`);\r\n    }\r\n    //\r\n    // #endregion\r\n}","import { NETWORK } from \"../Config\";\r\n\r\nimport { PlayerState } from \"./PlayerState\";\r\nimport { RoomManager } from \"../RoomManager\";\r\nimport { MoveController } from \"./MoveController\";\r\nimport { StaminaController } from \"./StaminaController\";\r\nimport { CombatController } from \"./CombatController\";\r\nimport { CollisionsManager } from \"../CollisionsManager\";\r\n\r\nexport class DashController {\r\n    constructor(\r\n        private collisionsManager: CollisionsManager,\r\n        private combatController: CombatController,\r\n        private moveController: MoveController,\r\n        private playerState: PlayerState,\r\n        private roomManager: RoomManager,\r\n        private staminaController: StaminaController,\r\n        private userId: string\r\n    ) { }\r\n\r\n    // #region [ Dash ]\r\n    //\r\n    /**\r\n     * Start a dash when the assigned keybind is pressed.\r\n     */\r\n    public startDash(): void {\r\n        if (this.playerState.isDashing || !this.collisionsManager.collisionsEnabled(this.playerState.myPlayer) || !this.moveController.isMoving()) return;\r\n\r\n        const currentTime = Date.now(); // Cooldown check first\r\n        if (currentTime < this.playerState.lastDashTime + this.playerState.myPlayer.actions.dash.cooldown) {\r\n            console.log('Dash on cooldown');\r\n            return;\r\n        }\r\n\r\n        // Input check\r\n        let { inputX, inputY, inputLength } = this.moveController.getMoveInput();\r\n\r\n        // Normalize input\r\n        if (!this.moveController.isMoving()) {\r\n            console.log('No movement input for dash');\r\n            return;\r\n        }\r\n\r\n        inputX = inputX / inputLength;\r\n        inputY = inputY / inputLength;\r\n\r\n        if (!this.staminaController.requestStamina(this.playerState.myPlayer.actions.dash.drain)) {\r\n            console.log('Not enough stamina to dash');\r\n            return;\r\n        }\r\n\r\n        if (this.playerState.myPlayer.unique.includes('spectral_image')) {\r\n            // Set local state\r\n            this.playerState.myPlayer.flags.hidden = true;\r\n            this.playerState.myPlayer.flags.invulnerable = true;\r\n\r\n            // Broadcast partial update\r\n            this.roomManager.sendMessage(JSON.stringify({\r\n                type: 'partial-state',\r\n                userId: this.userId,\r\n                flags: {\r\n                    hidden: true,\r\n                    invulnerable: true\r\n                }\r\n            }));\r\n        }\r\n\r\n        // Start dash\r\n        this.playerState.isDashing = true;\r\n        this.playerState.dashStartTime = currentTime;\r\n        this.playerState.lastDashTime = currentTime;\r\n\r\n        // Set dash velocity\r\n        const dashSpeed = this.playerState.myPlayer.stats.speed * this.playerState.myPlayer.actions.dash.multiplier;\r\n        this.playerState.playerVelocityX = inputX * dashSpeed;\r\n        this.playerState.playerVelocityY = inputY * dashSpeed;\r\n\r\n        console.log(`Dashing! Speed: ${dashSpeed}`);\r\n    }\r\n\r\n    /**\r\n     * Process dash update loop when isDashing.\r\n     */\r\n    public updateDash(delta: number): void {\r\n        if (!this.playerState.isDashing) return;\r\n\r\n        const currentTime = Date.now();\r\n\r\n        let newX = this.playerState.myPlayer.transform.pos.x + this.playerState.playerVelocityX * delta;\r\n        let newY = this.playerState.myPlayer.transform.pos.y + this.playerState.playerVelocityY * delta;\r\n\r\n        this.playerState.myPlayer.transform.pos.x = newX;\r\n        this.playerState.myPlayer.transform.pos.y = newY;\r\n\r\n        let moved = (this.playerState.playerVelocityX !== 0 || this.playerState.playerVelocityY !== 0);\r\n\r\n        // Send position update if moved\r\n        const distanceFromLastSent = Math.sqrt(\r\n            (this.playerState.myPlayer.transform.pos.x - this.playerState.lastSentX) ** 2 +\r\n            (this.playerState.myPlayer.transform.pos.y - this.playerState.lastSentY) ** 2\r\n        );\r\n\r\n        if (moved && distanceFromLastSent > 2 && currentTime - this.playerState.lastSentMoveTime >= NETWORK.MOVE_INTERVAL) {\r\n            this.roomManager.sendMessage(JSON.stringify({\r\n                type: 'player-move',\r\n                transform: {\r\n                    pos: {\r\n                        x: this.playerState.myPlayer.transform.pos.x,\r\n                        y: this.playerState.myPlayer.transform.pos.y\r\n                    }\r\n                }\r\n            }));\r\n\r\n            this.playerState.lastSentX = this.playerState.myPlayer.transform.pos.x;\r\n            this.playerState.lastSentY = this.playerState.myPlayer.transform.pos.y;\r\n            this.playerState.lastSentMoveTime = currentTime;\r\n        }\r\n\r\n        // Check if dash time is over\r\n        if (currentTime >= this.playerState.dashStartTime + this.playerState.myPlayer.actions.dash.time) {\r\n            if (this.playerState.myPlayer.unique.includes('spectral_image')) {\r\n                // Revert local state\r\n                this.playerState.myPlayer.flags.hidden = false;\r\n                this.playerState.myPlayer.flags.invulnerable = false;\r\n\r\n                // Broadcast partial update\r\n                this.roomManager.sendMessage(JSON.stringify({\r\n                    type: 'partial-state',\r\n                    userId: this.userId,\r\n                    flags: {\r\n                        hidden: false,\r\n                        invulnerable: false\r\n                    }\r\n                }));\r\n            }\r\n\r\n            this.playerState.isDashing = false;\r\n\r\n            if (this.playerState.myPlayer.equipment.includes('switch')) {\r\n                this.combatController.toggleAutoFire(Date.now() + this.playerState.myPlayer.actions.dash.cooldown);\r\n            }\r\n\r\n            console.log('Dash ended');\r\n        }\r\n    }\r\n    //\r\n    // #endregion\r\n}","import { PlayerState } from \"./PlayerState\";\r\n\r\nexport class LuckController {\r\n    constructor(private playerState: PlayerState) { }\r\n\r\n    /**\r\n     * Perform a luck roll using the player's luck stat.\r\n     *\r\n     * Luck is a signed value centered around 0.\r\n     * - Uses tanh() to map luck smoothly into [-1, 1], which gives soft limits.\r\n     * - The resulting chance is 5%95%, with heavy diminishing returns past 10.\r\n     *\r\n     * Approximate success odds:\r\n     *   luck -20  ~2%\r\n     *   luck -10  ~4%\r\n     *   luck  -5  ~6%\r\n     *   luck   0  10%\r\n     *   luck  +5  17%\r\n     *   luck +10  30%\r\n     *   luck +20  45%\r\n     * \r\n     * Optionally pass a multiplier to scale luck.\r\n     */\r\n    public luckRoll(multiplier: number = 1): boolean {\r\n        const effectiveLuck = this.playerState.myPlayer.stats.luck * multiplier;\r\n        const scaledLuck = Math.tanh(effectiveLuck / 10);\r\n\r\n        const baseChance = 0.1; // 10%\r\n        const softCap = 0.35; // 35%\r\n\r\n        const chance = baseChance + scaledLuck * softCap;\r\n        return Math.random() < chance;\r\n    }\r\n}","import { ControlsManager } from \"../ControlsManager\";\r\nimport { SettingsManager } from \"../SettingsManager\";\r\n\r\nexport class MoveController {\r\n    constructor(private controlsManager: ControlsManager, private settingsManager: SettingsManager) {}\r\n\r\n    /**\r\n     * Detects and returns the Vec2 movement input from the assigned keybinds.\r\n     */\r\n    public getMoveInput(): { inputX: number; inputY: number; inputLength: number } {\r\n        let inputX = 0;\r\n        let inputY = 0;\r\n\r\n        if (this.controlsManager.getActiveKeys().has(this.settingsManager.getSettings().controls.keybinds.moveUp)) inputY -= 1;\r\n        if (this.controlsManager.getActiveKeys().has(this.settingsManager.getSettings().controls.keybinds.moveDown)) inputY += 1;\r\n        if (this.controlsManager.getActiveKeys().has(this.settingsManager.getSettings().controls.keybinds.moveLeft)) inputX -= 1;\r\n        if (this.controlsManager.getActiveKeys().has(this.settingsManager.getSettings().controls.keybinds.moveRight)) inputX += 1;\r\n\r\n        const inputLength = Math.sqrt(inputX * inputX + inputY * inputY);\r\n\r\n        if (inputLength > 0) {\r\n            inputX = inputX / inputLength;\r\n            inputY = inputY / inputLength;\r\n        }\r\n\r\n        return { inputX, inputY, inputLength };\r\n    }\r\n\r\n    /**\r\n     * Returns state based on if the player is currently moving or not.\r\n     */\r\n    public isMoving(): boolean {\r\n        return this.getMoveInput().inputLength > 0;\r\n    }\r\n}","import { OBJECT_DEFAULTS } from \"./Config\";\r\nimport { AmmoBox, GameObject, SpawnObjectParams } from \"./Types\";\r\n\r\nimport { Utility } from \"./Utility\";\r\n\r\nimport { PlayerState } from \"./player/PlayerState\";\r\n\r\nexport class ObjectsManager {\r\n    public ammoBoxes: Map<string, AmmoBox> = new Map();\r\n\r\n    constructor(private playerState: PlayerState, private utility: Utility) {}\r\n\r\n    // #region [ Objects ]\r\n    //\r\n    /**\r\n     * Spawns a GameObject in the scene, returning it's properties for the construction.\r\n     */\r\n    private spawnObject(params: SpawnObjectParams): GameObject {\r\n        const baseObject: GameObject = {\r\n            id: this.utility.generateUID(OBJECT_DEFAULTS.DATA.ID_LENGTH),\r\n            transform: params.transform,\r\n            timestamp: Date.now()\r\n        };\r\n\r\n        switch (params.type) { //TODO: Spawn the player, projectiles and any other GameObject types here\r\n            case 'AmmoBox':\r\n                return {\r\n                    id: baseObject.id,\r\n                    transform: baseObject.transform,\r\n                    timestamp: baseObject.timestamp,\r\n                    ammoAmount: params.data?.amount || 10,\r\n                    isOpen: false,\r\n                    lid: {\r\n                        pos: { x: 0, y: 0 },\r\n                        rot: 0,\r\n                        velocity: { x: 0, y: 0 },\r\n                        torque: 0\r\n                    }\r\n                } as AmmoBox;\r\n\r\n            default:\r\n                throw new Error(`Unknown object type: ${params.type}`);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Constructs an ammo box and returns the spawned object instantiated through spawnObject.\r\n     */\r\n    public spawnAmmoBox(amount: number): AmmoBox {\r\n        return this.spawnObject({\r\n            type: 'AmmoBox',\r\n            transform: {\r\n                pos: {\r\n                    x: this.playerState.myPlayer.transform.pos.x,\r\n                    y: this.playerState.myPlayer.transform.pos.y\r\n                },\r\n                rot: this.playerState.myPlayer.transform.rot\r\n            },\r\n            data: { amount }\r\n        }) as AmmoBox;\r\n    }\r\n    //\r\n    // #endregion\r\n}","import { NETWORK } from \"../Config\";\r\nimport { AudioParams, CreateParticleParams, DeathDecal, DecalParams, EmitterParams, PlayerHitParams, SetSliderParams, Vec2 } from \"../Types\";\r\n\r\nimport { LuckController } from \"./LuckController\";\r\nimport { MoveController } from \"./MoveController\";\r\nimport { PlayerState } from \"./PlayerState\";\r\n\r\nimport { AudioManager } from \"../AudioManager\";\r\nimport { DecalsManager } from \"../DecalsManager\";\r\nimport { GameState } from \"../GameState\";\r\nimport { ObjectsManager } from \"../ObjectsManager\";\r\nimport { ParticlesManager } from \"../ParticlesManager\";\r\nimport { RoomManager } from \"../RoomManager\";\r\nimport { UserInterface } from \"../UserInterface\";\r\nimport { Utility } from \"../Utility\";\r\nimport { AudioConfig } from \"../AudioConfig\";\r\n\r\n\r\nexport class PlayerController {\r\n    constructor(\r\n        private audioConfig: AudioConfig,\r\n        private audioManager: AudioManager,\r\n        private decalsManager: DecalsManager,\r\n        private gameState: GameState,\r\n        private luckController: LuckController,\r\n        private moveController: MoveController,\r\n        private objectsManager: ObjectsManager,\r\n        private particlesManager: ParticlesManager,\r\n        private playerState: PlayerState,\r\n        private roomManager: RoomManager,\r\n        private ui: UserInterface,\r\n        private userId: string,\r\n        private utility: Utility\r\n    ) {\r\n        this.setupEventListeners();\r\n    }\r\n\r\n    private setupEventListeners(): void {\r\n        window.addEventListener('customEvent_playerHitRelay', ((event: CustomEvent) => {\r\n            console.log('Player hit event received:', event.detail.params);\r\n            this.playerHit(event.detail.params);\r\n        }) as EventListener);\r\n    }\r\n\r\n    /**\r\n     * Updates the local player's position and movement state.\r\n     * \r\n     * Applies acceleration, friction, sprint multipliers, and stamina drain\r\n     * based on current movement input. Sends position updates to the server\r\n     * when movement exceeds the defined threshold or interval.\r\n     * \r\n     * Does not process updates when game is not active, player is dead, or dashing.\r\n     */\r\n    public updatePlayerPosition(delta: number): void {\r\n        if (!this.gameState.gameInProgress || this.playerState.myPlayer.stats.health.value <= 0 || this.playerState.isDashing) return;\r\n\r\n        const now = Date.now();\r\n        const { inputX, inputY } = this.moveController.getMoveInput();\r\n\r\n        // [ Sprinting ]\r\n        const canSprint = this.playerState.isSprinting && this.playerState.myPlayer.stats.stamina.value > 0 && this.moveController.isMoving();\r\n        const currentSpeed = canSprint ? this.playerState.myPlayer.stats.speed * this.playerState.myPlayer.actions.sprint.multiplier : this.playerState.myPlayer.stats.speed;\r\n        if (this.playerState.isSprinting && this.playerState.myPlayer.stats.stamina.value <= 0) { // Stop sprinting if out of stamina\r\n            this.playerState.isSprinting = false;\r\n            console.log('Out of stamina, stopped sprinting');\r\n        }\r\n        //\r\n\r\n        // CHANGED: Apply friction always, before calculating acceleration\r\n        this.playerState.playerVelocityX *= Math.pow(this.playerState.myPlayer.physics.friction, delta);\r\n        this.playerState.playerVelocityY *= Math.pow(this.playerState.myPlayer.physics.friction, delta);\r\n\r\n        // CHANGED: Only apply acceleration when there's input\r\n        if (this.moveController.isMoving()) {\r\n            const targetVelocityX = inputX * currentSpeed;\r\n            const targetVelocityY = inputY * currentSpeed;\r\n\r\n            this.playerState.playerVelocityX += (targetVelocityX - this.playerState.playerVelocityX) * this.playerState.myPlayer.physics.acceleration * delta;\r\n            this.playerState.playerVelocityY += (targetVelocityY - this.playerState.playerVelocityY) * this.playerState.myPlayer.physics.acceleration * delta;\r\n        }\r\n\r\n        let newX = this.playerState.myPlayer.transform.pos.x + this.playerState.playerVelocityX * delta;\r\n        let newY = this.playerState.myPlayer.transform.pos.y + this.playerState.playerVelocityY * delta;\r\n\r\n        this.playerState.myPlayer.transform.pos.x = newX;\r\n        this.playerState.myPlayer.transform.pos.y = newY;\r\n\r\n        let moved = (this.playerState.playerVelocityX !== 0 || this.playerState.playerVelocityY !== 0);\r\n\r\n        const distanceFromLastSent = Math.sqrt(\r\n            (this.playerState.myPlayer.transform.pos.x - this.playerState.lastSentX) ** 2 +\r\n            (this.playerState.myPlayer.transform.pos.y - this.playerState.lastSentY) ** 2\r\n        );\r\n\r\n        if (moved && distanceFromLastSent > 2 && now - this.playerState.lastSentMoveTime >= NETWORK.MOVE_INTERVAL) {\r\n            this.roomManager.sendMessage(JSON.stringify({\r\n                type: 'player-move',\r\n                transform: {\r\n                    pos: {\r\n                        x: this.playerState.myPlayer.transform.pos.x,\r\n                        y: this.playerState.myPlayer.transform.pos.y\r\n                    }\r\n                }\r\n            }));\r\n\r\n            this.playerState.lastSentX = this.playerState.myPlayer.transform.pos.x;\r\n            this.playerState.lastSentY = this.playerState.myPlayer.transform.pos.y;\r\n            this.playerState.lastSentMoveTime = now;\r\n        }\r\n\r\n        if (Math.abs(this.playerState.playerVelocityX) < 0.01) this.playerState.playerVelocityX = 0;\r\n        if (Math.abs(this.playerState.playerVelocityY) < 0.01) this.playerState.playerVelocityY = 0;\r\n    }\r\n\r\n    /**\r\n     * Processes local hits to players. Sends network message for syncing.\r\n     */\r\n    public playerHit(params: PlayerHitParams): void {\r\n        // Update health slider\r\n        const sliderLerpTime = 300; //TODO: Define UI lerping times globally\r\n        const healthSliderParams: SetSliderParams = {\r\n            sliderId: 'healthBar',\r\n            targetValue: this.playerState.myPlayer.stats.health.value,\r\n            maxValue: this.playerState.myPlayer.stats.health.max,\r\n            lerpTime: sliderLerpTime\r\n        }\r\n        this.utility.setSlider(healthSliderParams);\r\n\r\n        if (params.target.id === this.userId) { // Random chance to play grunt when I'm hit\r\n            if (this.utility.getRandomNum(0, 1) < 0.2) { // 20%\r\n                const gruntParams: AudioParams = {\r\n                    src: this.utility.getRandomInArray(this.audioConfig.resources.sfx.player.male.grunt), // TODO: Allow player to define gender\r\n                    listener: {\r\n                        x: this.playerState.myPlayer.transform.pos.x,\r\n                        y: this.playerState.myPlayer.transform.pos.y\r\n                    },\r\n                    output: 'voice',\r\n                    pitch: { min: 0.95, max: 1.075 },\r\n                    spatial: {\r\n                        blend: 1.0,\r\n                        pos: { x: this.playerState.myPlayer.transform.pos.x, y: this.playerState.myPlayer.transform.pos.y }\r\n                    },\r\n                    volume: { min: 0.9, max: 1 }\r\n                }\r\n                this.audioManager.playAudioNetwork(gruntParams);\r\n            }\r\n        } else { // The player hit was not me\r\n            const sfxParams: AudioParams = {\r\n                src: this.utility.getRandomInArray(this.audioConfig.resources.sfx.impact.flesh.bullet), // TODO: User current body material\r\n                listener: {\r\n                    x: this.playerState.myPlayer.transform.pos.x,\r\n                    y: this.playerState.myPlayer.transform.pos.y\r\n                },\r\n                output: 'sfx',\r\n                pitch: { min: 0.925, max: 1.15 },\r\n                spatial: {\r\n                    blend: 1.0,\r\n                    pos: { x: params.source.transform.pos.x, y: params.source.transform.pos.y }\r\n                },\r\n                volume: { min: 0.95, max: 1 }\r\n            }\r\n            this.audioManager.playAudioNetwork(sfxParams);\r\n\r\n            const decalParams: DecalParams = {\r\n                id: `blood_${params.source.id}`,\r\n                pos: {\r\n                    x: params.source.transform.pos.x,\r\n                    y: params.source.transform.pos.y\r\n                },\r\n                type: 'parametric',\r\n                parametric: this.decalsManager.decalsConfig.decals.blood // TODO: Get current blood type\r\n            };\r\n            this.decalsManager.createDecal(decalParams);\r\n\r\n            const bloodDirection: Vec2 = {\r\n                x: -params.source.velocity.x / Math.sqrt(params.source.velocity.x ** 2 + params.source.velocity.y ** 2),\r\n                y: -params.source.velocity.y / Math.sqrt(params.source.velocity.x ** 2 + params.source.velocity.y ** 2)\r\n            };\r\n\r\n            const particleParams: CreateParticleParams = {\r\n                id: `blood_${params.source.id}`,\r\n                pos: {\r\n                    x: params.source.transform.pos.x,\r\n                    y: params.source.transform.pos.y\r\n                },\r\n                particleParams: this.particlesManager.particlesConfig.particles.blood.spray, // TODO: Get current blood type\r\n                direction: bloodDirection\r\n            }\r\n            this.particlesManager.createParticles(particleParams);\r\n\r\n            const emission: EmitterParams = {\r\n                id: `particle_emitter_${params.target.id}_${Date.now()}`,\r\n                interval: this.utility.getRandomNum(200, 400), // ms\r\n                lifetime: this.utility.getRandomNum(1000, 3000), // ms\r\n                offset: {\r\n                    x: params.target.transform.pos.x,\r\n                    y: params.target.transform.pos.y\r\n                },\r\n                particleType: this.particlesManager.particlesConfig.particles.blood.drip, // TODO: Get current blood type\r\n                playerId: params.target.id,\r\n                pos: {\r\n                    x: params.source.transform.pos.x,\r\n                    y: params.source.transform.pos.y\r\n                }\r\n            };\r\n            this.particlesManager.createEmitter(emission);\r\n\r\n            if (params.newHealth <= 0) { // If they died, I get a kill\r\n                console.log(`I killed ${params.target.id}!`);\r\n\r\n                const me = this.ui.leaderboard.get(this.userId);\r\n                if (me) { me.kills++; }\r\n\r\n                const other = this.ui.leaderboard.get(params.target.id);\r\n                if (other) { other.deaths++; }\r\n\r\n                this.ui.updateLeaderboardDisplay(this.userId);\r\n            }\r\n        }\r\n\r\n        const message = {\r\n            type: 'player-hit',\r\n            targetId: params.target.id,\r\n            shooterId: params.shooterId,\r\n            damage: params.damage,\r\n            newHealth: params.newHealth,\r\n            projectileId: params.source.id,\r\n            wasKill: params.wasKill\r\n        }\r\n        this.roomManager.sendMessage(JSON.stringify(message));\r\n    }\r\n\r\n    /**\r\n     * Record the player's own death when they are the targetId of a player-hit message and their health reaches 0.\r\n     */\r\n    public playerDeath(): void {\r\n        const triggeredUniques = this.triggerUniques();\r\n\r\n        console.log('I died! Waiting for round to end...');\r\n\r\n        this.playerState.resetPlayerState();\r\n\r\n        const ammoBox = this.objectsManager.spawnAmmoBox(10);\r\n        this.objectsManager.ammoBoxes.set(ammoBox.id, ammoBox);\r\n\r\n        const gore: DeathDecal = {\r\n            gore: {\r\n                amount: this.utility.getRandomInt(2, 5)\r\n            },\r\n            blood: {\r\n                amount: this.utility.getRandomInt(1, 3)\r\n            },\r\n            ownerId: this.userId,\r\n            pos: {\r\n                x: this.playerState.myPlayer.transform.pos.x,\r\n                y: this.playerState.myPlayer.transform.pos.y\r\n            },\r\n            radius: this.playerState.myPlayer.stats.size\r\n        }\r\n        this.particlesManager.generateGore(gore);\r\n\r\n        this.roomManager.sendMessage(JSON.stringify({\r\n            type: 'player-death',\r\n            playerId: this.userId,\r\n            x: this.playerState.myPlayer.transform.pos.x,\r\n            y: this.playerState.myPlayer.transform.pos.y,\r\n            size: this.playerState.myPlayer.stats.size,\r\n            ammoBox: ammoBox\r\n        }));\r\n    }\r\n\r\n    /**\r\n     * Used to trigger player related uniques during specific states like death, etc.\r\n     * \r\n     * Returns each unique that succeeds.\r\n     */\r\n    private triggerUniques(): string[] {\r\n        if (this.playerState.myPlayer.unique.length === 0) return [];\r\n\r\n        const succeededUniques: string[] = [];\r\n\r\n        for (const unique of this.playerState.myPlayer.unique) {\r\n            if (unique === 'phoenix_module') {\r\n                const succeeded = this.luckController.luckRoll(1.5);\r\n\r\n                if (succeeded) {\r\n                    console.log('Phoenix Module activated!');\r\n\r\n                    // Double damage permanently\r\n                    this.playerState.myPlayer.actions.primary.projectile.damage *= 2;\r\n\r\n                    // Remove phoenix module so it can't trigger again\r\n                    const index = this.playerState.myPlayer.unique.indexOf('phoenix_module');\r\n                    if (index > -1) {\r\n                        this.playerState.myPlayer.unique.splice(index, 1);\r\n                    }\r\n\r\n                    succeededUniques.push('phoenix_module');\r\n                }\r\n            }\r\n        }\r\n        return succeededUniques;\r\n    }\r\n}","import { WORLD } from \"../Config\";\r\n\r\nimport { Player, Players } from \"../Types\";\r\nimport { Utility } from \"../Utility\";\r\nimport { PlayerConfig } from \"./PlayerConfig\";\r\n\r\nexport class PlayerState {\r\n    public myPlayer: Player; // My player object\r\n    public players: Players = new Map(); // Other players in game\r\n\r\n    public isHost = false;\r\n\r\n    public canShoot = true;\r\n    public canAutoFire = false;\r\n    public isBurstActive = false;\r\n    public isReloading = false;\r\n    public isMelee = false;\r\n    public isSprinting = false;\r\n    public isDashing = false;\r\n    public isStaminaRecoveryBlocked = false;\r\n\r\n    public lastSentX = 0;\r\n    public lastSentY = 0;\r\n    public lastSentRotation = 0;\r\n    public lastSentRotationTime = 0;\r\n    public lastSentMoveTime = 0;\r\n\r\n    public playerVelocityX = 0;\r\n    public playerVelocityY = 0;\r\n\r\n    public dashStartTime = 0;\r\n    public lastDashTime = 0;\r\n    public reloadStartTime = 0;\r\n    public lastShotTime = 0;\r\n    public lastMeleeTime = 0;\r\n    public nextBurstShotTime = 0;\r\n    public currentBurstShot = 0;\r\n    public lastStaminaDrainTime = 0;\r\n    public staminaRecoveryBlockedUntil = 0;\r\n\r\n    private statListeners: Map<string, (value: any) => void> = new Map();\r\n\r\n    constructor(private playerConfig: PlayerConfig, private userId: string, private utility: Utility) {\r\n        this.myPlayer = this.initPlayer(this.userId);\r\n    }\r\n\r\n    // #region [ State ]\r\n    //\r\n    // [ IMPORTANT ] Keep full track of Player object here\r\n    /**\r\n     * Initializes the default player object using the playerConfig.\r\n     */\r\n    public initPlayer(userId: string): Player {\r\n        return this.myPlayer = {\r\n            id: userId,\r\n            transform: {\r\n                pos: {\r\n                    x: Math.random() * (WORLD.WIDTH - WORLD.BORDER_MARGIN * 2) + WORLD.BORDER_MARGIN,\r\n                    y: Math.random() * (WORLD.HEIGHT - WORLD.BORDER_MARGIN * 2) + WORLD.BORDER_MARGIN\r\n                },\r\n                rot: 0\r\n            },\r\n            timestamp: Date.now(),\r\n            color: this.utility.getRandomColor(), // TODO: Replace with char customization\r\n            actions: {\r\n                dash: {\r\n                    cooldown: this.playerConfig.default.actions.dash.cooldown,\r\n                    drain: this.playerConfig.default.actions.dash.drain,\r\n                    multiplier: this.playerConfig.default.actions.dash.multiplier,\r\n                    time: this.playerConfig.default.actions.dash.time\r\n                },\r\n                melee: {\r\n                    cooldown: this.playerConfig.default.actions.melee.cooldown,\r\n                    damage: this.playerConfig.default.actions.melee.damage,\r\n                    duration: this.playerConfig.default.actions.melee.duration,\r\n                    range: this.playerConfig.default.actions.melee.range,\r\n                    size: this.playerConfig.default.actions.melee.size\r\n                },\r\n                primary: {\r\n                    buffer: this.playerConfig.default.actions.primary.buffer,\r\n                    burst: {\r\n                        amount: this.playerConfig.default.actions.primary.burst.amount,\r\n                        delay: this.playerConfig.default.actions.primary.burst.delay\r\n                    },\r\n                    magazine: {\r\n                        currentAmmo: this.playerConfig.default.actions.primary.magazine.size,\r\n                        currentReserve: this.playerConfig.default.actions.primary.magazine.startingReserve,\r\n                        maxReserve: this.playerConfig.default.actions.primary.magazine.maxReserve,\r\n                        size: this.playerConfig.default.actions.primary.magazine.size\r\n                    },\r\n                    offset: this.playerConfig.default.actions.primary.offset,\r\n                    projectile: {\r\n                        amount: this.playerConfig.default.actions.primary.projectile.amount,\r\n                        color: this.playerConfig.default.actions.primary.projectile.color,\r\n                        damage: this.playerConfig.default.actions.primary.projectile.damage,\r\n                        length: this.playerConfig.default.actions.primary.projectile.length,\r\n                        range: this.playerConfig.default.actions.primary.projectile.range,\r\n                        size: this.playerConfig.default.actions.primary.projectile.size,\r\n                        speed: this.playerConfig.default.actions.primary.projectile.speed,\r\n                        spread: this.playerConfig.default.actions.primary.projectile.spread\r\n                    },\r\n                    reload: {\r\n                        time: this.playerConfig.default.actions.primary.reload.time\r\n                    }\r\n                },\r\n                sprint: {\r\n                    drain: this.playerConfig.default.actions.sprint.drain,\r\n                    multiplier: this.playerConfig.default.actions.sprint.multiplier\r\n                }\r\n            },\r\n            equipment: this.playerConfig.default.equipment,\r\n            flags: {\r\n                hidden: this.playerConfig.default.flags.hidden,\r\n                invulnerable: this.playerConfig.default.flags.invulnerable\r\n            },\r\n            inventory: {\r\n                primary: this.playerConfig.default.inventory.primary,\r\n                melee: this.playerConfig.default.inventory.melee\r\n            },\r\n            physics: {\r\n                acceleration: this.playerConfig.default.physics.acceleration,\r\n                friction: this.playerConfig.default.physics.friction\r\n            },\r\n            rig: {\r\n                body: this.playerConfig.default.rig.body,\r\n                head: this.playerConfig.default.rig.head,\r\n                headwear: this.playerConfig.default.rig.headwear,\r\n                weapon: this.playerConfig.default.rig.weapon\r\n            },\r\n            stats: {\r\n                defense: this.playerConfig.default.stats.defense,\r\n                health: {\r\n                    max: this.playerConfig.default.stats.health.max,\r\n                    value: this.playerConfig.default.stats.health.max,\r\n                },\r\n                luck: this.playerConfig.default.stats.luck,\r\n                size: this.playerConfig.default.stats.size,\r\n                speed: this.playerConfig.default.stats.speed,\r\n                stamina: {\r\n                    max: this.playerConfig.default.stats.stamina.max,\r\n                    recovery: {\r\n                        delay: this.playerConfig.default.stats.stamina.recovery.delay,\r\n                        rate: this.playerConfig.default.stats.stamina.recovery.rate\r\n                    },\r\n                    value: this.playerConfig.default.stats.stamina.max,\r\n                },\r\n            },\r\n            unique: this.playerConfig.default.unique\r\n        };\r\n    }\r\n\r\n    /**\r\n     * Resets the current player state stored in memory to default.\r\n     */\r\n    public resetPlayerState(): void {\r\n        this.canShoot = true;\r\n        this.isBurstActive = false;\r\n        this.isReloading = false;\r\n        this.isMelee = false;\r\n        this.isSprinting = false;\r\n        this.isDashing = false;\r\n        this.isStaminaRecoveryBlocked = false;\r\n\r\n        this.playerVelocityX = 0;\r\n        this.playerVelocityY = 0;\r\n\r\n        this.dashStartTime = 0;\r\n        this.lastDashTime = 0;\r\n        this.reloadStartTime = 0;\r\n        this.lastMeleeTime = 0;\r\n        this.lastShotTime = 0;\r\n        this.nextBurstShotTime = 0;\r\n        this.currentBurstShot = 0;\r\n        this.lastStaminaDrainTime = 0;\r\n        this.staminaRecoveryBlockedUntil = 0;\r\n\r\n        this.lastSentX = 0;\r\n        this.lastSentY = 0;\r\n        this.lastSentRotation = 0;\r\n        this.lastSentRotationTime = 0;\r\n        this.lastSentMoveTime = 0;\r\n    }\r\n    //\r\n    // #endregion\r\n\r\n    // #region [ Events ]\r\n    //\r\n\r\n    /**\r\n     * Event callback for when stats change, informing all stat listeners.\r\n     */\r\n    public onStatChange(statPath: string, callback: (value: any) => void): void {\r\n        this.statListeners.set(statPath, callback);\r\n    }\r\n\r\n    /**\r\n     * Routing process to notify each listener that is subscribed to a stat change.\r\n     */\r\n    private notifyChange(statPath: string, value: any): void {\r\n        const listener = this.statListeners.get(statPath);\r\n        if (listener) {\r\n            listener(value);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Directly updates the stat, triggering an 'onStatChange' event for all listeners.\r\n     */\r\n    public updateStat(statPath: string, value: any): void {\r\n        // Navigate to the property and set it\r\n        const pathParts = statPath.split('.');\r\n        let obj: any = this.myPlayer;\r\n\r\n        for (let i = 0; i < pathParts.length - 1; i++) {\r\n            obj = obj[pathParts[i]];\r\n        }\r\n\r\n        const lastProp = pathParts[pathParts.length - 1];\r\n        obj[lastProp] = value;\r\n\r\n        console.log(`${lastProp}: ${value}`);\r\n\r\n        // Notify listeners\r\n        this.notifyChange(statPath, value);\r\n    }\r\n    //\r\n    // #endregion\r\n}","import { PlayerState } from \"./PlayerState\";\r\n\r\nexport class StaminaController {\r\n    constructor(private playerState: PlayerState) { }\r\n\r\n    // #region [ Stamina ]\r\n    //\r\n    /**\r\n     * Requests stamina from my pool for actions that require it.\r\n     * \r\n     * If there is enough, drain the needed stamina and return true.\r\n     */\r\n    public requestStamina(amount: number): boolean {\r\n        if (this.playerState.myPlayer.stats.stamina.value < amount) {\r\n            console.log(`Insufficient stamina! Need: ${amount}, Have: ${this.playerState.myPlayer.stats.stamina}`);\r\n            return false;\r\n        }\r\n\r\n        this.playerState.myPlayer.stats.stamina.value -= amount;\r\n\r\n        // Block stamina recovery for the delay period\r\n        this.playerState.isStaminaRecoveryBlocked = true;\r\n        this.playerState.staminaRecoveryBlockedUntil = Date.now() + this.playerState.myPlayer.stats.stamina.recovery.delay;\r\n\r\n        console.log(`Stamina drained: -${amount}, Remaining: ${this.playerState.myPlayer.stats.stamina}`);\r\n        return true;\r\n    }\r\n\r\n    /**\r\n     * Process stamina requests and recovery.\r\n     */\r\n    public updateStamina(delta: number): void {\r\n        const currentTime = Date.now();\r\n\r\n        // Handle sprint stamina drain (every second while sprinting)\r\n        if (this.playerState.isSprinting && currentTime >= this.playerState.lastStaminaDrainTime + 100) {\r\n            if (!this.requestStamina(this.playerState.myPlayer.actions.sprint.drain)) {\r\n                // Out of stamina, stop sprinting\r\n                this.playerState.isSprinting = false;\r\n                console.log('Out of stamina, stopped sprinting');\r\n            }\r\n            this.playerState.lastStaminaDrainTime = currentTime;\r\n        }\r\n\r\n        // Handle stamina recovery\r\n        if (!this.playerState.isStaminaRecoveryBlocked || currentTime >= this.playerState.staminaRecoveryBlockedUntil) {\r\n            this.playerState.isStaminaRecoveryBlocked = false;\r\n\r\n            // Recover stamina if not at max and not sprinting\r\n            if (this.playerState.myPlayer.stats.stamina.value < this.playerState.myPlayer.stats.stamina.max && !this.playerState.isSprinting) {\r\n                const staminaRecoveryPerFrame = (this.playerState.myPlayer.stats.stamina.recovery.rate / 1000) * 16.67 * delta;\r\n                this.playerState.myPlayer.stats.stamina.value = Math.min(this.playerState.myPlayer.stats.stamina.max, this.playerState.myPlayer.stats.stamina.value + staminaRecoveryPerFrame);\r\n            }\r\n        }\r\n    }\r\n    //\r\n    // #endregion\r\n}","export class PlayerConfig {\r\n    public default = {\r\n        actions: {\r\n            dash: {\r\n                cooldown: 1000, // ms\r\n                drain: 40, // per dash\r\n                multiplier: 3,\r\n                time: 150 // ms\r\n            },\r\n            melee: {\r\n                cooldown: 250, // ms\r\n                damage: 10,\r\n                duration: 100, // ms\r\n                range: 10, // px\r\n                size: 2, // px^2 area at tip\r\n            },\r\n            primary: {\r\n                buffer: 250, // ms\r\n                burst: {\r\n                    amount: 1,\r\n                    delay: 75 // ms\r\n                },\r\n                magazine: {\r\n                    size: 10,\r\n                    startingReserve: 20,\r\n                    maxReserve: 50\r\n                },\r\n                offset: 10, // px\r\n                projectile: {\r\n                    amount: 1,\r\n                    color: '#fff5beff',\r\n                    damage: 25,\r\n                    length: 15,\r\n                    range: 5,\r\n                    size: 1,\r\n                    speed: 35,\r\n                    spread: 10\r\n                },\r\n                reload: {\r\n                    time: 750 // ms\r\n                }\r\n            },\r\n            sprint: {\r\n                drain: 5, // per ms\r\n                multiplier: 1.75\r\n            },\r\n        },\r\n        data: {\r\n            idLength: 12,\r\n            idOffset: 25\r\n        },\r\n        equipment: [],\r\n        flags: {\r\n            hidden: false,\r\n            invulnerable: false\r\n        },\r\n        inventory: {\r\n            primary: 'glock',\r\n            melee: 'knife'\r\n        },\r\n        physics: {\r\n            acceleration: 0.65,\r\n            friction: 0.8\r\n        },\r\n        rig: {\r\n            body: 'default',\r\n            head: 'default',\r\n            headwear: 'default',\r\n            weapon: 'glock'\r\n        },\r\n        stats: {\r\n            defense: 0,\r\n            health: {\r\n                max: 100\r\n            },\r\n            luck: 1,\r\n            size: 100, // px^2\r\n            speed: 6,\r\n            stamina: {\r\n                max: 100,\r\n                recovery: {\r\n                    delay: 1000,\r\n                    rate: 25\r\n                }\r\n            }\r\n        },\r\n        unique: []\r\n    };\r\n\r\n    constructor() { }\r\n}","export class AudioConfig {\r\n    public mixer = {\r\n        master: 1.0,\r\n        interface: 0.85,\r\n        music: 0.75,\r\n        sfx: 0.9,\r\n        voice: 1.0\r\n    }\r\n\r\n    public resources = {\r\n        sfx: {\r\n            impact: {\r\n                flesh: {\r\n                    bullet: [\r\n                        '/assets/audio/sfx/impact/flesh/bullet/impact_flesh_bullet_00.ogg',\r\n                        '/assets/audio/sfx/impact/flesh/bullet/impact_flesh_bullet_01.ogg',\r\n                        '/assets/audio/sfx/impact/flesh/bullet/impact_flesh_bullet_02.ogg',\r\n                        '/assets/audio/sfx/impact/flesh/bullet/impact_flesh_bullet_03.ogg',\r\n                        '/assets/audio/sfx/impact/flesh/bullet/impact_flesh_bullet_04.ogg',\r\n                        '/assets/audio/sfx/impact/flesh/bullet/impact_flesh_bullet_05.ogg'\r\n                    ]\r\n                },\r\n                metal: {\r\n                    bullet: [\r\n                        '/assets/audio/sfx/impact/metal/bullet/impact_metal_bullet_00.ogg',\r\n                        '/assets/audio/sfx/impact/metal/bullet/impact_metal_bullet_01.ogg',\r\n                        '/assets/audio/sfx/impact/metal/bullet/impact_metal_bullet_02.ogg',\r\n                        '/assets/audio/sfx/impact/metal/bullet/impact_metal_bullet_03.ogg',\r\n                        '/assets/audio/sfx/impact/metal/bullet/impact_metal_bullet_04.ogg'\r\n                    ]\r\n                }\r\n            },\r\n            player: {\r\n                male: {\r\n                    grunt: [\r\n                        '/assets/audio/sfx/player/voice/male/player_male_hit_00.ogg',\r\n                        '/assets/audio/sfx/player/voice/male/player_male_hit_01.ogg',\r\n                        '/assets/audio/sfx/player/voice/male/player_male_hit_02.ogg',\r\n                        '/assets/audio/sfx/player/voice/male/player_male_hit_03.ogg',\r\n                        '/assets/audio/sfx/player/voice/male/player_male_hit_04.ogg',\r\n                        '/assets/audio/sfx/player/voice/male/player_male_hit_05.ogg',\r\n                        '/assets/audio/sfx/player/voice/male/player_male_hit_06.ogg',\r\n                        '/assets/audio/sfx/player/voice/male/player_male_hit_07.ogg',\r\n                        '/assets/audio/sfx/player/voice/male/player_male_hit_08.ogg',\r\n                        '/assets/audio/sfx/player/voice/male/player_male_hit_09.ogg'\r\n                    ]\r\n                },\r\n                // female: {\r\n                //     grunt: [\r\n\r\n                //     ]\r\n                // }\r\n            },\r\n            weapon: {\r\n                glock: {\r\n                    attack: [\r\n                        '/assets/audio/sfx/weapons/glock/glock_attack_00.ogg',\r\n                        '/assets/audio/sfx/weapons/glock/glock_attack_01.ogg',\r\n                        '/assets/audio/sfx/weapons/glock/glock_attack_02.ogg',\r\n                        '/assets/audio/sfx/weapons/glock/glock_attack_03.ogg',\r\n                        '/assets/audio/sfx/weapons/glock/glock_attack_04.ogg',\r\n                        '/assets/audio/sfx/weapons/glock/glock_attack_05.ogg'\r\n                    ],\r\n                    empty: [\r\n                        '/assets/audio/sfx/weapons/glock/glock_empty_00.ogg'\r\n                    ],\r\n                    reload: {\r\n                        end: [\r\n                            '/assets/audio/sfx/weapons/glock/glock_reload_end_00.ogg',\r\n                            '/assets/audio/sfx/weapons/glock/glock_reload_end_01.ogg',\r\n                            '/assets/audio/sfx/weapons/glock/glock_reload_end_02.ogg',\r\n                            '/assets/audio/sfx/weapons/glock/glock_reload_end_03.ogg'\r\n\r\n                        ],\r\n                        start: [\r\n                            '/assets/audio/sfx/weapons/glock/glock_reload_start_00.ogg',\r\n                            '/assets/audio/sfx/weapons/glock/glock_reload_start_01.ogg',\r\n                            '/assets/audio/sfx/weapons/glock/glock_reload_start_02.ogg',\r\n                            '/assets/audio/sfx/weapons/glock/glock_reload_start_03.ogg'\r\n                        ]\r\n                    },\r\n                    shell: [\r\n                        '/assets/audio/sfx/weapons/glock/glock_shell_00.ogg',\r\n                        '/assets/audio/sfx/weapons/glock/glock_shell_01.ogg',\r\n                        '/assets/audio/sfx/weapons/glock/glock_shell_02.ogg',\r\n                        '/assets/audio/sfx/weapons/glock/glock_shell_03.ogg',\r\n                        '/assets/audio/sfx/weapons/glock/glock_shell_04.ogg',\r\n                        '/assets/audio/sfx/weapons/glock/glock_shell_05.ogg',\r\n                        '/assets/audio/sfx/weapons/glock/glock_shell_06.ogg',\r\n                        '/assets/audio/sfx/weapons/glock/glock_shell_07.ogg',\r\n                        '/assets/audio/sfx/weapons/glock/glock_shell_08.ogg',\r\n                        '/assets/audio/sfx/weapons/glock/glock_shell_09.ogg',\r\n                        '/assets/audio/sfx/weapons/glock/glock_shell_10.ogg',\r\n                        '/assets/audio/sfx/weapons/glock/glock_shell_11.ogg',\r\n                        '/assets/audio/sfx/weapons/glock/glock_shell_12.ogg',\r\n                        '/assets/audio/sfx/weapons/glock/glock_shell_13.ogg',\r\n                        '/assets/audio/sfx/weapons/glock/glock_shell_14.ogg'\r\n                    ],\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    public settings = {\r\n        maxConcurrent: 5, // Max simultaneous instances of same sound\r\n        poolSize: 10, // Number of Audio objects per sound\r\n        preloadSounds: true // Toggle sound resource preloading on start\r\n    }\r\n\r\n    constructor() { }\r\n}","import { CANVAS, WORLD } from \"./Config\";\r\nimport { Vec2 } from \"./Types\";\r\n\r\nimport { PlayerState } from \"./player/PlayerState\";\r\nimport { Utility } from \"./Utility\";\r\n\r\nexport class Camera {\r\n    public pos: Vec2 = { x: 0, y: 0 }\r\n    public targetPos: Vec2 = { x: 0, y: 0 }\r\n\r\n    public config = {\r\n        followSpeed: 0.1,\r\n        lookAhead: 100 // Forward pixel offset based on player rotation\r\n    }\r\n\r\n    constructor(\r\n        private playerState: PlayerState,\r\n        private utility: Utility\r\n    ) { }\r\n\r\n    /**\r\n     * Processes camera updates during gameplay.\r\n     */\r\n    public update(delta: number): void {\r\n        // Get player's forward direction and convert rotation to direction\r\n        const playerRot = this.playerState.myPlayer.transform.rot - Math.PI / 2;\r\n        const forwardDir = this.utility.forward(playerRot);\r\n\r\n        // Calculate look-ahead offset\r\n        const offsetX = forwardDir.x * this.config.lookAhead;\r\n        const offsetY = forwardDir.y * this.config.lookAhead;\r\n\r\n        // Set camera target to follow player with directional offset\r\n        this.targetPos.x = (this.playerState.myPlayer.transform.pos.x + offsetX) - CANVAS.WIDTH / 2;\r\n        this.targetPos.y = (this.playerState.myPlayer.transform.pos.y + offsetY) - CANVAS.HEIGHT / 2;\r\n\r\n        // Constrain camera to world bounds\r\n        this.targetPos.x = Math.max(0, Math.min(WORLD.WIDTH - CANVAS.WIDTH, this.targetPos.x));\r\n        this.targetPos.y = Math.max(0, Math.min(WORLD.HEIGHT - CANVAS.HEIGHT, this.targetPos.y));\r\n\r\n        // Smooth camera movement\r\n        this.pos.x += (this.targetPos.x - this.pos.x) * this.config.followSpeed * delta;\r\n        this.pos.y += (this.targetPos.y - this.pos.y) * this.config.followSpeed * delta;\r\n    }\r\n\r\n    /**\r\n     * Convert world coordinates to screen coordinates.\r\n     */\r\n    public worldToScreen(worldPos: Vec2): Vec2 {\r\n        return {\r\n            x: worldPos.x - this.pos.x,\r\n            y: worldPos.y - this.pos.y\r\n        };\r\n    }\r\n\r\n    /**\r\n     * Convert screen coordinates to world coordinates.\r\n     */\r\n    public screenToWorld(screenPos: Vec2): Vec2 {\r\n        return {\r\n            x: screenPos.x + this.pos.x,\r\n            y: screenPos.y + this.pos.y\r\n        };\r\n    }\r\n\r\n    /**\r\n     * Check if world position is visible on screen.\r\n     */\r\n    public isVisible(worldPos: Vec2, margin: number = 50): boolean {\r\n        return worldPos.x >= this.pos.x - margin &&\r\n            worldPos.x <= this.pos.x + CANVAS.WIDTH + margin &&\r\n            worldPos.y >= this.pos.y - margin &&\r\n            worldPos.y <= this.pos.y + CANVAS.HEIGHT + margin;\r\n    }\r\n}","import { Vec2 } from \"../Types\";\r\nimport { WorldConfig } from \"./WorldConfig\";\r\n\r\nexport class WorldChunk {\r\n    // Store version/pos/size for runtime chunk updates\r\n    public version: number = 0;\r\n    public pos: Vec2 = { x: 0, y: 0 };\r\n    public size: number = 0;\r\n    \r\n    public pixelData: Uint8Array; // (MaterialIndex << 2) | ColorVariantIndex\r\n    public heightData: Uint8Array; // Baked height per pixel in [0..255] (0=low, 255=high)\r\n    public waterData: Uint8Array;\r\n    public chosenBiomeName: string;\r\n\r\n    private worldConfig: WorldConfig;\r\n\r\n    constructor(\r\n        biomeName: string,\r\n        sourcePixels: Uint8Array,\r\n        sourceHeights: Uint8Array,\r\n        sourceWater: Uint8Array,\r\n        worldConfig: WorldConfig\r\n    ) {\r\n        this.pixelData = sourcePixels;\r\n        this.heightData = sourceHeights;\r\n        this.waterData = sourceWater;\r\n        this.chosenBiomeName = biomeName;\r\n        this.worldConfig = worldConfig;\r\n    }\r\n\r\n    /**\r\n     * Returns the specific color of a pixel within a chunk.\r\n     */\r\n    public getColorAt(localX: number, localY: number, chunkSize: number): string {\r\n        const index = localY * chunkSize + localX;\r\n        const combinedIndex = this.pixelData[index];\r\n\r\n        const materialIndex = combinedIndex >> 2;\r\n        const colorVariantIndex = combinedIndex & 0b11;\r\n        const material = Object.values(this.worldConfig.materials)[materialIndex];\r\n\r\n        return material.colors[colorVariantIndex];\r\n    }\r\n\r\n    /**\r\n     * Returns the height for a specific pixel within a chunk.\r\n     */\r\n    public getHeightAt(localX: number, localY: number, chunkSize: number): number {\r\n        const index = localY * chunkSize + localX;\r\n\r\n        return this.heightData[index] / 255;\r\n    }\r\n\r\n    /** \r\n     * Returns amount of water for a pixel in a specific chunk.\r\n     */\r\n    public getWaterAt(localX: number, localY: number, chunkSize: number): number {\r\n        const index = localY * chunkSize + localX;\r\n\r\n        return this.waterData[index] / 255;\r\n    }\r\n}","import { Material, WorldLayer, PhysicsMaterialTypes, NoiseType, WorldParams } from \"../Types\";\r\n\r\nexport class WorldConfig {\r\n    public worldgenParams: WorldParams = {\r\n        general: {\r\n            chunk: { size: 128 },\r\n            cell: { size: 2 },\r\n            options: { island: false, valley: false, },\r\n            seed: 0\r\n        },\r\n        terrain: {\r\n            noiseType: NoiseType.Perlin,\r\n            intensity: 2,\r\n            octaves: 6.0,\r\n            scale: 0.0005,\r\n            persistence: 0.55,\r\n            heightCurve: 1.5,\r\n            seaLevel: 0.18,\r\n            lowestDepth: 0.1\r\n        },\r\n        material: {\r\n            noiseType: NoiseType.Perlin,\r\n            scale: 0.005,\r\n            detail: {\r\n                noiseType: NoiseType.Perlin,\r\n                scale: 1.0,\r\n            },\r\n            colorVariation: 0.75\r\n        },\r\n        degen: {\r\n            noiseType: NoiseType.Perlin,\r\n            scale: 0.0001,\r\n            intensity: 0.35,\r\n            minHeight: 0.1,\r\n            threshold: 0.55,\r\n            hardness: 0.5,\r\n            detail: {\r\n                noiseType: NoiseType.Perlin,\r\n                scale: 0.005\r\n            }\r\n        },\r\n        hydration: {\r\n            noiseType: NoiseType.Perlin,\r\n            intensity: 0.5,\r\n            scale: 0.001,\r\n            multiplier: 1\r\n        },\r\n        render: {\r\n            water: {\r\n                opacityBase: 0.55,\r\n                opacityMultiplier: 0.975,\r\n                foamIntensity: 1.0,\r\n                foamScale: 0.035,\r\n                noiseScale: 0.001,\r\n                shoreBlend: 0.0275,\r\n                shimmerStrength: 0.15,\r\n                depthDarkness: 1\r\n            },\r\n            grid: {\r\n                enabled: false,\r\n                lineWidth: 1,\r\n                chunkBorderColor: \"#a1a1a1\",\r\n                worldBorderColor: \"#9747ff\",\r\n                layerBorderColor: \"#ff4343\",\r\n                borderWidth: 3\r\n            }\r\n        }\r\n    };\r\n\r\n    public worldLayers: Record<string, WorldLayer> = {\r\n        // NAME KEY MUST MATCH OBJECT LITERAL !IMPORTANT\r\n        // MUST BE ORDERED BY HEIGHT [0..1]\r\n\r\n        foundation: {\r\n            name: \"foundation\",\r\n            height: 0.05,\r\n            materials: [\r\n                { material: \"bedrock\", weight: 10, blend: 0.1 },\r\n                { material: \"granite\", weight: 6, blend: 0.2 },\r\n                { material: \"basalt\", weight: 3, blend: 0.2 }\r\n            ]\r\n        },\r\n        substrate: {\r\n            name: \"substrate\",\r\n            height: 0.07,\r\n            materials: [\r\n                { material: \"granite\", weight: 6, blend: 0.3 },\r\n                { material: \"limestone\", weight: 4, blend: 0.5 },\r\n                { material: \"shale\", weight: 3, blend: 0.4 },\r\n                { material: \"slate\", weight: 2, blend: 0.4 }\r\n            ]\r\n        },\r\n        sediment: {\r\n            name: \"sediment\",\r\n            height: 0.12,\r\n            materials: [\r\n                { material: \"silt\", weight: 4, blend: 0.9 },\r\n                { material: \"sand\", weight: 5, blend: 0.9 },\r\n                { material: \"gravel\", weight: 2, blend: 0.6 },\r\n                { material: \"dirt\", weight: 1, blend: 0.4 }\r\n            ]\r\n        },\r\n        alluvium: {\r\n            name: \"alluvium\",\r\n            height: 0.18,\r\n            materials: [\r\n                { material: \"silt\", weight: 3, blend: 0.95 },\r\n                { material: \"sand\", weight: 6, blend: 0.9 },\r\n                { material: \"gravel\", weight: 3, blend: 0.6 },\r\n                { material: \"stone\", weight: 1, blend: 0.2 }\r\n            ]\r\n        },\r\n        soil: {\r\n            name: \"soil\",\r\n            height: 0.3,\r\n            materials: [\r\n                { material: \"grass\", weight: 7, blend: 0.8 },\r\n                { material: \"dirt\", weight: 2, blend: 0.6 },\r\n                { material: \"gravel\", weight: 2, blend: 0.7 },\r\n                { material: \"stone\", weight: 1, blend: 0.3 }\r\n            ]\r\n        },\r\n        topsoil: {\r\n            name: \"topsoil\",\r\n            height: 0.45,\r\n            materials: [\r\n                { material: \"grass\", weight: 7, blend: 0.8 },\r\n                { material: \"dirt\", weight: 2, blend: 0.6 },\r\n                { material: \"gravel\", weight: 1, blend: 0.4 }\r\n            ]\r\n        },\r\n        cliffs: {\r\n            name: \"cliffs\",\r\n            height: 0.7,\r\n            materials: [\r\n                { material: \"stone\", weight: 6, blend: 0.3 },\r\n                { material: \"gravel\", weight: 3, blend: 0.5 },\r\n                { material: \"dirt\", weight: 1, blend: 0.6 },\r\n                { material: \"snow\", weight: 1, blend: 0.8 },\r\n            ]\r\n        },\r\n        mountains: {\r\n            name: \"mountains\",\r\n            height: 0.9,\r\n            materials: [\r\n                { material: \"stone\", weight: 2, blend: 0.3 },\r\n                { material: \"gravel\", weight: 1, blend: 0.4 },\r\n                { material: \"snow\", weight: 4, blend: 0.8 },\r\n                { material: \"ice\", weight: 3, blend: 0.9 }\r\n            ]\r\n        }\r\n    };\r\n\r\n    public materials: Record<string, Material> = {\r\n        // NAME KEY MUST MATCH OBJECT LITERAL !IMPORTANT\r\n\r\n        // TEMPLATE\r\n        // name: { // Name key and name string must match (case-sensitive)\r\n        //     name: \"\", type: \"terrain\",\r\n        //     colors: [],\r\n        //     physics: {\r\n        //         type: PhysicsMaterialTypes.Solid,\r\n        //         simulate: ,\r\n        //         durability: ,\r\n        //         friction: ,\r\n        //         density: \r\n        //     }\r\n        // },\r\n\r\n        // TERRAIN\r\n        basalt: {\r\n            name: \"basalt\", type: \"terrain\",\r\n            colors: [\"#2e2e2e\", \"#3e3e3e\", \"#4e4e4e\", \"#5e5e5e\"],\r\n            physics: {\r\n                type: PhysicsMaterialTypes.Solid,\r\n                simulate: false,\r\n                durability: 0.8,\r\n                friction: 0.88,\r\n                density: 0.88\r\n            }\r\n        },\r\n        bedrock: {\r\n            name: \"bedrock\", type: \"terrain\",\r\n            colors: [\"#2f3236\", \"#3a3e44\", \"#454a52\", \"#50565f\"],\r\n            physics: {\r\n                type: PhysicsMaterialTypes.Solid,\r\n                simulate: false,\r\n                durability: 1,\r\n                friction: 0.9,\r\n                density: 0.95\r\n            }\r\n        },\r\n        clay: {\r\n            name: \"clay\", type: \"terrain\",\r\n            colors: [\"#6f5a4a\", \"#7c6755\", \"#897461\", \"#96816e\"],\r\n            physics: {\r\n                type: PhysicsMaterialTypes.Solid,\r\n                simulate: false,\r\n                durability: 0.2,\r\n                friction: 0.75,\r\n                density: 0.4\r\n            }\r\n        },\r\n        dirt: {\r\n            name: \"dirt\", type: \"terrain\",\r\n            colors: [\"#5b3a1f\", \"#6b4a2f\", \"#7b5a3f\", \"#8b6a4f\"],\r\n            physics: {\r\n                type: PhysicsMaterialTypes.Solid,\r\n                simulate: false,\r\n                durability: 0.2,\r\n                friction: 0.8,\r\n                density: 0.5\r\n            }\r\n        },\r\n        granite: {\r\n            name: \"granite\", type: \"terrain\",\r\n            colors: [\"#6e6e6e\", \"#7e7e7e\", \"#8e8e8e\", \"#9e9e9e\"],\r\n            physics: {\r\n                type: PhysicsMaterialTypes.Solid,\r\n                simulate: false,\r\n                durability: 0.9,\r\n                friction: 0.9,\r\n                density: 0.9\r\n            }\r\n        },\r\n        grass: {\r\n            name: \"grass\", type: \"terrain\",\r\n            colors: [\"#3a5f3e\", \"#4a6f4e\", \"#5a7f5e\", \"#6a8f6e\"],\r\n            physics: {\r\n                type: PhysicsMaterialTypes.Solid,\r\n                simulate: false,\r\n                durability: 0.2,\r\n                friction: 0.8,\r\n                density: 0.5\r\n            }\r\n        },\r\n        gravel: {\r\n            name: \"gravel\", type: \"terrain\",\r\n            colors: [\"#606060\", \"#707070\", \"#808080\", \"#909090\"],\r\n            physics: {\r\n                type: PhysicsMaterialTypes.Solid,\r\n                simulate: true,\r\n                durability: 0.1,\r\n                friction: 0.6,\r\n                density: 0.3\r\n            }\r\n        },\r\n        ice: {\r\n            name: \"ice\", type: \"terrain\",\r\n            colors: [\"#a9d5ff\", \"#8fc5ff\", \"#6fb5ff\", \"#5aa4f2\"],\r\n            physics: {\r\n                type: PhysicsMaterialTypes.Solid,\r\n                simulate: false,\r\n                durability: 0.3,\r\n                friction: 0.4,\r\n                density: 0.5\r\n            }\r\n        },\r\n        permafrost: {\r\n            name: \"permafrost\", type: \"terrain\",\r\n            colors: [\"#a4b5ef\", \"#7aabeb\", \"#9bc6f5\", \"#7d92f9\"],\r\n            physics: {\r\n                type: PhysicsMaterialTypes.Solid,\r\n                simulate: false,\r\n                durability: 0.7,\r\n                friction: 0.85,\r\n                density: 0.8\r\n            }\r\n        },\r\n        loam: {\r\n            name: \"loam\", type: \"terrain\",\r\n            colors: [\"#2d1f12\", \"#3a2918\", \"#4a361f\", \"#5a4328\"],\r\n            physics: {\r\n                type: PhysicsMaterialTypes.Solid,\r\n                simulate: false,\r\n                durability: 0.2,\r\n                friction: 0.8,\r\n                density: 0.55\r\n            }\r\n        },\r\n        limestone: {\r\n            name: \"limestone\", type: \"terrain\",\r\n            colors: [\"#c0b8a0\", \"#b0a890\", \"#a09880\", \"#908870\"],\r\n            physics: {\r\n                type: PhysicsMaterialTypes.Solid,\r\n                simulate: false,\r\n                durability: 0.5,\r\n                friction: 0.8,\r\n                density: 0.7\r\n            }\r\n        },\r\n        moss: {\r\n            name: \"moss\", type: \"terrain\",\r\n            colors: [\"#264a2f\", \"#2f5a3a\", \"#376a45\", \"#3f7a50\"],\r\n            physics: {\r\n                type: PhysicsMaterialTypes.Solid,\r\n                simulate: false,\r\n                durability: 0.1,\r\n                friction: 0.8,\r\n                density: 0.4\r\n            }\r\n        },\r\n        peat: {\r\n            name: \"peat\", type: \"terrain\",\r\n            colors: [\"#1a150f\", \"#241e16\", \"#2e271e\", \"#383024\"],\r\n            physics: {\r\n                type: PhysicsMaterialTypes.Solid,\r\n                simulate: false,\r\n                durability: 0.1,\r\n                friction: 0.6,\r\n                density: 0.3\r\n            }\r\n        },\r\n        sand: {\r\n            name: \"sand\", type: \"terrain\",\r\n            colors: [\"#b2a280\", \"#c2b290\", \"#d2c2a0\", \"#e2d2b0\"],\r\n            physics: {\r\n                type: PhysicsMaterialTypes.Solid,\r\n                simulate: true,\r\n                durability: 0.1,\r\n                friction: 0.6,\r\n                density: 0.2\r\n            }\r\n        },\r\n        sandstone: {\r\n            name: \"sandstone\", type: \"terrain\",\r\n            colors: [\"#c2b290\", \"#b2a280\", \"#a29270\", \"#928260\"],\r\n            physics: {\r\n                type: PhysicsMaterialTypes.Solid,\r\n                simulate: false,\r\n                durability: 0.4,\r\n                friction: 0.75,\r\n                density: 0.65\r\n            }\r\n        },\r\n        scree: {\r\n            name: \"scree\", type: \"terrain\",\r\n            colors: [\"#868680\", \"#8f8f88\", \"#999990\", \"#a3a399\"],\r\n            physics: {\r\n                type: PhysicsMaterialTypes.Solid,\r\n                simulate: false,\r\n                durability: 0.4,\r\n                friction: 0.75,\r\n                density: 0.65\r\n            }\r\n        },\r\n        shale: {\r\n            name: \"shale\", type: \"terrain\",\r\n            colors: [\"#4f555d\", \"#5a616a\", \"#656d77\", \"#707a85\"],\r\n            physics: {\r\n                type: PhysicsMaterialTypes.Solid,\r\n                simulate: false,\r\n                durability: 0.4,\r\n                friction: 0.75,\r\n                density: 0.7\r\n            }\r\n        },\r\n        silt: {\r\n            name: \"silt\", type: \"terrain\",\r\n            colors: [\"#7a7362\", \"#777165\", \"#6b6965\", \"#6d6755\"],\r\n            physics: {\r\n                type: PhysicsMaterialTypes.Solid,\r\n                simulate: true,\r\n                durability: 0.1,\r\n                friction: 0.5,\r\n                density: 0.3\r\n            }\r\n        },\r\n        slate: {\r\n            name: \"slate\", type: \"terrain\",\r\n            colors: [\"#4a4f55\", \"#555a60\", \"#60656b\", \"#6b7076\"],\r\n            physics: {\r\n                type: PhysicsMaterialTypes.Solid,\r\n                simulate: false,\r\n                durability: 0.6,\r\n                friction: 0.82,\r\n                density: 0.75\r\n            }\r\n        },\r\n        snow: {\r\n            name: \"snow\", type: \"terrain\",\r\n            colors: [\"#ffffff\", \"#e6eef5\", \"#dfe8f2\", \"#cfdceb\"],\r\n            physics: {\r\n                type: PhysicsMaterialTypes.Solid,\r\n                simulate: false,\r\n                durability: 0.2,\r\n                friction: 0.9,\r\n                density: 0.4\r\n            }\r\n        },\r\n        stone: {\r\n            name: \"stone\", type: \"terrain\",\r\n            colors: [\"#707070\", \"#808080\", \"#909090\", \"#a0a0a0\"],\r\n            physics: {\r\n                type: PhysicsMaterialTypes.Solid,\r\n                simulate: false,\r\n                durability: 0.5,\r\n                friction: 0.85,\r\n                density: 0.75\r\n            }\r\n        },\r\n\r\n        // MINERAL\r\n        coal: {\r\n            name: \"coal\", type: \"mineral\",\r\n            colors: [\"#0a0a0a\", \"#1a1a1a\", \"#2a2a2a\", \"#3a3a3a\"],\r\n            physics: {\r\n                type: PhysicsMaterialTypes.Solid,\r\n                simulate: false,\r\n                durability: 0.6,\r\n                friction: 0.85,\r\n                density: 0.55\r\n            }\r\n        },\r\n        iron: {\r\n            name: \"iron\", type: \"mineral\",\r\n            colors: [\"#7b3716\", \"#8b4726\", \"#9b5736\", \"#ab6746\"],\r\n            physics: {\r\n                type: PhysicsMaterialTypes.Solid,\r\n                simulate: false,\r\n                durability: 0.7,\r\n                friction: 0.85,\r\n                density: 0.9\r\n            }\r\n        },\r\n        gold: {\r\n            name: \"gold\", type: \"mineral\",\r\n            colors: [\"#eec700\", \"#fed700\", \"#ffe700\", \"#fff74c\"],\r\n            physics: {\r\n                type: PhysicsMaterialTypes.Solid,\r\n                simulate: false,\r\n                durability: 0.8,\r\n                friction: 0.85,\r\n                density: 0.8\r\n            }\r\n        },\r\n        silver: {\r\n            name: \"silver\", type: \"mineral\",\r\n            colors: [\"#b0b0b0\", \"#c0c0c0\", \"#d0d0d0\", \"#e0e0e0\"],\r\n            physics: {\r\n                type: PhysicsMaterialTypes.Solid,\r\n                simulate: false,\r\n                durability: 0.7,\r\n                friction: 0.85,\r\n                density: 0.75\r\n            }\r\n        },\r\n        copper: {\r\n            name: \"copper\", type: \"mineral\",\r\n            colors: [\"#a86323\", \"#b87333\", \"#c88343\", \"#d89353\"],\r\n            physics: {\r\n                type: PhysicsMaterialTypes.Solid,\r\n                simulate: false,\r\n                durability: 0.6,\r\n                friction: 0.85,\r\n                density: 0.7\r\n            }\r\n        },\r\n\r\n        // SURFACE\r\n        wood: {\r\n            name: \"wood\", type: \"surface\",\r\n            colors: [\"#7b3503\", \"#8b4513\", \"#9b5523\", \"#ab6533\"],\r\n            physics: {\r\n                type: PhysicsMaterialTypes.Solid,\r\n                simulate: false,\r\n                durability: 0.4,\r\n                friction: 0.85,\r\n                density: 0.5\r\n            }\r\n        },\r\n        concrete: {\r\n            name: \"concrete\", type: \"surface\",\r\n            colors: [\"#2a2a2a\", \"#3a3a3a\", \"#4a4a4a\", \"#5a5a5a\"],\r\n            physics: {\r\n                type: PhysicsMaterialTypes.Solid,\r\n                simulate: false,\r\n                durability: 0.8,\r\n                friction: 0.85,\r\n                density: 0.65\r\n            }\r\n        },\r\n        metal: {\r\n            name: \"metal\", type: \"surface\",\r\n            colors: [\"#4a4a4a\", \"#6a6a6a\", \"#7a7a7a\", \"#8a8a8a\"],\r\n            physics: {\r\n                type: PhysicsMaterialTypes.Solid,\r\n                simulate: false,\r\n                durability: 0.9,\r\n                friction: 0.85,\r\n                density: 0.8\r\n            }\r\n        },\r\n        asphalt: {\r\n            name: \"asphalt\", type: \"surface\",\r\n            colors: [\"#1b1b1b\", \"#2b2b2b\", \"#3b3b3b\", \"#4b4b4b\"],\r\n            physics: {\r\n                type: PhysicsMaterialTypes.Solid,\r\n                simulate: false,\r\n                durability: 0.8,\r\n                friction: 0.85,\r\n                density: 0.7\r\n            }\r\n        },\r\n\r\n        // LIQUIDS\r\n        water: {\r\n            name: \"water\", type: \"liquid\",\r\n            colors: [\"#2d6bc9\", \"#2450a6\", \"#1f3f8a\", \"#1a2f6e\"],\r\n            physics: {\r\n                type: PhysicsMaterialTypes.Liquid,\r\n                simulate: true,\r\n                viscosity: 0.2\r\n            }\r\n        }\r\n    };\r\n\r\n    constructor() { }\r\n}\r\n\r\n// 1761802917695 1761883681927 1761926328530","import { CANVAS, WORLD } from \"../Config\";\r\n\r\nimport { Camera } from \"../Camera\";\r\nimport { ControlsManager } from \"../ControlsManager\";\r\nimport { UserInterface } from \"../UserInterface\";\r\nimport { World } from \"./World\";\r\nimport { PhysicsMaterialTypes } from \"../Types\";\r\nimport { Utility } from \"../Utility\";\r\n\r\nexport class WorldDebug {\r\n    public hoveredChunk: string | null = null;\r\n\r\n    private overlayMode: number = 0; // 0 = chunks/borders, 1 = heightmap, 2 = contours\r\n    private overlayNames: string[] = [\"Grid\", \"Heightmap\", \"Contours\"];\r\n\r\n    constructor(\r\n        private camera: Camera,\r\n        private controlsManager: ControlsManager,\r\n        private ui: UserInterface,\r\n        private utility: Utility,\r\n        private world: World\r\n    ) {\r\n        this.listenForDebugShortcuts();\r\n    }\r\n\r\n    /**\r\n     * Sets up event listeners for debug shortcut keys. (Hold CTRL + ALT + Keybind)\r\n     * \r\n     * Overlay: Numpad Enter | [ ] < -- Brackets switch debug overlay pages.\r\n     * \r\n     * Regen World: Numpad 0 | ReRender: Numpad . \r\n     */\r\n    private listenForDebugShortcuts(): void {\r\n        window.addEventListener(\"keydown\", e => {\r\n            if (e.ctrlKey && e.altKey) {\r\n                switch (e.code) {\r\n                    case \"Numpad0\":\r\n                        e.preventDefault();\r\n                        console.log(\"Opening generation menu...\");\r\n                        this.world.showGenerationMenu()\r\n                            .then(async (worldData) => {\r\n                                await this.world.generateWorld(worldData);\r\n                            });\r\n                        break;\r\n\r\n                    case \"NumpadDecimal\":\r\n                        e.preventDefault();\r\n                        console.log(\"Refreshing world rendering...\");\r\n                        this.world.renderMenu();\r\n                        break;\r\n\r\n                    case \"NumpadEnter\":\r\n                        e.preventDefault();\r\n                        this.world.worldConfig.worldgenParams.render.grid.enabled =\r\n                            !this.world.worldConfig.worldgenParams.render.grid.enabled;\r\n                        if (!this.world.worldConfig.worldgenParams.render.grid.enabled) this.hoveredChunk = null;\r\n                        console.log(\"Overlay \" + (this.world.worldConfig.worldgenParams.render.grid.enabled ? \"enabled\" : \"disabled\") +\r\n                            \" (mode: \" + this.overlayNames[this.overlayMode] + \")\");\r\n                        break;\r\n\r\n                    default:\r\n                        break;\r\n                }\r\n            }\r\n\r\n            if (this.world.worldConfig.worldgenParams.render.grid.enabled && e.ctrlKey && e.altKey) { // Debug page cycling\r\n                if (e.key === \"[\" || e.code === \"BracketLeft\") {\r\n                    e.preventDefault();\r\n                    this.overlayMode = (this.overlayMode - 1 + this.overlayNames.length) % this.overlayNames.length;\r\n                    console.log(\"Overlay mode: \" + this.overlayNames[this.overlayMode]);\r\n                }\r\n                if (e.key === \"]\" || e.code === \"BracketRight\") {\r\n                    e.preventDefault();\r\n                    this.overlayMode = (this.overlayMode + 1) % this.overlayNames.length;\r\n                    console.log(\"Overlay mode: \" + this.overlayNames[this.overlayMode]);\r\n                }\r\n            }\r\n        });\r\n    }\r\n\r\n\r\n    /**\r\n     * General entrypoint for different world debug overlays.\r\n     */\r\n    public drawDebug(): void {\r\n        if (!this.ui.ctx || !this.world.isGenerated) return;\r\n\r\n        // Draw terrain overlays if enabled\r\n        if (this.world.worldConfig.worldgenParams.render.grid.enabled) {\r\n            switch (this.overlayMode) {\r\n                case 0: this.drawGrid(); break;\r\n                case 1: this.drawHeightmap(); break;\r\n                case 2: this.drawContours(); break;\r\n            }\r\n            this.drawInfoPanels();\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Draws fixed info panels at the top of the screen\r\n     */\r\n    private drawInfoPanels(): void {\r\n        const hoveredCoords = this.world.updateHoveredChunk();\r\n        if (!hoveredCoords || !this.hoveredChunk) return;\r\n\r\n        const chunkSize = this.world.worldConfig.worldgenParams.general.chunk.size;\r\n        const [hcx, hcy] = this.hoveredChunk.split(\",\").map(Number);\r\n\r\n        const worldX = Math.floor(hoveredCoords.worldX);\r\n        const worldY = Math.floor(hoveredCoords.worldY);\r\n        const worldPos = { x: worldX, y: worldY }\r\n\r\n        const key = `${hcx},${hcy}`;\r\n        const chunk = this.world.chunks.get(key);\r\n        const chunkLayer = this.world.chunkLayers.get(key);\r\n\r\n        if (!chunk) return;\r\n\r\n        const localX = worldX - hcx * chunkSize;\r\n        const localY = worldY - hcy * chunkSize;\r\n        const li = localY * chunkSize + localX;\r\n\r\n        const combined = chunk.pixelData[li];\r\n        const materialIndex = combined >> 2;\r\n        const colorVariantIndex = combined & 0b11;\r\n        const height01 = chunk.getHeightAt(localX, localY, chunkSize);\r\n\r\n        const mat = Object.values(this.world.worldConfig.materials)[materialIndex];\r\n        const waterData = this.world.getWaterData(worldPos);\r\n\r\n        const margin = 10;\r\n        let currentX = margin;\r\n\r\n        // Draw main panel\r\n        const mainInfo = [\r\n            `Layer: ${chunkLayer ? chunkLayer.name : \"N/A\"}`,\r\n            `Chunk: ${hcx}, ${hcy} (${chunkSize}x${chunkSize})`,\r\n            `Pixel: ${worldX}, ${worldY}`,\r\n            `Height: ${height01.toFixed(3)}`\r\n        ];\r\n        currentX += this.drawPanel(\"Main\", mainInfo, currentX, 10, '#888888', null) + margin;\r\n\r\n        // Solid material (terrain)\r\n        if (mat && mat.physics.type === PhysicsMaterialTypes.Solid) {\r\n            const materialColor = this.utility.getLightestColor(mat.colors);\r\n            const solidInfo = [\r\n                `Material: ${mat.name} [${materialIndex}]`,\r\n                `Type: ${mat.type}`,\r\n                `Color Var: ${colorVariantIndex}`,\r\n                `Simulate: ${mat.physics.simulate}`,\r\n                `Durability: ${mat.physics.durability.toFixed(2)}`,\r\n                `Friction: ${mat.physics.friction.toFixed(2)}`,\r\n                `Density: ${mat.physics.density.toFixed(2)}`\r\n            ];\r\n            currentX += this.drawPanel(\"Solid\", solidInfo, currentX, 10, materialColor, materialColor) + margin;\r\n        }\r\n\r\n        // Liquid (water)\r\n        if (waterData && waterData.hasWater) {\r\n            const phys = waterData.material.physics;\r\n\r\n            if (phys.type === PhysicsMaterialTypes.Liquid) {\r\n                const materialColor = this.utility.getLightestColor(waterData.material.colors);\r\n                const liquidInfo = [\r\n                    `Material: ${waterData.material.name}`,\r\n                    `Depth: ${waterData.depth.toFixed(3)}`,\r\n                    `Simulate: ${phys.simulate}`,\r\n                    `Viscosity: ${phys.viscosity.toFixed(2)}`\r\n                ];\r\n                currentX += this.drawPanel(\"Liquid\", liquidInfo, currentX, 10, materialColor, materialColor) + margin;\r\n            }\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Draws a single info panel and returns its width\r\n     */\r\n    private drawPanel(title: string, lines: string[], x: number, y: number, color: string, titleBgColor: string | null): number {\r\n        const ctx = this.ui.ctx;\r\n        if (!ctx) return 0;\r\n\r\n        const padding = 8;\r\n        const lineHeight = 14;\r\n        const headerHeight = 20;\r\n        const titleMargin = 4; // Space between title and content\r\n\r\n        ctx.font = \"11px monospace\";\r\n        ctx.textAlign = \"left\";\r\n\r\n        let maxWidth = ctx.measureText(title).width;\r\n        lines.forEach(line => {\r\n            maxWidth = Math.max(maxWidth, ctx.measureText(line).width);\r\n        });\r\n\r\n        const boxWidth = maxWidth + padding * 2;\r\n        const boxHeight = headerHeight + titleMargin + lines.length * lineHeight + padding;\r\n\r\n        // Background\r\n        ctx.fillStyle = \"rgba(0, 0, 0, 0.85)\";\r\n        ctx.fillRect(x, y, boxWidth, boxHeight);\r\n\r\n        // Border\r\n        ctx.strokeStyle = color;\r\n        ctx.lineWidth = 2;\r\n        ctx.strokeRect(x, y, boxWidth, boxHeight);\r\n\r\n        // Header with background color\r\n        if (titleBgColor) {\r\n            ctx.fillStyle = titleBgColor;\r\n            ctx.fillRect(x, y, boxWidth, headerHeight);\r\n        }\r\n\r\n        // Title text\r\n        ctx.font = \"bold 12px monospace\";\r\n        ctx.fillStyle = titleBgColor ? \"#000000\" : color; // Black text if has bg, colored if not\r\n        ctx.fillText(title, x + padding, y + padding + 10);\r\n\r\n        // Content\r\n        ctx.fillStyle = titleBgColor ? color : \"#ffffff\"; // Use material color for content if material panel\r\n        ctx.font = \"11px monospace\";\r\n        lines.forEach((line, i) => {\r\n            ctx.fillText(line, x + padding, y + headerHeight + titleMargin + padding + i * lineHeight);\r\n        });\r\n\r\n        return boxWidth;\r\n    }\r\n\r\n    /**\r\n     * Renders chunk borders with layer highlights\r\n     */\r\n    private drawGrid(): void {\r\n        if (!this.ui.ctx || !this.world.isGenerated) return;\r\n\r\n        const ctx = this.ui.ctx;\r\n        const chunkSize = this.world.worldConfig.worldgenParams.general.chunk.size;\r\n        const camX = this.camera.pos.x, camY = this.camera.pos.y;\r\n\r\n        const startCX = Math.floor(camX / chunkSize);\r\n        const endCX = Math.ceil((camX + CANVAS.WIDTH) / chunkSize);\r\n        const startCY = Math.floor(camY / chunkSize);\r\n        const endCY = Math.ceil((camY + CANVAS.HEIGHT) / chunkSize);\r\n\r\n        ctx.save();\r\n\r\n        // Highlight hovered chunk\r\n        if (this.hoveredChunk) {\r\n            const [hcx, hcy] = this.hoveredChunk.split(\",\").map(Number);\r\n            const hoveredChunkWorldX = hcx * chunkSize;\r\n            const hoveredChunkWorldY = hcy * chunkSize;\r\n            const hoveredScreenX = hoveredChunkWorldX - camX;\r\n            const hoveredScreenY = hoveredChunkWorldY - camY;\r\n\r\n            const hex = this.world.worldConfig.worldgenParams.render.grid.chunkBorderColor.slice(1);\r\n            const r = parseInt(hex.slice(0, 2), 16);\r\n            const g = parseInt(hex.slice(2, 4), 16);\r\n            const b = parseInt(hex.slice(4, 6), 16);\r\n            ctx.fillStyle = `rgba(${r}, ${g}, ${b}, 0.2)`;\r\n            ctx.fillRect(hoveredScreenX, hoveredScreenY, chunkSize, chunkSize);\r\n        }\r\n\r\n        // Draw chunk borders\r\n        for (let cx = startCX; cx < endCX; cx++) {\r\n            for (let cy = startCY; cy < endCY; cy++) {\r\n                const worldX = cx * chunkSize;\r\n                const worldY = cy * chunkSize;\r\n                const screenX = worldX - camX;\r\n                const screenY = worldY - camY;\r\n\r\n                const currentLayer = this.world.getChunkLayer(cx, cy);\r\n                const layerRight = this.world.getChunkLayer(cx + 1, cy) || currentLayer;\r\n                const layerBottom = this.world.getChunkLayer(cx, cy + 1) || currentLayer;\r\n\r\n                const vBorder = !!(currentLayer && layerRight && currentLayer.name !== layerRight.name);\r\n                const hBorder = !!(currentLayer && layerBottom && currentLayer.name !== layerBottom.name);\r\n\r\n                // Right edge\r\n                ctx.beginPath();\r\n                ctx.moveTo(screenX + chunkSize, screenY);\r\n                ctx.lineTo(screenX + chunkSize, screenY + chunkSize);\r\n                ctx.lineWidth = vBorder ? this.world.worldConfig.worldgenParams.render.grid.borderWidth : this.world.worldConfig.worldgenParams.render.grid.lineWidth;\r\n                ctx.strokeStyle = vBorder ? this.world.worldConfig.worldgenParams.render.grid.layerBorderColor : this.world.worldConfig.worldgenParams.render.grid.chunkBorderColor;\r\n                ctx.stroke();\r\n\r\n                // Bottom edge\r\n                ctx.beginPath();\r\n                ctx.moveTo(screenX, screenY + chunkSize);\r\n                ctx.lineTo(screenX + chunkSize, screenY + chunkSize);\r\n                ctx.lineWidth = hBorder ? this.world.worldConfig.worldgenParams.render.grid.borderWidth : this.world.worldConfig.worldgenParams.render.grid.lineWidth;\r\n                ctx.strokeStyle = hBorder ? this.world.worldConfig.worldgenParams.render.grid.layerBorderColor : this.world.worldConfig.worldgenParams.render.grid.chunkBorderColor;\r\n                ctx.stroke();\r\n            }\r\n        }\r\n\r\n        // World bounds\r\n        ctx.strokeStyle = this.world.worldConfig.worldgenParams.render.grid.worldBorderColor;\r\n        ctx.lineWidth = this.world.worldConfig.worldgenParams.render.grid.borderWidth;\r\n        ctx.strokeRect(0 - camX, 0 - camY, WORLD.WIDTH, WORLD.HEIGHT);\r\n\r\n        ctx.restore();\r\n    }\r\n\r\n    /**\r\n     * Draws a heightmap debug view.\r\n     * \r\n     * Heightmap ranges from blue > green > red > white.\r\n     */\r\n    private drawHeightmap(): void {\r\n        const ctx = this.ui.ctx;\r\n        if (!ctx || !this.world.isGenerated) return;\r\n\r\n        const camX = this.camera.pos.x;\r\n        const camY = this.camera.pos.y;\r\n        const chunkSize = this.world.worldConfig.worldgenParams.general.chunk.size;\r\n        const resolution = 4;\r\n        const alpha = 0.6;\r\n\r\n        const { seaLevel, lowestDepth } = this.world.worldConfig.worldgenParams.terrain;\r\n        const layers = this.world.worldConfig.worldLayers;\r\n\r\n        ctx.save();\r\n        ctx.globalAlpha = alpha;\r\n\r\n        const startCX = Math.floor(camX / chunkSize);\r\n        const endCX = Math.ceil((camX + CANVAS.WIDTH) / chunkSize);\r\n        const startCY = Math.floor(camY / chunkSize);\r\n        const endCY = Math.ceil((camY + CANVAS.HEIGHT) / chunkSize);\r\n\r\n        const lerpColor = (a: [number, number, number], b: [number, number, number], t: number): [number, number, number] => [\r\n            Math.floor(this.utility.lerp(a[0], b[0], t)),\r\n            Math.floor(this.utility.lerp(a[1], b[1], t)),\r\n            Math.floor(this.utility.lerp(a[2], b[2], t)),\r\n        ];\r\n\r\n        const stops: [number, [number, number, number]][] = [];\r\n        const shoreBlend = 0.05;\r\n\r\n        stops.push([lowestDepth, [0, 0, 90]]);\r\n        stops.push([seaLevel * 0.5, [0, 60, 170]]);\r\n        stops.push([seaLevel - shoreBlend, [0, 120, 220]]);\r\n        stops.push([seaLevel + shoreBlend, [0, 200, 140]]);\r\n\r\n        for (const layer of Object.values(layers)) {\r\n            const h = layer.height;\r\n\r\n            if (h <= seaLevel) continue;\r\n\r\n            const t = Object.keys(layers).indexOf(layer.name) / (Object.keys(layers).length - 1);\r\n            let color: [number, number, number];\r\n\r\n            if (t < 0.25) color = [60, 220, 80];\r\n            else if (t < 0.5) color = [230, 230, 60];\r\n            else if (t < 0.75) color = [240, 140, 50];\r\n            else if (t < 0.95) color = [255, 70, 40];\r\n            else color = [255, 255, 255];\r\n\r\n            stops.push([h, color]);\r\n        }\r\n\r\n        stops.sort((a, b) => a[0] - b[0]);\r\n\r\n        for (let cx = startCX; cx < endCX; cx++) {\r\n            for (let cy = startCY; cy < endCY; cy++) {\r\n                const key = `${cx},${cy}`;\r\n                const chunk = this.world.chunks.get(key);\r\n                if (!chunk) continue;\r\n\r\n                const startX = cx * chunkSize - camX;\r\n                const startY = cy * chunkSize - camY;\r\n\r\n                for (let y = 0; y < chunkSize; y += resolution) {\r\n                    for (let x = 0; x < chunkSize; x += resolution) {\r\n                        const h = chunk.getHeightAt(x, y, chunkSize);\r\n\r\n                        let lower = stops[0];\r\n                        let upper = stops[stops.length - 1];\r\n                        for (let i = 0; i < stops.length - 1; i++) {\r\n                            if (h >= stops[i][0] && h <= stops[i + 1][0]) {\r\n                                lower = stops[i];\r\n                                upper = stops[i + 1];\r\n                                break;\r\n                            }\r\n                        }\r\n\r\n                        const range = upper[0] - lower[0];\r\n                        let t = range > 0 ? (h - lower[0]) / range : 0;\r\n                        t = this.utility.smoothstep(t);\r\n\r\n                        const [r, g, b] = lerpColor(lower[1], upper[1], t);\r\n                        ctx.fillStyle = `rgb(${r},${g},${b})`;\r\n                        ctx.fillRect(startX + x, startY + y, resolution, resolution);\r\n                    }\r\n                }\r\n            }\r\n        }\r\n\r\n        ctx.restore();\r\n    }\r\n\r\n    /**\r\n     * Draws contour lines showing visible height changes in the terrain.\r\n     */\r\n    private drawContours(): void {\r\n        const ctx = this.ui.ctx;\r\n        if (!ctx || !this.world.isGenerated) return;\r\n\r\n        const camX = this.camera.pos.x;\r\n        const camY = this.camera.pos.y;\r\n        const chunkSize = this.world.worldConfig.worldgenParams.general.chunk.size;\r\n        const resolution = 2;\r\n        const contourStep = 0.02;\r\n        const lineWidth = 1;\r\n        const color = \"rgba(0,0,0,0.35)\";\r\n\r\n        ctx.save();\r\n        ctx.lineWidth = lineWidth;\r\n        ctx.strokeStyle = color;\r\n\r\n        const startCX = Math.floor(camX / chunkSize);\r\n        const endCX = Math.ceil((camX + CANVAS.WIDTH) / chunkSize);\r\n        const startCY = Math.floor(camY / chunkSize);\r\n        const endCY = Math.ceil((camY + CANVAS.HEIGHT) / chunkSize);\r\n\r\n        const getH = (chunk: any, x: number, y: number): number => chunk.getHeightAt(x, y, chunkSize);\r\n\r\n        for (let cx = startCX; cx < endCX; cx++) {\r\n            for (let cy = startCY; cy < endCY; cy++) {\r\n                const key = `${cx},${cy}`;\r\n                const chunk = this.world.chunks.get(key);\r\n                if (!chunk) continue;\r\n\r\n                const startX = cx * chunkSize - camX;\r\n                const startY = cy * chunkSize - camY;\r\n\r\n                for (let y = 0; y < chunkSize - resolution; y += resolution) {\r\n                    for (let x = 0; x < chunkSize - resolution; x += resolution) {\r\n                        const h00 = getH(chunk, x, y);\r\n                        const h10 = getH(chunk, x + resolution, y);\r\n                        const h01 = getH(chunk, x, y + resolution);\r\n                        const h11 = getH(chunk, x + resolution, y + resolution);\r\n\r\n                        const minH = Math.min(h00, h10, h01, h11);\r\n                        const maxH = Math.max(h00, h10, h01, h11);\r\n\r\n                        const base = Math.floor(minH / contourStep) * contourStep;\r\n                        for (let level = base; level <= maxH; level += contourStep) {\r\n                            if (level >= minH && level <= maxH) {\r\n                                ctx.beginPath();\r\n\r\n                                const interp = (v1: number, v2: number, offset: number): number => {\r\n                                    const t = (offset - v1) / (v2 - v1);\r\n                                    return Math.max(0, Math.min(1, t));\r\n                                };\r\n\r\n                                const points: { x: number; y: number }[] = [];\r\n\r\n                                if ((level - h00) * (level - h10) < 0)\r\n                                    points.push({ x: startX + x + resolution * interp(h00, h10, level), y: startY + y });\r\n                                if ((level - h10) * (level - h11) < 0)\r\n                                    points.push({ x: startX + x + resolution, y: startY + y + resolution * interp(h10, h11, level) });\r\n                                if ((level - h11) * (level - h01) < 0)\r\n                                    points.push({ x: startX + x + resolution * (1 - interp(h11, h01, level)), y: startY + y + resolution });\r\n                                if ((level - h01) * (level - h00) < 0)\r\n                                    points.push({ x: startX + x, y: startY + y + resolution * (1 - interp(h01, h00, level)) });\r\n\r\n                                if (points.length >= 2) {\r\n                                    ctx.moveTo(points[0].x, points[0].y);\r\n                                    for (let i = 1; i < points.length; i++) ctx.lineTo(points[i].x, points[i].y);\r\n                                    ctx.stroke();\r\n                                }\r\n                            }\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n        }\r\n\r\n        ctx.restore();\r\n    }\r\n}","import { RoomManager } from \"../RoomManager\";\r\nimport { NetworkChunk, Vec2 } from \"../Types\";\r\nimport { UserInterface } from \"../UserInterface\";\r\nimport { Utility } from \"../Utility\";\r\nimport { World } from \"./World\";\r\n\r\nexport class WorldEdit {\r\n    private world: World;\r\n    private roomManager: RoomManager;\r\n    private ui: UserInterface;\r\n    private utility: Utility;\r\n\r\n    constructor(\r\n        world: World,\r\n        roomManager: RoomManager,\r\n        ui: UserInterface,\r\n        utility: Utility\r\n    ) {\r\n        this.world = world;\r\n        this.roomManager = roomManager;\r\n        this.ui = ui;\r\n        this.utility = utility;\r\n    }\r\n\r\n    public requestCraterAt(worldPos: Vec2): void {\r\n        const chunkSize = this.world.worldConfig.worldgenParams.general.chunk.size;\r\n        const cx = Math.floor(worldPos.x / chunkSize);\r\n        const cy = Math.floor(worldPos.y / chunkSize);\r\n        const key = `${cx},${cy}`;\r\n        const chunk = this.world.chunks.get(key);\r\n        if (!chunk) return;\r\n\r\n        const radius = 10;\r\n        const centerX = Math.floor(worldPos.x) % chunkSize;\r\n        const centerY = Math.floor(worldPos.y) % chunkSize;\r\n\r\n        const bedrock = this.world.worldConfig.materials.bedrock;\r\n        const bedrockIndex = Object.keys(this.world.worldConfig.materials).indexOf(\"bedrock\");\r\n\r\n        for (let y = -radius; y <= radius; y++) {\r\n            for (let x = -radius; x <= radius; x++) {\r\n                const localX = centerX + x;\r\n                const localY = centerY + y;\r\n                if (localX < 0 || localX >= chunkSize || localY < 0 || localY >= chunkSize) continue;\r\n\r\n                const idx = localY * chunkSize + localX;\r\n\r\n                const newColorIdx = Math.floor(Math.random() * bedrock.colors.length);\r\n                const newPacked = (bedrockIndex << 2) | newColorIdx;\r\n                chunk.pixelData[idx] = newPacked;\r\n                chunk.heightData[idx] = Math.max(0, chunk.heightData[idx] - 1);\r\n            }\r\n        }\r\n\r\n        // re-render updated chunk\r\n        this.world.renderChunk(cx, cy, chunk);\r\n\r\n        // Broadcast to server\r\n        const networkChunk: NetworkChunk = {\r\n            pos: { x: cx, y: cy },\r\n            version: Date.now(),\r\n            size: chunkSize,\r\n            layer: this.world.chunkLayers.get(key)?.name || \"unknown\",\r\n            cellData: {\r\n                worldPixelData: chunk.pixelData,\r\n                worldHeightData: chunk.heightData,\r\n                worldWaterData: chunk.waterData,\r\n                cellLayerGrid: [] // stub\r\n            }\r\n        };\r\n\r\n        this.roomManager.sendMessage(JSON.stringify({\r\n            type: \"chunk-update\",\r\n            chunk: networkChunk\r\n        }));\r\n\r\n        console.log(`Crater applied: ${worldPos.x},${worldPos.y}`);\r\n    }\r\n}","import { CANVAS, WORLD } from \"../Config\";\r\nimport { WorldLayer, CellData, Material, PhysicsMaterialTypes, PixelData, Vec2, NoiseType, NetworkChunk, PixelWaterData, WorldData } from \"../Types\";\r\n\r\nimport { Camera } from \"../Camera\";\r\nimport { ControlsManager } from \"../ControlsManager\";\r\nimport { RoomManager } from \"../RoomManager\";\r\nimport { UserInterface } from \"../UserInterface\";\r\nimport { Utility } from \"../Utility\";\r\n\r\nimport { WorldChunk } from \"./WorldChunk\";\r\nimport { WorldConfig } from \"./WorldConfig\";\r\nimport { WorldDebug } from \"./WorldDebug\";\r\nimport { WorldEdit } from \"./WorldEdit\";\r\nimport { PlayerState } from \"../player/PlayerState\";\r\n\r\nexport class World {\r\n    public chunks: Map<string, WorldChunk> = new Map();\r\n    public chunkLayers: Map<string, WorldLayer> = new Map();\r\n\r\n    public isGenerated = false;\r\n    public currentSeed = 0;\r\n\r\n    public worldConfig: WorldConfig;\r\n    public worldDebug: WorldDebug;\r\n    public worldEdit: WorldEdit;\r\n\r\n    private erosionTemplate: { name: string; index: number }[] | null = null;\r\n    private chunkBuffer: { cx: number; cy: number; loaded: boolean }[] = [];\r\n    private worldBuffer: CellData | null = null;\r\n    private streamingComplete = false;\r\n\r\n    private readonly YIELD_RATE = 10;\r\n    private readonly CHUNK_LOAD_RADIUS = Math.max(CANVAS.WIDTH, CANVAS.HEIGHT) * 2;\r\n    private readonly WORLDGEN_PHASES: readonly string[] = [\"cells\", \"degen\", \"hydration\"];\r\n\r\n    constructor(\r\n        private camera: Camera,\r\n        private controlsManager: ControlsManager,\r\n        private playerState: PlayerState,\r\n        private roomManager: RoomManager,\r\n        private ui: UserInterface,\r\n        private utility: Utility\r\n    ) {\r\n        this.worldConfig = new WorldConfig();\r\n        this.worldDebug = new WorldDebug(this.camera, this.controlsManager, this.ui, this.utility, this);\r\n        this.worldEdit = new WorldEdit(this, this.roomManager, this.ui, this.utility);\r\n\r\n        this.initLoadingProgressEvents();\r\n    }\r\n\r\n    // #region [ General ]\r\n    //\r\n    /**\r\n     * Clears all of the world data for a fresh slate.\r\n     */\r\n    public clear(): void {\r\n        this.chunks.clear();\r\n        this.chunkLayers.clear();\r\n        this.worldDebug.hoveredChunk = null;\r\n        this.isGenerated = false;\r\n        this.chunkBuffer = [];\r\n        this.worldBuffer = null;\r\n        if (this.ui.worldCtx && this.ui.worldCanvas) {\r\n            this.ui.worldCtx.clearRect(0, 0, WORLD.WIDTH, WORLD.HEIGHT);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * General entrypoint for all chunk updates.\r\n     * \r\n     * Network message triggers this, as well as client-side edits.\r\n     */\r\n    public handleChunkUpdate(remoteChunk: NetworkChunk): void {\r\n        if (!remoteChunk || !remoteChunk.pos) return;\r\n\r\n        const key = `${remoteChunk.pos.x},${remoteChunk.pos.y}`;\r\n        const existing = this.chunks.get(key);\r\n\r\n        // Only update if it's new or newer\r\n        if (existing && (remoteChunk.version ?? 0) <= (existing as any).version) {\r\n            return;\r\n        }\r\n\r\n        // Convert NetworkChunk  WorldChunk\r\n        const newChunk = new WorldChunk(\r\n            remoteChunk.layer,\r\n            remoteChunk.cellData.worldPixelData,\r\n            remoteChunk.cellData.worldHeightData,\r\n            remoteChunk.cellData.worldWaterData!,\r\n            this.worldConfig\r\n        );\r\n\r\n        // Extend runtime metadata\r\n        newChunk.version = remoteChunk.version;\r\n        newChunk.pos = remoteChunk.pos;\r\n        newChunk.size = remoteChunk.size;\r\n\r\n        this.chunks.set(key, newChunk);\r\n        this.chunkLayers.set(\r\n            key,\r\n            this.worldConfig.worldLayers[remoteChunk.layer] || Object.values(this.worldConfig.worldLayers)[0]\r\n        );\r\n\r\n        console.log(` Synced chunk ${key} (v${remoteChunk.version})`);\r\n\r\n        // Immediately re-render the updated chunk\r\n        this.renderChunk(remoteChunk.pos.x, remoteChunk.pos.y, newChunk);\r\n    }\r\n    //\r\n    // #endregion\r\n\r\n    // #region [ Generation ]\r\n    //\r\n    /**\r\n     * Shows the generation menu for the host allows worldgen tuning.\r\n     * \r\n     * Returns seed and chosen params for network sync and generation.\r\n     */\r\n    public async showGenerationMenu(): Promise<WorldData> {\r\n        await this.worldgenMenu();\r\n\r\n        const params = this.worldConfig.worldgenParams;\r\n        const seed = params.general.seed || Date.now();\r\n\r\n        params.general.seed = seed;\r\n        this.currentSeed = seed;\r\n\r\n        return { seed, params };\r\n    }\r\n\r\n    /**\r\n     * Main world generation loop.\r\n     * \r\n     * - Creates cellData\r\n     * - Uses cellData for degeneration pass\r\n     * - Hydrates cells for water coverage\r\n     * - Bakes world details into chunks\r\n     */\r\n    public async generateWorld(worldData: WorldData): Promise<void> {\r\n        this.showLoadingMenu();\r\n\r\n        this.worldConfig.worldgenParams = worldData.params;\r\n        this.currentSeed = worldData.seed;\r\n\r\n        this.clear(); // Full refresh just in case\r\n\r\n        const cellData = await this.generateCells(worldData.seed);\r\n        const degenCellData = await this.applyDegen(cellData, worldData.seed);\r\n        const hydratedCellData = await this.applyHydration(degenCellData, worldData.seed);\r\n        await this.bakeChunksFromCells(hydratedCellData);\r\n\r\n        this.isGenerated = true;\r\n        this.hideLoadingMenu();\r\n        console.log(`World generated: ${worldData.seed}`);\r\n    }\r\n\r\n    /**\r\n     * Processes cell generation, which is responsible for the detail level in the world.\r\n     * \r\n     * Creates and returns the CellData which is used to bake the cells into chunks.\r\n     */\r\n    private async generateCells(seed: number): Promise<CellData> {\r\n        const cellSize = this.worldConfig.worldgenParams.general.cell.size; // Get the cell size from the configuration\r\n        const lowestDepth = this.worldConfig.worldgenParams.terrain.lowestDepth; // World bottom\r\n\r\n        const allLayerKeys = Object.keys(this.worldConfig.worldLayers);\r\n        const allMaterialKeys = Object.keys(this.worldConfig.materials);\r\n\r\n        // Determine how many cells needed to fill world\r\n        const cellsX = Math.ceil(WORLD.WIDTH / cellSize);\r\n        const cellsY = Math.ceil(WORLD.HEIGHT / cellSize);\r\n\r\n        const worldPixelData = new Uint8Array(WORLD.WIDTH * WORLD.HEIGHT); // Build storage for pixel data (1byte per px)\r\n        const worldHeightData = new Uint8Array(WORLD.WIDTH * WORLD.HEIGHT); // Build storage for pixel height data (1byte per px)\r\n\r\n        // Build storage for the layer type for each cell\r\n        const cellLayerGrid: number[][] = Array.from({ length: cellsY }, () => new Array<number>(cellsX).fill(0));\r\n\r\n        // Show status message\r\n        const phaseMessages = [\"building cells...\", \"placing pixels...\", \"spawning pixels...\", \"creating cells...\"];\r\n        const randomMessage = phaseMessages[Math.floor(Math.random() * phaseMessages.length)];\r\n        await this.utility.yield(randomMessage);\r\n\r\n        const totalCells = cellsX * cellsY;\r\n        let processedCells = 0;\r\n\r\n        for (let cellY = 0; cellY < cellsY; cellY++) {\r\n            for (let cellX = 0; cellX < cellsX; cellX++) {\r\n\r\n                processedCells++;\r\n                if (processedCells % Math.floor(totalCells / this.YIELD_RATE) === 0) {\r\n                    await this.utility.yield();\r\n                }\r\n\r\n                // Sample height from noise\r\n                let adjustedHeight = this.utility.getNoise(\r\n                    this.worldConfig.worldgenParams.terrain.noiseType,\r\n                    (cellX + 0.5) * this.worldConfig.worldgenParams.terrain.scale,\r\n                    (cellY + 0.5) * this.worldConfig.worldgenParams.terrain.scale,\r\n                    seed,\r\n                    {\r\n                        octaves: this.worldConfig.worldgenParams.terrain.octaves,\r\n                        persistence: this.worldConfig.worldgenParams.terrain.persistence\r\n                    }\r\n                );\r\n\r\n                if (adjustedHeight < 0) adjustedHeight = 0;\r\n                else if (adjustedHeight > 1) adjustedHeight = 1; // Clamp [0..1]\r\n\r\n                const mid: number = 0.5; // Push contrast around midpoint\r\n                adjustedHeight = mid + (adjustedHeight - mid) * this.worldConfig.worldgenParams.terrain.intensity;\r\n                if (adjustedHeight < 0) adjustedHeight = 0;\r\n                else if (adjustedHeight > 1) adjustedHeight = 1; // Clamp [0..1]\r\n\r\n                adjustedHeight = Math.pow(adjustedHeight, this.worldConfig.worldgenParams.terrain.heightCurve); // Bias curve\r\n                if (adjustedHeight < 0) adjustedHeight = 0;\r\n                else if (adjustedHeight > 1) adjustedHeight = 1; // Clamp [0..1]\r\n\r\n                // === Island / Valley shaping (exclusive) ===\r\n                const opts = this.worldConfig.worldgenParams.general.options;\r\n                if (opts.island || opts.valley) {\r\n                    const seaLevel = this.worldConfig.worldgenParams.terrain.seaLevel;\r\n                    const lowestDepth = this.worldConfig.worldgenParams.terrain.lowestDepth;\r\n\r\n                    // Distance from nearest world edge\r\n                    const distToEdgeX = Math.min(cellX * cellSize, WORLD.WIDTH - (cellX * cellSize + cellSize));\r\n                    const distToEdgeY = Math.min(cellY * cellSize, WORLD.HEIGHT - (cellY * cellSize + cellSize));\r\n                    const distToEdge = Math.min(distToEdgeX, distToEdgeY);\r\n\r\n                    // Normalize 0 at edge  1 at center\r\n                    const maxDist = Math.min(WORLD.WIDTH, WORLD.HEIGHT) * 0.5;\r\n                    let t = Math.min(1, distToEdge / maxDist);\r\n\r\n                    // Smooth curve (smootherstep)\r\n                    t = t * t * (3 - 2 * t);\r\n\r\n                    // Optional subtle noise for organic variation\r\n                    const edgeNoise = this.utility.getNoise(\r\n                        this.worldConfig.worldgenParams.terrain.noiseType,\r\n                        cellX * 0.002,\r\n                        cellY * 0.002,\r\n                        seed + 9100,\r\n                        { octaves: 2, persistence: 0.5 }\r\n                    ) * 0.1;\r\n\r\n                    // === ISLAND MODE ===\r\n                    if (opts.island) {\r\n                        // Hard ocean edge (height  0) fading toward normal terrain\r\n                        const fade = Math.pow(1 - t, this.worldConfig.worldgenParams.terrain.heightCurve * 1.5);\r\n                        const target = seaLevel * 0.5; // deep ocean floor baseline\r\n                        adjustedHeight = this.utility.lerp(target, adjustedHeight, t + edgeNoise);\r\n\r\n                        if (adjustedHeight < lowestDepth) adjustedHeight = lowestDepth;\r\n                        else if (adjustedHeight > 1) adjustedHeight = 1;\r\n                    }\r\n\r\n                    // === VALLEY MODE ===\r\n                    else if (opts.valley) {\r\n                        // Hard mountain edge (height  1) fading toward valley\r\n                        const fade = Math.pow(1 - t, this.worldConfig.worldgenParams.terrain.heightCurve * 1.5);\r\n                        const target = 1.0; // mountain peak height\r\n                        adjustedHeight = this.utility.lerp(adjustedHeight, target, fade + edgeNoise);\r\n\r\n                        if (adjustedHeight < lowestDepth) adjustedHeight = lowestDepth;\r\n                        else if (adjustedHeight > 1) adjustedHeight = 1;\r\n                    }\r\n                }\r\n\r\n\r\n                if (adjustedHeight < lowestDepth) { adjustedHeight = lowestDepth; } // Clamp water floor to lowestDepth\r\n\r\n                const layerForCell = this.pickLayerForHeight(adjustedHeight);\r\n                const layerIndex = allLayerKeys.indexOf(layerForCell.name);\r\n                cellLayerGrid[cellY][cellX] = layerIndex;\r\n\r\n                // Calculate pixel coordinates in this cell\r\n                const startX = cellX * cellSize;\r\n                const startY = cellY * cellSize;\r\n\r\n                for (let ly = 0; ly < cellSize; ly++) {\r\n                    for (let lx = 0; lx < cellSize; lx++) {\r\n                        const worldPos = {\r\n                            x: startX + lx,\r\n                            y: startY + ly\r\n                        }\r\n\r\n                        if (worldPos.x >= WORLD.WIDTH || worldPos.y >= WORLD.HEIGHT) continue; // Skip cells outside the world\r\n\r\n                        const pixelInfo = this.samplePixelData(worldPos, seed, layerForCell);\r\n                        const landMatIndex = allMaterialKeys.indexOf(pixelInfo.material.name);\r\n                        const outMaterialIndex = landMatIndex >= 0 ? landMatIndex : 0;\r\n                        const outColorIndex = pixelInfo.materialColorIndex;\r\n\r\n                        // Pack material index + color variant into single byte\r\n                        const combined = (outMaterialIndex << 2) | outColorIndex;\r\n\r\n                        const gi = worldPos.y * WORLD.WIDTH + worldPos.x;\r\n                        worldPixelData[gi] = combined;\r\n\r\n                        // Store final adjustedHeight (0..1 mapped to 0..255)\r\n                        worldHeightData[gi] = Math.round(adjustedHeight * 255);\r\n                    }\r\n                }\r\n            }\r\n        }\r\n\r\n        return { worldPixelData, worldHeightData, cellLayerGrid };\r\n    }\r\n\r\n    /**\r\n     * Given the provided inputs, sample what pixel should be at this worldPos based on the seed.\r\n     * \r\n     * Decides:\r\n     * - Which material goes here using layer weights and noise\r\n     * - Which color variant of that material to use\r\n     * - Returns that and the layer we used to make the decision\r\n     */\r\n    public samplePixelData(worldPos: Vec2, seed: number, layer: WorldLayer): PixelData {\r\n        // Sample broad-scale material noise for this pixel\r\n        // (used to pick WHICH material from the layer we get here)\r\n        const materialNoise = this.utility.getNoise(\r\n            this.worldConfig.worldgenParams.material.noiseType,\r\n            worldPos.x * this.worldConfig.worldgenParams.material.scale,\r\n            worldPos.y * this.worldConfig.worldgenParams.material.scale,\r\n            seed + 1000,\r\n            {\r\n                octaves: this.worldConfig.worldgenParams.terrain.octaves,\r\n                persistence: this.worldConfig.worldgenParams.terrain.persistence\r\n            }\r\n        );\r\n\r\n        // Roll weighted choice from the layer's material list\r\n        // { material: \"dirt\", weight: 3 }\r\n        const entries = layer.materials;\r\n        const totalWeight = entries.reduce((s, m) => s + m.weight, 0);\r\n        let target = materialNoise * totalWeight;\r\n\r\n        let selectedMaterial: Material = this.worldConfig.materials.stone; // fallback\r\n\r\n        for (const entry of entries) {\r\n            target -= entry.weight;\r\n            if (target <= 0) {\r\n                const mat = this.worldConfig.materials[entry.material];\r\n                if (mat) selectedMaterial = mat;\r\n                break;\r\n            }\r\n        }\r\n\r\n        // Sample higher-frequency noise to pick which color index of chosen material to use\r\n        // (this breaks up flat color tiling so it doesn't look copy/paste everywhere)\r\n        const detailNoise = this.utility.getNoise(\r\n            this.worldConfig.worldgenParams.material.detail.noiseType,\r\n            worldPos.x * this.worldConfig.worldgenParams.material.detail.scale,\r\n            worldPos.y * this.worldConfig.worldgenParams.material.detail.scale,\r\n            seed + 3000,\r\n            {\r\n                octaves: this.worldConfig.worldgenParams.terrain.octaves,\r\n                persistence: this.worldConfig.worldgenParams.terrain.persistence\r\n            }\r\n        );\r\n        const colorIdx = Math.floor(detailNoise * selectedMaterial.colors.length); // Pick color index from material's palette\r\n\r\n        return { material: selectedMaterial, materialColorIndex: colorIdx, layer };\r\n    }\r\n\r\n    /**\r\n     * Processes a normalized height value, and picks the closest layer.\r\n     */\r\n    private pickLayerForHeight(h: number): WorldLayer {\r\n        const layers = Object.values(this.worldConfig.worldLayers);\r\n\r\n        let best = layers[0]; // Start with first layer as \"best match\"\r\n        let bestDist = Math.abs(h - best.height);\r\n\r\n        // Check all other layer and find correct best match\r\n        for (let i = 1; i < layers.length; i++) {\r\n            const d = Math.abs(h - layers[i].height);\r\n            if (d < bestDist) {\r\n                best = layers[i];\r\n                bestDist = d;\r\n            }\r\n        }\r\n        return best;\r\n    }\r\n\r\n    //\r\n    // #endregion\r\n\r\n    // #region [ Degeneration ]\r\n    //\r\n    /**\r\n     * Second-phase world shaping.\r\n     * \r\n     * Lowers height, changes material and simulates nearby pixels.\r\n     * \r\n     * Returns new CellData.\r\n     */\r\n    private async applyDegen(cellData: CellData, seed: number): Promise<CellData> {\r\n        console.log(\"Applying degeneration pass...\");\r\n\r\n        const { worldPixelData, worldHeightData, cellLayerGrid } = cellData;\r\n        const newPixelData = new Uint8Array(worldPixelData);\r\n        const newHeightData = new Uint8Array(worldHeightData);\r\n\r\n        const degenConfig = this.worldConfig.worldgenParams.degen;\r\n\r\n        const erosionMaterials = this.getErosionTemplate();\r\n\r\n        const phaseMessages = [\"eroding terrain...\", \"wearing down surfaces...\", \"carving material layers...\", \"degenerating terrain...\", \"exposing layers...\"];\r\n        const randomMessage = phaseMessages[Math.floor(Math.random() * phaseMessages.length)];\r\n        await this.utility.yield(randomMessage);\r\n\r\n        const totalPixels = WORLD.WIDTH * WORLD.HEIGHT;\r\n        let processedPixels = 0;\r\n\r\n        // === EROSION PASS ===\r\n        for (let wy = 0; wy < WORLD.HEIGHT; wy++) {\r\n            for (let wx = 0; wx < WORLD.WIDTH; wx++) {\r\n                const gi = wy * WORLD.WIDTH + wx;\r\n\r\n                processedPixels++;\r\n                if (processedPixels % Math.floor(totalPixels / this.YIELD_RATE) === 0) {\r\n                    await this.utility.yield();\r\n                }\r\n\r\n                const originalHeightByte = worldHeightData[gi];\r\n                const originalHeight01 = originalHeightByte / 255;\r\n\r\n                // Skip if below minimum erosion height\r\n                if (originalHeight01 < degenConfig.minHeight) {\r\n                    newPixelData[gi] = worldPixelData[gi];\r\n                    newHeightData[gi] = worldHeightData[gi];\r\n                    continue;\r\n                }\r\n\r\n                // === CALCULATE EROSION AMOUNT ===\r\n                const erosionNoise = this.utility.getNoise(\r\n                    degenConfig.noiseType,\r\n                    wx * degenConfig.scale,\r\n                    wy * degenConfig.scale,\r\n                    seed + 6000,\r\n                    {\r\n                        octaves: this.worldConfig.worldgenParams.degen.scale,\r\n                        persistence: this.worldConfig.worldgenParams.degen.hardness\r\n                    }\r\n                );\r\n\r\n                const detailNoise = this.utility.getNoise(\r\n                    degenConfig.detail.noiseType,\r\n                    wx * degenConfig.detail.scale,\r\n                    wy * degenConfig.detail.scale,\r\n                    seed + 7000,\r\n                    {\r\n                        octaves: this.worldConfig.worldgenParams.degen.detail.scale,\r\n                        persistence: this.worldConfig.worldgenParams.degen.hardness\r\n                    }\r\n                );\r\n\r\n                // Combine noises\r\n                const combinedNoise = erosionNoise * 0.7 + detailNoise * 0.3;\r\n\r\n                // Only erode if above threshold\r\n                if (combinedNoise < degenConfig.threshold) {\r\n                    newPixelData[gi] = worldPixelData[gi];\r\n                    newHeightData[gi] = worldHeightData[gi];\r\n                    continue;\r\n                }\r\n\r\n                // Calculate erosion strength\r\n                const erosionStrength = (combinedNoise - degenConfig.threshold) / (1 - degenConfig.threshold);\r\n                const erosionAmount = erosionStrength * degenConfig.intensity;\r\n\r\n                // Get current material's durability (check if solid first!)\r\n                const currentPacked = worldPixelData[gi];\r\n                const currentMatIndex = currentPacked >> 2;\r\n                const currentMat = Object.values(this.worldConfig.materials)[currentMatIndex];\r\n\r\n                let durability = 0.5;\r\n                if (currentMat.physics.type === PhysicsMaterialTypes.Solid) {\r\n                    durability = currentMat.physics.durability;\r\n                }\r\n\r\n                // Apply erosion with material resistance\r\n                const heightReduction = erosionAmount * (1 - durability) * degenConfig.hardness;\r\n                let newHeight01 = originalHeight01 - heightReduction;\r\n                if (newHeight01 < 0) newHeight01 = 0;\r\n\r\n                const newHeightByte = Math.round(newHeight01 * 255);\r\n                newHeightData[gi] = newHeightByte;\r\n\r\n                // === CALCULATE EROSION DEPTH (0 = no erosion, 1 = max erosion) ===\r\n                const erosionDepth = (originalHeight01 - newHeight01) / Math.max(0.01, originalHeight01);\r\n\r\n                // === SELECT MATERIAL BASED ON EROSION DEPTH ===\r\n                // Map erosion depth to material hardness gradient\r\n                // 0% eroded = keep original material (or softest if significantly eroded)\r\n                // 100% eroded = hardest material (bedrock)\r\n\r\n                const originalDurability = currentMat.physics.type === PhysicsMaterialTypes.Solid\r\n                    ? currentMat.physics.durability\r\n                    : 0.5;\r\n\r\n                // Filter erosion materials to only those HARDER than current material\r\n                const allMaterials = Object.values(this.worldConfig.materials);\r\n\r\n                const harderMaterials = erosionMaterials.filter(m => {\r\n                    const mat = allMaterials[m.index];\r\n                    if (!mat) return false;\r\n\r\n                    const matDurability =\r\n                        mat.physics.type === PhysicsMaterialTypes.Solid\r\n                            ? mat.physics.durability\r\n                            : 0.5;\r\n\r\n                    return matDurability >= originalDurability;\r\n                });\r\n\r\n                let newMatIndex: number;\r\n                let newColorVariantIndex: number;\r\n\r\n                if (harderMaterials.length === 0) {\r\n                    // Current material is already the hardest - keep it\r\n                    newMatIndex = currentMatIndex;\r\n                    const colorVariant = currentPacked & 0b11;\r\n                    newColorVariantIndex = colorVariant;\r\n                } else {\r\n                    // Map erosion depth [0...1] to harder materials gradient [0...length-1]\r\n                    const normalizedDepth = Math.min(1, erosionDepth);\r\n                    const materialIndex = Math.floor(normalizedDepth * (harderMaterials.length - 1));\r\n                    const clampedIndex = Math.min(materialIndex, harderMaterials.length - 1);\r\n\r\n                    newMatIndex = harderMaterials[clampedIndex].index;\r\n\r\n                    // Pick random color variant for the new material\r\n                    const detailForColor = this.utility.getNoise(\r\n                        this.worldConfig.worldgenParams.material.detail.noiseType,\r\n                        wx * this.worldConfig.worldgenParams.material.detail.scale,\r\n                        wy * this.worldConfig.worldgenParams.material.detail.scale,\r\n                        seed + 8000,\r\n                        {\r\n                            octaves: this.worldConfig.worldgenParams.degen.detail.scale,\r\n                            persistence: this.worldConfig.worldgenParams.degen.hardness\r\n                        }\r\n                    );\r\n\r\n                    const selectedMat = Object.values(this.worldConfig.materials)[newMatIndex];\r\n                    const numColors = selectedMat.colors.length;\r\n                    newColorVariantIndex = Math.floor(detailForColor * numColors) % numColors;\r\n                }\r\n\r\n                // Pack and store\r\n                const newPacked = (newMatIndex << 2) | (newColorVariantIndex & 0b11);\r\n                newPixelData[gi] = newPacked;\r\n            }\r\n        }\r\n\r\n        console.log(\"Degeneration pass complete.\");\r\n        return {\r\n            worldPixelData: newPixelData,\r\n            worldHeightData: newHeightData,\r\n            cellLayerGrid: cellLayerGrid\r\n        };\r\n    }\r\n\r\n    /**\r\n     * Gets or creates the erosion template from the chosen materials.\r\n     */\r\n    private getErosionTemplate(): { name: string; index: number }[] {\r\n        if (this.erosionTemplate) return this.erosionTemplate;\r\n\r\n        const erosionMaterialNames: string[] = [\r\n            \"silt\",\r\n            \"sand\",\r\n            \"gravel\",\r\n            \"dirt\",\r\n            \"clay\",\r\n            \"shale\",\r\n            \"limestone\",\r\n            \"stone\",\r\n            \"slate\",\r\n            \"basalt\",\r\n            \"granite\",\r\n            \"bedrock\"\r\n        ]; // These materials will be possibly exposed during erosion\r\n\r\n        const allKeys = Object.keys(this.worldConfig.materials);\r\n        const cached: { name: string; index: number }[] = erosionMaterialNames\r\n            .map((name: string) => {\r\n                const index: number = allKeys.indexOf(name);\r\n                return { name, index };\r\n            })\r\n            .filter(m => m.index >= 0);\r\n\r\n        this.erosionTemplate = cached;\r\n        console.log(\"Cached erosion materials...\");\r\n\r\n        return cached;\r\n    }\r\n\r\n    //\r\n    // #endregion\r\n\r\n    // #region [ Hydration ]\r\n    //\r\n\r\n    private async applyHydration(cellData: CellData, seed: number): Promise<CellData> {\r\n        console.log(\"Applying hydration pass...\");\r\n\r\n        const { worldPixelData, worldHeightData, cellLayerGrid } = cellData;\r\n        const newWaterData = new Uint8Array(worldPixelData.length);\r\n\r\n        const seaLevel = this.worldConfig.worldgenParams.terrain.seaLevel;\r\n        const lowestDepth = this.worldConfig.worldgenParams.terrain.lowestDepth;\r\n        const depthRange = seaLevel - lowestDepth;\r\n\r\n        const phaseMessages = [\"hydrating terrain...\", \"filling water basins...\", \"flooding valleys...\", \"hydrating cells...\", \"hydrating pixels...\", \"creating water...\"];\r\n        const randomMessage = phaseMessages[Math.floor(Math.random() * phaseMessages.length)];\r\n        await this.utility.yield(randomMessage);\r\n\r\n        const totalPixels = worldHeightData.length;\r\n        let processedPixels = 0;\r\n\r\n        for (let i = 0; i < worldHeightData.length; i++) {\r\n            processedPixels++;\r\n            if (processedPixels % Math.floor(totalPixels / this.YIELD_RATE) === 0) {\r\n                await this.utility.yield();\r\n            }\r\n\r\n            const height01 = worldHeightData[i] / 255;\r\n\r\n            if (height01 < seaLevel) {\r\n                // how far below sea level this pixel is (0 = shore, 1 = deepest)\r\n                let depthT = (seaLevel - height01) / depthRange;\r\n                if (depthT < 0) depthT = 0;\r\n                else if (depthT > 1) depthT = 1;\r\n                newWaterData[i] = Math.round(depthT * 255);\r\n            } else {\r\n                newWaterData[i] = 0;\r\n            }\r\n        }\r\n\r\n        console.log(\"Hydration pass complete.\");\r\n\r\n        const hydratedData: CellData = { worldPixelData, worldHeightData, worldWaterData: newWaterData, cellLayerGrid };\r\n\r\n        return hydratedData;\r\n    }\r\n\r\n    /**\r\n     * Helper method that returns PixelWaterData.\r\n     * \r\n     * This contains the amount of water in a cell and the current water material.\r\n     */\r\n    public getWaterData(worldPos: Vec2): PixelWaterData | null {\r\n        const chunkSize = this.worldConfig.worldgenParams.general.chunk.size;\r\n        const cx = Math.floor(worldPos.x / chunkSize);\r\n        const cy = Math.floor(worldPos.y / chunkSize);\r\n        const key = `${cx},${cy}`;\r\n        const chunk = this.chunks.get(key);\r\n\r\n        if (!chunk) return null;\r\n\r\n        const localX = worldPos.x - cx * chunkSize;\r\n        const localY = worldPos.y - cy * chunkSize;\r\n        const waterLevel = chunk.getWaterAt(localX, localY, chunkSize);\r\n\r\n        if (waterLevel <= 0) return null;\r\n\r\n        const height = chunk.getHeightAt(localX, localY, chunkSize);\r\n        const seaLevel = this.worldConfig.worldgenParams.terrain.seaLevel;\r\n        const depth = seaLevel - height;\r\n\r\n        const waterMaterial = this.worldConfig.materials.water;\r\n\r\n        const pxWaterData: PixelWaterData = {\r\n            hasWater: true,\r\n            waterLevel,\r\n            depth,\r\n            material: waterMaterial\r\n        }\r\n\r\n        return pxWaterData;\r\n    }\r\n    //\r\n    // #endregion\r\n\r\n    // #region [ Baking ]\r\n    //\r\n    /**\r\n     * Final step before rendering.\r\n     * \r\n     * Bakes all generated cells into chunks.\r\n     */\r\n    private async bakeChunksFromCells(params: CellData): Promise<void> {\r\n        const chunkSize = this.worldConfig.worldgenParams.general.chunk.size; // Get the chunk size from the config\r\n        const allWorldLayers = Object.values(this.worldConfig.worldLayers);\r\n\r\n        this.worldBuffer = params; // Save worldData for streaming\r\n\r\n        if (!params.worldHeightData || !params.worldPixelData || !params.worldWaterData) return; // Return if you don't have the data\r\n\r\n        // Determine how many chunks needed to fill world\r\n        const chunksX = Math.ceil(WORLD.WIDTH / chunkSize);\r\n        const chunksY = Math.ceil(WORLD.HEIGHT / chunkSize);\r\n        const totalChunks = chunksX * chunksY;\r\n\r\n        const cellSize = this.worldConfig.worldgenParams.general.cell.size; // Get cell size from config\r\n\r\n        // Check how many cells there are filling the world\r\n        const cellsX = Math.ceil(WORLD.WIDTH / cellSize);\r\n        const cellsY = Math.ceil(WORLD.HEIGHT / cellSize);\r\n\r\n        const startMessages = [\"baking chunks...\", \"baking pixels into chunks...\", \"assembling chunks...\", \"chunkifying... is that a word?\", \"packing pixels into chunks...\", \"arranging cells into chunks...\"];\r\n        const halfwayMessages = [\"getting close...\", \"thanks for waiting...\", \"almost done...\", \"still chunking...\", \"about 50% of chunks baked...\", \"still baking pixels into chunks...\", \"almost all pixels baked...\"]\r\n\r\n        const firstMessage = startMessages[Math.floor(Math.random() * startMessages.length)];\r\n        const secondMessage = halfwayMessages[Math.floor(Math.random() * halfwayMessages.length)];\r\n        await this.utility.yield(firstMessage);\r\n\r\n        // === sort chunks by distance to player spawn ===\r\n        const spawn = {\r\n            x: this.playerState.myPlayer.transform.pos.x,\r\n            y: this.playerState.myPlayer.transform.pos.y\r\n        };\r\n        const chunkCoords: { cx: number; cy: number; dist: number }[] = [];\r\n\r\n        for (let cx = 0; cx < chunksX; cx++) {\r\n            for (let cy = 0; cy < chunksY; cy++) {\r\n                const centerX = (cx + 0.5) * chunkSize;\r\n                const centerY = (cy + 0.5) * chunkSize;\r\n                const dx = centerX - spawn.x;\r\n                const dy = centerY - spawn.y;\r\n                chunkCoords.push({ cx, cy, dist: Math.sqrt(dx * dx + dy * dy) });\r\n            }\r\n        }\r\n        chunkCoords.sort((a, b) => a.dist - b.dist);\r\n\r\n        // === iterate sorted chunks ===\r\n        const progressMessagePoint = Math.floor(totalChunks * 0.25);\r\n        const halfwayPoint = Math.floor(totalChunks * 0.5);\r\n\r\n        for (let i = 0; i < chunkCoords.length; i++) {\r\n            const { cx, cy } = chunkCoords[i];\r\n\r\n            if (i === progressMessagePoint) {\r\n                await this.utility.yield(secondMessage);\r\n            }\r\n\r\n            if (i === halfwayPoint) {\r\n                this.chunkBuffer = chunkCoords.slice(i).map(c => ({ cx: c.cx, cy: c.cy, loaded: false })); // Store remaining chunks for streaming later\r\n\r\n                this.isGenerated = true;\r\n                this.hideLoadingMenu();\r\n                console.log(`Returned early after ${i}/${totalChunks} chunks baked. Buffered ${this.chunkBuffer.length} chunks for streaming.`);\r\n                this.backgroundStreamAllChunks(); // Load all remaining chunks\r\n                return;\r\n            }\r\n            else {\r\n                await this.utility.yield();\r\n            }\r\n\r\n            // === keep all your existing chunk-baking code ===\r\n            const chunkPixels = new Uint8Array(chunkSize * chunkSize);\r\n            const chunkHeights = new Uint8Array(chunkSize * chunkSize);\r\n            const chunkWater = new Uint8Array(chunkSize * chunkSize);\r\n\r\n            for (let y = 0; y < chunkSize; y++) {\r\n                for (let x = 0; x < chunkSize; x++) {\r\n                    const worldX = cx * chunkSize + x;\r\n                    const worldY = cy * chunkSize + y;\r\n                    if (worldX >= WORLD.WIDTH || worldY >= WORLD.HEIGHT) continue;\r\n\r\n                    const gi = worldY * WORLD.WIDTH + worldX;\r\n                    const li = y * chunkSize + x;\r\n\r\n                    chunkPixels[li] = params.worldPixelData[gi];\r\n                    chunkHeights[li] = params.worldHeightData[gi];\r\n                    chunkWater[li] = params.worldWaterData[gi];\r\n                }\r\n            }\r\n\r\n            const layerCounts: Record<number, number> = {};\r\n            const startCellX = Math.floor((cx * chunkSize) / cellSize);\r\n            const endCellX = Math.floor(((cx + 1) * chunkSize - 1) / cellSize);\r\n            const startCellY = Math.floor((cy * chunkSize) / cellSize);\r\n            const endCellY = Math.floor(((cy + 1) * chunkSize - 1) / cellSize);\r\n\r\n            for (let cby = startCellY; cby <= endCellY; cby++) {\r\n                if (cby < 0 || cby >= cellsY) continue;\r\n                for (let cbx = startCellX; cbx <= endCellX; cbx++) {\r\n                    if (cbx < 0 || cbx >= cellsX) continue;\r\n                    if (!params.cellLayerGrid) continue;\r\n\r\n                    const idx = params.cellLayerGrid[cby][cbx];\r\n                    layerCounts[idx] = (layerCounts[idx] || 0) + 1;\r\n                }\r\n            }\r\n\r\n            let dominantIdx = 0, max = -1;\r\n            for (const k in layerCounts) {\r\n                const c = layerCounts[k as any];\r\n                if (c > max) { max = c; dominantIdx = parseInt(k, 10); }\r\n            }\r\n            \r\n            const dominantLayer = allWorldLayers[dominantIdx] || allWorldLayers[0];\r\n\r\n            const worldChunk = new WorldChunk(\r\n                dominantLayer.name,\r\n                chunkPixels,\r\n                chunkHeights,\r\n                chunkWater,\r\n                this.worldConfig\r\n            );\r\n\r\n            const key = `${cx},${cy}`;\r\n            this.chunks.set(key, worldChunk);\r\n            this.chunkLayers.set(key, dominantLayer);\r\n            this.renderChunk(cx, cy, worldChunk);\r\n        }\r\n    }\r\n    //\r\n    // #endregion\r\n\r\n    // #region [ Rendering ]\r\n    //\r\n    /**\r\n     * Renders the world to the world canvas within the camera bounds.\r\n     */\r\n    public drawWorld(): void {\r\n        if (!this.ui.ctx || !this.ui.worldCanvas || !this.isGenerated) return;\r\n\r\n        this.ui.ctx.drawImage(\r\n            this.ui.worldCanvas,\r\n            this.camera.pos.x, this.camera.pos.y,\r\n            CANVAS.WIDTH, CANVAS.HEIGHT,\r\n            0, 0,\r\n            CANVAS.WIDTH, CANVAS.HEIGHT\r\n        );\r\n    }\r\n\r\n    /**\r\n     * Renders a single chunk onto the world canvas.\r\n     * \r\n     * For each pixel in this chunk:\r\n     * - get its base material color\r\n     * - apply noise using detailNoiseScale\r\n     * - draw it to the world canvas at its world position\r\n     */\r\n    public renderChunk(cx: number, cy: number, chunk: WorldChunk): void {\r\n        if (!this.ui.worldCtx) return;\r\n\r\n        const chunkSize = this.worldConfig.worldgenParams.general.chunk.size;\r\n        const startX = cx * chunkSize, startY = cy * chunkSize;\r\n\r\n        for (let y = 0; y < chunkSize; y++) {\r\n            for (let x = 0; x < chunkSize; x++) {\r\n                const worldX = startX + x, worldY = startY + y;\r\n                if (worldX >= WORLD.WIDTH || worldY >= WORLD.HEIGHT) continue;\r\n\r\n                const baseColor = chunk.getColorAt(x, y, chunkSize);\r\n                const detailNoise = this.utility.getNoise( // Sample noise to slightly vary brightness/saturation\r\n                    this.worldConfig.worldgenParams.material.detail.noiseType,\r\n                    worldX * this.worldConfig.worldgenParams.material.detail.scale,\r\n                    worldY * this.worldConfig.worldgenParams.material.detail.scale,\r\n                    this.currentSeed + 3000,\r\n                    {\r\n                        octaves: this.worldConfig.worldgenParams.terrain.octaves,\r\n                        persistence: this.worldConfig.worldgenParams.terrain.persistence\r\n                    }\r\n                );\r\n                const finalColor = this.adjustPixelColor(baseColor, detailNoise);\r\n\r\n                this.ui.worldCtx.fillStyle = finalColor;\r\n                this.ui.worldCtx.fillRect(worldX, worldY, 1, 1);\r\n            }\r\n        }\r\n\r\n        this.renderWater(cx, cy, chunk);\r\n    }\r\n\r\n    /**\r\n     * Renders water with the render.water params.\r\n     * \r\n     * Uses getHeightAt and getWaterAt to create pixel perfect water render.\r\n     */\r\n    private renderWater(cx: number, cy: number, chunk: WorldChunk): void {\r\n        if (!this.ui.worldCtx) return;\r\n\r\n        const ctx = this.ui.worldCtx;\r\n        const chunkSize = this.worldConfig.worldgenParams.general.chunk.size;\r\n        const startX = cx * chunkSize;\r\n        const startY = cy * chunkSize;\r\n        const seaLevel = this.worldConfig.worldgenParams.terrain.seaLevel;\r\n\r\n        const w = this.worldConfig.worldgenParams.render.water; // hydration config reference\r\n        const waterMat = this.worldConfig.materials.water;\r\n        const palette = waterMat.colors;\r\n\r\n        const seed = this.currentSeed + 9100;\r\n        const noiseScale = w.noiseScale;\r\n        const foamScale = w.foamScale;\r\n        const shoreBlend = w.shoreBlend;\r\n\r\n        for (let y = 0; y < chunkSize; y++) {\r\n            for (let x = 0; x < chunkSize; x++) {\r\n                const worldX = startX + x;\r\n                const worldY = startY + y;\r\n                if (worldX >= WORLD.WIDTH || worldY >= WORLD.HEIGHT) continue;\r\n\r\n                const height = chunk.getHeightAt(x, y, chunkSize);\r\n                const waterLevel = chunk.getWaterAt(x, y, chunkSize);\r\n\r\n                if (waterLevel <= 0) continue;\r\n\r\n                const depth = seaLevel - height;\r\n                const depthRatio = Math.max(0, Math.min(1, depth / seaLevel));\r\n\r\n                // flip logic: shallow = bright, deep = dark\r\n                const baseIdx = Math.floor((1 - depthRatio) * (palette.length - 1));\r\n                const baseColor = palette[baseIdx];\r\n                const r = parseInt(baseColor.slice(1, 3), 16);\r\n                const g = parseInt(baseColor.slice(3, 5), 16);\r\n                const b = parseInt(baseColor.slice(5, 7), 16);\r\n\r\n                // wave shimmer\r\n                const waveNoise = this.utility.getNoise(\r\n                    NoiseType.Perlin,\r\n                    worldX * noiseScale,\r\n                    worldY * noiseScale,\r\n                    seed,\r\n                    { octaves: 4, persistence: 0.55 }\r\n                );\r\n\r\n                // ridge pattern for foam + wave edges\r\n                const ridge = this.utility.getNoise(\r\n                    NoiseType.Ridged,\r\n                    worldX * foamScale,\r\n                    worldY * foamScale,\r\n                    seed + 3000,\r\n                    { octaves: 2, persistence: 0.5 }\r\n                );\r\n\r\n                // shoreline foam  invert so it appears near land\r\n                let foam = 0;\r\n                if (height > seaLevel - shoreBlend) {\r\n                    const t = (seaLevel - height) / shoreBlend;\r\n                    foam = this.utility.smoothstep(1 - Math.max(0, Math.min(1, t))) * ridge * w.foamIntensity;\r\n                }\r\n\r\n                // depth-based shading (dark in deep)\r\n                const darkness = 1 - (depthRatio * w.depthDarkness);\r\n                const shade = (0.5 + (1 - depthRatio) * 0.5 + waveNoise * w.shimmerStrength) * darkness;\r\n                const scatter = 0.25 + waveNoise * 0.25;\r\n\r\n                const dr = Math.max(0, Math.min(255, r * shade + 200 * foam + 30 * scatter));\r\n                const dg = Math.max(0, Math.min(255, g * shade + 220 * foam + 50 * scatter));\r\n                const db = Math.max(0, Math.min(255, b * shade + 255 * foam + 60 * scatter));\r\n\r\n                // opacity from config\r\n                const alpha = Math.min(1, w.opacityBase + depthRatio * w.opacityMultiplier);\r\n\r\n                ctx.fillStyle = `rgba(${dr},${dg},${db},${alpha})`;\r\n                ctx.fillRect(worldX, worldY, 1, 1);\r\n            }\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Changes a pixel's color based on noise.\r\n     * \r\n     * Uses the colorVariation from the config to adjust the brightness.\r\n     */\r\n    private adjustPixelColor(hexColor: string, noise: number): string {\r\n        const variation = this.worldConfig.worldgenParams.material.colorVariation;\r\n\r\n        // Brightness multiplier:\r\n        // noise = 0.5 => factor ~1.0 (no change)\r\n        // noise < 0.5 => darker\r\n        // noise > 0.5 => brighter\r\n        const factor = 1 + (noise - 0.5) * variation;\r\n\r\n        const r = parseInt(hexColor.slice(1, 3), 16);\r\n        const g = parseInt(hexColor.slice(3, 5), 16);\r\n        const b = parseInt(hexColor.slice(5, 7), 16);\r\n\r\n        const nr = Math.max(0, Math.min(255, Math.floor(r * factor)));\r\n        const ng = Math.max(0, Math.min(255, Math.floor(g * factor)));\r\n        const nb = Math.max(0, Math.min(255, Math.floor(b * factor)));\r\n\r\n        return `#${nr.toString(16).padStart(2, '0')}${ng.toString(16).padStart(2, '0')}${nb.toString(16).padStart(2, '0')}`;\r\n    }\r\n    //\r\n    // #endregion\r\n\r\n    // #region [ Runtime Helpers ]\r\n    //\r\n    /**\r\n     * Gets the material property of a pixel at runtime.\r\n     */\r\n    public getMaterialAt(x: number, y: number): Material | null {\r\n        const chunkSize = this.worldConfig.worldgenParams.general.chunk.size;\r\n        const cx = Math.floor(x / chunkSize), cy = Math.floor(y / chunkSize);\r\n        const key = `${cx},${cy}`;\r\n        const chunk = this.chunks.get(key);\r\n        if (!chunk) return null;\r\n\r\n        const localX = x - cx * chunkSize;\r\n        const localY = y - cy * chunkSize;\r\n        const idx = localY * chunkSize + localX;\r\n        const combined = chunk.pixelData[idx];\r\n        const materialIndex = combined >> 2;\r\n\r\n        return Object.values(this.worldConfig.materials)[materialIndex] || null;\r\n    }\r\n\r\n    /**\r\n     * Gets the height of a specific pixel at coordinates.\r\n     */\r\n    public getHeightAt(x: number, y: number): number | null {\r\n        const chunkSize = this.worldConfig.worldgenParams.general.chunk.size;\r\n        const cx = Math.floor(x / chunkSize), cy = Math.floor(y / chunkSize);\r\n        const key = `${cx},${cy}`;\r\n        const chunk = this.chunks.get(key);\r\n\r\n        if (!chunk) return null;\r\n\r\n        const localX = x - cx * chunkSize;\r\n        const localY = y - cy * chunkSize;\r\n\r\n        return chunk.getHeightAt(localX, localY, chunkSize);\r\n    }\r\n\r\n    /**\r\n     * Gets the physics properties of a pixel.\r\n     */\r\n    public getPhysicsAt(x: number, y: number) {\r\n        const mat = this.getMaterialAt(x, y);\r\n        return mat ? mat.physics : null;\r\n    }\r\n\r\n    /**\r\n     * Gets the stored or calculated primary layer for a chunk.\r\n     */\r\n    public getChunkLayer(cx: number, cy: number): WorldLayer | null {\r\n        const key = `${cx},${cy}`;\r\n        return this.chunkLayers.get(key) || null;\r\n    }\r\n\r\n    /**\r\n     * Calculates the world and chunk coordinates based on the mouse position from ControlsManager.\r\n     */\r\n    public updateHoveredChunk(): { worldX: number; worldY: number } | null {\r\n        const mousePos = this.controlsManager.getMousePos();\r\n        const worldX = mousePos.x + this.camera.pos.x;\r\n        const worldY = mousePos.y + this.camera.pos.y;\r\n\r\n        if (worldX < 0 || worldX >= WORLD.WIDTH || worldY < 0 || worldY >= WORLD.HEIGHT) {\r\n            this.worldDebug.hoveredChunk = null;\r\n            return null;\r\n        }\r\n\r\n        const chunkSize = this.worldConfig.worldgenParams.general.chunk.size;\r\n        const cx = Math.floor(worldX / chunkSize);\r\n        const cy = Math.floor(worldY / chunkSize);\r\n        this.worldDebug.hoveredChunk = `${cx},${cy}`;\r\n        return { worldX, worldY };\r\n    }\r\n    //\r\n    // #endregion\r\n\r\n    // #region [ Menus ]\r\n    //\r\n    /**\r\n     * Builds and displays the worldgen menu.\r\n     */\r\n    private async worldgenMenu(): Promise<void> {\r\n        return new Promise(resolve => {\r\n            const container = document.createElement(\"div\");\r\n            container.className = \"config_popup_container\";\r\n\r\n            const header = document.createElement(\"h3\");\r\n            header.textContent = 'World Generation Config';\r\n\r\n            const popup = document.createElement(\"div\");\r\n            popup.className = \"config_popup\";\r\n\r\n            const form = document.createElement(\"form\");\r\n\r\n            // Helper to create noise type dropdown\r\n            const noiseTypeOptions = Object.values(NoiseType).map(type =>\r\n                `<option value=\"${type}\" ${this.worldConfig.worldgenParams.terrain.noiseType === type ? 'selected' : ''}>${type.charAt(0).toUpperCase() + type.slice(1)}</option>`\r\n            ).join('');\r\n\r\n            form.innerHTML = `\r\n            <!-- GENERAL -->\r\n            <fieldset id=\"generalFieldset\">\r\n                <legend>General</legend>\r\n                <div class=\"form_grid\">\r\n                    <label id=\"seedLabel\">\r\n                        <span>Seed:</span>\r\n                        <input type=\"text\" name=\"general.seed\" placeholder=\"enter seed or leave blank...\">\r\n                    </label>\r\n                    <div id=\"generalFormDiv\">\r\n                        <label>\r\n                            <span>Chunk Size (px):</span>\r\n                            <input type=\"number\" name=\"general.chunk.size\" value=\"${this.worldConfig.worldgenParams.general.chunk.size}\" min=\"1\" step=\"1\">\r\n                        </label>\r\n                        <label>\r\n                            <span>Cell Size (px):</span>\r\n                            <input type=\"number\" name=\"general.cell.size\" value=\"${this.worldConfig.worldgenParams.general.cell.size}\" min=\"1\" step=\"1\">\r\n                        </label>\r\n                    </div>\r\n                </div>\r\n            </fieldset>\r\n\r\n            <!-- TERRAIN -->\r\n            <fieldset id=\"terrainFieldset\">\r\n                <legend>Terrain</legend>\r\n                <div class=\"form_grid\">\r\n                    <label>\r\n                        <span>Noise Type:</span>\r\n                        <select name=\"terrain.noiseType\">${noiseTypeOptions}</select>\r\n                    </label>\r\n                    <label>\r\n                        <span>Scale:</span>\r\n                        <input type=\"number\" name=\"terrain.scale\" value=\"${this.worldConfig.worldgenParams.terrain.scale}\" step=\"any\">\r\n                    </label>\r\n                    <label>\r\n                        <span>Intensity:</span>\r\n                        <input type=\"number\" name=\"terrain.intensity\" value=\"${this.worldConfig.worldgenParams.terrain.intensity}\" step=\"any\" min=\"0\">\r\n                    </label>\r\n                    <label>\r\n                        <span>Octaves:</span>\r\n                        <input type=\"number\" name=\"terrain.octaves\" value=\"${this.worldConfig.worldgenParams.terrain.octaves}\" min=\"1\" max=\"12\" step=\"1\">\r\n                    </label>\r\n                    <label>\r\n                        <span>Persistence:</span>\r\n                        <input type=\"number\" name=\"terrain.persistence\" value=\"${this.worldConfig.worldgenParams.terrain.persistence}\" step=\"any\" min=\"0\" max=\"1\">\r\n                    </label>\r\n                    <label>\r\n                        <span>Height Curve:</span>\r\n                        <input type=\"number\" name=\"terrain.heightCurve\" value=\"${this.worldConfig.worldgenParams.terrain.heightCurve}\" step=\"any\" min=\"0.1\">\r\n                    </label>\r\n                    <label>\r\n                        <span>Sea Level:</span>\r\n                        <input type=\"number\" name=\"terrain.seaLevel\" value=\"${this.worldConfig.worldgenParams.terrain.seaLevel}\" step=\"any\" min=\"0\" max=\"1\">\r\n                    </label>\r\n                    <label>\r\n                        <span>Lowest Depth:</span>\r\n                        <input type=\"number\" name=\"terrain.lowestDepth\" value=\"${this.worldConfig.worldgenParams.terrain.lowestDepth}\" step=\"any\" min=\"0\" max=\"1\">\r\n                    </label>\r\n                </div>\r\n            </fieldset>\r\n\r\n            <!-- MATERIALS -->\r\n            <fieldset id=\"materialsFieldset\">\r\n                <legend>Materials</legend>\r\n                <div class=\"form_grid\">\r\n                    <label>\r\n                        <span>Noise Type:</span>\r\n                        <select name=\"material.noiseType\">${noiseTypeOptions}</select>\r\n                    </label>\r\n                    <label>\r\n                        <span>Scale:</span>\r\n                        <input type=\"number\" name=\"material.scale\" value=\"${this.worldConfig.worldgenParams.material.scale}\" step=\"any\">\r\n                    </label>\r\n                    <label>\r\n                        <span>Color Variation:</span>\r\n                        <input type=\"number\" name=\"material.colorVariation\" value=\"${this.worldConfig.worldgenParams.material.colorVariation}\" step=\"any\" min=\"0\" max=\"1\">\r\n                    </label>\r\n                </div>\r\n                <div class=\"form_grid form_grid_detail\">\r\n                <h4>Detail</h4>\r\n                    <label>\r\n                        <span>Noise Type:</span>\r\n                        <select name=\"material.detail.noiseType\">${noiseTypeOptions}</select>\r\n                    </label>\r\n                    <label>\r\n                        <span>Scale:</span>\r\n                        <input type=\"number\" name=\"material.detail.scale\" value=\"${this.worldConfig.worldgenParams.material.detail.scale}\" step=\"any\">\r\n                    </label>\r\n                </div>\r\n            </fieldset>\r\n\r\n            <!-- DEGENERATION -->\r\n            <fieldset id=\"degenerationFieldset\">\r\n                <legend>Degeneration</legend>\r\n                <div class=\"form_grid\">\r\n                    <label>\r\n                        <span>Noise Type:</span>\r\n                        <select name=\"degen.noiseType\">${noiseTypeOptions}</select>\r\n                    </label>\r\n                    <label>\r\n                        <span>Scale:</span>\r\n                        <input type=\"number\" name=\"degen.scale\" value=\"${this.worldConfig.worldgenParams.degen.scale}\" step=\"any\" min=\"0\">\r\n                    </label>\r\n                    <label>\r\n                        <span>Intensity:</span>\r\n                        <input type=\"number\" name=\"degen.intensity\" value=\"${this.worldConfig.worldgenParams.degen.intensity}\" step=\"any\" min=\"0\" max=\"2\">\r\n                    </label>\r\n                    <label>\r\n                        <span>Min Height:</span>\r\n                        <input type=\"number\" name=\"degen.minHeight\" value=\"${this.worldConfig.worldgenParams.degen.minHeight}\" step=\"any\" min=\"0\" max=\"1\">\r\n                    </label>\r\n                    <label>\r\n                        <span>Threshold:</span>\r\n                        <input type=\"number\" name=\"degen.threshold\" value=\"${this.worldConfig.worldgenParams.degen.threshold}\" step=\"any\" min=\"0\" max=\"1\">\r\n                    </label>\r\n                    <label>\r\n                        <span>Hardness:</span>\r\n                        <input type=\"number\" name=\"degen.hardness\" value=\"${this.worldConfig.worldgenParams.degen.hardness}\" step=\"any\" min=\"0\" max=\"1\">\r\n                    </label>\r\n                </div>\r\n                <div class=\"form_grid form_grid_detail\">\r\n                <h4>Detail</h4>\r\n                    <label>\r\n                        <span>Noise Type:</span>\r\n                        <select name=\"degen.detail.noiseType\">${noiseTypeOptions}</select>\r\n                    </label>\r\n                    <label>\r\n                        <span>Scale:</span>\r\n                        <input type=\"number\" name=\"degen.detail.scale\" value=\"${this.worldConfig.worldgenParams.degen.detail.scale}\" step=\"any\" min=\"0\">\r\n                    </label>\r\n                </div>\r\n            </fieldset>\r\n\r\n            <!-- HYDRATION\r\n            <fieldset id=\"hydrationFieldset\">\r\n                <legend>Hydration</legend>\r\n                <div class=\"form_grid\">\r\n                    <label>\r\n                        <span>Noise Type:</span>\r\n                        <select name=\"hydration.noiseType\">${noiseTypeOptions}</select>\r\n                    </label>\r\n                    <label>\r\n                        <span>Scale:</span>\r\n                        <input type=\"number\" name=\"hydration.scale\" value=\"${this.worldConfig.worldgenParams.hydration.scale}\" step=\"any\" min=\"0\">\r\n                    </label>\r\n                    <label>\r\n                        <span>Intensity:</span>\r\n                        <input type=\"number\" name=\"hydration.intensity\" value=\"${this.worldConfig.worldgenParams.hydration.intensity}\" step=\"any\" min=\"0\" max=\"5\">\r\n                    </label>\r\n                    <label>\r\n                        <span>Multiplier:</span>\r\n                        <input type=\"number\" name=\"hydration.multiplier\" value=\"${this.worldConfig.worldgenParams.hydration.multiplier}\" step=\"any\" min=\"0\" max=\"10\">\r\n                    </label>\r\n                </div>\r\n            </fieldset> -->\r\n\r\n            <div class=\"form_submit\">\r\n                <button type=\"submit\">Generate (Enter)</button>\r\n            </div>\r\n        `;\r\n\r\n            form.onsubmit = e => {\r\n                e.preventDefault();\r\n                const fd = new FormData(form);\r\n\r\n                const num = (key: string) => parseFloat(fd.get(key) as string);\r\n                const int = (key: string) => parseInt(fd.get(key) as string);\r\n\r\n                // --- General ---\r\n                this.worldConfig.worldgenParams.general.chunk.size = int(\"general.chunk.size\");\r\n                this.worldConfig.worldgenParams.general.cell.size = int(\"general.cell.size\");\r\n                this.worldConfig.worldgenParams.general.seed = int(\"general.seed\");\r\n\r\n                // --- Terrain ---\r\n                this.worldConfig.worldgenParams.terrain.noiseType = fd.get(\"terrain.noiseType\") as NoiseType;\r\n                this.worldConfig.worldgenParams.terrain.scale = num(\"terrain.scale\");\r\n                this.worldConfig.worldgenParams.terrain.intensity = num(\"terrain.intensity\");\r\n                this.worldConfig.worldgenParams.terrain.octaves = int(\"terrain.octaves\");\r\n                this.worldConfig.worldgenParams.terrain.persistence = num(\"terrain.persistence\");\r\n                this.worldConfig.worldgenParams.terrain.heightCurve = num(\"terrain.heightCurve\");\r\n                this.worldConfig.worldgenParams.terrain.seaLevel = num(\"terrain.seaLevel\");\r\n                this.worldConfig.worldgenParams.terrain.lowestDepth = num(\"terrain.lowestDepth\");\r\n\r\n                // --- Materials ---\r\n                this.worldConfig.worldgenParams.material.noiseType = fd.get(\"material.noiseType\") as NoiseType;\r\n                this.worldConfig.worldgenParams.material.scale = num(\"material.scale\");\r\n                this.worldConfig.worldgenParams.material.colorVariation = num(\"material.colorVariation\");\r\n                this.worldConfig.worldgenParams.material.detail.noiseType = fd.get(\"material.detail.noiseType\") as NoiseType;\r\n                this.worldConfig.worldgenParams.material.detail.scale = num(\"material.detail.scale\");\r\n\r\n                // --- Degeneration ---\r\n                this.worldConfig.worldgenParams.degen.noiseType = fd.get(\"degen.noiseType\") as NoiseType;\r\n                this.worldConfig.worldgenParams.degen.scale = num(\"degen.scale\");\r\n                this.worldConfig.worldgenParams.degen.intensity = num(\"degen.intensity\");\r\n                this.worldConfig.worldgenParams.degen.minHeight = num(\"degen.minHeight\");\r\n                this.worldConfig.worldgenParams.degen.threshold = num(\"degen.threshold\");\r\n                this.worldConfig.worldgenParams.degen.hardness = num(\"degen.hardness\");\r\n                this.worldConfig.worldgenParams.degen.detail.noiseType = fd.get(\"degen.detail.noiseType\") as NoiseType;\r\n                this.worldConfig.worldgenParams.degen.detail.scale = num(\"degen.detail.scale\");\r\n\r\n                // --- Hydration ---\r\n                // this.worldConfig.params.hydration.noiseType = fd.get(\"hydration.noiseType\") as NoiseType;\r\n                // this.worldConfig.params.hydration.scale = num(\"hydration.scale\");\r\n                // this.worldConfig.params.hydration.intensity = num(\"hydration.intensity\");ds\r\n                // this.worldConfig.params.hydration.multiplier = num(\"hydration.multiplier\");\r\n\r\n\r\n                document.body.removeChild(container);\r\n                resolve();\r\n            };\r\n\r\n            popup.appendChild(form);\r\n            container.appendChild(header);\r\n            container.appendChild(popup);\r\n            document.body.appendChild(container);\r\n            (form.querySelector(\"input\") as HTMLInputElement)?.focus();\r\n        });\r\n    }\r\n\r\n    /**\r\n     * Builds and displays the rendering menu.\r\n     */\r\n    public async renderMenu(): Promise<void> {\r\n        return new Promise(resolve => {\r\n            const popup = document.createElement(\"div\");\r\n            popup.className = \"config_popup\";\r\n            const form = document.createElement(\"form\");\r\n\r\n            const w = this.worldConfig.worldgenParams.render.water;\r\n\r\n            form.innerHTML = `\r\n        <h3>Render Config</h3>\r\n\r\n        <fieldset>\r\n            <legend>Water Rendering</legend>\r\n            <div class=\"form_grid\">\r\n                <label><span>Base Opacity:</span>\r\n                    <input type=\"number\" name=\"opacityBase\" value=\"${w.opacityBase}\" step=\"any\" min=\"0\" max=\"1\">\r\n                </label>\r\n                <label><span>Opacity Multiplier:</span>\r\n                    <input type=\"number\" name=\"opacityMultiplier\" value=\"${w.opacityMultiplier}\" step=\"any\" min=\"0\" max=\"2\">\r\n                </label>\r\n                <label><span>Foam Intensity:</span>\r\n                    <input type=\"number\" name=\"foamIntensity\" value=\"${w.foamIntensity}\" step=\"any\" min=\"0\" max=\"2\">\r\n                </label>\r\n                <label><span>Foam Scale:</span>\r\n                    <input type=\"number\" name=\"foamScale\" value=\"${w.foamScale}\" step=\"any\" min=\"0\">\r\n                </label>\r\n                <label><span>Noise Scale:</span>\r\n                    <input type=\"number\" name=\"noiseScale\" value=\"${w.noiseScale}\" step=\"any\" min=\"0\">\r\n                </label>\r\n                <label><span>Shore Blend:</span>\r\n                    <input type=\"number\" name=\"shoreBlend\" value=\"${w.shoreBlend}\" step=\"any\" min=\"0\" max=\"1\">\r\n                </label>\r\n                <label><span>Shimmer Strength:</span>\r\n                    <input type=\"number\" name=\"shimmerStrength\" value=\"${w.shimmerStrength}\" step=\"any\" min=\"0\" max=\"1\">\r\n                </label>\r\n                <label><span>Depth Darkness:</span>\r\n                    <input type=\"number\" name=\"depthDarkness\" value=\"${w.depthDarkness}\" step=\"any\" min=\"0\" max=\"2\">\r\n                </label>\r\n            </div>\r\n        </fieldset>\r\n\r\n        <div class=\"form_submit\">\r\n            <button type=\"submit\">Apply (Enter)</button>\r\n        </div>\r\n        `;\r\n\r\n            form.onsubmit = e => {\r\n                e.preventDefault();\r\n                const fd = new FormData(form);\r\n                const num = (key: string) => parseFloat(fd.get(key) as string);\r\n\r\n                // Update render params directly\r\n                w.opacityBase = num(\"opacityBase\");\r\n                w.opacityMultiplier = num(\"opacityMultiplier\");\r\n                w.foamIntensity = num(\"foamIntensity\");\r\n                w.foamScale = num(\"foamScale\");\r\n                w.noiseScale = num(\"noiseScale\");\r\n                w.shoreBlend = num(\"shoreBlend\");\r\n                w.shimmerStrength = num(\"shimmerStrength\");\r\n                w.depthDarkness = num(\"depthDarkness\");\r\n\r\n                //  FULL RE-RENDER ONLY\r\n                console.log(\" Re-rendering world (no regeneration)...\");\r\n\r\n                if (this.ui.worldCtx) {\r\n                    this.ui.worldCtx.clearRect(0, 0, WORLD.WIDTH, WORLD.HEIGHT);\r\n                }\r\n\r\n                for (const [key, chunk] of this.chunks.entries()) {\r\n                    const [cx, cy] = key.split(\",\").map(Number);\r\n                    this.renderChunk(cx, cy, chunk);\r\n                }\r\n\r\n                document.body.removeChild(popup);\r\n                resolve();\r\n            };\r\n\r\n            popup.appendChild(form);\r\n            document.body.appendChild(popup);\r\n            (form.querySelector(\"input\") as HTMLInputElement)?.focus();\r\n        });\r\n    }\r\n\r\n    /**\r\n     * Shows the loading menu during worldgen process.\r\n     */\r\n    public showLoadingMenu(): void {\r\n        const existing = document.getElementById(\"worldLoadingMenu\");\r\n        if (existing) existing.remove(); // Remove old if exists\r\n\r\n        const menu = document.createElement(\"div\");\r\n        menu.id = \"worldLoadingMenu\";\r\n        menu.innerHTML = `\r\n        <div class=\"loading_wrapper\">\r\n            <span id=\"loadingMessage\">Initializing world...</span>\r\n            <div class=\"loading_bar\">\r\n                <div id=\"loadingBarFill\"></div>\r\n            </div>\r\n        </div>\r\n    `;\r\n        document.body.appendChild(menu);\r\n    }\r\n\r\n    /**\r\n     * Hides the loading menu once the worldgen process is completed.\r\n     */\r\n    private hideLoadingMenu(): void {\r\n        const loadingMenu = document.getElementById(\"worldLoadingMenu\");\r\n        if (!loadingMenu) return;\r\n\r\n        loadingMenu.style.opacity = \"0\"; // fade-out (optional)\r\n        setTimeout(() => loadingMenu.remove(), 300); // remove after fade\r\n    }\r\n\r\n    //\r\n    // #endregion\r\n\r\n    // #region [ Events ]\r\n    //\r\n    private initLoadingProgressEvents(): void {\r\n        document.addEventListener(\"yieldMessage\", (e: Event) => {\r\n            const event = e as CustomEvent<{ message: string }>;\r\n            const msgEl = document.getElementById(\"loadingMessage\");\r\n            if (msgEl) msgEl.textContent = event.detail.message;\r\n        });\r\n\r\n        document.addEventListener(\"yieldProgress\", () => {\r\n            const bar = document.getElementById(\"loadingBarFill\");\r\n            if (!bar) return;\r\n\r\n            const current = parseFloat(bar.style.width || \"0\");\r\n            const newWidth = Math.min(100, current + (100 / this.totalYieldSteps()));\r\n            bar.style.width = `${newWidth}%`;\r\n        });\r\n    }\r\n\r\n\r\n    private totalYieldSteps(): number {\r\n        const yieldPerProcess = this.YIELD_RATE;\r\n\r\n        const chunksX = Math.ceil(WORLD.WIDTH / this.worldConfig.worldgenParams.general.chunk.size);\r\n        const chunksY = Math.ceil(WORLD.HEIGHT / this.worldConfig.worldgenParams.general.chunk.size);\r\n        const totalChunks = chunksX * chunksY;\r\n\r\n        const bakedChunks = Math.floor(totalChunks * 0.5);\r\n\r\n        return (yieldPerProcess * this.WORLDGEN_PHASES.length) + bakedChunks;\r\n    }\r\n\r\n    //\r\n    // #endregion\r\n\r\n    private async backgroundStreamAllChunks(): Promise<void> {\r\n        console.log(\"Starting background chunk streaming...\");\r\n\r\n        for (let i = 0; i < this.chunkBuffer.length; i++) {\r\n            const entry = this.chunkBuffer[i];\r\n            if (entry.loaded) continue;\r\n\r\n            this.loadChunk(entry.cx, entry.cy);\r\n            entry.loaded = true;\r\n\r\n            await this.utility.yield(); // one chunk per frame\r\n        }\r\n\r\n        console.log(\" Background streaming complete. All chunks loaded.\");\r\n        this.chunkBuffer = [];\r\n        this.worldBuffer = null;\r\n        this.streamingComplete = true;\r\n    }\r\n\r\n    public async streamUnloadedChunks(): Promise<void> {\r\n        if (!this.isGenerated || !this.playerState?.myPlayer || this.streamingComplete) return;\r\n\r\n        if (!this.chunkBuffer.length || this.chunkBuffer.every(c => c.loaded)) {\r\n            console.log(\"All chunks streamed. Cleaning up temporary world data...\");\r\n            this.chunkBuffer = [];\r\n            this.worldBuffer = null;\r\n            this.streamingComplete = true;\r\n            return;\r\n        }\r\n\r\n        const playerPos = this.playerState.myPlayer.transform.pos;\r\n        const chunkSize = this.worldConfig.worldgenParams.general.chunk.size;\r\n        const loadRadius = this.CHUNK_LOAD_RADIUS;\r\n\r\n        // Only load one new chunk per frame to avoid stutter\r\n        for (let i = 0; i < this.chunkBuffer.length; i++) {\r\n            const entry = this.chunkBuffer[i];\r\n            if (entry.loaded) continue;\r\n\r\n            const centerX = (entry.cx + 0.5) * chunkSize;\r\n            const centerY = (entry.cy + 0.5) * chunkSize;\r\n            const dx = centerX - playerPos.x;\r\n            const dy = centerY - playerPos.y;\r\n            const dist = Math.sqrt(dx * dx + dy * dy);\r\n\r\n            if (dist < loadRadius) {\r\n                entry.loaded = true;\r\n                this.loadChunk(entry.cx, entry.cy);\r\n                await this.utility.yield(); // Give the frame time to breathe\r\n                break; // One chunk allowed per frame\r\n            }\r\n        }\r\n    }\r\n\r\n    private loadChunk(cx: number, cy: number): void {\r\n        if (!this.worldBuffer || !this.worldBuffer.cellLayerGrid || !this.worldBuffer.worldWaterData) return;\r\n\r\n        const allWorldLayers = Object.values(this.worldConfig.worldLayers);\r\n\r\n        const chunkSize = this.worldConfig.worldgenParams.general.chunk.size;\r\n        const cellSize = this.worldConfig.worldgenParams.general.cell.size;\r\n\r\n        const chunkPixels = new Uint8Array(chunkSize * chunkSize);\r\n        const chunkHeights = new Uint8Array(chunkSize * chunkSize);\r\n        const chunkWater = new Uint8Array(chunkSize * chunkSize);\r\n\r\n        // Copy pixel/height/water data from world arrays\r\n        for (let y = 0; y < chunkSize; y++) {\r\n            for (let x = 0; x < chunkSize; x++) {\r\n                const worldX = cx * chunkSize + x;\r\n                const worldY = cy * chunkSize + y;\r\n                if (worldX >= WORLD.WIDTH || worldY >= WORLD.HEIGHT) continue;\r\n\r\n                const gi = worldY * WORLD.WIDTH + worldX;\r\n                const li = y * chunkSize + x;\r\n\r\n                chunkPixels[li] = this.worldBuffer.worldPixelData[gi];\r\n                chunkHeights[li] = this.worldBuffer.worldHeightData[gi];\r\n                chunkWater[li] = this.worldBuffer.worldWaterData[gi];\r\n            }\r\n        }\r\n\r\n        const layerCounts: Record<number, number> = {};\r\n        const cellsX = Math.ceil(WORLD.WIDTH / cellSize);\r\n        const cellsY = Math.ceil(WORLD.HEIGHT / cellSize);\r\n        const startCellX = Math.floor((cx * chunkSize) / cellSize);\r\n        const endCellX = Math.floor(((cx + 1) * chunkSize - 1) / cellSize);\r\n        const startCellY = Math.floor((cy * chunkSize) / cellSize);\r\n        const endCellY = Math.floor(((cy + 1) * chunkSize - 1) / cellSize);\r\n\r\n        for (let cby = startCellY; cby <= endCellY; cby++) {\r\n            if (cby < 0 || cby >= cellsY) continue;\r\n            for (let cbx = startCellX; cbx <= endCellX; cbx++) {\r\n                if (cbx < 0 || cbx >= cellsX) continue;\r\n\r\n                const idx = this.worldBuffer.cellLayerGrid[cby][cbx];\r\n                layerCounts[idx] = (layerCounts[idx] || 0) + 1;\r\n            }\r\n        }\r\n\r\n        let dominantIdx = 0, max = -1;\r\n        for (const k in layerCounts) {\r\n            const c = layerCounts[k as any];\r\n            if (c > max) { max = c; dominantIdx = parseInt(k, 10); }\r\n        }\r\n        const dominantLayer = allWorldLayers[dominantIdx] || allWorldLayers[0];\r\n\r\n        const worldChunk = new WorldChunk(dominantLayer.name, chunkPixels, chunkHeights, chunkWater, this.worldConfig);\r\n        const key = `${cx},${cy}`;\r\n        this.chunks.set(key, worldChunk);\r\n        this.chunkLayers.set(key, dominantLayer);\r\n        this.renderChunk(cx, cy, worldChunk);\r\n    }\r\n}","\r\nimport { CANVAS, GAME, WORLD } from './Config';\r\nimport { Player, RoomMessage, LobbyPlayer, LeaderboardEntry, ResetType, SetSliderParams, SetSpanParams, DeathDecal, EmitterParams, GameSettings, RenderCharacterParams } from './Types';\r\n\r\nimport { Admin } from './Admin';\r\nimport { Animator } from './Animator';\r\nimport { AudioManager } from './AudioManager';\r\nimport { CacheManager } from './CacheManager';\r\nimport { CharacterConfig } from './CharacterConfig';\r\nimport { CharacterManager } from './CharacterManager';\r\nimport { ChatManager } from './ChatManager';\r\nimport { ControlsManager } from './ControlsManager';\r\nimport { CollisionsManager } from './CollisionsManager';\r\nimport { DecalsManager } from './DecalsManager';\r\nimport { EventsManager } from './EventsManager';\r\nimport { GameState } from './GameState';\r\nimport { LobbyManager } from './LobbyManager';\r\nimport { ParticlesManager } from './ParticlesManager';\r\nimport { RenderingManager } from './RenderingManager';\r\nimport { RoomController } from './RoomController';\r\nimport { RoomManager } from './RoomManager';\r\nimport { SettingsManager } from './SettingsManager';\r\nimport { UpgradeManager } from './UpgradeManager';\r\nimport { UserInterface } from './UserInterface';\r\nimport { Utility } from './Utility';\r\nimport { WebsocketManager } from './WebsocketManager';\r\n\r\nimport { CombatController } from './player/CombatController';\r\nimport { DashController } from './player/DashController';\r\nimport { LuckController } from './player/LuckController';\r\nimport { MoveController } from './player/MoveController';\r\nimport { ObjectsManager } from './ObjectsManager';\r\nimport { PlayerController } from './player/PlayerController';\r\nimport { PlayerState } from './player/PlayerState';\r\nimport { StaminaController } from './player/StaminaController';\r\nimport { PlayerConfig } from './player/PlayerConfig';\r\nimport { AudioConfig } from './AudioConfig';\r\nimport { Camera } from './Camera';\r\nimport { World } from './world/World';\r\n\r\nclass Client {\r\n    private userId: string;\r\n\r\n    private isRoundInProgress = false;\r\n\r\n    private roundWinner: string | null = null;\r\n    private gameWinner: string | null = null; // TODO: Use the game winner to display lobby historical wins\r\n\r\n    private admin: Admin;\r\n    private animator: Animator;\r\n    private audioConfig: AudioConfig;\r\n    private audioManager: AudioManager;\r\n    private cacheManager: CacheManager;\r\n    private camera: Camera;\r\n    private charConfig: CharacterConfig;\r\n    private charManager: CharacterManager;\r\n    private chatManager: ChatManager;\r\n    private collisionsManager: CollisionsManager;\r\n    private combatController: CombatController;\r\n    private controlsManager: ControlsManager;\r\n    private dashController: DashController;\r\n    private decalsManager: DecalsManager;\r\n    private eventsManager: EventsManager;\r\n    private gameState: GameState;\r\n    private lobbyManager: LobbyManager;\r\n    private luckController: LuckController;\r\n    private moveController: MoveController;\r\n    private objectsManager: ObjectsManager;\r\n    private particlesManager: ParticlesManager;\r\n    private playerConfig: PlayerConfig;\r\n    private playerController: PlayerController;\r\n    private playerState: PlayerState;\r\n    private renderingManager: RenderingManager;\r\n    private roomController: RoomController;\r\n    private roomManager: RoomManager;\r\n    private settingsManager: SettingsManager;\r\n    private staminaController: StaminaController;\r\n    private upgradeManager: UpgradeManager;\r\n    private ui: UserInterface;\r\n    private utility: Utility;\r\n    private wsManager: WebsocketManager;\r\n    private world: World;\r\n\r\n    // #region [ Initialization ]\r\n    //\r\n    constructor() {\r\n        this.cacheManager = new CacheManager();\r\n        this.utility = new Utility();\r\n        this.gameState = new GameState();\r\n\r\n        this.audioConfig = new AudioConfig();\r\n\r\n        this.settingsManager = new SettingsManager(this.audioConfig, this.cacheManager);\r\n        this.controlsManager = new ControlsManager(this.settingsManager);\r\n\r\n        this.charConfig = new CharacterConfig();\r\n        this.charManager = new CharacterManager(this.charConfig);\r\n\r\n        this.playerConfig = new PlayerConfig();\r\n\r\n        this.userId = this.utility.generateUID(this.playerConfig.default.data.idLength);\r\n        this.playerState = new PlayerState(this.playerConfig, this.userId, this.utility);\r\n\r\n        this.camera = new Camera(this.playerState, this.utility);\r\n\r\n        this.ui = new UserInterface(this.playerState, this.settingsManager, this.utility);\r\n\r\n        this.admin = new Admin(this.cacheManager, this.ui);\r\n\r\n        this.objectsManager = new ObjectsManager(\r\n            this.playerState,\r\n            this.utility\r\n        );\r\n\r\n        this.roomManager = new RoomManager(this.userId, this.utility);\r\n        this.lobbyManager = new LobbyManager(this.charManager, this.playerConfig, this.playerState, this.roomManager, this.ui, this.utility);\r\n        this.wsManager = new WebsocketManager(this.gameState, this.roomManager, this.utility);\r\n        this.chatManager = new ChatManager(this.roomManager, this.ui);\r\n\r\n        this.world = new World(this.camera, this.controlsManager, this.playerState, this.roomManager, this.ui, this.utility);\r\n\r\n        this.upgradeManager = new UpgradeManager(\r\n            this.playerConfig,\r\n            this.playerState,\r\n            this.ui,\r\n            this.utility\r\n        );\r\n\r\n        this.roomController = new RoomController(\r\n            this.gameState,\r\n            this.lobbyManager,\r\n            this.playerState,\r\n            this.roomManager,\r\n            this.ui,\r\n            this.upgradeManager,\r\n            this.userId,\r\n            this.utility,\r\n            this.wsManager\r\n        );\r\n\r\n        this.collisionsManager = new CollisionsManager(\r\n            this.objectsManager,\r\n            this.playerState,\r\n            this.roomManager,\r\n            this.ui,\r\n            this.userId\r\n        );\r\n\r\n        this.moveController = new MoveController(this.controlsManager, this.settingsManager);\r\n        this.staminaController = new StaminaController(this.playerState);\r\n        this.luckController = new LuckController(this.playerState);\r\n\r\n        this.audioManager = new AudioManager(this.audioConfig, this.roomManager, this.settingsManager, this.utility);\r\n        this.animator = new Animator(this.playerState, this.roomManager, this.userId);\r\n\r\n        this.renderingManager = new RenderingManager(\r\n            this.animator,\r\n            this.camera,\r\n            this.charManager,\r\n            this.lobbyManager,\r\n            this.objectsManager,\r\n            this.playerConfig,\r\n            this.ui,\r\n            this.userId\r\n        );\r\n\r\n        this.decalsManager = new DecalsManager(\r\n            this.camera,\r\n            this.charConfig,\r\n            this.playerState,\r\n            this.roomManager,\r\n            this.ui,\r\n            this.userId,\r\n            this.utility\r\n        );\r\n\r\n        this.particlesManager = new ParticlesManager(\r\n            this.camera,\r\n            this.charConfig,\r\n            this.collisionsManager,\r\n            this.decalsManager,\r\n            this.playerState,\r\n            this.renderingManager,\r\n            this.roomManager,\r\n            this.ui,\r\n            this.userId,\r\n            this.utility\r\n        );\r\n\r\n        this.playerController = new PlayerController(\r\n            this.audioConfig,\r\n            this.audioManager,\r\n            this.decalsManager,\r\n            this.gameState,\r\n            this.luckController,\r\n            this.moveController,\r\n            this.objectsManager,\r\n            this.particlesManager,\r\n            this.playerState,\r\n            this.roomManager,\r\n            this.ui,\r\n            this.userId,\r\n            this.utility\r\n        );\r\n\r\n        this.combatController = new CombatController(\r\n            this.animator,\r\n            this.audioConfig,\r\n            this.audioManager,\r\n            this.collisionsManager,\r\n            this.decalsManager,\r\n            this.gameState,\r\n            this.luckController,\r\n            this.particlesManager,\r\n            this.playerController,\r\n            this.playerState,\r\n            this.roomManager,\r\n            this.ui,\r\n            this.userId,\r\n            this.utility,\r\n            this.world\r\n        );\r\n\r\n        this.dashController = new DashController(\r\n            this.collisionsManager,\r\n            this.combatController,\r\n            this.moveController,\r\n            this.playerState,\r\n            this.roomManager,\r\n            this.staminaController,\r\n            this.userId\r\n        );\r\n\r\n        this.eventsManager = new EventsManager(\r\n            this.animator,\r\n            this.camera,\r\n            this.chatManager,\r\n            this.controlsManager,\r\n            this.gameState,\r\n            this.roomController,\r\n            this.playerState,\r\n            this.settingsManager,\r\n            this.ui,\r\n            this.userId\r\n        );\r\n\r\n        if (document.readyState === 'loading') {\r\n            document.addEventListener('DOMContentLoaded', () => { this.initClient(); });\r\n        } else {\r\n            this.initClient();\r\n        }\r\n\r\n        document.addEventListener('keydown', (e) => {\r\n            if (e.key === 'Escape' && this.gameState.gameInProgress && !this.lobbyManager.inLobby) {\r\n                e.preventDefault();\r\n                // TODO: Test stuff here!\r\n\r\n                const ammo = 20;\r\n\r\n                this.playerState.myPlayer.actions.primary.magazine.currentReserve += ammo;\r\n                this.ui.ammoReservesUIController.spawnAmmoInReserveUI(ammo);\r\n            }\r\n        });\r\n    }\r\n\r\n    /**\r\n     * Main initializer for the game client.\r\n     */\r\n    private async initClient(): Promise<void> {\r\n        this.ui.initInterface();\r\n        this.eventsManager.initEventListeners();\r\n        this.initGlobalEvents();\r\n\r\n        this.roomController.checkForRoomInURL();\r\n        this.roomController.showRoomControls();\r\n\r\n        const spanParams: SetSpanParams = {\r\n            spanId: 'userId',\r\n            value: this.userId\r\n        }\r\n        this.utility.setSpan(spanParams);\r\n\r\n        await this.settingsManager.loadSettings();\r\n        const settings: GameSettings = this.settingsManager.getSettings();\r\n\r\n        this.ui.initSoundSliders(settings);\r\n        this.ui.initSettingsInputs(settings);\r\n        this.ui.initSettingsToggles(settings)\r\n\r\n        this.ui.ammoReservesUIController.initAmmoReserveCanvas();\r\n\r\n        this.eventsManager.initKeybindListeners();\r\n\r\n        if (this.audioConfig.settings.preloadSounds) {\r\n            this.audioManager.preloadAudioAssets(this.audioConfig.resources.sfx, '.ogg');\r\n        }\r\n\r\n        this.watchForInputs();\r\n\r\n        this.admin.onAdminCommand = (command, key) => {\r\n            this.roomManager.sendAdminCommand(command, key);\r\n        };\r\n    }\r\n\r\n    /**\r\n     * Initializes event listeners.\r\n     */\r\n    private initGlobalEvents(): void {\r\n        window.addEventListener(\"customEvent_startGame\", () => this.startGame());\r\n        window.addEventListener(\"customEvent_resetGameState\", (e: Event) => {\r\n            const event = e as CustomEvent<{ resetType: ResetType }>;\r\n            this.resetGameState(event.detail.resetType);\r\n        });\r\n\r\n        // Room manager message handler\r\n        this.roomManager.onMessage((message) => this.handleRoomMessage(message));\r\n    }\r\n    //\r\n    // #endregion\r\n    //\r\n    //\r\n    //\r\n    //\r\n    //\r\n    //\r\n    // #region [ Client <> Server ]\r\n    //\r\n    private handleRoomMessage(message: RoomMessage): void {\r\n        switch (message.type) {\r\n            case 'room-created':\r\n                console.log('Room created');\r\n                break;\r\n            case 'room-joined':\r\n                console.log('Joined room - lobby');\r\n                this.playerState.isHost = false;\r\n                this.lobbyManager.showLobbyControls({\r\n                    lobby: this.lobbyManager,\r\n                    lobbyOptions: {\r\n                        maxPlayers: this.gameState.gameMaxPlayers,\r\n                        maxWins: this.gameState.gameMaxWins,\r\n                        isHost: this.playerState.isHost,\r\n                        privateRoom: this.roomManager.isPrivateRoom,\r\n                        upgradesEnabled: this.upgradeManager.isUpgradesEnabled\r\n                    },\r\n                    myPlayer: this.playerState.myPlayer,\r\n                    roomId: this.roomManager.getCurrentRoom() || \"\",\r\n                    userId: this.userId\r\n                });\r\n\r\n                // Send my lobby info\r\n                this.roomManager.sendMessage(JSON.stringify({\r\n                    type: 'lobby-join',\r\n                    color: this.playerState.myPlayer.color,\r\n                    rig: {\r\n                        body: this.playerConfig.default.rig.body,\r\n                        head: this.playerConfig.default.rig.head,\r\n                        headwear: this.playerConfig.default.rig.headwear,\r\n                        weapon: this.playerConfig.default.rig.weapon\r\n                    }\r\n                }));\r\n\r\n                const centerX = this.ui.charCustomizeCanvas ? this.ui.charCustomizeCanvas.width / 2 : 0;\r\n                const centerY = this.ui.charCustomizeCanvas ? this.ui.charCustomizeCanvas.height / 2 : 0;\r\n\r\n                // Add myself to lobby\r\n                this.lobbyManager.lobbyPlayers.set(this.userId, {\r\n                    id: this.userId,\r\n                    color: this.playerState.myPlayer.color,\r\n                    isHost: this.playerState.isHost,\r\n                    rig: {\r\n                        body: this.playerConfig.default.rig.body,\r\n                        head: this.playerConfig.default.rig.head,\r\n                        headwear: this.playerConfig.default.rig.headwear,\r\n                        weapon: this.playerConfig.default.rig.weapon\r\n                    },\r\n                    transform: {\r\n                        pos: { x: centerX, y: centerY },\r\n                        rot: 0\r\n                    }\r\n                });\r\n                this.ui.displayLobbyPlayers(this.playerState.isHost, this.lobbyManager, this.userId);\r\n                this.ui.updateHostDisplay(this.playerState.isHost, this.lobbyManager);\r\n\r\n                if (this.lobbyManager.lobbyPlayers.size === 0) { // No other players added to lobby list\r\n                    this.playerState.isHost = true;\r\n                    this.lobbyManager.lobbyPlayers.get(this.userId)!.isHost = true;\r\n                    this.ui.updateHostDisplay(this.playerState.isHost, this.lobbyManager);\r\n                    console.log('I am the only player in the room...');\r\n                }\r\n                break;\r\n            case 'user-left':\r\n                console.log(`User ${message.userId} left`);\r\n                this.lobbyManager.lobbyPlayers.delete(message.userId);\r\n                this.playerState.players.delete(message.userId);\r\n\r\n                // Remove from leaderboard when player leaves\r\n                this.ui.leaderboard.delete(message.userId);\r\n                this.ui.updateLeaderboardDisplay(this.userId);\r\n                console.log(`Removed ${message.userId} from leaderboard`);\r\n\r\n                // Remove projectiles from disconnected player\r\n                this.combatController.projectiles.forEach((projectile, id) => {\r\n                    if (projectile.ownerId === message.userId) {\r\n                        this.combatController.projectiles.delete(id);\r\n                    }\r\n                });\r\n                this.ui.displayLobbyPlayers(this.playerState.isHost, this.lobbyManager, this.userId);\r\n                break;\r\n            case 'room-message':\r\n                this.handleGameMessage(message);\r\n                break;\r\n            case 'room-error':\r\n                alert(`Error: ${message.message}`);\r\n                break;\r\n        }\r\n    }\r\n\r\n    private async handleGameMessage(message: RoomMessage): Promise<void> {\r\n        if (!message.message) return;\r\n\r\n        try {\r\n            const gameData = JSON.parse(message.message);\r\n\r\n            switch (gameData.type) {\r\n                //\r\n                // [ Lobby ]\r\n                //\r\n                case 'lobby-join':\r\n                    const centerX = this.ui.charCustomizeCanvas ? this.ui.charCustomizeCanvas.width / 2 : 0;\r\n                    const centerY = this.ui.charCustomizeCanvas ? this.ui.charCustomizeCanvas.height / 2 : 0;\r\n\r\n                    this.lobbyManager.lobbyPlayers.set(message.userId, {\r\n                        id: message.userId,\r\n                        color: gameData.color,\r\n                        isHost: false,\r\n                        rig: gameData.rig,\r\n                        transform: {\r\n                            pos: { x: centerX, y: centerY },\r\n                            rot: 0\r\n                        }\r\n                    });\r\n                    this.ui.displayLobbyPlayers(this.playerState.isHost, this.lobbyManager, this.userId);\r\n\r\n                    // If I'm host, send current lobby state to new player\r\n                    if (this.playerState.isHost) {\r\n                        this.roomManager.sendMessage(JSON.stringify({\r\n                            type: 'lobby-state',\r\n                            players: Array.from(this.lobbyManager.lobbyPlayers.values()),\r\n                            options: {\r\n                                privateRoom: this.roomManager.isPrivateRoom,\r\n                                maxPlayers: this.gameState.gameMaxPlayers,\r\n                                maxWins: this.gameState.gameMaxWins,\r\n                                upgradesEnabled: this.upgradeManager.isUpgradesEnabled\r\n                                // TODO: Add more room options here as enabled\r\n                            }\r\n                        }));\r\n                    }\r\n                    break;\r\n                case 'lobby-state':\r\n                    this.lobbyManager.lobbyPlayers.clear();\r\n\r\n                    gameData.players.forEach((player: LobbyPlayer) => {\r\n                        this.lobbyManager.lobbyPlayers.set(player.id, player);\r\n                    });\r\n\r\n                    this.ui.displayLobbyPlayers(this.playerState.isHost, this.lobbyManager, this.userId);\r\n                    this.ui.updateHostDisplay(this.playerState.isHost, this.lobbyManager);\r\n\r\n                    if (gameData.options) {\r\n                        this.lobbyManager.syncLobbyOptions(gameData.options);\r\n                    }\r\n                    break;\r\n                case 'lobby-options':\r\n                    this.lobbyManager.syncLobbyOptions(gameData);\r\n                    break;\r\n                case 'promote-player':\r\n                    this.lobbyManager.lobbyPlayers.forEach((player, id) => { // Update host status for all players\r\n                        player.isHost = id === gameData.targetPlayerId;\r\n                    });\r\n\r\n                    // Update my own host status\r\n                    this.playerState.isHost = gameData.targetPlayerId === this.userId;\r\n\r\n                    // If I just became host due to migration, log it\r\n                    if (this.playerState.isHost && gameData.reason === 'host-migration') {\r\n                        console.log('I am now the host due to host migration');\r\n                    }\r\n\r\n                    this.lobbyManager.setupLobbyOptions({\r\n                        maxPlayers: this.gameState.gameMaxPlayers,\r\n                        maxWins: this.gameState.gameMaxWins,\r\n                        isHost: this.playerState.isHost,\r\n                        privateRoom: this.roomManager.isPrivateRoom,\r\n                        upgradesEnabled: this.upgradeManager.isUpgradesEnabled\r\n                    });\r\n\r\n                    this.ui.displayLobbyPlayers(this.playerState.isHost, this.lobbyManager, this.userId);\r\n                    this.ui.updateHostDisplay(this.playerState.isHost, this.lobbyManager);\r\n                    break;\r\n                case 'return-to-lobby': // New message type\r\n                    console.log('Returning to lobby - last player or game ended');\r\n\r\n                    // Update host status if I'm the new host\r\n                    if (gameData.newHostId === this.userId) {\r\n                        this.playerState.isHost = true;\r\n                        console.log('I am now the host as the last remaining player');\r\n                    }\r\n\r\n                    this.resetGameState('Lobby');\r\n\r\n                    // Show lobby\r\n                    this.lobbyManager.showLobbyControls({\r\n                        lobby: this.lobbyManager,\r\n                        lobbyOptions: {\r\n                            maxPlayers: this.gameState.gameMaxPlayers,\r\n                            maxWins: this.gameState.gameMaxWins,\r\n                            isHost: this.playerState.isHost,\r\n                            privateRoom: this.roomManager.isPrivateRoom,\r\n                            upgradesEnabled: this.upgradeManager.isUpgradesEnabled\r\n                        },\r\n                        myPlayer: this.playerState.myPlayer,\r\n                        roomId: this.roomManager.getCurrentRoom() || \"\",\r\n                        userId: this.userId\r\n                    });\r\n                    break;\r\n                case 'kick-player':\r\n                    if (gameData.targetPlayerId === this.userId) {\r\n                        alert('You have been kicked from the lobby');\r\n                        this.roomController.leaveRoom();\r\n                    }\r\n                    break;\r\n                //\r\n                // [ Chat ]\r\n                //\r\n                case 'chat-message':\r\n                    if (message.userId !== this.userId) {\r\n                        this.chatManager.displayChatMessage({\r\n                            senderId: message.userId,\r\n                            message: gameData.message,\r\n                            isOwn: false\r\n                        });\r\n                    }\r\n                    break;\r\n                //\r\n                // [ Player ]\r\n                //\r\n                // [ IMPORTANT ] Keep full track of Player object here\r\n                case 'player-state':\r\n                    console.log('Player State for player', gameData.id, ':', gameData);\r\n\r\n                    this.playerState.players.set(message.userId, {\r\n                        id: message.userId,\r\n                        transform: {\r\n                            pos: {\r\n                                x: gameData.transform?.pos.x,\r\n                                y: gameData.transform?.pos.y\r\n                            },\r\n                            rot: gameData.transform?.rot\r\n                        },\r\n                        timestamp: gameData.timestamp,\r\n                        color: gameData.color,\r\n                        actions: {\r\n                            dash: {\r\n                                cooldown: gameData.actions?.dash.cooldown || this.playerConfig.default.actions.dash.cooldown,\r\n                                drain: gameData.actions?.dash.drain || this.playerConfig.default.actions.dash.drain,\r\n                                multiplier: gameData.actions?.dash.multiplier || this.playerConfig.default.actions.dash.multiplier,\r\n                                time: gameData.actions?.dash.time || this.playerConfig.default.actions.dash.time\r\n                            },\r\n                            melee: {\r\n                                cooldown: gameData.actions?.melee.cooldown || this.playerConfig.default.actions.melee.cooldown,\r\n                                damage: gameData.actions?.melee.damage || this.playerConfig.default.actions.melee.damage,\r\n                                duration: gameData.actions?.melee.duration || this.playerConfig.default.actions.melee.duration,\r\n                                range: gameData.actions?.melee.range || this.playerConfig.default.actions.melee.range,\r\n                                size: gameData.actions?.melee.size || this.playerConfig.default.actions.melee.size\r\n                            },\r\n                            primary: {\r\n                                buffer: gameData.actions?.primary.buffer || this.playerConfig.default.actions.primary.buffer,\r\n                                burst: {\r\n                                    amount: gameData.actions?.primary.burst.amount || this.playerConfig.default.actions.primary.burst.amount,\r\n                                    delay: gameData.actions?.primary.burst.delay || this.playerConfig.default.actions.primary.burst.delay\r\n                                },\r\n                                magazine: {\r\n                                    currentAmmo: gameData.actions?.primary.magazine.currentAmmo,\r\n                                    currentReserve: gameData.actions?.primary.magazine.currentReserve,\r\n                                    maxReserve: gameData.actions?.primary.magazine.maxReserve,\r\n                                    size: gameData.actions?.primary.magazine.size || this.playerConfig.default.actions.primary.magazine.size\r\n                                },\r\n                                offset: gameData.actions?.primary.offset || this.playerConfig.default.actions.primary.offset,\r\n                                projectile: {\r\n                                    amount: gameData.actions?.primary.projectile.amount || this.playerConfig.default.actions.primary.projectile.amount,\r\n                                    color: gameData.actions?.primary.projectile.color || this.playerConfig.default.actions.primary.projectile.color,\r\n                                    damage: gameData.actions?.primary.projectile.damage || this.playerConfig.default.actions.primary.projectile.damage,\r\n                                    length: gameData.actions?.primary.projectile.length || this.playerConfig.default.actions.primary.projectile.length,\r\n                                    range: gameData.actions?.primary.projectile.range || this.playerConfig.default.actions.primary.projectile.range,\r\n                                    size: gameData.actions?.primary.projectile.size || this.playerConfig.default.actions.primary.projectile.size,\r\n                                    speed: gameData.actions?.primary.projectile.speed || this.playerConfig.default.actions.primary.projectile.speed,\r\n                                    spread: gameData.actions?.primary.projectile.spread || this.playerConfig.default.actions.primary.projectile.spread\r\n                                },\r\n                                reload: {\r\n                                    time: gameData.actions?.primary.reload.time || this.playerConfig.default.actions.primary.reload.time\r\n                                }\r\n                            },\r\n                            sprint: {\r\n                                drain: gameData.actions?.sprint.drain || this.playerConfig.default.actions.sprint.drain,\r\n                                multiplier: gameData.actions?.sprint.multiplier || this.playerConfig.default.actions.sprint.multiplier\r\n                            }\r\n                        },\r\n                        equipment: gameData.equipment || this.playerConfig.default.equipment,\r\n                        flags: {\r\n                            hidden: gameData.flags?.hidden || this.playerConfig.default.flags.hidden,\r\n                            invulnerable: gameData.flags?.invulnerable || this.playerConfig.default.flags.invulnerable\r\n                        },\r\n                        inventory: {\r\n                            primary: gameData.inventory?.primary || this.playerConfig.default.inventory.primary,\r\n                            melee: gameData.inventory?.melee || this.playerConfig.default.inventory.melee\r\n                        },\r\n                        physics: {\r\n                            acceleration: gameData.physics?.acceleration || this.playerConfig.default.physics.acceleration,\r\n                            friction: gameData.physics?.friction || this.playerConfig.default.physics.friction\r\n                        },\r\n                        rig: {\r\n                            body: gameData.rig?.body || this.playerConfig.default.rig.body,\r\n                            head: gameData.rig?.head || this.playerConfig.default.rig.head,\r\n                            headwear: gameData.rig?.headwear || this.playerConfig.default.rig.headwear,\r\n                            weapon: gameData.rig?.weapon || this.playerConfig.default.rig.weapon\r\n                        },\r\n                        stats: {\r\n                            defense: gameData.stats?.defense || this.playerConfig.default.stats.defense,\r\n                            health: {\r\n                                max: gameData.stats?.health.max || this.playerConfig.default.stats.health.max,\r\n                                value: gameData.stats?.health.value || this.playerConfig.default.stats.health.max\r\n                            },\r\n                            luck: gameData.stats?.luck || this.playerConfig.default.stats.luck,\r\n                            size: gameData.stats?.size || this.playerConfig.default.stats.size,\r\n                            speed: gameData.stats?.speed || this.playerConfig.default.stats.speed,\r\n                            stamina: {\r\n                                max: gameData.stats?.stamina.max || this.playerConfig.default.stats.stamina.max,\r\n                                recovery: {\r\n                                    delay: gameData.stats?.stamina.recovery.delay || this.playerConfig.default.stats.stamina.recovery.delay,\r\n                                    rate: gameData.stats?.stamina.recovery.rate || this.playerConfig.default.stats.stamina.recovery.rate\r\n                                },\r\n                                value: gameData.stats?.stamina.value || this.playerConfig.default.stats.stamina.max,\r\n                            },\r\n                        },\r\n                        unique: gameData.unique || this.playerConfig.default.unique\r\n                    });\r\n\r\n                    if (gameData.leaderboard) {\r\n                        gameData.leaderboard.forEach(([playerId, entry]: [string, LeaderboardEntry]) => {\r\n                            this.ui.leaderboard.set(playerId, entry);\r\n                        });\r\n                    }\r\n\r\n                    this.ui.createLeaderboard(this.lobbyManager, this.playerState.players, this.userId);\r\n                    break;\r\n                case 'partial-state': {\r\n                    if (message.userId === this.userId) return;\r\n\r\n                    const player = this.playerState.players.get(message.userId);\r\n                    if (!player) break;\r\n\r\n                    console.log('Partial State update for player', message.userId, ':', gameData);\r\n\r\n                    this.utility.deepMerge(player, gameData);\r\n                    break;\r\n                }\r\n                case 'player-move':\r\n                    if (!this.lobbyManager.inLobby && this.playerState.players.has(message.userId)) {\r\n                        const player = this.playerState.players.get(message.userId);\r\n                        if (!player) break;\r\n\r\n                        if (gameData.transform.pos) {\r\n                            player.transform.pos.x = gameData.transform.pos.x;\r\n                            player.transform.pos.y = gameData.transform.pos.y;\r\n                        }\r\n\r\n                        if (gameData.transform.rot !== undefined) {\r\n                            player.transform.rot = gameData.transform.rot;\r\n                        }\r\n                    }\r\n                    break;\r\n                case 'player-hit':\r\n                    if (gameData.projectileId) { // Remove the projectile for everyone\r\n                        this.combatController.projectiles.delete(gameData.projectileId);\r\n                    }\r\n\r\n                    if (gameData.targetId === this.userId) { // I got hit\r\n                        this.playerState.myPlayer.stats.health.value = gameData.newHealth;\r\n\r\n                        const sliderLerpTime = 300; //TODO: Define UI lerping times globally\r\n                        const healthSliderParams: SetSliderParams = {\r\n                            sliderId: 'healthBar',\r\n                            targetValue: this.playerState.myPlayer.stats.health.value,\r\n                            maxValue: this.playerState.myPlayer.stats.health.max,\r\n                            lerpTime: sliderLerpTime\r\n                        }\r\n                        this.utility.setSlider(healthSliderParams);\r\n\r\n                        if (this.playerState.myPlayer.stats.health.value <= 0) {\r\n                            this.playerController.playerDeath();\r\n                        }\r\n                    } else if (this.playerState.players.has(gameData.targetId)) { // Another player got hit\r\n                        const hitPlayer = this.playerState.players.get(gameData.targetId);\r\n                        if (!hitPlayer) break;\r\n\r\n                        hitPlayer.stats.health.value = gameData.newHealth;\r\n\r\n                        if (hitPlayer.stats.health.value <= 0) {\r\n                            console.log(`Player ${hitPlayer.id} died`);\r\n                        }\r\n                    }\r\n\r\n                    if (gameData.wasKill) {\r\n                        const shooter = this.ui.leaderboard.get(gameData.shooterId);\r\n                        if (shooter) {\r\n                            shooter.kills++;\r\n                        }\r\n\r\n                        const target = this.ui.leaderboard.get(gameData.targetId);\r\n                        if (target) {\r\n                            target.deaths++;\r\n                        }\r\n\r\n                        this.ui.updateLeaderboardDisplay(this.userId);\r\n                    }\r\n                    break;\r\n                case 'player-death':\r\n                    if (message.userId !== this.userId && gameData.ammoBox) { // Spawn ammo\r\n                        this.objectsManager.ammoBoxes.set(gameData.ammoBox.id, gameData.ammoBox);\r\n                        console.log(`Ammo box spawned at death of ${message.userId}`);\r\n                    }\r\n\r\n                    const gore: DeathDecal = {\r\n                        gore: {\r\n                            amount: this.utility.getRandomInt(2, 5)\r\n                        },\r\n                        blood: {\r\n                            amount: this.utility.getRandomInt(1, 3)\r\n                        },\r\n                        ownerId: message.userId,\r\n                        pos: {\r\n                            x: gameData.x,\r\n                            y: gameData.y\r\n                        },\r\n                        radius: gameData.size\r\n                    }\r\n                    this.particlesManager.generateGore(gore); // Spawn gore\r\n\r\n                    console.log(`Generated gore for ${message.userId}`);\r\n                    break;\r\n                case 'ammo-pickup':\r\n                    if (gameData.playerId === this.userId) break;\r\n\r\n                    if (this.objectsManager.ammoBoxes.has(gameData.ammoBoxId)) {\r\n                        const box = this.objectsManager.ammoBoxes.get(gameData.ammoBoxId);\r\n                        if (!box) break;\r\n\r\n                        // Update box state\r\n                        box.isOpen = gameData.boxState.isOpen;\r\n                        box.lid = gameData.boxState.lid;\r\n\r\n                        console.log(`Ammo box opened by ${gameData.playerId}`);\r\n                    }\r\n                    break;\r\n                case 'weapon-change':\r\n                    if (message.userId !== this.userId && this.playerState.players.has(message.userId)) {\r\n                        const player = this.playerState.players.get(message.userId);\r\n                        if (!player) break;\r\n\r\n                        player.rig.weapon = gameData.weapon;\r\n                        console.log(`${message.userId} switched to ${gameData.weapon}`);\r\n                    }\r\n                    break;\r\n                //\r\n                //\r\n                // [ Projectile ]\r\n                //\r\n                case 'projectile-launch':\r\n                    if (!this.lobbyManager.inLobby && message.userId !== this.userId) {\r\n                        this.combatController.projectiles.set(gameData.projectile.id, gameData.projectile);\r\n                    }\r\n                    break;\r\n                case 'projectile-remove':\r\n                    if (!this.lobbyManager.inLobby) {\r\n                        this.combatController.projectiles.delete(gameData.projectileId);\r\n                    }\r\n                    break;\r\n                case 'projectile-update': // Used for deflections or any projectile mid trajectory updates\r\n                    if (!this.lobbyManager.inLobby && this.combatController.projectiles.has(gameData.projectileId)) {\r\n                        const projectile = this.combatController.projectiles.get(gameData.projectileId);\r\n                        if (!projectile) break;\r\n\r\n                        // Update projectile properties\r\n                        projectile.ownerId = gameData.newOwnerId;\r\n                        projectile.velocity = gameData.velocity;\r\n                        projectile.color = gameData.color;\r\n                        projectile.transform.rot = Math.atan2(projectile.velocity.y, projectile.velocity.x);\r\n\r\n                        console.log(`Projectile ${gameData.projectileId} data updated by ${gameData.newOwnerId}`);\r\n                    }\r\n                    break;\r\n                //\r\n                //\r\n                // [ Game ]\r\n                //\r\n                case 'start-game':\r\n                    if (gameData.spawnMap && gameData.spawnMap[this.userId]) {\r\n                        this.playerState.myPlayer.transform.pos.x = gameData.spawnMap[this.userId].x;\r\n                        this.playerState.myPlayer.transform.pos.y = gameData.spawnMap[this.userId].y;\r\n                        console.log(\"My Player Spawn:\", gameData.spawnMap[this.userId].x, gameData.spawnMap[this.userId].y)\r\n                    }\r\n                    // For other players\r\n                    if (gameData.spawnMap) {\r\n                        this.playerState.players.forEach((player: Player, id: string) => {\r\n                            if (gameData.spawnMap[id]) {\r\n                                player.transform.pos.x = gameData.spawnMap[id].x;\r\n                                player.transform.pos.y = gameData.spawnMap[id].y;\r\n                                console.log(`Player ${id} spawn:`, gameData.spawnMap[id].x, gameData.spawnMap[id].y)\r\n                            }\r\n                        });\r\n                    }\r\n\r\n                    if (gameData.worldData) {\r\n                        await this.world.generateWorld(gameData.worldData);\r\n                    }\r\n\r\n                    this.showGameControls(this.roomManager.getCurrentRoom() || '');\r\n                    this.startGameLoop();\r\n                    break;\r\n                case 'game-end':\r\n                    console.log(`Game ended! Winner: ${gameData.winnerId}`);\r\n                    this.gameWinner = gameData.winnerId;\r\n                    break;\r\n                //\r\n                //\r\n                // [ Round ]\r\n                //\r\n                case 'round-end':\r\n                    console.log(`Round ended! Winner: ${gameData.winnerId || 'No one'}`);\r\n                    this.endRound(gameData.winnerId);\r\n                    break;\r\n                case 'new-round':\r\n                    if (!gameData.spawnMap) return;\r\n                    console.log(gameData.spawnMap);\r\n\r\n                    // Hide upgrade UI\r\n                    if (this.ui.upgradeContainer) {\r\n                        this.ui.upgradeContainer.style.display = 'none';\r\n                    }\r\n\r\n                    console.log('New round started! Everyone respawning...');\r\n                    this.isRoundInProgress = true;\r\n                    this.roundWinner = null;\r\n\r\n                    this.playerState.myPlayer.stats.health.value = this.playerState.myPlayer.stats.health.max;\r\n\r\n                    const sliderLerpTime = 300; //TODO: Define UI lerping times globally\r\n                    const healthSliderParams: SetSliderParams = {\r\n                        sliderId: 'healthBar',\r\n                        targetValue: this.playerState.myPlayer.stats.health.value,\r\n                        maxValue: this.playerState.myPlayer.stats.health.max,\r\n                        lerpTime: sliderLerpTime\r\n                    }\r\n\r\n                    const staminaSliderParams: SetSliderParams = {\r\n                        sliderId: 'staminaBar',\r\n                        targetValue: this.playerState.myPlayer.stats.stamina.value,\r\n                        maxValue: this.playerState.myPlayer.stats.stamina.max,\r\n                        lerpTime: sliderLerpTime\r\n                    }\r\n\r\n                    this.utility.setSlider(healthSliderParams);\r\n                    this.utility.setSlider(staminaSliderParams);\r\n\r\n                    this.playerState.myPlayer.transform.pos.x = gameData.spawnMap[this.userId].x;\r\n                    this.playerState.myPlayer.transform.pos.y = gameData.spawnMap[this.userId].y;\r\n\r\n                    this.resumeGame(); // Unpause locally\r\n\r\n                    // Receive all player's spawn locations and reset their health\r\n                    this.playerState.players.forEach((player: Player, playerId: string) => { // Respawn other players\r\n                        if (gameData.spawnMap[playerId]) {\r\n                            player.transform.pos.x = gameData.spawnMap[player.id].x;\r\n                            player.transform.pos.y = gameData.spawnMap[player.id].y;\r\n                            player.transform.rot = 0;\r\n\r\n                            // Reset vitals for good measure lol\r\n                            player.stats.health.value = player.stats.health.max;\r\n                            player.stats.stamina.value = player.stats.stamina.max;\r\n                        }\r\n                    });\r\n                    break;\r\n                case 'upgrade-taken': // Someone else took an upgrade\r\n                    if (gameData.upgradeId && gameData.isUnique) { // That upgrade is unique - remove it from my local uniques pool\r\n                        this.upgradeManager.removeUpgradeFromPool(gameData.upgradeId);\r\n                        console.log(`Unique upgrade ${gameData.upgradeId} taken by ${message.userId}`);\r\n                    }\r\n\r\n                    if (this.roundWinner === this.userId) { // I am the round winner - how many players have taken upgrades?\r\n                        this.upgradeManager.upgradesCompleted.add(message.userId);\r\n                        console.log(`${message.userId} completed upgrade. ${this.upgradeManager.upgradesCompleted.size}/${this.playerState.players.size} done`);\r\n\r\n                        // Check if all losers are done\r\n                        if (this.upgradeManager.upgradesCompleted.size >= this.playerState.players.size) {\r\n                            this.showWinnerContinueButton();\r\n                        }\r\n                    }\r\n                    break;\r\n                //\r\n                //\r\n                // [ Audio ]\r\n                //\r\n                case 'play-audio':\r\n                    if (message.userId !== this.userId) {\r\n                        this.audioManager.playAudio(gameData.params);\r\n                    }\r\n                    break;\r\n                //\r\n                //\r\n                // [ Visual ]\r\n                //\r\n                case 'add-decal':\r\n                    if (message.userId !== this.userId) {\r\n                        this.decalsManager.createDecalNetwork(gameData.params);\r\n                    }\r\n                    break;\r\n                case 'add-particles':\r\n                    if (message.userId !== this.userId) {\r\n                        this.particlesManager.createParticlesNetwork(gameData.params);\r\n                    }\r\n                    break;\r\n                case 'particle-emitter':\r\n                    if (message.userId !== this.userId) {\r\n                        const emission: EmitterParams = {\r\n                            id: gameData.id,\r\n                            interval: gameData.interval,\r\n                            lifetime: gameData.lifetime,\r\n                            offset: {\r\n                                x: gameData.offset.x,\r\n                                y: gameData.offset.y\r\n                            },\r\n                            particleType: gameData.particleType,\r\n                            playerId: gameData.playerId,\r\n                            pos: {\r\n                                x: gameData.pos.x,\r\n                                y: gameData.pos.y\r\n                            }\r\n                        }\r\n                        this.particlesManager.generateEmitter(emission);\r\n                    }\r\n                    break;\r\n                case 'character-animation':\r\n                    if (gameData.params.playerId !== this.userId) {\r\n                        this.animator.animateCharacterPartNetwork(gameData.params);\r\n                    }\r\n                    break;\r\n                case 'shrapnel-spawn':\r\n                    if (message.userId !== this.userId) {\r\n                        this.particlesManager.generateShrapnel(gameData.pieces);\r\n                    }\r\n                    break;\r\n                //\r\n                //\r\n                // [ World ]\r\n                //\r\n                case 'chunk-update':\r\n                    if (gameData.chunk) {\r\n                        this.world.handleChunkUpdate(gameData.chunk);\r\n                    }\r\n                    break;\r\n            }\r\n        } catch (error) {\r\n            console.error('Error parsing game message:', error);\r\n        }\r\n    }\r\n    //\r\n    // #endregion\r\n    //\r\n    //\r\n    //\r\n    //\r\n    //\r\n    //\r\n    // #region [ Lobby ]\r\n    //\r\n    /**\r\n     * Return to the lobby for this room from the game.\r\n     * \r\n     * Called when game ends, or when you are the last player left in the game.\r\n     */\r\n    private returnToLobby(): void {\r\n        this.resetGameState('Lobby');\r\n\r\n        // Notify others and return to lobby\r\n        this.roomManager.sendMessage(JSON.stringify({\r\n            type: 'return-to-lobby',\r\n            reason: 'game-ended'\r\n        }));\r\n\r\n        this.lobbyManager.showLobbyControls({\r\n            lobby: this.lobbyManager,\r\n            lobbyOptions: {\r\n                maxPlayers: this.gameState.gameMaxPlayers,\r\n                maxWins: this.gameState.gameMaxWins,\r\n                isHost: this.playerState.isHost,\r\n                privateRoom: this.roomManager.isPrivateRoom,\r\n                upgradesEnabled: this.upgradeManager.isUpgradesEnabled\r\n            },\r\n            myPlayer: this.playerState.myPlayer,\r\n            roomId: this.roomManager.getCurrentRoom() || \"\",\r\n            userId: this.userId\r\n        });\r\n    }\r\n    //\r\n    // #endregion\r\n    //\r\n    //\r\n    //\r\n    //\r\n    //\r\n    //\r\n    // #region [ Round ]\r\n    //\r\n    /**\r\n     * Processes end of round logic.\r\n     */\r\n    private endRound(winnerId: string | null): void {\r\n        if (!this.isRoundInProgress) {\r\n            console.log('Ignoring endRound - round already ended');\r\n            return;\r\n        }\r\n\r\n        console.log(`Server confirmed round end. Winner: ${winnerId || 'No one'}`);\r\n\r\n        this.isRoundInProgress = false;\r\n        this.roundWinner = winnerId;\r\n\r\n        if (!winnerId) { // Everyone died somehow\r\n            console.log('Round ended with no survivors!');\r\n            if (this.playerState.isHost) {\r\n                this.utility.safeTimeout(() => {\r\n                    this.startNewRound();\r\n                }, GAME.ROUND_END_DELAY);\r\n            }\r\n            return;\r\n        }\r\n\r\n        // Increment win for the winner\r\n        if (winnerId && this.ui.leaderboard.has(winnerId)) {\r\n            const winnerEntry = this.ui.leaderboard.get(winnerId);\r\n            if (!winnerEntry) return;\r\n\r\n            winnerEntry.wins++;\r\n            console.log(`${winnerId} won the round! Total wins: ${winnerEntry.wins}`);\r\n\r\n            // Check if they've won the game - use dynamic max wins\r\n            if (winnerEntry.wins >= this.gameState.gameMaxWins) {\r\n                this.endGame(winnerId); // TODO: Maybe don't rely on leaderboard data to end the game but actual player data stored for the round\r\n                return; // Don't start a new round\r\n            }\r\n\r\n            // Update display to show new win count\r\n            this.ui.updateLeaderboardDisplay(this.userId);\r\n        }\r\n\r\n        this.utility.safeTimeout(() => {\r\n            this.pauseGame(); // Everybody pause locally\r\n        }, GAME.ROUND_END_DELAY / 6);\r\n\r\n        // We have a winner, start the upgrade phase after a delay\r\n        this.utility.safeTimeout(() => {\r\n            this.startUpgradePhase(winnerId);\r\n        }, GAME.ROUND_END_DELAY);\r\n    }\r\n\r\n    /**\r\n     * Processes end of game logic.\r\n     */\r\n    private endGame(winnerId: string): void {\r\n        this.gameWinner = winnerId;\r\n        console.log(`${winnerId} won the game with ${this.gameState.gameMaxWins} wins!`);\r\n\r\n        // Send game end message\r\n        this.roomManager.sendMessage(JSON.stringify({\r\n            type: 'game-end',\r\n            winnerId: winnerId\r\n        }));\r\n\r\n        // Return to lobby after delay\r\n        this.utility.safeTimeout(() => {\r\n            this.returnToLobby();\r\n        }, GAME.GAME_END_DELAY);\r\n    }\r\n\r\n    /**\r\n     * Starts a new round, keeping track of full player states.\r\n     */\r\n    private startNewRound(): void {\r\n        console.log('Starting new round...');\r\n\r\n        // Locally update all other players for the winner, their state should already be updated after taking upgrades\r\n        // [ IMPORTANT ] Keep full track of Player object here\r\n        // TODO: Probably won't need this eventually due to player-state messages being sent when upgrades are taken, but need more testing to be sure\r\n        this.playerState.players.forEach((player: Player) => {\r\n            player.transform.rot = 0;\r\n            player.timestamp = player.timestamp || Date.now();\r\n            player.actions.dash.cooldown = player.actions.dash.cooldown || this.playerConfig.default.actions.dash.cooldown;\r\n            player.actions.dash.drain = player.actions.dash.drain || this.playerConfig.default.actions.dash.drain;\r\n            player.actions.dash.multiplier = player.actions.dash.multiplier || this.playerConfig.default.actions.dash.multiplier;\r\n            player.actions.dash.time = player.actions.dash.time || this.playerConfig.default.actions.dash.time;\r\n            player.actions.melee.cooldown = player.actions.melee.cooldown || this.playerConfig.default.actions.melee.cooldown;\r\n            player.actions.melee.damage = player.actions.melee.damage || this.playerConfig.default.actions.melee.damage;\r\n            player.actions.melee.duration = player.actions.melee.duration || this.playerConfig.default.actions.melee.duration;\r\n            player.actions.melee.range = player.actions.melee.range || this.playerConfig.default.actions.melee.range;\r\n            player.actions.melee.size = player.actions.melee.size || this.playerConfig.default.actions.melee.size;\r\n            player.actions.primary.buffer = player.actions.primary.buffer || this.playerConfig.default.actions.primary.buffer;\r\n            player.actions.primary.burst.amount = player.actions.primary.burst.amount || this.playerConfig.default.actions.primary.burst.amount;\r\n            player.actions.primary.burst.delay = player.actions.primary.burst.delay || this.playerConfig.default.actions.primary.burst.delay;\r\n            player.actions.primary.magazine.currentAmmo = player.actions.primary.magazine.currentAmmo || this.playerConfig.default.actions.primary.magazine.size;\r\n            player.actions.primary.magazine.currentReserve = player.actions.primary.magazine.currentReserve || this.playerConfig.default.actions.primary.magazine.startingReserve;\r\n            player.actions.primary.magazine.maxReserve = player.actions.primary.magazine.maxReserve || this.playerConfig.default.actions.primary.magazine.maxReserve;\r\n            player.actions.primary.magazine.size = player.actions.primary.magazine.size || this.playerConfig.default.actions.primary.magazine.size;\r\n            player.actions.primary.offset = player.actions.primary.offset || this.playerConfig.default.actions.primary.offset;\r\n            player.actions.primary.projectile.amount = player.actions.primary.projectile.amount || this.playerConfig.default.actions.primary.projectile.amount;\r\n            player.actions.primary.projectile.color = player.actions.primary.projectile.color || this.playerConfig.default.actions.primary.projectile.color;\r\n            player.actions.primary.projectile.damage = player.actions.primary.projectile.damage || this.playerConfig.default.actions.primary.projectile.damage;\r\n            player.actions.primary.projectile.length = player.actions.primary.projectile.length || this.playerConfig.default.actions.primary.projectile.length;\r\n            player.actions.primary.projectile.range = player.actions.primary.projectile.range || this.playerConfig.default.actions.primary.projectile.range;\r\n            player.actions.primary.projectile.size = player.actions.primary.projectile.size || this.playerConfig.default.actions.primary.projectile.size;\r\n            player.actions.primary.projectile.speed = player.actions.primary.projectile.speed || this.playerConfig.default.actions.primary.projectile.speed;\r\n            player.actions.primary.projectile.spread = player.actions.primary.projectile.spread || this.playerConfig.default.actions.primary.projectile.spread;\r\n            player.actions.primary.reload.time = player.actions.primary.reload.time || this.playerConfig.default.actions.primary.reload.time;\r\n            player.actions.sprint.drain = player.actions.sprint.drain || this.playerConfig.default.actions.sprint.drain;\r\n            player.actions.sprint.multiplier = player.actions.sprint.multiplier || this.playerConfig.default.actions.sprint.multiplier;\r\n            player.equipment = player.equipment || this.playerConfig.default.equipment;\r\n            player.flags.hidden = player.flags.hidden || this.playerConfig.default.flags.hidden;\r\n            player.flags.invulnerable = player.flags.invulnerable || this.playerConfig.default.flags.invulnerable;\r\n            player.inventory.primary = player.inventory.primary || this.playerConfig.default.inventory.primary;\r\n            player.inventory.melee = player.inventory.melee || this.playerConfig.default.inventory.melee;\r\n            player.physics.acceleration = player.physics.acceleration || this.playerConfig.default.physics.acceleration;\r\n            player.physics.friction = player.physics.friction || this.playerConfig.default.physics.friction;\r\n            player.rig.body = player.rig.body || this.playerConfig.default.rig.body;\r\n            player.rig.head = player.rig.head || this.playerConfig.default.rig.head;\r\n            player.rig.headwear = player.rig.headwear || this.playerConfig.default.rig.headwear;\r\n            player.rig.weapon = player.rig.weapon || this.playerConfig.default.rig.weapon;\r\n            player.stats.defense = player.stats.defense || this.playerConfig.default.stats.defense;\r\n            player.stats.health.max = player.stats.health.max || this.playerConfig.default.stats.health.max;\r\n            player.stats.health.value = player.stats.health.max || this.playerConfig.default.stats.health.max;\r\n            player.stats.luck = player.stats.luck || this.playerConfig.default.stats.luck;\r\n            player.stats.size = player.stats.size || this.playerConfig.default.stats.size;\r\n            player.stats.speed = player.stats.speed || this.playerConfig.default.stats.speed;\r\n            player.stats.stamina.max = player.stats.stamina.max || this.playerConfig.default.stats.stamina.max;\r\n            player.stats.stamina.recovery.delay = player.stats.stamina.recovery.delay || this.playerConfig.default.stats.stamina.recovery.delay;\r\n            player.stats.stamina.recovery.rate = player.stats.stamina.recovery.rate || this.playerConfig.default.stats.stamina.recovery.rate;\r\n            player.stats.stamina.value = player.stats.stamina.value || this.playerConfig.default.stats.stamina.max;\r\n            player.unique = player.unique || this.playerConfig.default.unique\r\n        });\r\n\r\n        // Send the spawn map to all other players\r\n        this.roomManager.sendMessage(JSON.stringify({\r\n            type: 'new-round',\r\n            reservedSpawn: {\r\n                x: Math.random() * (WORLD.WIDTH - WORLD.BORDER_MARGIN * 2) + WORLD.BORDER_MARGIN,\r\n                y: Math.random() * (WORLD.HEIGHT - WORLD.BORDER_MARGIN * 2) + WORLD.BORDER_MARGIN\r\n            }\r\n        }));\r\n    }\r\n    //\r\n    // #endregion\r\n    //\r\n    //\r\n    //\r\n    //\r\n    //\r\n    //\r\n    // #region [ Game ]\r\n    //\r\n    /**\r\n     * Update the display with the game canvas via updateDisplay.\r\n     */\r\n    private showGameControls(roomId: string): void {\r\n        this.ui.updateDisplay(this.lobbyManager, \"game\", roomId);\r\n    }\r\n\r\n    /**\r\n     * Called by the host when the start button is pressed in the lobby.\r\n     * \r\n     * Starts game loop via executeStartGame or displays a warning before continuing if solo.\r\n     */\r\n    private startGame(): void {\r\n        if (!this.playerState.isHost) return;\r\n\r\n        // Check if solo and show warning if needed\r\n        if (this.lobbyManager.lobbyPlayers.size === 1) {\r\n            this.ui.soloGameWarning(() => this.executeStartGame());\r\n            return; // Don't continue, let the modal handle it\r\n        }\r\n\r\n        // If not solo, proceed normally\r\n        this.executeStartGame();\r\n    }\r\n\r\n    /**\r\n     * Executes the beginning of a game and broadcasts the start to all lobbyplayers.\r\n     */\r\n    private async executeStartGame(): Promise<void> {\r\n        const worldData = await this.world.showGenerationMenu(); // Show the worldgen menu for the host, and use params for all clients\r\n\r\n        // Send start game message to other players\r\n        this.roomManager.sendMessage(JSON.stringify({\r\n            type: 'start-game',\r\n            reservedSpawn: {\r\n                x: this.playerState.myPlayer.transform.pos.x,\r\n                y: this.playerState.myPlayer.transform.pos.y\r\n            },\r\n            worldData: worldData\r\n        }));\r\n\r\n        await this.world.generateWorld(worldData); // Host worldgen\r\n\r\n        // Also start the game for myself as the host\r\n        this.showGameControls(this.roomManager.getCurrentRoom() || '');\r\n        this.startGameLoop();\r\n    }\r\n\r\n    /**\r\n     * Kicks of the game loop and initializes values to clean slate.\r\n     */\r\n    private startGameLoop(): void {\r\n        this.gameState.gameInProgress = true;\r\n        this.isRoundInProgress = true;\r\n\r\n        this.playerState.myPlayer.actions.primary.magazine.currentReserve = Math.floor(this.playerConfig.default.actions.primary.magazine.maxReserve / 2);\r\n        this.playerState.myPlayer.actions.primary.magazine.currentAmmo = this.playerState.myPlayer.actions.primary.magazine.size;\r\n        this.ui.ammoReservesUIController.spawnAmmoInReserveUI(this.playerState.myPlayer.actions.primary.magazine.currentReserve);\r\n        this.playerState.isReloading = false;\r\n\r\n        this.ui.createLeaderboard(this.lobbyManager, this.playerState.players, this.userId);\r\n\r\n        this.upgradeManager.resetUpgrades(this.playerState.myPlayer);\r\n\r\n        // Transfer rig from lobby to game player\r\n        const myLobbyPlayer = this.lobbyManager.lobbyPlayers.get(this.userId);\r\n        if (myLobbyPlayer) {\r\n            console.log(\"Found lobby rig for my player: \", myLobbyPlayer.rig);\r\n\r\n            this.playerState.myPlayer.rig.body = myLobbyPlayer.rig.body;\r\n            this.playerState.myPlayer.rig.head = myLobbyPlayer.rig.head;\r\n            this.playerState.myPlayer.rig.headwear = myLobbyPlayer.rig.headwear;\r\n            this.playerState.myPlayer.rig.weapon = myLobbyPlayer.rig.weapon;\r\n        }\r\n\r\n        // Send my player data\r\n        // TODO: You can maybe just call this.initializePlayer and use the returned player object, unsure yet.\r\n        // [ IMPORTANT ] Keep full track of Player object here\r\n        this.roomManager.sendMessage(JSON.stringify({\r\n            type: 'player-state',\r\n            id: this.playerState.myPlayer.id,\r\n            timestamp: this.playerState.myPlayer.timestamp,\r\n            color: this.playerState.myPlayer.color,\r\n            transform: {\r\n                pos: {\r\n                    x: this.playerState.myPlayer.transform.pos.x,\r\n                    y: this.playerState.myPlayer.transform.pos.y,\r\n                },\r\n                rot: this.playerState.myPlayer.transform.rot\r\n            },\r\n            actions: {\r\n                dash: {\r\n                    cooldown: this.playerState.myPlayer.actions.dash.cooldown,\r\n                    drain: this.playerState.myPlayer.actions.dash.drain,\r\n                    multiplier: this.playerState.myPlayer.actions.dash.multiplier,\r\n                    time: this.playerState.myPlayer.actions.dash.time\r\n                },\r\n                melee: {\r\n                    cooldown: this.playerState.myPlayer.actions.melee.cooldown,\r\n                    damage: this.playerState.myPlayer.actions.melee.damage,\r\n                    duration: this.playerState.myPlayer.actions.melee.duration,\r\n                    range: this.playerState.myPlayer.actions.melee.range,\r\n                    size: this.playerState.myPlayer.actions.melee.size\r\n                },\r\n                primary: {\r\n                    buffer: this.playerState.myPlayer.actions.primary.buffer,\r\n                    burst: {\r\n                        amount: this.playerState.myPlayer.actions.primary.burst.amount,\r\n                        delay: this.playerState.myPlayer.actions.primary.burst.delay\r\n                    },\r\n                    magazine: {\r\n                        currentAmmo: this.playerState.myPlayer.actions.primary.magazine.currentAmmo,\r\n                        currentReserve: this.playerState.myPlayer.actions.primary.magazine.currentReserve,\r\n                        maxReserve: this.playerState.myPlayer.actions.primary.magazine.maxReserve,\r\n                        size: this.playerState.myPlayer.actions.primary.magazine.size\r\n                    },\r\n                    offset: this.playerState.myPlayer.actions.primary.offset,\r\n                    projectile: {\r\n                        amount: this.playerState.myPlayer.actions.primary.projectile.amount,\r\n                        color: this.playerState.myPlayer.actions.primary.projectile.color,\r\n                        damage: this.playerState.myPlayer.actions.primary.projectile.damage,\r\n                        length: this.playerState.myPlayer.actions.primary.projectile.length,\r\n                        range: this.playerState.myPlayer.actions.primary.projectile.range,\r\n                        size: this.playerState.myPlayer.actions.primary.projectile.size,\r\n                        speed: this.playerState.myPlayer.actions.primary.projectile.speed,\r\n                        spread: this.playerState.myPlayer.actions.primary.projectile.spread\r\n                    },\r\n                    reload: {\r\n                        time: this.playerState.myPlayer.actions.primary.reload.time\r\n                    }\r\n                },\r\n                sprint: {\r\n                    drain: this.playerState.myPlayer.actions.sprint.drain,\r\n                    multiplier: this.playerState.myPlayer.actions.sprint.multiplier\r\n                }\r\n            },\r\n            equipment: this.playerState.myPlayer.equipment,\r\n            flags: {\r\n                hidden: this.playerState.myPlayer.flags.hidden,\r\n                invulnerable: this.playerState.myPlayer.flags.invulnerable\r\n            },\r\n            inventory: {\r\n                primary: this.playerState.myPlayer.inventory.primary,\r\n                melee: this.playerState.myPlayer.inventory.melee\r\n            },\r\n            physics: {\r\n                acceleration: this.playerState.myPlayer.physics.acceleration,\r\n                friction: this.playerState.myPlayer.physics.friction\r\n            },\r\n            rig: {\r\n                body: this.playerState.myPlayer.rig.body,\r\n                head: this.playerState.myPlayer.rig.head,\r\n                headwear: this.playerState.myPlayer.rig.headwear,\r\n                weapon: this.playerState.myPlayer.rig.weapon\r\n            },\r\n            stats: {\r\n                defense: this.playerState.myPlayer.stats.defense,\r\n                health: {\r\n                    max: this.playerState.myPlayer.stats.health.max,\r\n                    value: this.playerState.myPlayer.stats.health.value\r\n                },\r\n                luck: this.playerState.myPlayer.stats.luck,\r\n                size: this.playerState.myPlayer.stats.size,\r\n                speed: this.playerState.myPlayer.stats.speed,\r\n                stamina: {\r\n                    max: this.playerState.myPlayer.stats.stamina.max,\r\n                    recovery: {\r\n                        delay: this.playerState.myPlayer.stats.stamina.recovery.delay,\r\n                        rate: this.playerState.myPlayer.stats.stamina.recovery.rate\r\n                    },\r\n                    value: this.playerState.myPlayer.stats.stamina.value,\r\n                },\r\n            },\r\n            unique: this.playerState.myPlayer.unique\r\n        }));\r\n\r\n        this.gameLoop();\r\n\r\n        const sliderLerpTime = 300; //TODO: Define UI lerping times globally\r\n        const healthSliderParams: SetSliderParams = {\r\n            sliderId: 'healthBar',\r\n            targetValue: this.playerState.myPlayer.stats.health.value,\r\n            maxValue: this.playerState.myPlayer.stats.health.max,\r\n            lerpTime: sliderLerpTime\r\n        }\r\n\r\n        const staminaSliderParams: SetSliderParams = {\r\n            sliderId: 'staminaBar',\r\n            targetValue: this.playerState.myPlayer.stats.stamina.value,\r\n            maxValue: this.playerState.myPlayer.stats.stamina.max,\r\n            lerpTime: sliderLerpTime\r\n        }\r\n\r\n        this.utility.setSlider(healthSliderParams);\r\n        this.utility.setSlider(staminaSliderParams);\r\n    }\r\n\r\n    /**\r\n     * Core game processing function.\r\n     * \r\n     * Handles animation frame requests, update loops for all systems, and drawing functions.\r\n     */\r\n    private gameLoop(): void {\r\n        if (!this.gameState.gameInProgress || !this.ui.ctx || !this.ui.canvas || !this.ui.decalCtx || !this.ui.decalCanvas) return;\r\n\r\n        if (this.gameState.isPaused) { // Continue the loop but skip all updates\r\n            requestAnimationFrame(() => this.gameLoop());\r\n            return;\r\n        }\r\n\r\n        const dt = this.utility.deltaTime();\r\n\r\n        this.camera.update(dt);\r\n\r\n        // Update\r\n        this.playerController.updatePlayerPosition(dt);\r\n        this.combatController.updateAttack(dt);\r\n        this.combatController.updateProjectiles(dt);\r\n        this.particlesManager.updateParticles(dt);\r\n        this.particlesManager.updateEmitters(dt);\r\n        this.particlesManager.updateShrapnel(dt);\r\n        this.animator.updateCharacterAnimations(dt);\r\n        this.staminaController.updateStamina(dt);\r\n        this.dashController.updateDash(dt);\r\n\r\n        this.collisionsManager.checkCollisions(dt);\r\n\r\n        const sliderLerpTime = 300; //TODO: Define UI lerping times globally\r\n        const staminaSliderParams: SetSliderParams = {\r\n            sliderId: 'staminaBar',\r\n            targetValue: this.playerState.myPlayer.stats.stamina.value,\r\n            maxValue: this.playerState.myPlayer.stats.stamina.max,\r\n            lerpTime: sliderLerpTime\r\n        }\r\n        this.utility.setSlider(staminaSliderParams);\r\n\r\n        // === RENDERING ===\r\n\r\n        // Clear main canvas\r\n        this.renderingManager.clearCtx(this.ui.ctx);\r\n\r\n        this.world.drawWorld();\r\n        this.world.worldDebug.drawDebug();\r\n\r\n        this.ui.ctx.drawImage(\r\n            this.ui.decalCanvas,\r\n            this.camera.pos.x, this.camera.pos.y,\r\n            CANVAS.WIDTH, CANVAS.HEIGHT,\r\n            0, 0,\r\n            CANVAS.WIDTH, CANVAS.HEIGHT\r\n        );\r\n\r\n        // Draw objects (with camera offset)\r\n        this.renderingManager.drawObjects();\r\n\r\n        // Draw projectiles (with camera offset)\r\n        this.combatController.projectiles.forEach(projectile => {\r\n            this.renderingManager.drawProjectile(projectile);\r\n        });\r\n\r\n        // Draw other players (with camera offset)\r\n        this.playerState.players.forEach((player: Player) => {\r\n            if (!this.ui.ctx) return;\r\n\r\n            const charRenderParams: RenderCharacterParams = { player, context: this.ui.ctx };\r\n            this.renderingManager.drawCharacter(charRenderParams);\r\n        });\r\n\r\n        // Draw my player (with camera offset)\r\n        const myRenderParams: RenderCharacterParams = { player: this.playerState.myPlayer, context: this.ui.ctx };\r\n        this.renderingManager.drawCharacter(myRenderParams);\r\n\r\n        // Draw particles and shrapnel (with camera offset)\r\n        this.particlesManager.drawParticles();\r\n        this.particlesManager.drawShrapnel();\r\n\r\n        // Continue game loop\r\n        requestAnimationFrame(() => this.gameLoop());\r\n\r\n        this.world.streamUnloadedChunks(); // Finish loading the world if it isn't yet\r\n    }\r\n\r\n    /**\r\n     * Pauses the game when called.\r\n     */\r\n    public pauseGame(): void {\r\n        if (!this.gameState.gameInProgress) return;\r\n\r\n        this.gameState.isPaused = true;\r\n        console.log('Game paused');\r\n\r\n        this.controlsManager.clearActiveKeys();\r\n        this.playerState.isSprinting = false;\r\n        this.playerState.isDashing = false;\r\n        this.playerState.isBurstActive = false;\r\n        this.playerState.currentBurstShot = 0;\r\n    }\r\n\r\n    /**\r\n     * Resumes the game when called.\r\n     */\r\n    public resumeGame(): void {\r\n        if (!this.gameState.gameInProgress) return;\r\n\r\n        this.gameState.isPaused = false;\r\n        console.log('Game resumed');\r\n    }\r\n\r\n    /**\r\n     * Resets the game state to default.\r\n     */\r\n    private resetGameState(resetType: ResetType): void {\r\n        // Clear game flags\r\n        this.gameState.gameInProgress = false;\r\n        this.gameState.isPaused = false;\r\n        this.isRoundInProgress = false;\r\n        this.gameWinner = null;\r\n        this.roundWinner = null;\r\n\r\n        this.gameState.gameMaxWins = GAME.MAX_WINS;\r\n        this.gameState.gameMaxPlayers = GAME.MAX_PLAYERS;\r\n\r\n        if (resetType === 'Room') {\r\n            this.lobbyManager.inLobby = false;\r\n            this.playerState.isHost = false;\r\n        }\r\n\r\n        // Clear all collections\r\n        this.playerState.players.clear();\r\n        this.combatController.projectiles.clear();\r\n        this.objectsManager.ammoBoxes.clear();\r\n        this.decalsManager.dynamicDecals.clear();\r\n        this.particlesManager.particles.clear();\r\n        this.particlesManager.emitters.clear();\r\n        this.particlesManager.shrapnel.clear();\r\n        this.upgradeManager.upgradesCompleted.clear();\r\n\r\n        this.ui.ammoReservesUIController.reserveBulletParticles = [];\r\n\r\n        if (resetType === 'Room') {\r\n            this.lobbyManager.lobbyPlayers.clear();\r\n        }\r\n\r\n        // Reset UI and player\r\n        this.renderingManager.clearCtx();\r\n        this.chatManager.clearChat();\r\n        this.ui.clearLeaderboard();\r\n        this.playerState.resetPlayerState();\r\n        this.playerState.initPlayer(this.userId);\r\n        this.controlsManager.clearActiveKeys();\r\n        this.animator.clearAllAnimations();\r\n\r\n        this.utility.clearTimeoutCache();\r\n\r\n        // Reset upgrades and equipment\r\n        this.upgradeManager.resetUpgrades(this.playerState.myPlayer);\r\n    }\r\n    //\r\n    // #endregion\r\n    //\r\n    //\r\n    //\r\n    //\r\n    //\r\n    //\r\n    // #region [ Actions / Inputs ]\r\n    //\r\n    /**\r\n     * Provides polling for inputs and keybinds - checking for any actions assigned.\r\n     */\r\n    private watchForInputs(): void {\r\n        const poll = () => {\r\n            if (this.controlsManager.gamepadConnectionEnabled) {\r\n                this.controlsManager.pollGamepad();\r\n            }\r\n            this.checkActions();\r\n            requestAnimationFrame(poll);\r\n        };\r\n        poll();\r\n    }\r\n\r\n    /**\r\n     * Checks for keybinds and input actions during polling.\r\n     */\r\n    public checkActions(): void {\r\n        // TODO: MAYBE add menu navigation with keyboard/gamepad here\r\n\r\n        if (!this.gameState.gameInProgress || this.gameState.isPaused) return;\r\n\r\n        const keybinds = this.settingsManager.getSettings().controls.keybinds;\r\n\r\n        if (this.controlsManager.triggered(keybinds.dash)) {\r\n            this.dashController.startDash();\r\n        }\r\n\r\n        if (this.controlsManager.triggered(keybinds.melee)) {\r\n            if (this.combatController.canMelee()) {\r\n                this.combatController.triggerAttack('melee');\r\n            }\r\n        }\r\n\r\n        if (this.controlsManager.triggered(keybinds.reload)) {\r\n            this.combatController.startReload();\r\n        }\r\n\r\n        if (this.controlsManager.held(keybinds.sprint)) {\r\n            if (this.moveController.isMoving()) {\r\n                this.playerState.isSprinting = true;\r\n            }\r\n        } else {\r\n            this.playerState.isSprinting = false;\r\n        }\r\n\r\n        if (this.controlsManager.triggered(keybinds.attack)) {\r\n            if (this.playerState.canShoot && !this.playerState.isBurstActive && !this.playerState.isMelee) {\r\n                this.combatController.triggerAttack('ranged');\r\n            }\r\n        }\r\n\r\n        if (this.controlsManager.held(keybinds.attack) && this.playerState.canAutoFire) {\r\n            this.combatController.triggerAttack('ranged');\r\n        }\r\n\r\n        const gamepadRAxis = this.controlsManager.getGamepadRAxis();\r\n        if (gamepadRAxis !== null) {\r\n            this.animator.rotateCharacterPart(this.userId, gamepadRAxis);\r\n        }\r\n\r\n        this.controlsManager.updatePreviousKeys();\r\n    }\r\n    //\r\n    // #endregion\r\n    //\r\n    //\r\n    //\r\n    //\r\n    //\r\n    //\r\n    // #region [ Upgrades ]\r\n    //\r\n    /**\r\n     * Start the upgrade phase by showing the relative UI for winners/losers.\r\n     */\r\n    private startUpgradePhase(winnerId: string | null): void {\r\n        console.log('Starting upgrade phase...');\r\n\r\n        this.upgradeManager.upgradesCompleted.clear(); // Reset upgrade tracking\r\n\r\n        const numUpgrades = 2; // TODO: This could change based on upgrades or other factors\r\n\r\n        // Show upgrade UI based on if I won or lost\r\n        if (winnerId === this.userId) {\r\n            this.showWinnerWaitScreen();\r\n        } else {\r\n            this.showUpgradeSelection(numUpgrades);\r\n        }\r\n    }\r\n\r\n    // [ Winner ]\r\n    //\r\n    /**\r\n     * Show the winner waiting screen.\r\n     * \r\n     * This screen will persist until all losers in the game finish picking upgrades.\r\n     */\r\n    private showWinnerWaitScreen(): void {\r\n        if (!this.ui.upgradeContainer) return;\r\n\r\n        this.ui.upgradeContainer.innerHTML = '';\r\n\r\n        const waitingDiv = document.createElement('div');\r\n        waitingDiv.className = 'upgrade_waiting';\r\n        waitingDiv.textContent = 'Waiting for other players...';\r\n\r\n        this.ui.upgradeContainer.appendChild(waitingDiv);\r\n        this.ui.upgradeContainer.style.display = 'flex';\r\n    }\r\n\r\n    /**\r\n     * Update winner waiting screen to show the continue button, which will conclude the round-end upgrade process.\r\n     */\r\n    private showWinnerContinueButton(): void {\r\n        if (!this.ui.upgradeContainer) return;\r\n        this.ui.upgradeContainer.innerHTML = '';\r\n\r\n        const waitingDiv = document.createElement('div');\r\n        waitingDiv.className = 'upgrade_waiting';\r\n        waitingDiv.textContent = 'Upgrade phase complete.';\r\n\r\n        const continueBtn = document.createElement('button');\r\n        continueBtn.textContent = 'Continue';\r\n        continueBtn.onclick = () => {\r\n            if (!this.ui.upgradeContainer) return;\r\n            console.log(\"Winner pressed continue...\");\r\n\r\n            this.ui.upgradeContainer.style.display = 'none';\r\n\r\n            this.utility.safeTimeout(() => {\r\n                this.startNewRound();\r\n            }, GAME.NEW_ROUND_DELAY);\r\n        };\r\n\r\n        this.ui.upgradeContainer.appendChild(waitingDiv);\r\n        this.ui.upgradeContainer.appendChild(continueBtn);\r\n        this.ui.upgradeContainer.style.display = 'flex';\r\n    }\r\n\r\n    // [ Losers ]\r\n    //\r\n    /**\r\n     * Displays the upgrade selection screen for losers during the upgrade phase.\r\n     */\r\n    private showUpgradeSelection(amount: number): void {\r\n        if (!this.ui.upgradeContainer) return;\r\n\r\n        this.ui.upgradeContainer.innerHTML = '';\r\n\r\n        // Get 3 random upgrades\r\n        const availableUpgrades = this.upgradeManager.getUpgrades(amount, this.playerState.myPlayer);\r\n\r\n        availableUpgrades.forEach(upgrade => {\r\n            const upgradeDiv = document.createElement('div');\r\n            upgradeDiv.className = 'upgrade_card container';\r\n            upgradeDiv.setAttribute('data-rarity', upgrade.rarity.toString());\r\n\r\n            // Create image element\r\n            const imageDiv = document.createElement('div');\r\n            imageDiv.className = 'upgrade_image';\r\n\r\n            const img = document.createElement('img');\r\n            img.src = upgrade.icon;\r\n            img.alt = upgrade.name;\r\n            img.className = 'upgrade_icon';\r\n\r\n            // Handle image load errors\r\n            img.onerror = () => {\r\n                console.warn(`Failed to load upgrade image: ${upgrade.icon}`);\r\n                img.style.display = 'none';\r\n            };\r\n\r\n            imageDiv.appendChild(img);\r\n\r\n            const nameDiv = document.createElement('div');\r\n            nameDiv.className = 'upgrade_name';\r\n            nameDiv.textContent = upgrade.name;\r\n\r\n            const subtitleDiv = document.createElement('div');\r\n            subtitleDiv.className = 'upgrade_subtitle';\r\n            subtitleDiv.textContent = upgrade.subtitle;\r\n\r\n            upgradeDiv.appendChild(imageDiv);\r\n            upgradeDiv.appendChild(nameDiv);\r\n            upgradeDiv.appendChild(subtitleDiv);\r\n\r\n            upgradeDiv.addEventListener('click', () => {\r\n                console.log(\"Selected upgrade: \", upgrade.name);\r\n                this.selectUpgrade(upgrade.id);\r\n            });\r\n\r\n            if (!this.ui.upgradeContainer) return;\r\n            this.ui.upgradeContainer.appendChild(upgradeDiv);\r\n        });\r\n\r\n        this.ui.upgradeContainer.style.display = 'flex';\r\n    }\r\n\r\n    /**\r\n     * Triggers on click when a loser selects an upgrade from their displayed options.\r\n     * \r\n     * Processes selection upgrade and sends a network message to inform others of the action.\r\n     */\r\n    private selectUpgrade(upgradeId: string): void {\r\n        const success = this.upgradeManager.applyUpgrade(upgradeId, this.playerState.myPlayer);\r\n        if (!success) {\r\n            console.error('Failed to apply upgrade'); // Maybe two people picked same one, (apply upgrade checks uniques)\r\n            return;\r\n        }\r\n\r\n        this.finishUpgrade(upgradeId);\r\n    }\r\n\r\n    /**\r\n     * Closes upgrade loop for loser once they have selected an upgrade.\r\n     */\r\n    private finishUpgrade(selectedUpgradeId: string): void {\r\n        if (this.ui.upgradeContainer) { // Hide upgrade UI\r\n            this.ui.upgradeContainer.style.display = 'none';\r\n        }\r\n\r\n        this.roomManager.sendMessage(JSON.stringify({\r\n            type: 'upgrade-taken',\r\n            upgradeId: selectedUpgradeId,\r\n            userId: this.userId,\r\n            isUnique: this.upgradeManager.upgrades.find(u => u.id === selectedUpgradeId)?.unique || false\r\n        }));\r\n\r\n        // [ IMPORTANT ] Keep full track of Player object here\r\n        this.roomManager.sendMessage(JSON.stringify({\r\n            type: 'player-state',\r\n            id: this.playerState.myPlayer.id,\r\n            timestamp: this.playerState.myPlayer.timestamp,\r\n            color: this.playerState.myPlayer.color,\r\n            transform: {\r\n                pos: {\r\n                    x: this.playerState.myPlayer.transform.pos.x,\r\n                    y: this.playerState.myPlayer.transform.pos.y,\r\n                },\r\n                rot: this.playerState.myPlayer.transform.rot\r\n            },\r\n            actions: {\r\n                dash: {\r\n                    cooldown: this.playerState.myPlayer.actions.dash.cooldown,\r\n                    drain: this.playerState.myPlayer.actions.dash.drain,\r\n                    multiplier: this.playerState.myPlayer.actions.dash.multiplier,\r\n                    time: this.playerState.myPlayer.actions.dash.time\r\n                },\r\n                melee: {\r\n                    cooldown: this.playerState.myPlayer.actions.melee.cooldown,\r\n                    damage: this.playerState.myPlayer.actions.melee.damage,\r\n                    duration: this.playerState.myPlayer.actions.melee.duration,\r\n                    range: this.playerState.myPlayer.actions.melee.range,\r\n                    size: this.playerState.myPlayer.actions.melee.size\r\n                },\r\n                primary: {\r\n                    buffer: this.playerState.myPlayer.actions.primary.buffer,\r\n                    burst: {\r\n                        amount: this.playerState.myPlayer.actions.primary.burst.amount,\r\n                        delay: this.playerState.myPlayer.actions.primary.burst.delay\r\n                    },\r\n                    magazine: {\r\n                        currentAmmo: this.playerState.myPlayer.actions.primary.magazine.currentAmmo,\r\n                        currentReserve: this.playerState.myPlayer.actions.primary.magazine.currentReserve,\r\n                        maxReserve: this.playerState.myPlayer.actions.primary.magazine.maxReserve,\r\n                        size: this.playerState.myPlayer.actions.primary.magazine.size\r\n                    },\r\n                    offset: this.playerState.myPlayer.actions.primary.offset,\r\n                    projectile: {\r\n                        amount: this.playerState.myPlayer.actions.primary.projectile.amount,\r\n                        color: this.playerState.myPlayer.actions.primary.projectile.color,\r\n                        damage: this.playerState.myPlayer.actions.primary.projectile.damage,\r\n                        length: this.playerState.myPlayer.actions.primary.projectile.length,\r\n                        range: this.playerState.myPlayer.actions.primary.projectile.range,\r\n                        size: this.playerState.myPlayer.actions.primary.projectile.size,\r\n                        speed: this.playerState.myPlayer.actions.primary.projectile.speed,\r\n                        spread: this.playerState.myPlayer.actions.primary.projectile.spread\r\n                    },\r\n                    reload: {\r\n                        time: this.playerState.myPlayer.actions.primary.reload.time\r\n                    }\r\n                },\r\n                sprint: {\r\n                    drain: this.playerState.myPlayer.actions.sprint.drain,\r\n                    multiplier: this.playerState.myPlayer.actions.sprint.multiplier\r\n                }\r\n            },\r\n            equipment: this.playerState.myPlayer.equipment,\r\n            flags: {\r\n                hidden: this.playerState.myPlayer.flags.hidden,\r\n                invulnerable: this.playerState.myPlayer.flags.invulnerable\r\n            },\r\n            inventory: {\r\n                primary: this.playerState.myPlayer.inventory.primary,\r\n                melee: this.playerState.myPlayer.inventory.melee\r\n            },\r\n            physics: {\r\n                acceleration: this.playerState.myPlayer.physics.acceleration,\r\n                friction: this.playerState.myPlayer.physics.friction\r\n            },\r\n            rig: {\r\n                body: this.playerState.myPlayer.rig.body,\r\n                head: this.playerState.myPlayer.rig.head,\r\n                headwear: this.playerState.myPlayer.rig.headwear,\r\n                weapon: this.playerState.myPlayer.rig.weapon\r\n            },\r\n            stats: {\r\n                defense: this.playerState.myPlayer.stats.defense,\r\n                health: {\r\n                    max: this.playerState.myPlayer.stats.health.max,\r\n                    value: this.playerState.myPlayer.stats.health.max\r\n                },\r\n                luck: this.playerState.myPlayer.stats.luck,\r\n                size: this.playerState.myPlayer.stats.size,\r\n                speed: this.playerState.myPlayer.stats.speed,\r\n                stamina: {\r\n                    max: this.playerState.myPlayer.stats.stamina.max,\r\n                    recovery: {\r\n                        delay: this.playerState.myPlayer.stats.stamina.recovery.delay,\r\n                        rate: this.playerState.myPlayer.stats.stamina.recovery.rate\r\n                    },\r\n                    value: this.playerState.myPlayer.stats.stamina.max\r\n                }\r\n            },\r\n            unique: this.playerState.myPlayer.unique\r\n        }));\r\n\r\n        console.log('Upgrade selected, waiting for others...');\r\n    }\r\n    //\r\n    // #endregion\r\n}\r\n\r\n// Initialize the game client\r\nif (document.readyState === 'loading') {\r\n    document.addEventListener('DOMContentLoaded', () => {\r\n        new Client();\r\n    });\r\n} else {\r\n    new Client();\r\n}\r\n"],"names":["map","webpackContext","req","id","webpackContextResolve","__webpack_require__","o","e","Error","code","keys","Object","resolve","module","exports","create","params","name","subtitle","icon","type","UNIQUE","rarity","SUPERIOR","unique","func","player","includes","push","LEGENDARY","NoiseType","UpgradeRarity","UpgradeType","PhysicsMaterialTypes","STAT","UNCOMMON","playerState","updateStat","stats","health","max","COMMON","speed","actions","dash","cooldown","RARE","SPECIAL","EXCEPTIONAL","time","stamina","recovery","rate","delay","primary","projectile","damage","buffer","EQUIPMENT","equipment","spread","RESOURCE","magazine","currentReserve","ui","ammoReservesUIController","spawnAmmoInReserveUI","__webpack_module_cache__","moduleId","cachedModule","undefined","__webpack_modules__","d","definition","key","defineProperty","enumerable","get","obj","prop","prototype","hasOwnProperty","call","r","Symbol","toStringTag","value","OBJECT_DEFAULTS","SHRAPNEL","AMMO_BOX","BASE","BULLETS","LID","WORLD","CANVAS","GAMEPAD_MAP","A","B","X","Y","LB","RB","LT","RT","SELECT","START","L_STICK","R_STICK","DPAD_UP","DPAD_DOWN","DPAD_LEFT","DPAD_RIGHT","HOME","AXES","LEFT_STICK_X","LEFT_STICK_Y","RIGHT_STICK_X","RIGHT_STICK_Y","GAME","CHARACTER_SIZE","CONNECTION_TIMEOUT","CONTROLS","KEYBINDS","MELEE","MOVE_UP","MOVE_LEFT","MOVE_DOWN","MOVE_RIGHT","RELOAD","SPRINT","ATTACK","DASH","GAMEPAD","DEADZONE","GAME_END_DELAY","GRAPHICS","PHYSICS","AMMORESERVES","STATIC_OVERLAY","BACKGROUND_PARTICLES","MAX_PLAYERS","MAX_WINS","RECONNECT_DELAY","ROUND_END_DELAY","NEW_ROUND_DELAY","ADMIN_KEYS","KEYS","REQUIRED_COUNT","Admin","constructor","cacheManager","adminKeysHeld","Set","this","initKeyListener","initConsoleKeybinds","window","addEventListener","add","checkAdminCombo","delete","every","has","size","clear","showAdminModal","modal","modalInput","modalConfirmButton","modalCancelButton","modalErrorDiv","modalText","classList","remove","style","display","textContent","focus","onclick","trim","command","split","executeAdminCommand","closeModal","console","log","onAdminCommand","document","getModifierState","preventDefault","clearCacheCommand","then","location","reload","Animator","roomManager","userId","characterAnimations","Map","characterOffsets","animateCharacterPart","generateCharacterAnimation","sendMessage","JSON","stringify","rotateCharacterPart","playerId","rotation","myPlayer","transform","rot","players","now","Date","Math","abs","lastSentRotation","lastSentRotationTime","animateCharacterPartNetwork","part","frames","duration","partIndex","animationId","set","startTime","originalOffset","x","y","updateCharacterAnimations","delta","animationsToRemove","currentTime","forEach","animation","progress","frameKeys","Number","sort","a","b","lerpedX","lerpedY","currentFrameIndex","i","length","frameProgress","nextFrameProgress","lastFrame","currentFrame","nextFrame","clearAllAnimations","AudioPool","poolSize","maxConcurrent","pools","activeAudio","createPool","src","pool","audio","Audio","preload","returnToPool","active","index","indexOf","splice","getAudio","pop","volume","playbackRate","loop","preloadSound","AudioManager","audioConfig","settingsManager","utility","audioPool","settings","playAudio","warn","min","random","blend","spatial","pos","dx","listener","dy","distance","sqrt","distanceVolume","rolloff","rolloffType","factor","maxDistance","referenceDistance","normalizedDistance","pow","outputGroup","output","toLowerCase","mixer","getSettings","master","pitch","delayMs","safeTimeout","play","catch","error","playAudioNetwork","preloadAudioAssets","sfx","extension","preloadSFX","Array","isArray","endsWith","CacheManager","dbName","dbVersion","db","initDB","Promise","reject","request","indexedDB","open","onerror","onsuccess","result","onupgradeneeded","event","target","objectStoreNames","contains","createObjectStore","write","transaction","objectStore","put","read","CharacterConfig","weapon","glock","knife","empty","full","body","default","head","blondeAfro","headwear","fez","strawHat","trucker","upgrades","kineticBrain","characterDecals","blood","gore","CharacterManager","charConfig","getCharacterAsset","layer","variant","getUpgradeVisual","upgradeName","lowerName","ChatManager","sendChatMessage","chatInput","message","alert","timestamp","displayChatMessage","senderId","isOwn","chatMessages","messageDiv","createElement","className","senderSpan","contentSpan","appendChild","scrollTop","scrollHeight","children","removeChild","firstChild","clearChat","innerHTML","ControlsManager","activeKeys","gamepadKeys","previousKeys","mousePos","gamepadConnected","gamepadConnectionEnabled","gamepadRAxis","initGamepad","held","triggered","getActiveKeys","addKey","removeKey","clearActiveKeys","updatePreviousKeys","getMousePos","setMousePos","pollGamepad","gamepad","navigator","getGamepads","keybinds","controls","gamepadMap","deadzone","xAxis","axes","yAxis","moveRight","moveLeft","moveDown","moveUp","buttons","melee","pressed","attack","sprint","rightX","rightY","aimMagnitude","atan2","PI","getGamepadRAxis","CollisionsManager","objectsManager","checkCollisions","checkObjectCollisions","checkPlayersCollisions","collisionsEnabled","collisionRadius","getPlayerCollider","ammoBoxes","ammoBox","boxId","isOpen","maxReserve","actualAmmoAdded","ammoAmount","angle","lid","velocity","cos","sin","torque","ammoBoxId","boxState","dist","minDist","overlap","pushX","pushY","padding","col","flags","hidden","invulnerable","DecalsConfig","decals","radius","density","opacity","variation","colors","explosion","DecalsManager","camera","dynamicDecals","staticDecalData","decalsConfig","createDecal","generateDecal","createDecalNetwork","decalCtx","parametric","generateParametricDecal","image","generateImageDecal","numPixels","floor","save","globalCompositeOperation","pixelX","pixelY","chosenColor","rgb","hexToRgb","pixelOpacity","clampedOpacity","fillStyle","g","fillRect","restore","Image","drawImage","complete","naturalWidth","translate","rotate","drawSize","scale","onload","bakeDecals","currentBaked","getImageData","data","alpha","newAlpha","oldAlpha","clearRect","renderBakedDecals","putImageData","spawnMagazineDecal","setTimeout","currentAmmo","magazineSrc","getRandomNum","decalParams","EventsManager","animator","chatManager","controlsManager","gameState","roomController","initEventListeners","canvas","hostButton","joinButton","quickplayButton","lobbyLeaveButton","lobbyCodeButton","gameLeaveButton","gameCodeButton","startGameBtn","chatSendBtn","hostRoom","joinRoom","quickPlay","leaveRoom","copyRoomCode","onStartButtonClick","shiftKey","canShoot","isSprinting","isDashing","isBurstActive","currentBurstShot","settingsButton","showSettingsPage","settingsCloseButton","hideSettingsPage","onKeyDown","onKeyUp","onMouseUp","onMouseMove","onMouseDown","switchSettingsPage","controlsTab","graphicsTab","soundTab","controlsBody","graphicsBody","soundBody","initSettingsAudioSliders","initSettingsInputListeners","initSettingsToggleListeners","activeElement","gameInProgress","isPaused","values","button","updateMouse","worldMousePos","screenToWorld","targetRotation","intensity","currentRotation","newRotation","rect","getBoundingClientRect","clientX","left","clientY","top","CustomEvent","dispatchEvent","slider","masterSlider","fill","masterFill","masterValue","channel","interfaceSlider","interfaceFill","interfaceValue","musicSlider","musicFill","musicValue","sfxSlider","sfxFill","sfxValue","voiceSlider","voiceFill","voiceValue","handleMove","moveEvent","sliderValue","calculateSliderValue","updateSettingsSlider","updateSettings","handleUp","removeEventListener","input","deadzoneInput","settingPath","parse","parseFloat","rawValue","parsedValue","isNaN","pathParts","update","current","toggle","particleJSToggle","staticVfxToggle","ammoReservesPhysicsToggle","newValue","getAttribute","setAttribute","removeAttribute","initKeybindListeners","controlsSettings","initKeybindsInterface","action","newBinding","onBindingChange","element","getElementById","toUpperCase","buttonName","find","toString","GameState","gameMaxWins","gameMaxPlayers","LobbyManager","characterManager","playerConfig","inLobby","lobbyPlayers","charCustomizeHandlers","showLobbyControls","lobby","lobbyOptions","roomId","isHost","maxWins","privateRoom","upgradesEnabled","updateDisplay","centerX","charCustomizeCanvas","width","centerY","height","color","rig","setupLobbyOptions","winsInputParams","inputId","privateToggleParams","toggleId","upgradesToggleParams","setToggle","setInput","displayLobbyPlayers","updateHostDisplay","setupCharacterCustomization","setupLobbyToggle","val","setupLobbyInput","maxPlayers","elementProp","messageKey","getter","setter","handlerKey","handler","toggleParams","parseInt","inputParams","syncLobbyOptions","options","syncOption","bind","v","elementId","fn","label","format","displayValue","promotePlayer","targetPlayerId","kickPlayer","bodyArrowLeft","bodyArrowRight","headArrowLeft","headArrowRight","headwearArrowLeft","headwearArrowRight","addHandler","cycleRigVariant","rigProp","direction","myLobbyPlayer","allVariants","currentVariant","newIndex","ParticlesConfig","particles","drip","count","lifetime","noise","strength","sizeOverLifetime","collide","fade","paint","stain","spray","muzzle","smoke","flash","shell","sparks","ParticlesManager","collisionsManager","decalsManager","renderingManager","emitters","shrapnel","particlesConfig","createParticles","generateParticles","createParticlesNetwork","particleParams","noiseStrength","noiseScale","getRandomInArray","particle","age","hasCollided","initialSize","maxOpacity","updateParticles","particlesToRemove","noiseX","simplexNoise2D","noiseY","ageRatio","stampParticle","extendedLifeRatio","speedReduction","lifetimeExtension","drawParticles","ctx","isVisible","screenPos","worldToScreen","globalAlpha","createEmitter","generateEmitter","interval","offset","particleType","offsetX","offsetY","emissionInterval","lastEmission","updateEmitters","emittersToRemove","emitter","emitterId","worldX","worldY","coneSpread","randomSpread","baseSpeed","speedVariation","finalSpeed","generateGore","gorePool","amount","goreAsset","goreDecal","decalId","ownerId","stampGore","bloodPool","bloodAsset","bloodDecal","characterImages","spawnShrapnel","pieces","piece","generateUID","images","rotationSpeed","generateShrapnel","updateShrapnel","shrapnelToRemove","actualDamage","defense","newHealth","shooterId","source","wasKill","detail","stampShrapnel","drawShrapnel","RenderingManager","charManager","lobbyManager","ammoBoxImages","clearCtx","customCtx","drawCharacter","context","renderUniqueEffects","font","textAlign","displayName","substring","fillText","idOffset","drawCharacterLayers","drawCharacterLayer","drawUpgradeLayers","assets","drawCharacterPart","assetPath","partType","renderLobbyPlayer","shouldApplyCamera","posX","posY","animationOffset","uniqueName","equipmentName","renderSpectralImage","staticGhosts","_spectralGhosts","lastHidden","flashes","wasHidden","isHidden","t","ghost","filter","ghostPlayer","getContext","drawObjects","layers","img","drawProjectile","dirX","dirY","frontX","frontY","backX","backY","strokeStyle","lineWidth","lineCap","beginPath","moveTo","lineTo","stroke","RoomController","upgradeManager","wsManager","showRoomControls","getWebSocket","createRoom","isPrivateRoom","isUpgradesEnabled","connectWebSocket","showJoinRoomModal","joinRoomById","fetch","response","ok","json","modalContent","modalButtons","resetType","checkForRoomInURL","getRoomIdFromURL","URLSearchParams","search","roomIdDisplay","gameRoomIdDisplay","clipboard","writeText","RoomManager","currentRoom","ws","messageHandlers","setWebSocket","setupMessageHandler","readyState","WebSocket","OPEN","send","generateLink","history","pushState","origin","text","sendAdminCommand","getCurrentRoom","getRoomLink","param","onMessage","onmessage","plainMessage","SettingsManager","gameSettings","initSettings","interface","music","voice","graphics","physics","ammoReserves","renderBackgroundParticles","showStaticOverlay","merge","loadSettings","cached","upgradeFiles","resource","UpgradeManager","takenUniques","upgradesCompleted","rarityConfig","weight","MYTHICAL","ENLIGHTENED","HOLY","initUpgrades","filename","upgrade","getUpgrades","availableUpgrades","selected","totalWeight","reduce","sum","getRarityWeight","selectedUpgrade","applyUpgrade","upgradeId","u","hasEquipment","removeUpgradeFromPool","resetUpgrades","equipmentId","hasUnique","uniqueId","getRarityColor","AmmoReservesUIController","ammoReserveIcon","projectileIcon","reserveBulletParticles","initAmmoReserveCanvas","renderAmmoReserves","requestAnimationFrame","updateAmmoReservePhysics","ammoReservesCtx","physicsEnabled","collisionHeight","collisionWidth","collisionX","collisionY","getAmmoReserveCollisionZone","vx","vy","removeAmmoFromReserveUI","shift","ammoReservesCanvas","bullet","j","ax","ay","va","vb","avg","UserInterface","decalCanvas","worldCanvas","worldCtx","gameContainer","gameOptionsContainer","lobbyContainer","roomControls","upgradeContainer","lobbyPlayersList","userIdDisplay","playersInput","privateToggle","upgradesToggle","winsInput","chatContainer","charCustomizeContainer","charCustomizeCtx","leaderboard","leaderboardBody","leaderboardContainer","settingsContainer","accuracyStat","damageStat","luckStat","rangeStat","shotSpeedStat","speedStat","initInterfaceListeners","initInterface","clearDisplay","gameRoomId","disabled","from","playerDiv","colorDiv","backgroundColor","nameDiv","controlsDiv","promoteBtn","kickBtn","onkeydown","onConfirm","url","URL","pathname","startsWith","replace","soloGameWarning","page","fillElement","valueElement","percentage","round","sliderElement","mouseX","position","initSoundSliders","audioSettings","initSettingsInputs","initSettingsToggles","showRebindModal","buttonValue","onRebind","duplicateWarnings","warningIndex","gamepads","some","gp","checkDuplicate","binding","entries","handleKeyPress","cleanup","newKey","handleMouseDown","stopPropagation","mouseKey","handleGamepadPress","createLeaderboard","allPlayers","_","wins","kills","deaths","updateLeaderboardDisplay","localPlayer","entryA","entryB","entry","row","nameCell","winsCell","killsCell","deathsCell","clearLeaderboard","animTime","steps","increaseColor","decreaseColor","timeout","onStatChange","oldValue","isIncrease","animateTextInElement","decimals","Utility","lastFrameTime","performance","simplexTable","generateSimplexTable","activeTimeouts","deepMerge","yield","deltaTime","callback","clearTimeoutCache","clearTimeout","toFixed","getRandomInt","array","getShuffledArray","slice","getDotProduct","v1","v2","getReflection","normal","dot","forward","getDirection","targetPos","rootPos","getRandomDirection","degrees","randomAngle","getRandomColor","hexColor","mode","primaries","padStart","channels","dr","dg","lr","lg","lb","gray","getLightestColor","lightestColor","maxBrightness","brightness","hex","exec","table","Uint8Array","k","override","perm","F2","G2","s","x0","y0","i1","j1","x1","y1","x2","y2","ii","jj","gi0","gi1","gi2","grad3","t0","t1","t2","getNoise","noiseType","seed","Perlin","perlinNoise","octaves","persistence","Ridged","ridgedNoise","Worley","worleyNoise","Voronoi","voronoiNoise","total","frequency","amplitude","maxValue","interpolateNoise","pointsPerCell","cellX","cellY","Infinity","cx","cy","p","hash2D","normalize","n","hash","ix","fx","iy","fy","v3","v4","sx","smoothstep","sy","lerp","i2","prefix","chars","base","inputElement","setSlider","sliderId","targetValue","lerpTime","sliderContainer","sliderFill","querySelector","targetPercentage","currentWidthStr","currentPercentage","transition","setSpan","spanElement","spanId","increment","stepTime","currentStep","currentValue","setInterval","clearInterval","WebsocketManager","wsProtocol","protocol","wsHost","port","hostname","host","onopen","onclose","CombatController","audioManager","luckController","particlesManager","playerController","world","projectiles","triggerAttack","startMelee","startBurst","updateAttack","isReloading","reloadStartTime","finishReload","nextBurstShotTime","ammoNeeded","burst","targetDir","triggerBurstUniques","launchProjectile","canMelee","isMelee","lastMeleeTime","inventory","range","spawnOffset","spawnX","spawnY","meleeProjectile","distanceTraveled","lastShotTime","ammoToUse","resources","emptyBlend","blendVolume","dir","overrides","canTriggerUnique","projectileAmount","projectileColor","projectileDamage","projectileLength","projectileRange","projectileSize","projectileSpeed","projectileSpread","baseAngle","bulletSpawnX","bulletSpawnY","muzzleParams","smokeParams","shellParams","shuffledUniques","luckRoll","triggerUnique","updateProjectiles","projectilesToRemove","aim","lerpFactor","lx","ly","norm","frameDistance","playerCollider","reflected","projectileId","newOwnerId","playerHit","dx2","dy2","impactX","impactY","triggerCollisionUniques","sparksParams","sfxParams","impact","metal","worldEdit","requestCraterAt","toggleAutoFire","canAutoFire","cachedBuffer","angleOffset","dirA","dirB","baseParams","succeededUniques","canReload","startReload","start","magazineSpace","ammoToReload","end","DashController","combatController","moveController","staminaController","startDash","isMoving","lastDashTime","inputX","inputY","inputLength","getMoveInput","requestStamina","drain","dashStartTime","dashSpeed","multiplier","playerVelocityX","playerVelocityY","updateDash","newX","newY","moved","distanceFromLastSent","lastSentX","lastSentY","lastSentMoveTime","LuckController","effectiveLuck","luck","chance","tanh","MoveController","ObjectsManager","spawnObject","baseObject","spawnAmmoBox","PlayerController","setupEventListeners","updatePlayerPosition","currentSpeed","friction","targetVelocityX","targetVelocityY","acceleration","healthSliderParams","gruntParams","male","grunt","flesh","bloodDirection","emission","me","other","targetId","playerDeath","triggerUniques","resetPlayerState","PlayerState","isStaminaRecoveryBlocked","lastStaminaDrainTime","staminaRecoveryBlockedUntil","statListeners","initPlayer","startingReserve","statPath","notifyChange","lastProp","StaminaController","updateStamina","staminaRecoveryPerFrame","PlayerConfig","idLength","AudioConfig","preloadSounds","Camera","config","followSpeed","lookAhead","playerRot","forwardDir","worldPos","margin","WorldChunk","biomeName","sourcePixels","sourceHeights","sourceWater","worldConfig","version","pixelData","heightData","waterData","chosenBiomeName","getColorAt","localX","localY","chunkSize","combinedIndex","materialIndex","colorVariantIndex","materials","getHeightAt","getWaterAt","WorldConfig","worldgenParams","general","chunk","cell","island","valley","terrain","heightCurve","seaLevel","lowestDepth","material","colorVariation","degen","minHeight","threshold","hardness","hydration","render","water","opacityBase","opacityMultiplier","foamIntensity","foamScale","shoreBlend","shimmerStrength","depthDarkness","grid","enabled","chunkBorderColor","worldBorderColor","layerBorderColor","borderWidth","worldLayers","foundation","substrate","sediment","alluvium","soil","topsoil","cliffs","mountains","basalt","Solid","simulate","durability","bedrock","clay","dirt","granite","grass","gravel","ice","permafrost","loam","limestone","moss","peat","sand","sandstone","scree","shale","silt","slate","snow","stone","coal","iron","gold","silver","copper","wood","concrete","asphalt","Liquid","viscosity","WorldDebug","hoveredChunk","overlayMode","overlayNames","listenForDebugShortcuts","ctrlKey","altKey","showGenerationMenu","async","worldData","generateWorld","renderMenu","drawDebug","isGenerated","drawGrid","drawHeightmap","drawContours","drawInfoPanels","hoveredCoords","updateHoveredChunk","hcx","hcy","chunks","chunkLayer","chunkLayers","li","combined","height01","mat","getWaterData","currentX","mainInfo","drawPanel","materialColor","solidInfo","hasWater","phys","liquidInfo","depth","title","lines","titleBgColor","maxWidth","measureText","line","boxWidth","boxHeight","headerHeight","strokeRect","camX","camY","startCX","endCX","ceil","startCY","endCY","hoveredScreenX","hoveredScreenY","screenX","screenY","currentLayer","getChunkLayer","layerRight","layerBottom","vBorder","hBorder","lerpColor","stops","h","startX","startY","lower","upper","contourStep","getH","h00","h10","h01","h11","minH","maxH","level","interp","points","WorldEdit","bedrockIndex","idx","newPacked","renderChunk","networkChunk","cellData","worldPixelData","worldHeightData","worldWaterData","cellLayerGrid","World","currentSeed","erosionTemplate","chunkBuffer","worldBuffer","streamingComplete","YIELD_RATE","CHUNK_LOAD_RADIUS","WORLDGEN_PHASES","worldDebug","initLoadingProgressEvents","handleChunkUpdate","remoteChunk","existing","newChunk","worldgenMenu","showLoadingMenu","generateCells","degenCellData","applyDegen","hydratedCellData","applyHydration","bakeChunksFromCells","hideLoadingMenu","cellSize","allLayerKeys","allMaterialKeys","cellsX","cellsY","phaseMessages","randomMessage","totalCells","processedCells","adjustedHeight","mid","opts","distToEdgeX","distToEdgeY","distToEdge","maxDist","edgeNoise","layerForCell","pickLayerForHeight","layerIndex","pixelInfo","samplePixelData","landMatIndex","materialColorIndex","gi","materialNoise","m","selectedMaterial","detailNoise","best","bestDist","newPixelData","newHeightData","degenConfig","erosionMaterials","getErosionTemplate","processedPixels","wy","wx","originalHeight01","combinedNoise","erosionAmount","currentPacked","currentMatIndex","currentMat","newHeight01","newHeightByte","erosionDepth","originalDurability","allMaterials","harderMaterials","newMatIndex","newColorVariantIndex","normalizedDepth","detailForColor","numColors","allKeys","newWaterData","depthRange","totalPixels","depthT","waterLevel","allWorldLayers","chunksX","chunksY","totalChunks","startMessages","halfwayMessages","firstMessage","secondMessage","spawn","chunkCoords","progressMessagePoint","halfwayPoint","c","loaded","backgroundStreamAllChunks","chunkPixels","chunkHeights","chunkWater","layerCounts","startCellX","endCellX","startCellY","endCellY","cby","cbx","dominantIdx","dominantLayer","worldChunk","drawWorld","baseColor","finalColor","adjustPixelColor","renderWater","w","palette","depthRatio","waveNoise","ridge","foam","darkness","shade","scatter","nr","ng","nb","getMaterialAt","getPhysicsAt","container","header","popup","form","noiseTypeOptions","charAt","join","onsubmit","fd","FormData","num","int","menu","loadingMenu","msgEl","bar","newWidth","totalYieldSteps","yieldPerProcess","bakedChunks","loadChunk","streamUnloadedChunks","playerPos","loadRadius","Client","isRoundInProgress","roundWinner","gameWinner","admin","dashController","eventsManager","initClient","ammo","initGlobalEvents","spanParams","watchForInputs","startGame","resetGameState","handleRoomMessage","handleGameMessage","gameData","reason","newHostId","sliderLerpTime","hitPlayer","shooter","box","spawnMap","showGameControls","startGameLoop","winnerId","endRound","staminaSliderParams","resumeGame","isUnique","showWinnerContinueButton","returnToLobby","startNewRound","winnerEntry","endGame","pauseGame","startUpgradePhase","reservedSpawn","executeStartGame","gameLoop","dt","charRenderParams","myRenderParams","poll","checkActions","showWinnerWaitScreen","showUpgradeSelection","waitingDiv","continueBtn","upgradeDiv","imageDiv","alt","subtitleDiv","selectUpgrade","finishUpgrade","selectedUpgradeId"],"sourceRoot":""}